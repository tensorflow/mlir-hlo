// RUN: stablehlo-opt --chlo-pre-serialization-pipeline -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s | stablehlo-translate --serialize --target=current | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xf16>, tensor<20x20xf16>)
    %1 = call @expected() : () -> tensor<20x20xf16>
    %2 = chlo.next_after %0#0, %0#1 : tensor<20x20xf16>, tensor<20x20xf16> -> tensor<20x20xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<20x20xf16>, tensor<20x20xf16>) -> ()
    return %2 : tensor<20x20xf16>
  }
  func.func private @inputs() -> (tensor<20x20xf16> {mhlo.layout_mode = "default"}, tensor<20x20xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8E45293DEF3A1D40383BEFC4FDC35EBBACBA233C2243194059C6623AE03D6B41034700C4E441AE416F4765B83745B33DD23808C2AF3F3EBC5439583ABCBD88B9713D4C3E58BC31BDD23CD5C4F43E20C01FC093B4D0B4D93C2FC063385DBD6DBA1A3E9239052F2E3F2244293CCBC1F244F0421CBF4DB251452641433CC5C150BF0CBEB442943F003916BB75AEA244C5369A3933BA44C60CBCE93D02C6FB3861BC9BBF8B44CBA8BCBD763966BC5A3E94C277BD1F396139DA46C34009BC85C167BCD0C268B1B9C1344076395944CB41E53ECEC17042894586443DC06DC73B3745B56142AF3F713E2944D8C432BEE5C749C01D435EBC6E3D92C5F4BA7044C541423F553EDAB2F0C35A418EBDA2BDF6BCB0C1853C72300E3B54C08242A73FFD3541C3223B69C46640C6479EBFF6BF22354C4354C3FD41FD3B04C00E33CD386D3D643B66BC20BE3BB72240AB418EBE7243784198BC8E4494BB913E87B7194453468F43FA3A8F38CBC438BD19C483BA263E6ABA41B6FA38622AD23C7D4097B960268BBFFE26413D1F447B404B4376432C424838B0C050BE5FC36FB8EF3C2044C1B5F8BA1CC2C2BD86386343DEC1D6398147B7B605C2783EC4BB973812C0464421414B402C48134041B8EC3BB13CA04666C094C014C85E3F7BC3CFBEEA4430C70C48C241823ED63C6D3E7B39ECBFD9C2E242163F8A43CE4143B88A3655259343DEC21040243D884153C4CC3C74BE02A9F6B2F63F00BAB63E7D44753E623E1D2C1A4364C4BE3F9CB75EAE0A41CD46734196C7CEBA10C5AEC5E2418B42DEC1C2C3543819C36346E62AEEBC444788C3C3C231C3F840EE324CC514C5C74026445B43D73C1AC33D44CBC052B1CC4755BE18437F42E0C20DC401BAF4BA9E4273BC4040F73D7C411A460F40C03CD8413B387043F92ACB42823D8144F74499C0AA3CB9BD75BF0DC80B41423C1646A5C2F74098BFA3B17AB7DD4329BD3B30DBC0633C44B29D38AA3ED3C23743DE314C3B1C3A3930953C53C4B3C0744290BF0FC226B1ADC523425B3EED3E9EC27040D2C032BF59C4523CF1B21AC3C539123A34C39B47094138A9F5BC81C5CDBCF6C0774225B42244BB3BCDBEB84356B391C491C6F4BCBEBEA9C13A39"> : tensor<20x20xf16>
    %cst_0 = stablehlo.constant dense<"0x8C3B1E45734351C5FBB960AD17C054425ABBB4C40E38233DB744673F72BACA3F00C0C346F941EB3EAEBE8142BDC2962DD43DCB3849C08FB71B4068BDD6417D3CEDC301BB99BEBC3B6D3A8DC369BEFC3894C123C46DBD76BDB43FFA335842E840C5C020B662B85A3D143988B6702C11405EBE12C3324021BD2640D2BA82BF0C43383933410E3A66BC7848A5AE4BBFC2464FC53F4560C4F53DF9C53D3E6DBCDC396B42252E41C3F72F47C5293C3ABF4C415A47CA40422A01C17DC576B89E39B740D7C2AEC3DB42A8C1793AD737F83EF041CEBDEE4186BEA2416E4100C473BE1C3D48BF9C3D9F432B402AC1F5388942543B7C3E65421846B5411FC5FCC1B2350BC0F8444BC60D39513D5135C8BF9DBDE9BC7EC6E2C46F4425C606427C442547FB36DFBD734174C1104034C3FB3DF2BFF6402BB5D8C2D83D2344F9C443465F3B42BC36C418C235AD29C318BD7B414315FA3DE1C14D40073E75C44FC102BAFE3BDD34C73A024476C0CEC0AFBC0ABB25BF273BA3C7F53A62BEA5C0163F9845AA405CAA30BABF35DC435BC769BDAD397CB9D53E4C3D7B3FC22E2A38974214BF3EC4D144B3C3BCBF143597C37A469C4648C4E23DADC08D3F2C43BC3D4AC6F13D2D37D3BBD3434E449F4233C1EDC393C51DBC80C6C336974632BE2A3F144426C4B545B4C4C7C40D419DC491C3D2C1DB3B1DC3C242374339C2A6BE20B83F445F35F83E0EC0C43DC13D6B40543BF53E86BDB3B9463E3B3DA345813308C295BA243BB23CD1C5D64060C198BCD03D39BD5AC212B1943E7E47304262BC00C340B07F2576BCF93F0C4637C1E3C0703738C0AC41DE3F82421EB6434024BB3739F34551B817B4DCBAA2BAC640F23990C112BF643ED33F4C43584404BE07BC27C193BDAEBFBABCB1C0C84335B352C47BBC29C1D93534BFE4C073C35B41A2C284BAE0BF93C424C18040DFBC59BF973EBD3AFF3F2F2CEF4611BA8AC2173E6746D5C2914297BE2BC49E4045C6C1C103B96A44913C3F4000C1EC4154BE38C2FDBCED441BC2B3B54742D0C792B196BFA1C15A3156C1F4C491C21DC0C7C7E0B737348F3B0045CABCCF40633491439A3AD6BF6137B8C49F42DDBB2CC8B1B0903550433641E0C44FC165C4BBC2"> : tensor<20x20xf16>
    return %cst, %cst_0 : tensor<20x20xf16>, tensor<20x20xf16>
  }
  func.func private @expected() -> (tensor<20x20xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8D452A3DF03A1C40373BEEC4FCC35DBBADBA223C2143184058C6633ADF3D6A410247FFC3E541AD416E4764B83645B23DD33807C2AE3F3DBC5539573ABBBD87B9703D4B3E59BC30BDD13CD4C4F33E1FC020C094B4D1B4D83C2EC062385CBD6CBA193E9139042F2D3F2144283CCAC1F144EF421DBF4CB250452541423CC4C14FBF0BBEB342933FFF3815BB76AEA144C636993932BA43C60BBCE83D01C6FA3860BC9ABF8A44CCA8BBBD753965BC593E93C276BD20396039D946C24008BC84C166BCD1C269B1B8C1334077395844CA41E63ECDC16F42884585443CC06CC73A3744B56042AE3F723E2844D7C431BEE4C748C01C435DBC6F3D91C5F5BA6F44C441413F563EDBB2EFC359418DBDA3BDF7BCAFC1843C71300F3B55C08142A83FFE3540C3213B68C46540C5479FBFF5BF21354B4353C3FC41FE3B03C00D33CE386C3D633B67BC21BE3AB72140AA418DBE7143774199BC8D4493BB903E88B7184452468E43F93A9038CAC439BD18C484BA253E69BA42B6FB38612AD13C7C4096B961268ABFFD26403D1E447A404A4375432B424938AFC04FBE5EC36EB8F03C1F44C2B5F7BA1DC2C3BD85386243DDC1D7398047B6B604C2793EC3BB983813C0454420414A402B48144040B8EB3BB03C9F4665C095C013C85F3F7AC3CEBEE9442FC70B48C141813ED73C6C3E7A39EDBFD8C2E142173F8943CD4144B8893656259243DDC20F40253D874152C4CB3C73BE03A9F7B2F53FFFB9B73E7C44743E613E1E2C194365C4BF3F9DB75FAE0941CC46724195C7CDBA0FC5ADC5E1418A42DDC1C1C3533818C36246E52AEFBC434787C3C2C230C3F940ED324BC513C5C64027445A43D63C19C33C44CAC051B1CB4756BE17437E42DFC20CC402BAF5BA9D4274BC3F40F63D7B4119460E40BF3CD7413A386F43F82ACA42813D8044F64498C0A93CBABD76BF0CC80A41413C1546A4C2F64097BFA2B17BB7DC4328BD3C30DCC0643C45B29C38AB3ED4C23643DD314D3B1D3A3A30943C52C4B2C073428FBF0EC227B1ACC524425A3EEC3E9DC26F40D1C033BF5AC4513CF2B21BC3C439113A33C39A47084137A9F4BC80C5CCBCF5C0764226B42144BA3BCEBEB74355B390C490C6F5BCBFBEAAC13939"> : tensor<20x20xf16>
    return %cst : tensor<20x20xf16>
  }
}
