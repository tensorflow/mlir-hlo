// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %1 = call @expected() : () -> tensor<5x6x7xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<5x6x7xf32>, tensor<2x2x2xi64>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> ()
    return %2 : tensor<5x6x7xf32>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}, tensor<5x2x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8F134D4047C50FBB537BBFC08D0A48BF389E3C404A66D8BEBA15F23F1AD820C079C272401C493AC0783ED03FD68490BF9C4BC7BFF4E6E03E27C7D63FCFD90C40090DD2404999A03E271DA83F59F8A740EF4E3B4067CC4B405712313D8E8410BF46C2E4BE517A1A3FA652813E284441C07A3559400D1C25BEC8839EBFB8F91840BA2463C042EB5AC0954F99C0A3D604BFBCE5603EA5EEBCBF3D95A83E4B5D813F045E94408D2C063F30EADEBF420D8E40B93E04409B7A86C0C1EC01404AACB73FFE979D3F3DD716BEEE52ACC07FD5D0C07AC5E03F0B847F3F4257F8BF92840D40AD8A433D9837FABFFBFA1A3F976932C04C84F1BFBF674BC011F04FBFAD371AC03FE4C73F74C91B40CE878A4082101E406AE9A2400B8317404A6054BFEF30F03D847346C0E5AC8FC0689B99BF000284401042DB3FC66B454031041DC080494940CFB002C05F46F6BEB26266C08EF99240A24028C0808F5ABF610ABF3E8EC5BEC0697F26C0D853CDBF1233713FD99782C02D2A2B3E27030A40B8208E3D05745EBEB46FD5BEF9EFF0BE12DC1A40DEC10C3F504838409012AC40660C193F0F8D2940E8DFDEBEE9479C3E68EDC13E0F1FAE3F33E694BEA77EE3C0EF728EBF1DDCD03E0D60A93D76388AC01DA43FC0805A2E3FF9A746BEE3745CC014E3B13E7D78A6BFC3EE5B3F4E9EF8BE2526B23F0B79784094C3E13E7115FA3E774DB03F20087240EF6B56C0F6C9AE4022FAB73FBCDFA0C0EE4EEFBF488AA5BF1F8B29C006F81140CB98903D21C21EBF8268073F4002B5BFFDC8033E5872E8BF81D4C7406807B9C0333C3840DF92FCC064DF91C0A6847040C62064C075438440F59943C096DD163FE451873C81923FC04F2C9E3E51AF4F40FD4599BF7C17CBBF3D7DBFC0072A8B40205DF140142D3DC0B9771A40E2A786C03441A73FCE6CEEC0280B9CBF7BC683402C6192C062372FC0AAFF71BEBD9E203FBD0523C05F9D26C0600F39405C7C1340BE4D04C06372D83F3E5A4BBF62D0C9BF222A6840445721C0ABFB92C0D24E7A4072B5833F1452E0BE68FE9DBFD2B486C0148A16C003159F4002C4D43F46F202C169FC324047A68CBF57048BBFB391ADC03F4BAE40309F4FC092B375C0F75F5BC0C15F0340FF57AB400F82B63F4CD46BBDC67AB4BFF89850C07B176B40477D6A401DEA1F3F44EB8040"> : tensor<5x6x7xf32>
    %cst_0 = stablehlo.constant dense<[[[7.60194778, -0.606740891], [5.0216012, 1.75130713]], [[-4.04302549, -3.17711735], [0.889000535, 4.27793789]], [[4.67987537, 5.46739197], [-1.66563082, -0.314689904]], [[1.70092821, -0.0996990576], [-5.03606033, -6.83100367]], [[-2.04668713, 3.85292363], [0.00280787842, 0.163647234]]]> : tensor<5x2x2xf32>
    return %cst, %cst_0 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8F134D40F99D88BC537BBFC08D0A48BF389E3C404A66D8BEBA15F23F1AD820C079C27240231FA3C0783ED03FD68490BF9C4BC7BFF4E6E03E27C7D63FCFD90C40090DD24039E242BE271DA83F59F8A740EF4E3B4067CC4B405712313D8E8410BF46C2E4BE517A1A3FA652813E284441C0915788410D1C25BEC8839EBFB8F91840BA2463C042EB5AC0954F99C0A3D604BFBCE5603EA5EEBCBF3D95A83E4B5D813F045E94408D2C063F30EADEBF6B948FC1B93E04409B7A86C0C1EC01404AACB73FFE979D3F3DD716BEEE52ACC03D58DFC17AC5E03F0B847F3F4257F8BF92840D40AD8A433D9837FABFFBFA1A3F97B50D414C84F1BFBF674BC011F04FBFAD371AC03FE4C73F74C91B40CE878A4082101E406AE9A2400B83174070CD3CBFEF30F03D847346C0E5AC8FC0689B99BF000284401042DB3FC66B454031041DC080494940CFB002C05F46F6BEB26266C08EF99240A24028C083B57FC0610ABF3E8EC5BEC0697F26C0D853CDBF1233713FD99782C02D2A2B3E6EB92DBFB8208E3D05745EBEB46FD5BEF9EFF0BE12DC1A40DEC10C3F504838406C32EB41660C193F0F8D2940E8DFDEBEE9479C3E68EDC13E0F1FAE3F33E694BEA77EE3C0EF728EBF1DDCD03EEB0E0DBE76388AC01DA43FC0805A2E3FF9A746BEE3745CC014E3B13E7D78A6BFC3EE5B3F4E9EF8BE2526B23F0B79784094C3E13E7115FA3E774DB03FDDD6CD40EF6B56C0F6C9AE4022FAB73FBCDFA0C0EE4EEFBF488AA5BF1F8B29C0474779C1CB98903D21C21EBF8268073F4002B5BFFDC8033E5872E8BF81D4C740E393133F333C3840DF92FCC064DF91C0A6847040C62064C075438440F59943C096DD163FE451873C81923FC06D24C7BF51AF4F40FD4599BF7C17CBBF3D7DBFC0072A8B40205DF140142D3DC0B9771A40E2A786C03441A73FCE6CEEC0280B9CBF7BC683402C6192C0784EB340AAFF71BEBD9E203FBD0523C05F9D26C0600F39405C7C1340BE4D04C007AF8D3E3E5A4BBF62D0C9BF222A6840445721C0ABFB92C0D24E7A4072B5833F9312D8BF68FE9DBFD2B486C0148A16C003159F4002C4D43F46F202C169FC324047A68CBF57048BBFB391ADC022927A3C309F4FC092B375C0F75F5BC0C15F0340FF57AB400F82B63F4CD46BBDC67AB4BFF89850C07B176B40477D6A401DEA1F3F44EB8040"> : tensor<5x6x7xf32>
    return %cst : tensor<5x6x7xf32>
  }
}
