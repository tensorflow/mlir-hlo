// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xbf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>)
    %1 = call @expected() : () -> tensor<5x6x7xbf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<bf16>
      stablehlo.return %3 : tensor<bf16>
    }) : (tensor<5x6x7xbf16>, tensor<2x2x1xi64>, tensor<5x2x2x7xbf16>) -> tensor<5x6x7xbf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xbf16>, tensor<5x6x7xbf16>) -> ()
    return %2 : tensor<5x6x7xbf16>
  }
  func.func private @inputs() -> (tensor<5x6x7xbf16> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xC2BE0940ED3D46C03F3DB33F8E40A2BF86C068C0E0BF894002C0ACC057C03F40F93E10403340DDBE8DBFBB405D4065C0AF3F1BC085403FBF754020C0AD4073BED94027C0D8BF3A3EFBBF873E313E4CBFA340B4BFED3F5B40DBBF483F3B4034C0D5C09EBF80405DBF21BF524064C0EABF66C070407ABF3F3F9EBF253F36401E40184041BFFEBFEB406CC00FBFDEBF533F3540BABF0DC021C01BC0774069BF1DBD9C40CA3FA7C07D3FC4C08040ABBF8D3C5CBFCE3E5F3FF03EF63FCB3FE8BEA6C08140A63F75408240E03F0F40DDBF814095BF7BC05B403BC02F3FA3407CBF9A40A0BF9D404FBF4C4022C08FC0CB40D9BF2CC07640BEC06FBF993FA93F86C0DD3F1F401B4004BDBABF48C0A3BFC240E83D0140A43FEF3E80BF71409040AE3D8C3E8240E3C053C0B3BF3F3FB940F03F2640F7BF20C01740E2BF893F2E40A8BE29404CBE34C027C00340B2BF6C3C6DC0CB409DBF72404D3D31C0733FDE3E89BF0A3EA83FB63F913E304085C01CBFB040CE3FB4C0E4BF0C403AC051C0063F653FA13E46406F3FF93F3C40B23FD93FF43FA0C0C53E8D40ADBF06410F409340DBBE52C087409B3F"> : tensor<5x6x7xbf16>
    %cst_0 = stablehlo.constant dense<"0xFDBE38C085402B4056BDBC3FB23FE6C045C0DB3F1140BEC082C0B2C0754087400E3F8BC0F43F943E82C040BF244069C04C3C6A40A1BF05C08EBF163FB13E863F7E4088C02F4095BE7F3E25BE4CBF66BF9F40CEBD06BF1BC0B3BD0840C03F52C0B7C0CEBE6540183E59C036407F3F5AC0CE3FF1BF2F3F854012BE164081401D3F28C002C02A40A63F9D3FA43F79BFECC090BBFDBF923F803FA3402DC0BF40DEBE43C0984079C0DFBF99BFD13CB44097BF994049C09640194074BFEFBF87C0E8BFEDBF5D406E4058C0184002405FBF9F405E40DD3FFBBD0BC10140FD3C203F30BD823FCBBD08C073C0684049BF35C01BBF7D401E4050C0094049402540163F73C0983E3DC01E4074BF33C0F63F95C057C0C5BF6940CEBF96C0"> : tensor<5x2x2x7xbf16>
    return %cst, %cst_0 : tensor<5x6x7xbf16>, tensor<5x2x2x7xbf16>
  }
  func.func private @expected() -> (tensor<5x6x7xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x403EC5C0F63E04C120BB0340C54012414E41C6C07EC0CBC10441EF414EC149418A3E1CC1AB4000BE8F408CC00E4150418B3C0EC1A7C0C63F754020C0AD4073BED94027C0D8BF3A3EFBBF873E313E4CBFA340B4BF03C0004017BF513F3A413F4192C1B83E7F3F0E3E003F3DC08EC13C3EF13F11C1AF3DCB3FEDBF07C082C17EBF0841E5BDD740A7416BC0F43FDEBF533F3540BABF0DC021C01BC0774069BF1DBD9C40CA3FA7C07D3F1EC1F1C06ABF933DFB3D713F6140933EA1C04EC09ABFD7C09E40D53F6EC0F0C1FCBB8DC0FCBF8140BEC02A41A341A23F05C0C241754006C1A0BF9D404FBF4C4022C08FC0CB40D9BF2CC07640BEC06FBF993FA93FA040343D604137C01EBE92406AC143C0B9C059BE08C115C05DBF5DC0604173C14F3E0E3F62C00DC237C11BC0BBBD49C27240A43D9ABFDC3D1740E2BF893F2E40A8BE29404CBE34C027C00340B2BF6C3C6DC0CB409FBFC0BEDABD28415C40AEBE4240A7BDA64061406CBFBC4051C1C9BF4E40C4C0D6BFA840AD4031401241813F85C087BF98C05A4048C05CC1B23FD93FF43FA0C0C53E8D40ADBF06410F409340DBBE52C087409B3F"> : tensor<5x6x7xbf16>
    return %cst : tensor<5x6x7xbf16>
  }
}
