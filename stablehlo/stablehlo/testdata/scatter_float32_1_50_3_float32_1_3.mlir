// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x50x3xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<32> : tensor<1xi64>
    %0:2 = call @inputs() : () -> (tensor<1x50x3xf32>, tensor<1x3xf32>)
    %1 = call @expected() : () -> tensor<1x50x3xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      stablehlo.return %arg1 : tensor<f32>
    }) : (tensor<1x50x3xf32>, tensor<1xi64>, tensor<1x3xf32>) -> tensor<1x50x3xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x50x3xf32>, tensor<1x50x3xf32>) -> ()
    return %2 : tensor<1x50x3xf32>
  }
  func.func private @inputs() -> (tensor<1x50x3xf32> {mhlo.layout_mode = "default"}, tensor<1x3xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x0AE34EC01BB3CF3F5E80AE405CAAB23FC6BF51C0657F1FC0361E46BF1BA552BFE0A123400C2761407E5C983FE7A921400BA734404DBF484096E44C4015CF9FC0F9B46040553217BF928153C0C925EBBFE2B97640301F3A404519E9BF9F57F640D690A8BF840D05BF3F572CC011814F4016DA993FB61B944038BE7D40738081C0059A143F8D0B063F2CEBB43F62CDBF3D55A65AC02576ECBFAE95B83E86DD42C06C1DB3BF1551B53F939A354080FD23BD070396BFB1264B3F2904683F5FF51CC09D625DBFD9DA99C0ED4968C07014983E70602AC0A05294BF9D98034090BB49C0097BAF3F044CDC3E7D0BA13F7ADE12BF3673213E63F515C0B74D84BF112EDCBF89E95AC0C1C4E4BE6864803F8042B740D89458BF1593BBC0435930BF33C3813FF84E9A3F69AD38BF2ECC5DBF7D2CC140E65702C0D05482C035CFC63F0ABF1CBF4DEB983FCB154F40A3863240AC9B933FBDCD353F8C4C6F40FE69834018064DBFC47C3EBFAF8302BEC453623F6BE0A63D37890C40F084C0BED39A43BFD13378BFA088353FC587B23F73FADDBFA61D80C09D67A0BEE4417E3F7FD1B5408CE808BF7C397740B59EFFBF66C2864099A7B040A77809BFAABADBBFB957FA3E3AB68AC0781B024083F37CC0421424C01E98DA3FCE034C40050E05C09AC7813F7B5372BF7DFA2C4075456A3F20F613C0B28BC13FAA8C783F3C2B99C09C4E27C06706A13FF4B512C08C902FBF06DF2940344E163F831D283F5AD813406AD470C0087EC5408DE1E03F0D6A5A4002BE693FD65D63C013F85EBF187CC1BF89CB803FBFFCAB3F5EFC0440F8F214BE6523AEC019A43D408CBE9DC0CB8E523F"> : tensor<1x50x3xf32>
    %cst_0 = stablehlo.constant dense<[[-3.67949653, -5.5500555, -2.43463874]]> : tensor<1x3xf32>
    return %cst, %cst_0 : tensor<1x50x3xf32>, tensor<1x3xf32>
  }
  func.func private @expected() -> (tensor<1x50x3xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x0AE34EC01BB3CF3F5E80AE405CAAB23FC6BF51C0657F1FC0361E46BF1BA552BFE0A123400C2761407E5C983FE7A921400BA734404DBF484096E44C4015CF9FC0F9B46040553217BF928153C0C925EBBFE2B97640301F3A404519E9BF9F57F640D690A8BF840D05BF3F572CC011814F4016DA993FB61B944038BE7D40738081C0059A143F8D0B063F2CEBB43F62CDBF3D55A65AC02576ECBFAE95B83E86DD42C06C1DB3BF1551B53F939A354080FD23BD070396BFB1264B3F2904683F5FF51CC09D625DBFD9DA99C0ED4968C07014983E70602AC0A05294BF9D98034090BB49C0097BAF3F044CDC3E7D0BA13F7ADE12BF3673213E63F515C0B74D84BF112EDCBF89E95AC0C1C4E4BE6864803F8042B740D89458BF1593BBC0435930BF33C3813FF84E9A3F69AD38BF2ECC5DBF7D2CC140E65702C0D05482C035CFC63F0ABF1CBF4DEB983FCB154F40A3863240AC9B933FBDCD353F8C4C6F40FE69834018064DBFC47C3EBFAF8302BEC453623F6BE0A63D37890C40F084C0BED39A43BFD13378BFDF7C6BC00E9AB1C01FD11BC0A61D80C09D67A0BEE4417E3F7FD1B5408CE808BF7C397740B59EFFBF66C2864099A7B040A77809BFAABADBBFB957FA3E3AB68AC0781B024083F37CC0421424C01E98DA3FCE034C40050E05C09AC7813F7B5372BF7DFA2C4075456A3F20F613C0B28BC13FAA8C783F3C2B99C09C4E27C06706A13FF4B512C08C902FBF06DF2940344E163F831D283F5AD813406AD470C0087EC5408DE1E03F0D6A5A4002BE693FD65D63C013F85EBF187CC1BF89CB803FBFFCAB3F5EFC0440F8F214BE6523AEC019A43D408CBE9DC0CB8E523F"> : tensor<1x50x3xf32>
    return %cst : tensor<1x50x3xf32>
  }
}
