// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x1xi64>, tensor<5x2x2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xF25203EA659A16C0E49213DC00F80540162FD2F4AA1204406EFA41644F2CF03F9607796E84B80740A55566C4AE7CEBBFD2DC24E12F5FF63FA23123264FE71A40EC3267F10496EB3F3D189BCC63EC174029D86431E71601C0CECCB0A9AABBE53FC1080E1A19120CC0A466A3F13331F4BF1E66BE6B60F21040DC19B1CD220DEF3F8724E2C73A5E0540A773EDD7EE2904C0FA91D908C6481440B599B5A10BEB14C02867147C05431440DBD2D2B9AAD4F3BFC1A75056CEBECDBF6372574711E0EB3FAC372CCF47AA0BC022241358E27F1240448F77A815C1F43FB3A6E152748F79BF009EECC583D111403E5F2C5FCCF9D7BF9A1524031870E3BF652192073B1B13C0DE5F7CA65298F33F50BCBFD96999BDBFE0F6F741241D06C0762D3869E2880740AEB4B4A1AADF1840EB19FE77204FE63F02A37281D0351EC06FE28D48E0DFB13FAAAC76DD34251B406A0DC6F288BA1840FA667FFEECF6114012219C92107D07409420A170A61009C0BCA2B83847F4F73F34085886681814C0C572FA797388DEBFA25D2FE21937F23F270628BDF778D5BF277C7D0797E1B5BF18897468A47BE3BF66C7EB17986C1CC090DF8ED847B51640EAA6C9A1DE240340AFCF1408AC8B02C02A81DD168D74E9BF284502FACD92F03F62BDEFE596BDD93F7440A6457AF8FDBFF408A73647710AC00A419553F796F83F4E3EC7D1EE89F1BFB8214622CF6711C0E68FFE54AD4EC8BF732DAC8BD6FA13C08F19B1A82C3BF2BFBAC4678D1D5CEF3F866B679BFAF3F73FD8D7493317C8F53F6A11097C3393E2BFBD845F5B0889FD3F3811A9EC97F3A3BFE9CC3AD3B336E7BF73CA4297929D0BC09CA5EC0914C6CB3F45A0F324851A0640EE50A293BECDD9BFD4D0A33DF8F202C0F536CFA6D2E6E4BF1E441506205EFDBFC7B3BBB5A8E1FCBF8CBC3CBD5A51F83F467DEBF4E92BE7BF0E5645218977D4BFF4FCFE822314F9BF92A43EBF69CFCC3FF80C653868850340E9B074C7EFCCF2BF2997610AD26B0040234F54B6D44C0CC09344F2D73084A83F847FE790B6A90FC096280818A46BEB3F6D1C58E9604401C0DD5612C793245C3F3ABE773D4F5621408806A8D02F50F83FF7D7C6EF6D0C20C0C82DABF0FCEC02C0D9414767D75DFF3F3F88A7B5DB1EE63F53D85DD3E10204408EE2F6CE004617C0A639FE46530CFB3FFEC2C4206E599B3FCF9203D195D606C02652BF5C0C7A02406E69CCEA615BE1BF0674EAF7583A084049B8CAEAEE0212C0A49C7E6D77E000C0A69877D40416D4BFC4EA489AB2C6FB3FC239998256F10B40F85663A9F41F0540B77B032984BAF33FC67308C5574B04C0462A61C5A020D03FCE96BC37BE83F2BF0CB74354D9DB1FC04015EE2696590740B9677E635B2F06C01A7E7A7301C2024049F54DACB94A01C0EE9EEA485459F8BF33015FC87B1482BF96D4160B73A8F33FB491E5AF308B0A40EF0B7B173EAFD3BFCE630B70BA84E5BF86292B26E38C0F40E1A63D27D172F33F0CFCF86574BC0A403C24746AA66112C00E30183C69A52040069B682BF9B71C40CE3996D33ECBE43F283DF848A62212C07A7B735E144FEC3F827C800ADBECE2BF02FF9F3B28FADA3FAA9EB4414B49F43F723BF3E47ED90FC0860C96019708D43F6DC653010603064036428813254203C09B06F57229C6FEBF186519B9F281DD3FCC17A1D6A79EF6BF66B5954B01A012C0A0014443F732F23FBA80A447E74DF7BF704B44149175F7BFBDFB91114EC1FEBFB459B2947ADC00C08A3378BC5C6BF23F4CE3CCCDD03510C0E29B70F426D61AC02EEF07E5BA0A1AC084CC09CB7D6EF5BF9F683AAD72091C4026F8E3A359F3014007CEA89DFE9BF1BF74DF192E662CE2BF5401A8099255EC3F429C78137BCE08C058D30AFFFBCFE7BFBCDAD9BCAF0AF8BF17A1D16E934B1640F01603BB0C310640111D08B65D18F4BF5C85DFEC7116E23F1E85C8E59381D6BF8479616C836D01407BE09E4EC6421A40E6C12D11F75FC7BFC661096C3606F3BF2E3295E59AA20340C6489630E96312C0B0E694A348D9F7BF782005DE021612C069315C73BED20C40572A35720986E43F6672C647D1481640C5A3167BBB72E93F22E71BD3EF66F6BFFE5A7A370F21FE3F201350C61B8EF53FA47E070643000740DA91ACD89DCFEE3F4923978C654DFABF0E15FF38D7A410C0D63F4B39181718C050834AEF20D9F9BFB60EE4CE10BFF83F486BDD3194E0DB3F227E5BF4A37D17404EAB177625D907C0A85EDE2A09FCF2BF779B1E869128D0BF9EA18670CDA30C40281BFDB2DAB21B403F8E04476C70EFBF40728616F787F2BF4C11C9F4F8DE014045A3C5E23FD223C092A7F8D587BEED3F33695E1E9914FBBF4A9EC0D3504703C0"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<"0x293A90484AFC00C09BE71699A3A9F93FD2B12646206116C0CC8EB8ECEEB6DBBF6CDC32ECDCAF08C053CE656099D6F7BF6652D8B87FD810C096DCA3BE96CDDABFD287FF7EC1D4D63F06831782C7D9D53F81B15EFDF9370140FC320C4F9B00164069405FDA227307402002978B971C0C4050A2936A2D3804C00ECD61A84D0412409895D841B080F6BF47DCF6560392004054B90759F8220C40EB8D4C23B42AF73FBBC96B4EA6F80840704EB324C165D2BF07C15807F349A2BF14E728FA21680D408A140A16A3BAF5BF2CDDF614D80CF6BF2E5E60C44B830740B90C1BC7872A05C05D416DF613F714405CF6A62051A4FCBF0AEC43FC4C8C0EC0C0828DA1F0FFF6BFAC6118E10AF1E6BF0B3C0ADDF0FBC5BF249FC72D99450B400A1F857F36560BC0C4179DFC4E900EC0BF44E3DC9D0B14403BA01DE8FD63E0BF3E98AF643F40F33F2A41CB464016E03FCED63B38A883F9BFE6D99CCF81F0FB3FBF885BD159560AC08A2A006FDB3405C06CE3151A755406C08A73E7DB69DB14C0701243E2B7F9F33F083E7A8B3FFADABF5279D59558EC1340098A54680840F03F8CD3716E81EDFF3F90AA1049A6ED04C00890F1BB9AB71340807C9377C00F07C01CDF03A34718F1BF5FA9C1C39FF60440283D7C148E3C03C08757E4170FEB07403A110660839913C02E4F3317209FFCBF8A899D2CF3F6F2BF55CCC90C1C310640F4C652B06C730C40B4F6B4B319EB2240D55BFA715B2CE0BFBE4855A7244115C077E940F5C9A1E5BF218B2BB1826918C0E1F5591729D6034002ECC1DB957AF73FD7B70FBCC7AF02C0040F2E342492E13F14B2E9B0109B02402A290E94CCBAF83F63BB237DA1531540925E8933F45CF4BF8A48A15AD3191D4045DA124472C4F63F2B568ECA1706F0BFFF2A67642EA302C04E6D1CFFFF88D73FE0CD58C7D828F43F35EC22C37749D0BF796FD4FA3669FA3F22BDAD92DD8AECBF343721FE48951F407A341179740110C0E1AFEE763C75C8BF421CDC5B847BF6BF576CDAC46EF012C042F7FCF3CC570040929E8FA3BEC6EABF916691144DA6F43F1683D10D665DC93FCE2E3861B12710402772C4A437170040FFC2AC4E097A19C0A63C97684542F23F3A90FA37B350F83F3521A21156FB1040DC832CFF14528B3F03A79576938302C0FE888DD7E986F4BF42977AB69AE90CC0C897B16310B40DC02E61DC6D4710F2BFC25DF450F89CCFBF7372BC694E9607C01FF04F57A4B41AC0862DF7833360F7BFBFDB134BDEE7DBBFFCBC0A76800F08C05445B9B268A4D8BFDEC51CBC9F9EF63FFA5968CDD65303C0ABF3350F2840F0BF9A1A17129CC600C09CA7DE78F92BFABF8DF8471DAF97114052F4B0AF7FC808C0E595D206327411C0BAE032831C3E0BC062E19FDB479D12C00B2EFF707B9CF0BF68C741A1B96004406894A53EED01EE3F0083290A29A904C0EAC44165AF31F13F4A39D6DF434FFDBF87B6BBC58E2F05C024D3B7B97CBEF2BF9C6E5D2873E9F93F19505BB8DD12F53FA27DD3CB7F5901C07EED8BA41F60F5BFBFBAFE89870DF33FEED0B84DEDCA0EC0769FC42F21130340F1C7EA8E05AA17C0"> : tensor<5x2x2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x293A90484AFC00C0E49213DC00F80540162FD2F4AA1204406EFA41644F2CF03F9607796E84B80740A55566C4AE7CEBBFD2DC24E12F5FF63FA23123264FE71A40EC3267F10496EB3F3D189BCC63EC174081B15EFDF9370140FC320C4F9B00164069405FDA227307402002978B971C0C401E66BE6B60F210400ECD61A84D0412408724E2C73A5E054047DCF65603920040FA91D908C6481440EB8D4C23B42AF73F2867147C05431440704EB324C165D2BF07C15807F349A2BF14E728FA21680D408A140A16A3BAF5BF22241358E27F12402E5E60C44B830740B3A6E152748F79BF009EECC583D111403E5F2C5FCCF9D7BF9A1524031870E3BF652192073B1B13C0DE5F7CA65298F33F50BCBFD96999BDBFE0F6F741241D06C0762D3869E2880740AEB4B4A1AADF1840EB19FE77204FE63F02A37281D0351EC06FE28D48E0DFB13FAAAC76DD34251B406A0DC6F288BA18405D416DF613F7144012219C92107D07409420A170A61009C0BCA2B83847F4F73FAC6118E10AF1E6BF0B3C0ADDF0FBC5BF249FC72D99450B40270628BDF778D5BF277C7D0797E1B5BFBF44E3DC9D0B14403BA01DE8FD63E0BF90DF8ED847B51640EAA6C9A1DE240340CED63B38A883F9BFE6D99CCF81F0FB3F284502FACD92F03F62BDEFE596BDD93F7440A6457AF8FDBFF408A73647710AC00A419553F796F83F083E7A8B3FFADABF5279D59558EC1340098A54680840F03F8CD3716E81EDFF3F8F19B1A82C3BF2BF0890F1BB9AB71340866B679BFAF3F73FD8D7493317C8F53F6A11097C3393E2BFBD845F5B0889FD3F3811A9EC97F3A3BFE9CC3AD3B336E7BF73CA4297929D0BC09CA5EC0914C6CB3F45A0F324851A0640EE50A293BECDD9BFD4D0A33DF8F202C0F536CFA6D2E6E4BF1E441506205EFDBFC7B3BBB5A8E1FCBF8CBC3CBD5A51F83F467DEBF4E92BE7BF5FA9C1C39FF60440F4FCFE822314F9BF8757E4170FEB0740F80C653868850340E9B074C7EFCCF2BF2997610AD26B004055CCC90C1C310640F4C652B06C730C40B4F6B4B319EB224096280818A46BEB3F6D1C58E9604401C0DD5612C793245C3F3ABE773D4F562140E1F5591729D6034002ECC1DB957AF73FD7B70FBCC7AF02C0D9414767D75DFF3F14B2E9B0109B024053D85DD3E102044063BB237DA1531540A639FE46530CFB3F8A48A15AD3191D4045DA124472C4F63F2652BF5C0C7A02406E69CCEA615BE1BF0674EAF7583A0840E0CD58C7D828F43F35EC22C37749D0BFA69877D40416D4BFC4EA489AB2C6FB3FC239998256F10B40F85663A9F41F0540B77B032984BAF33FC67308C5574B04C0462A61C5A020D03FCE96BC37BE83F2BF0CB74354D9DB1FC04015EE2696590740B9677E635B2F06C01A7E7A7301C2024049F54DACB94A01C0EE9EEA485459F8BF796FD4FA3669FA3F96D4160B73A8F33F343721FE48951F40EF0B7B173EAFD3BFE1AFEE763C75C8BF86292B26E38C0F40E1A63D27D172F33F0CFCF86574BC0A40929E8FA3BEC6EABF0E30183C69A52040069B682BF9B71C40CE2E3861B12710402772C4A4371700407A7B735E144FEC3FA63C97684542F23F3A90FA37B350F83F3521A21156FB1040DC832CFF14528B3F860C96019708D43F6DC653010603064036428813254203C09B06F57229C6FEBF186519B9F281DD3FC25DF450F89CCFBF7372BC694E9607C0A0014443F732F23FBA80A447E74DF7BFBFDB134BDEE7DBBFBDFB91114EC1FEBFB459B2947ADC00C08A3378BC5C6BF23F4CE3CCCDD03510C0E29B70F426D61AC02EEF07E5BA0A1AC084CC09CB7D6EF5BF9F683AAD72091C4026F8E3A359F3014007CEA89DFE9BF1BF74DF192E662CE2BF5401A8099255EC3F429C78137BCE08C058D30AFFFBCFE7BFBCDAD9BCAF0AF8BF17A1D16E934B1640F01603BB0C310640111D08B65D18F4BF5C85DFEC7116E23F1E85C8E59381D6BF8479616C836D01407BE09E4EC6421A40E6C12D11F75FC7BFC661096C3606F3BF2E3295E59AA20340C6489630E96312C00B2EFF707B9CF0BF68C741A1B960044069315C73BED20C40572A35720986E43F6672C647D1481640C5A3167BBB72E93F22E71BD3EF66F6BFFE5A7A370F21FE3F9C6E5D2873E9F93FA47E070643000740DA91ACD89DCFEE3F7EED8BA41F60F5BFBFBAFE89870DF33FEED0B84DEDCA0EC0769FC42F21130340B60EE4CE10BFF83F486BDD3194E0DB3F227E5BF4A37D17404EAB177625D907C0A85EDE2A09FCF2BF779B1E869128D0BF9EA18670CDA30C40281BFDB2DAB21B403F8E04476C70EFBF40728616F787F2BF4C11C9F4F8DE014045A3C5E23FD223C092A7F8D587BEED3F33695E1E9914FBBF4A9EC0D3504703C0"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
