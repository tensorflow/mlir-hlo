// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<1x20xf32>, tensor<20x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#0, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = stablehlo.add %2, %0#1 : tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<1x20xf32> {mhlo.layout_mode = "default"}, tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<[[0.977869093, -2.95485735, -2.63425946, 3.37474132, 2.55621076, -6.3794117, 3.77089119, 1.04626977, 7.24682045, 4.20864725, 1.76182485, 0.182185054, 2.10681438, -4.07676077, 0.497429788, 1.08807075, -6.25094127, 1.93655813, 0.764749944, -0.524217248]]> : tensor<1x20xf32>
    %cst_0 = stablehlo.constant dense<"0x88CE6E40ACD1DFBFC20BACBEE4BE6040BA3A53BF9F7B81BF738108C0D7899A3F937A8E4074C5043E4F80D6BD258403C096F99BBE47AB5D3F1761C9402DC0A240F42A94C06AA33E4021281A402E6B7F408CAC3DC03EE213C0FE6B17C038286640637F82409F259D40605F2740063387BFB385E1BF8C4EE9BF28835C402C6FEDBE6966CFC0F09508419E8934C0EAAA16402D7D0EBF1CF72AC0DD3206403C4322406B880B3F466AEFBFD5EA73404A9C513F9D3DD0BFBA8699BF4172513EC0D88BC040BDAABF9A6B2B40CD4446C0ABEB93BE1938423F3953C640DB3D81C03DB315402E990FC0626801C0A0D0B140AC2217C0CA988F4065BD65C02DD4A540BF1BC43FC67684C05D7FCC4029F522C0178503C0F92A71BF9B2D16C08D1AA1BFB7922440C4DF764095476340A7CE2440A2505FC0DE0A34C0D96C1340E62FA7C01D1B37C07D5871C0763ED83FA6B91ABF9FC042C02BD601BFA87382407B42B3C075AC1040FFCA49C041D0EA3DA390603FEE47A3408DF820C0F1621BC08E421EC0A533893FA3DA1F409A9271404F3F84C0C2B7D0BF33969CBFE9623FBFEE390941A7B430C0276F73C0CCC8CF3F2CDC1040016B01C0E66E66401A67FA3FE67AEE3F9C2794C0E2F8693D382B074086433DBFE72A08C044C859C09766893EE5B61CC0C671923E755585BF62EB08C06AD7E13F7AD3D93FB6FA7E409A89B73D2D42D7BFCB42ACC043C3673FC34A87C0464CA13FED631EC03034ED3EFA0D15C0ED4C6840191C02C07C9D2940DF3767C09AC58B3F9834B1407B5250C0F6CCED3F60C241C0902B8F3F44F4A1BF625456409B9D68400560ECC0D0C19240F3A57DBC7EC91D404E7787C01DCABABE44034E402C9A0940D59D44BF9A8382BED1A32FC079E6E93FB6F7C3BF72722D404F25C9BEED542C40F2AD0040F41BBBBF8CCC6ABEC1BC5EC08E7A60C09B7E68C03E1B2040C51B0BC01C6549C0DDDD713FF82456C0C79F0040169205C1FBCEABC089AC363FD3FF95BE4AB87C406A6A454008F9D5BEBE7493403A40273E7C16ADBFA05393C002D37840F11533C019A704418ED3CABF8302793FA0C069C0DCF682BF18E0B6C0C8C2A3C0B53A91BE0D44CABE843B54C00D7029BF17CC21C0D2C092BFE2356CC0CEABEFBFCD6D113F8D4F43BF05228A3E8FAB63BFE24D8E3F73A223C037DB323F697EF43F90DBA13F2741F1BFAE9109BFF25FDCBF35BB8FBE2197814097BC624089F7ADBF46E310C0E6CA16C0FF55C33F61CF80BE1136034080603CC01699483FE57DFC3FA83794BF61B0A0C072CD34BFAEF8A5C006146C407655004085A229C00312CD3E1F61B8C00D90A3405103C13D3E1BA93F60AB8C3E80F5513EE3C4D9BF7C82DDBE6AC0A6BFB3A998BF1C78223FEF2438C0D2BDEDBFE7CF27BF480B3340A2A60BBF95B20FC009D8C53F7ACBB0C065E488402776BE3F02E861C0483B87BF31BF67BF8C158EBFAE63C7C0E9535D4039BA02C0E3BD82402640F3BF8DBD01412A87C93EA8BBF6C05F308FBF8AA6DFBF7130AC40DA3A27409C29D1BF7C515D4049CCC3C03E9D86C0A9C7533E3B01ADBEFA77324041B6DF3EB2AAE2BFED2E99C0E0CB55C01D29A73EBB577840695E0C3F6FACAEC0C1701E40D971EEBF000A223FEBC7F8BF58D53BC0E526053EE3DE203ECCEDA8C09A6694C0AD448D406331673FEFF521BF6EBEB33F18310E40A4C8E8BD160644C064F133C0EAA5C43EC0958240372B883FDF2855BF09BC3AC0EF4797C013F593409C63AE3FD2A40F4015C7B440EEEED23C57008EC00644E4BFD5292640E97C28BF7AE06140E55F1440664012C06822D0BFDF441CBF295720BF7AF038403DE9CC3F46201D40BC1831BEA4B2F2BE4DF04ABF0E99CBBF8E85373FE6D2F23F957F9BBF3CAF65BFD5D348BF6E4F20C03AC3923FE864E23E4197FA3EB2932540048269C0356F663F4706FA3F84457F3FAF94D8C00B65C740A5B521BEAB8F3540287AF440308FA9BD36484CC0AC0A9FC0B7033840A3CDAE3C4DB12DBED474494026D54AC097F9E2C0AA8FCA40EDC92FBF543381BE547584C008AB2FC07EADBCC048D56B40A61C8CC0360D7DC0542592BFF120FE3F4D43BB40AE258A3F0A2D0B40E2F969C09684C1BF23684BBFACEDD6BF85A6CCBF7412A1BF6C57A3BF6917C4BE0F7D78C0AF068CBE0CCC31C096312BC0552D87BF2BA12CBF8DC103C0700C43BF0B7653C0338B0B3F5578C63F994E9DBF5ED770402026E43FDDEC0EC091FB2AC02E63E53FD23614C0"> : tensor<20x20xf32>
    return %cst, %cst_0 : tensor<1x20xf32>, tensor<20x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xF8B196409C8296C02D193EC0545DDC408D94DD3F0C83ECC0AAA9D13F013B104044303B4169D38A40751BD43F73B6EFBFB2ADE63FD47E4DC0094CD940A791C54055192EC1FE499D40CB194B4068DE5D40482EFEBF507FA8C0DA01A0C0FE11DF40DE4BD44014FABBBFD45ACC40806D23BC8784AF4034B3184072A2A640D02790BE63FB8BC00DB78E40BAB314C0DE4D5C405CD7D9C02A1A3CBF8724374076B6004006EFC23FC2689AC040A6963F6B3186409AE86D3FD285F2C06C6D7E406ABB54C0A436BD400A63DC402006ABBF3C91DABD12643740CCBC0740D2A562C030565B4026EA07C110FAAEBD7549CA4072AF38C07EE3AE40E46CD1C0A5102340D1049D402EA9CABF0072363C3EC29C3F031E81BF95C0C940BE59EE3FDAD1003FA23B3040E8DABE40448806BF8BA44440AEAD19C0920611C1B5AE874011B78EC0E4A758C015C332C04EFAA1BF1E464FC020D9A93E6A230340F86013C05C5DEABF8AA25340740083407E588A40E6E52840641CA9400814D1BE4C26D0C054D9FCBFC63C0A40C93470C096C1B640F48C57C0A8E809C0145B7BBE1CF56CC00228BE40701C1D3F64AC9FBFF13198C03A19C140AED379BFB48E2D410447C54030FF674026538EC0F07D0A40DC7CFBBFDCAF77BEE70F85BFEC751AC1641D0D40768AD7BFDCE873BE48AA82BDE203A3C000B05EBFC072A240D649D140FE45C9C032B50540C0C78AC02E6F024100869DBCE067414002BB12C0927C2440D0FBCCC06811844096E471BFF07166C09B8ED6BFEEA8ED3F356EA04013BD11C0CE6B8CBF0A2DB5C0C6C88F40A63DA53FE6F341C0F2F9EC40FAE4CAC0E2533D416A2E86409E458740D8A281C091F9DE3F88995BBF10702940F2DBA33EF02FD0C0FECC4EBFE6E42540A28803C0DA076C400C4156C0004E6F3DDA54AC40F6158C3F887AD3C038CC943E78841DC04D4D6740DCBAD64040D0D2BE30BC3DC0834D43404F87EDC0AB752040B252E8C058EB39C1B49B29407B8DF13E842B5B40E9FF814083DB57C08EA3FC3FC76F62406E1B9A3FE2BB2FC1A514F540B73FE0BF139A7841B3F027405E022F40B4175EC03CB58A3F76AA1CC1D6D793C074EE4D3FF7ABD4C0E595B0BFD0B4D23DDE5843C00CB02CBE22A9D4C0CE3690C036577C40248AE53F0482C3C0646B3840061D0A40BA149640A4089D40F2006B40672DB93F8857633E09A793C02AB49CBF34AE4E3F2AE10CC09456AF406B2818BF0C7032C0FC6AB0BFC5E2B6BFA1B138C0EA98AD40583CC6BE0111B3C09DCAB740D0B7E4BD266B0E401E2760409F2F5BC0F2BC7740C19583401646D7C090E0653FA58F95C0A4DE91BFACF80140497F0540A8757FBE8069973F6AFF94C0044844C08E9B04403788AE3F20D5B7C064C5643F4EA34FBFF7EBD240E132E04029B09B3FAA0904C010C2694026A019C157CF984007DE2440DC7D1CC1B64B613F28E20FBE192FD1BFFA18A8C01CDE003FF7A895C0C4BBEE4088E3273FD85BDD3F974385409D40D5C0DC19C44035871D405091E440C6E33240F009F23EA8601EBF57E1B3C0889747C07969C1C0D4A0CC3FA4696340CCBFB2BDC3FF4ABF1EBDF7C0CA31BFC0E7E06C4058F8CD405798BAC02C05D8BFD66661407E49AC407DEE9A4088233ABE6C2C30C07A280F40B8DB7AC0DA0299C0402A63C0240CEBBFEABC3540E042073EC249613F80C64C40A76244C0E64EB6C07C29103FB22D3C40C81C13C0F2B59A40DCBD5A3EF0878A4090D504BFF255CC4073B5C53F6F3D8B400849C93F06EF053FBA5D56C05C8C00C1330D9140F04DDA3DB45340404DF5524064AEA7C0745488C08BEA30405606F73FCE575FC073E5AB405C1660402E5DE24026046F40A716783F3747B4BF70B7344033800BC09BA737BF4872433E3122E1C0727B11BF8EA6F43F3005A8BDA1D0BB3F8045BCBEDC0CC9C0C8CB88400C4E9040743BACC016D33FC016E0E84047D8E2401275E140836D1641408ECB3D54E48ABFC0BF10C19BD957401E018E3F4075CDC0B3B2A2407CE319C0FABFF3C05EDAE940DD0E69C020BE38C094BB43BF302141BED16844C1C895EE40364355C0B2BE5240D047444036D26F40C317C140E3E84B403879F3BFFE234AC0BCFAD8BEBA74E1C0DCCD833E638655BF012CE4BF6EB298BE4F9F55C0628AD0C0ED7A4640703163BE78DE10C19EBF2D40566EBE3E2E05A6405E975C409C68C5BFE12E3A3F36126A4079C8A9C0A156884004B6374012BF07C1FE2B3CBF41A3234098C335C0"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
