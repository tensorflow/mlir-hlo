// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xf32>, tensor<1x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#1, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = stablehlo.atan2 %0#0, %2 : tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}, tensor<1x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x1A2004408EC51E3F9EDBA7BE49F091C09A85BBC0413EC7C0DD32ACBFF02052BFE84A953EC5114CC0A4555940496204BF50DA983FEB6C1EBEAD2A90BF61094140456585402EF515C04131EDBEFB0348406A4104C08A0E8AC0D85BBA3E4D87C9BFCF49D2BF043E43C04E5D80C00514214047E3CC3E4F55933F98D42B40B1B8D4C0154EDBC07F84324050C8B3409AD85A4013FBF7BF031A75BD8A5F123F3B816CC03EDDD1BD4F7F84C0E5C9F7BFB47CDA3F8A699ABFAF9B923FFD9968C0A31C94C05BB108407211DEBF6D0C253F0E50D83F602E5D401AFE0CBE43C0F8BF9DB02BBE15C313C0F37A6C401CFEFFBFD7C580C01711B93F98375FBFF87999C02B5C94BF90BD4BC03A599A4085E00CC0398F25406ECF9A3FDB370040E0FAF3BF779C5E4078C1B23E41F175C0F3975A3F8446E93F3FAB8C40BBC83CC0EB5C303F1B1012C052CC3F4039C951BFB6BCC24005A8174034C6673F2D4D0440BFF87ABC34979B40013F993F9EBE8B3F9A5162BFC3EDDABFEACA1740992BF03F0BF5CE3F6DFF33BE7CB103C069130AC0B2F3853F321FA44059B597C0339E804039F0C1BF3F0482C0F3E0ADC0211C923FECBE8DC087E72440533233BE5CA62C409A9DDA3D24FDFFBF22B447BEFA62EEBFA07DE1BFC4E50740DBD801C0313257C053F412C0B3067FC0462A80405DA355405BCD76BF20A51BBECDF5BEBFA5EAB8C06A43B940D80B77BFDC325E3F872FB53F4572923FED7E61C054415BBFD7282BBF1565F7BFFA3B23403DFD583F22C608BFA2BA20C031447BC0B582F0BE6FD664C0D705003FBB123E40AEEC3DBF978583BEBEAB253FE13CA3C03B063ABF1F3C00C01EBD4EC029FA0BBF819595C0BA22AB3E6B4881BFD7C59B3F2C323C400163AFC064B7963F21AE9740D884C640385FF3BFEFF582C05A1F863FA0D24D3F4384EA3FCCC981BFACF186BF23D07DBF04BC14C0D4F231BFEC3983C0AE0F47C0CCAB7B3F812B123E6DF3D33E12484C40187AABBF60799EBEA9BBA6BFEBD1013EED8A0741368E81C0A10580C078D79940DF087740EEF6EFBEF03F7B3F1509EC3F2D562340A6B8A0BF7C32993F90D58E403154C9C01B998A3FB9C958C0F69D2EC01EA92540F4EF514034B524C063BB9BBE1CC5974037B358409617CBC0417B68BF80DE68C0C50C55C0E625BDC035E01740E3ABB9409ECBF9BFD7CDF43FDFA042BFAE9F06C0F2EF0640126E92BD8E678A3FBD3CA23FAC365D3D782E0DC061DC2DC01C3A7140196813BFED9C8740F0F382C0CB93E440E1FEF63D225E28C0E777CBBF2C431B3FD196E9BFDE00FBBF2BF1ACBFFF4A664051564740975D9BC0F059FC3F59621E402A71D4C0448BA23F35D1FFC0280D3E4064155A40547033BE806445C0F3FCDEBE4C65E43FCD1E883FD7DC08BE8F87D0404C851E40243F3540DE9C0BBEDD54F8BF4DDE363C3A68A33F45BE863F0C56A8BF3F8989BFF7B0693F47D251BEB30631C01C18A2C080DF59C0F045FCBE5B218E3EE1808DBF8C6A15C04D79FF3FCD1B8FC0F319BFBFB70A94C0228BADBFFE0777BF78C290401ADDF6BF0DE2453FC1C3B040D0799F4062344EC02BE86ABF859B22C01A452D4098B8A23EF631114025313BBEEEADAD3F1AE594BFBE6F74C0EB9EECBFE63ED13EC99A793FF1F38B403C02ECC0900DA23FA908F73F82452EC0C1A82A40CC7A1540403EAE3E2AB317C0D444B340D2FDD63E9C375E3EF7755AC0B7F2D33F14E525C09CB7823FC54F48C025A9D6BE32209EBF7AA78240EC83DD3FD62808C0F167F5BD786F91406AA37BBF7EDDE33E5DAEA1C0EAAF213BB44CB13FC59315BF5233123E79F61C407C5186BF93B103BF8730CE3F61519F3F263165401312D5BF3458A240B066894086E646C0EF3BFF3FFC84273F34ABE6C0412DA940A161D2C0C67DAD40E13459BF8B389AC0EF9172C0748F96C05A1AE5BFF6C13F40E922A8BF0A3D42C06E6E1640A4473BC065B836402D56163FBC328DC06D5ED2BE46C984BFC31D20403C7806C07F110EBFF764E8C078BBF53FF49F84C0F8C367C0A790ADBFDCCA92BF724F32C063A3C83E583F93BF66B190BF347E843F89E2D8BF2627CCBFE9D9A7BFC51BA0C06E99B6BF15BB514060A9A3C01328CE3DB71AFE3FE56AF0BE792AA83FC3704440ECFAFA3F2EACA7402EF327C0638846C0185392BF21F1753FA35552BFD8439FBF2FBB823F20DEE0BD2030424051A3C140D6F1E23FFB24FE3EB256554088C32040D822C1C0A21689BF888621C034771C40"> : tensor<20x20xf32>
    %cst_0 = stablehlo.constant dense<[[-3.7132256, -6.74087191, -5.19466734, 3.12910247, 1.85779881, -1.60591328, -2.12301493, 1.94030321, -3.50413465, -4.48389769, 1.63350224, -0.138680756, 0.939879656, -2.98028326, 1.40192485, -0.546516597, 1.72842062, 2.24525642, 3.36049438, -0.777860522]]> : tensor<1x20xf32>
    return %cst, %cst_0 : tensor<20x20xf32>, tensor<1x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x4E962840A8304340310745C0B22D78BFF2C3A1BF2D5FE9BFF4E924C09EE7CCBEA3BF4340188021C022AC8F3F7399EABF2E6C673F17BE45C05A432DBF7D01E03F52C0963F02854EBFEE470CBE4249E83F748F28C006A024C0BA9544403BAEEEBE5E5D39BFE38A03C02CAF03C04BFE693FE0C84140E4FA38406619833F5CBBCBBFD09DB7BFECE91840CFC2A93F1359DD3F04A357BFD746DABC56932C3E1B9EE3BFD34B47C01ACF25C0623B32C022AFFF3EFA6E13BF36692140D05D06C0714096BF78072640386F31C03778C03EDD8AD33FBB12A73F751B46C0CD2372BFC10236C0C59C6DBFC62B833FEA6D09BFAE80E1BF444C314043D440C0185919C0FCA0B5BEDA7185BF7433F23FADA315C0BC606D3FA8CA3340752B2E40F8BC5CBFA129CE3F181AB63E96BF0EC09E0C0C3FA35AEE3F461C993F4F916BBF620E4F3EA71BF3BF7A9A1D40CE5141C0A0C0114014ED253F5A2CE83EFDCC0E40A49948C00A76983FC4FD3340C4C6394035FCFDBEF16AD3BFA8C4983FE6192540F8415B3F632535C058455FBFC3F443BFCF919A3E0654DC3F040E0FC0C1A6264014E636C0861E6ABFACE49EBF908321408E2201C0F3E36C3F51DE45C0FB65264077A4853D77ECD1BF408151BEE05025C0EA0B66BF774EE93F207D5DBF67677BBF637319BFFBBCE1BF7E60144075A22B4060513DC0E4CE46BDE6342DBF1BC2EBBF060DF63FD84DECBEA8853940D87D3540536A1C3FF218CEBFD82E3DBF28F03AC0AA7971BFA114E43F8570E93EF2376FBE444C24BF2119E2BF200241C06CD929C06BEB42407A61423F1A87C2BE1EE93EC02C203640D8899ABFC3F93BC0AA2A2EC06D228DBF23DBE8BF0AAAAFBFFAE9414092D31FBFCB16FF3F440B853F924B97BFC38DAC3EC0E1DD3FAA0C0740927737C0315B1EC04571A53EED1DD13E459712408E8B2CC0E4D4FEBE426A37C06F752AC050FDCDBE9363CDBFE87FA3BF7EAB3440B3CFCF3DC0921F403D89893FF0B709BFE819BCBDE4FB06C0B0E04640088C0F4000B11EC0C83368BF70DC993F1C87FB3FFD273BC014C4EF3E190F2A40FEF12740D9C427BFDDD3D73F597FAE3FF8D700C0835C283F8B89DDBF47C880BF16355B3F2FF8453FEFA1EEBFC5D443C04FD22140B01724402C6E8EBFC3C9E8BEA743FEBF66DD08C09576A0BFEEF6224067A30E404EB65FBFC353D23FE01D2EBF13BA21C073E77B3F7EBC40C03C1C0F3F2290033FDFA4833C5D74F4BF70A320C0986E284024FF41C0264E6F3F928392BF565EE53F1E6E454097706FBF5DCE2DC01E754040603757BF6119D2BF8B8776BF29CD1040D8EC923FE168D7BF35DB593FD77F553F36158DBF80B407403F5C00C04E812E40EEE72340242465BDDDAA83BFE21C38C073541C409C59003F3D9F46C03D1A0B40AEDE7C3F3553CF3FA78313BE4C2124C02B70023C37D6FC3FF00A0C3F37A507BF0D739EBE79B21140AA8845C0262430C03C9A17C062D653BF4CBC84BE6E1B3E4022562AC0EB9B60BF00ED274065E116C041903DBFD5E5CCBF22F276BF840535C07A98A23F2868ECBFBD50D73E46A5973FE63E7A3F5962E7BF988E39C040FE31C03C502A408D4CCF3DE077623FD2CE41C069AA244093410ABF320B14C0000930C01E0A7B3E8625DB3F72F7AD3FB237FABFD4083C3F3D62EC3FECAA80BF42F75E3F1A7D1B3FD7AA2E4081B324C026AF1C4058E6434036CE8D3D7C4389BF1AD115403F7310C0580EF83E3D671AC0561843C065C225BF6B68CD3FD360893F5A6221C0FB9FAEBD5C61D83F116004BF9F60483E05DF7BBFE4DB484009363240438743C0A84D4740B62E2A3F67A003BFB83835C047851F406603123FDE191640CB4F32C09E30A13FD431CD3F9278A3BFCC5223407298DF3E78BFD2BFD99DA03F11F09EBFAF09823F120514C0A38B0EC0CA4728C09DF519C04D0305BF9904823F162F1DC0BE980BC0EB75613F59881CC05DC624403BB3B03E6515CDBFEB01D3BEBD9F33C020AF873F66A2E9BF49119FBE94AEA2BF6DDF043F27CFE0BF259917C07E5B3CC0E5273BC0E23B3ABF08E0543E7C4721C094BF29C00BEAFA3E863C2CC0A73033C0A22A2DBFDD9BCCBF8BFC7CBF72C3134018D1A6BF8C673D4000BC5A3FFA1C53BE55D0BE3EE1D4E83FE3F7294011C61E40C21F2BC097F347BFB4360DBFEC8E2640FD6D31C084F911BF32E93640BC7E47C0D2D8893FB2FECB3F64AB8A3FDE7F3E40971A963FB97BE43F805CA5BF22E2E3BEB8E724BFDA7DF03F"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
