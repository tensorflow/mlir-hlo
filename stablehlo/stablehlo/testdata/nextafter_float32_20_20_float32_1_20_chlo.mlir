// RUN: stablehlo-opt --chlo-pre-serialization-pipeline -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s | stablehlo-translate --serialize --target=current | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xf32>, tensor<1x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#1, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = chlo.next_after %0#0, %2 : tensor<20x20xf32>, tensor<20x20xf32> -> tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}, tensor<1x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x3CC2BFC0EC926B40DA7F83407093923F256E8F40070452BF98C0D9BFE74B5A408E559FBFA7C37140597DB84091DBFDBF4B019BC094B81340807BDDBFB5F53C40A8B4094044B2CF3F1290AFC0919FADC03064B3C07D33C6BFA7A969BEC94AAD40760E1E4087FA10C01E381EC09612A0407F1C16402CE94A401FF1154044421AC0E9758DBF362F96C06837B8BEF7B1E93D8986783DDCB3933FF7F483C0ABE4263EEF364EC0A0291FC0ACEB053FC12232C0448881BF528E8F403E68FA3E5B094F4041A286405B00E4C0607F03C084EE8DBF07787F3E695E1E407D4C63C0115A8A3F284DCC40970C3E3FB983923F880165BE03DA95BF947939C0C75C5140C8FA68BFBE2131C0116DEFBFA87E7DC089104CC0DF4225BF141F88406545D4C01F12953DBA839340F39C7F40CC22AFBFC269B0C08204D83F915CBE3F1CDBF8BF5482293F62AD8440A638243F7BD583C0C552D7C0F7DBC23F79685340DA9698C0570F2ABF286B86BF0D5F30408A38B7BED5DFD5BF39F695BF16ED8E40244ED4BF1DA18940E7E3FD40B3983BC0143E45BF70471BC067DD5D3FF48BA8404F62FA3F48BE1F403F37AD40439917C0E8138A3E7ACC7940F34B5CBE3DED7540DF9673C09EF82AC0B53607BF98411B40920298C0C6395140EADCA7BFAEDCEE3ED06246C0E116A8C0310693C00F7804C0831C3C404823DBBEAB9F1CC0B92392BE3977E73F2626D03F7445E53EEF3D87BE013F1DBFE5C2E83FC3B89EBFD05630BF7660A1BF2E319EBF513938BFB6295BBFE9E035BF503941C07C3C2BBE6F5342C0EEE3A43FD0BA8AC0533D09404D4856C02DEC803FF84EC7C001041240AAFAF3BF36C3CC3E7F1DB34037EFF43F95D799C052640E417E8533C0885110C07B7525C0F35283C097C097BEBC548C40B443D0BF800168BE8C8D0940993C8B40AB3132C0518AA63F92799EBFF7F02C40792E96C09FA70740FBFACDBFAF450E406CB32F40B794D1BF26D29240678A65BF54ECB13D6418114016828F40C10A843E562123402F02DBC0DF0CB24011621C40CFC90CC0191B823F798E80C0EB3C583FDDD5003F3B144DBF69C38F403C28C9BFDF3039C0995B844053BC0CC041DE78C07DE20E40694F043E56D499C0EDCDB04099BC6440EA6B02C0D2B78F3FFE8500C1F31C46405CFB29C0353C2CC0013518C019F9EF405B352D40D64537C003897B3FE6E9E7BFA062B6C00EAD003F0140913FD21145C0C29B813FEF74CBBF2845DFC0E856C6BF148F9B3F4D5B0F3F5D5165C07645BE3F39678BC0C8C230BF1484E9BF6A791E4159C3DA3F9C8D27407680E43E2EAA80400E3A9B4078E5823F3D8028C01DDF76BFD27C4C400CE64F401CF87640780505C0FF915840B12551BF78D5CE3E6F789EC0AB7EF63FEE228040D3F71840D26732C041B32FC08E92E1C0080D32C0D11588C0AF8939C06D381C407CEF16C000A58C3F17C3D84089B61CBF7A5AE53E3A1B46C0752CF33FBD98BBBFB33111408BC2F83E9AE90ABFA874973FED8CA1BF0074C5C0FD0851C0C364F0BE7063E6BEBC7258C0C737E83F203C58C0998EB6C0BD3901C07301E53FEBCECD3FAE332D404E1997C0B2527A4091B24BC08419A0BFF94B02407B490EC0C99B7C4040EBDC3F983123C0393F2140454E2EC0662447402D803E403EB2FFC00D8309C05C11B2401F6946C0A76B26C0471803BFF0CD10C00A0887BFC6DE5DBE449210408CEA8C3F150296BFF3BB17408E8A83C0E6AB8F40096830C01EE6B4C0F3573BC0C6252240700887BE5A85A3C07F07143D0CA70CBEEBC1B6408897C33F88821E3F4CEE7C40E8E00AC096AD73C0CFF10BC0CD7A0E3F0AC385BF4B81A2C0DAD344BF000679C024DB6BBC8DAD8C3F3C4D16C0BACDC13BCE2497BF5C560AC03A96303E9C57E6BF787C6040234FF43E07788DBCC347243F7595F4BE2F665AC056A9CF3F0571F33EA195C5BEEE532CBF005B93C03AABB13F166A00C0502E45407C159AC0AB78A8C02A30BC3F21A0E0406F9201414E55C2BD606FD140B8DB583F22C85A3E83B91DC0EF9A63C0026B3C404C4A8D40A9E1C23DF9AF813F9E60D44076CACD3E684834BDD2E454C08958BB3FCDF7B1BF6C562540279E08403D9F9640FBA813C080B2A3BF4FA39940710C8840E20008C099A2B04084A78840D71530C01BB41ABFB6AA0D4024D9B2BF1078D83F870D2DBFB08049BFD327B8BFB5AAB1C0E4CD8A3FA4C61D3F7D1891BEA4867C40311481C048664640445894C08960A6C072A67A3F"> : tensor<20x20xf32>
    %cst_0 = stablehlo.constant dense<[[0.890083789, -0.391410112, 0.785428106, -2.48780227, -1.64509737, -2.00489521, -3.22067952, -0.765830755, 4.66394377, 0.576535881, 1.49292409, 1.30754411, -1.3839196, 1.31058586, -1.05118334, -1.20111048, 0.0510369912, -3.10041928, 3.82744455, -0.814175069]]> : tensor<1x20xf32>
    return %cst, %cst_0 : tensor<20x20xf32>, tensor<1x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x3BC2BFC0EB926B40D97F83406F93923F246E8F40080452BF99C0D9BFE64B5A408D559FBFA6C37140587DB84090DBFDBF4A019BC093B813407F7BDDBFB4F53C40A7B4094043B2CF3F1190AFC0909FADC02F64B3C07C33C6BFA6A969BEC84AAD40750E1E4086FA10C01F381EC09512A040801C16402BE94A401EF1154043421AC0EA758DBF352F96C06937B8BEF6B1E93D8886783DDBB3933FF6F483C0AAE4263EEE364EC09F291FC0ADEB053FC02232C0458881BF518E8F403D68FA3E5A094F4042A286405A00E4C05F7F03C083EE8DBF06787F3E685E1E407C4C63C0105A8A3F274DCC40960C3E3FBA83923F890165BE02DA95BF937939C0C65C5140C9FA68BFBD2131C0126DEFBFA77E7DC088104CC0DE4225BF131F88406445D4C02012953DB9839340F29C7F40CB22AFBFC169B0C08104D83F905CBE3F1BDBF8BF5382293F61AD8440A538243F7AD583C0C452D7C0F6DBC23F78685340D99698C0580F2ABF276B86BF0C5F30408938B7BED4DFD5BF3AF695BF15ED8E40234ED4BF1CA18940E6E3FD40B4983BC0133E45BF6F471BC068DD5D3FF38BA8404E62FA3F47BE1F403E37AD40429917C0E7138A3E79CC7940F24B5CBE3CED7540DE9673C09DF82AC0B63607BF97411B40910298C0C5395140E9DCA7BFADDCEE3ECF6246C0E016A8C0300693C00E7804C0821C3C404923DBBEAA9F1CC0BA2392BE3877E73F2526D03F7545E53EEE3D87BE003F1DBFE4C2E83FC4B89EBFCF5630BF7560A1BF2D319EBF503938BFB7295BBFE8E035BF4F3941C07B3C2BBE6E5342C0EDE3A43FCFBA8AC0523D09404C4856C02CEC803FF74EC7C002041240A9FAF3BF37C3CC3E7E1DB34036EFF43F94D799C051640E417D8533C0875110C07C7525C0F25283C098C097BEBB548C40B343D0BF7F0168BE8B8D0940983C8B40AA3132C0508AA63F91799EBFF8F02C40782E96C09EA70740FAFACDBFAE450E406BB32F40B694D1BF25D29240668A65BF53ECB13D6518114015828F40C20A843E552123402E02DBC0DE0CB24010621C40CEC90CC0181B823F788E80C0EC3C583FDED5003F3A144DBF68C38F403B28C9BFDE3039C0985B844052BC0CC040DE78C07CE20E406A4F043E55D499C0ECCDB04098BC6440E96B02C0D1B78F3FFD8500C1F21C46405DFB29C0343C2CC0003518C018F9EF405A352D40D54537C002897B3FE5E9E7BF9F62B6C00DAD003F0040913FD31145C0C39B813FEE74CBBF2745DFC0E756C6BF138F9B3F4C5B0F3F5C5165C07545BE3F38678BC0C9C230BF1384E9BF69791E4158C3DA3F9B8D27407580E43E2DAA80400D3A9B4077E5823F3C8028C01EDF76BFD37C4C400BE64F401BF87640770505C0FE915840B22551BF77D5CE3E6E789EC0AA7EF63FED228040D4F71840D16732C040B32FC08D92E1C0070D32C0D01588C0AE8939C06C381C407BEF16C0FFA48C3F16C3D8408AB61CBF7B5AE53E391B46C0742CF33FBE98BBBFB23111408AC2F83E9BE90ABFA774973FEC8CA1BFFF73C5C0FC0851C0C264F0BE7163E6BEBB7258C0C637E83F1F3C58C0988EB6C0BE3901C07401E53FEACECD3FAD332D404D1997C0B1527A4090B24BC08519A0BFF84B02407C490EC0C89B7C4041EBDC3F973123C0383F2140444E2EC0652447402C803E403DB2FFC00C8309C05B11B240206946C0A66B26C0481803BFEFCD10C0090887BFC5DE5DBE439210408BEA8C3F160296BFF2BB17408D8A83C0E7AB8F40086830C01DE6B4C0F2573BC0C52522406F0887BE5985A3C07E07143D0BA70CBEEAC1B6408997C33F87821E3F4BEE7C40E7E00AC095AD73C0D0F10BC0CC7A0E3F0BC385BF4A81A2C0D9D344BFFF0579C023DB6BBC8EAD8C3F3B4D16C0B9CDC13BCD2497BF5B560AC03996303E9B57E6BF777C6040244FF43E08788DBCC447243F7495F4BE2E665AC055A9CF3F0471F33EA295C5BEEF532CBFFF5A93C03BABB13F156A00C04F2E45407B159AC0AA78A8C02930BC3F20A0E0406E9201414D55C2BD5F6FD140B9DB583F21C85A3E82B91DC0EE9A63C0016B3C404B4A8D40A8E1C23DF8AF813F9D60D44075CACD3E674834BDD1E454C08A58BB3FCCF7B1BF6B562540269E08403C9F9640FAA813C07FB2A3BF4EA39940700C8840E10008C098A2B04083A78840D61530C01CB41ABFB5AA0D4025D9B2BF0F78D83F880D2DBFAF8049BFD227B8BFB4AAB1C0E5CD8A3FA3C61D3F7C1891BEA3867C40301481C047664640435894C08860A6C071A67A3F"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
