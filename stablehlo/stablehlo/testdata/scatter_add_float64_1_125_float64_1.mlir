// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x125xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<0> : tensor<1xi64>
    %0:2 = call @inputs() : () -> (tensor<1x125xf64>, tensor<1xf64>)
    %1 = call @expected() : () -> tensor<1x125xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.add %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<1x125xf64>, tensor<1xi64>, tensor<1xf64>) -> tensor<1x125xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x125xf64>, tensor<1x125xf64>) -> ()
    return %2 : tensor<1x125xf64>
  }
  func.func private @inputs() -> (tensor<1x125xf64> {mhlo.layout_mode = "default"}, tensor<1xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xA2AE8FAF0D0FFABF156BCAEA5401F4BFD016287C6F0404C001BD40CB51AA08402038C481A4BA02400CBB3E53322C0C4056765817A6C7C8BF8618D8F8CCFEF43F8928AFAD7A7CB13F9B400042318D12403C51D9BA3C8D00C079769E9DEEC31140530C1B51762A114014E9884E40D81840FEED7645B82F1440135ED8A4664EE23F9105425EA39817C08A618C7A24DAFC3FBC1541311F9102C059CE59EA133707C0C472C8DEF356F13F9040D03D4B060140244B1967CE2303C07A72FFE2B7B7EE3F64028BA7CA1C094072E40CE883B3F33FCCA7B64C732EF63FAAD8B4F9AA370BC0B0208E92E658C53F1067D64B21C111405F36A730659F134096BC7F1E0EF514C048405C48CC0907C03766908351A902C0F696A379DF530AC06E0FC3DED6AF1B40BBF6A02A6A0D1AC0F066B035C61108C063A54EC0287ECA3F3B6FF26337C103C0BCD0739C00B8F73F3E678BBF9E3619403FC0703BB2EB04C0742FEB492C94DBBF98A53F16502800408EA519912843174079EC40577E45F43F37131AF10102A43F7179502591CAE03F2E5770145405D13F1A8C7F677DD31AC0DE144B75C01710403F190CFB9B4105C0C6ACB768601D09C06BBA5C6029AB0740BC5C36FB6029E23F7291FF709F50FB3F32681172A463DB3F0A68FE4FC86403C05CA47504AA8FF63F8396515A0F85C4BF809B8349AF4604C07766AF0DA546D33F64E773405835F8BF4F89D8BC283307C00A5B996D87CB0FC00B28956C5724FFBFE473E150781BFE3F81E1FAE4F36CA03F8166B766C14F04C0EF9086FBBB19D9BF1367DB4E4218F0BFBC38A8EE1E4F0A40E47BB32E9FC70B40E07098152FDAED3FEEAF40124BC800C059AA29579492D83F5188CBDDE8FFC7BFC253D334FFCE13C0A507A97B8D11F4BF7EAC7CD361311EC04EA77E845780FD3F459ABA765A5506C0121DF16714CF06C067D8C73CC414F23F6F7A933506EDF53FDE0336DBF1A6F53FACA5ABF4654D014068C941A189C5E8BFAD4B63D240C2F2BF76E0E23D9D4405C05E9D6FD961A4DEBFE10E3286E9A1FD3FC015A5AC104A09C0C6C507C2977D0140AA345A659E98E63F1D7E4A3CD30100C0DA626258FFB90140F88B680E28DC00C0846BE86D5AD4FCBFAB536ACB1F5224C0C03263293FCD0240F6DAB87C610015C0557BA9D84B891A40FA6351CE2F7500406E7EF30439B2F33FE2F3564F4D3D03405FBA8E5666FA0B40116EE29F912901C09D997B26DA8711C035539695392BD2BF1E8195EAF368E13F70DA776A1AD301C07B01EB37A64707C07E7C6FB42F3110406CD2E59C5031C33F1444C00A5218E13FF09B5BC8D79AF4BF08B0C754EA0BCA3F60612B8735020DC07279910076EA09C01C21AB08693C214038D8B06C439EF2BFD47237B0B2CCE63F293C21E16923E4BF"> : tensor<1x125xf64>
    %cst_0 = stablehlo.constant dense<5.0622738423283948> : tensor<1xf64>
    return %cst, %cst_0 : tensor<1x125xf64>, tensor<1xf64>
  }
  func.func private @expected() -> (tensor<1x125xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8FBBD99502780B40156BCAEA5401F4BFD016287C6F0404C001BD40CB51AA08402038C481A4BA02400CBB3E53322C0C4056765817A6C7C8BF8618D8F8CCFEF43F8928AFAD7A7CB13F9B400042318D12403C51D9BA3C8D00C079769E9DEEC31140530C1B51762A114014E9884E40D81840FEED7645B82F1440135ED8A4664EE23F9105425EA39817C08A618C7A24DAFC3FBC1541311F9102C059CE59EA133707C0C472C8DEF356F13F9040D03D4B060140244B1967CE2303C07A72FFE2B7B7EE3F64028BA7CA1C094072E40CE883B3F33FCCA7B64C732EF63FAAD8B4F9AA370BC0B0208E92E658C53F1067D64B21C111405F36A730659F134096BC7F1E0EF514C048405C48CC0907C03766908351A902C0F696A379DF530AC06E0FC3DED6AF1B40BBF6A02A6A0D1AC0F066B035C61108C063A54EC0287ECA3F3B6FF26337C103C0BCD0739C00B8F73F3E678BBF9E3619403FC0703BB2EB04C0742FEB492C94DBBF98A53F16502800408EA519912843174079EC40577E45F43F37131AF10102A43F7179502591CAE03F2E5770145405D13F1A8C7F677DD31AC0DE144B75C01710403F190CFB9B4105C0C6ACB768601D09C06BBA5C6029AB0740BC5C36FB6029E23F7291FF709F50FB3F32681172A463DB3F0A68FE4FC86403C05CA47504AA8FF63F8396515A0F85C4BF809B8349AF4604C07766AF0DA546D33F64E773405835F8BF4F89D8BC283307C00A5B996D87CB0FC00B28956C5724FFBFE473E150781BFE3F81E1FAE4F36CA03F8166B766C14F04C0EF9086FBBB19D9BF1367DB4E4218F0BFBC38A8EE1E4F0A40E47BB32E9FC70B40E07098152FDAED3FEEAF40124BC800C059AA29579492D83F5188CBDDE8FFC7BFC253D334FFCE13C0A507A97B8D11F4BF7EAC7CD361311EC04EA77E845780FD3F459ABA765A5506C0121DF16714CF06C067D8C73CC414F23F6F7A933506EDF53FDE0336DBF1A6F53FACA5ABF4654D014068C941A189C5E8BFAD4B63D240C2F2BF76E0E23D9D4405C05E9D6FD961A4DEBFE10E3286E9A1FD3FC015A5AC104A09C0C6C507C2977D0140AA345A659E98E63F1D7E4A3CD30100C0DA626258FFB90140F88B680E28DC00C0846BE86D5AD4FCBFAB536ACB1F5224C0C03263293FCD0240F6DAB87C610015C0557BA9D84B891A40FA6351CE2F7500406E7EF30439B2F33FE2F3564F4D3D03405FBA8E5666FA0B40116EE29F912901C09D997B26DA8711C035539695392BD2BF1E8195EAF368E13F70DA776A1AD301C07B01EB37A64707C07E7C6FB42F3110406CD2E59C5031C33F1444C00A5218E13FF09B5BC8D79AF4BF08B0C754EA0BCA3F60612B8735020DC07279910076EA09C01C21AB08693C214038D8B06C439EF2BFD47237B0B2CCE63F293C21E16923E4BF"> : tensor<1x125xf64>
    return %cst : tensor<1x125xf64>
  }
}
