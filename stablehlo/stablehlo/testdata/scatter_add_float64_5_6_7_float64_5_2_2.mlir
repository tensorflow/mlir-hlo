// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.add %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x2xi64>, tensor<5x2x2xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE08279E64A71FCBFE49E2D5D3586FB3FB9D28277910BE9BF540DBC97984409402E7D4E6B24DDD9BF01ADAE36A15813C08A33E221A89703C0CC526A1270FB01408F74CF1715DCE13FBD2F676B44960D404637279F108318C0EEA86F163D39F63F9C54F485629B0640CEC31AC0EBC91640107B16DAEF3D1BC0D021E1FDE62C01406F3AEB74BF6403406897C09A1D5AE43FEF05E9736322F23FA9E1A652803310C0872C23DF994A0AC0C04326B7D3F0CDBFE60E11E8DE1FE6BF98C00ED097A40EC04A126F0B38510B4000A5156FD93E03400A7209131D1E02C06BDC4CD51E56FEBF15BD2EB0B8EFE1BFC0BA28F9116FD9BFA8980759AF9D08C0047DFFB7401C1240DF4E15F556A9134012B2EC14CC49034099FC9495BB6F17408FA93C40C563DE3FEEBC2F3872BB1140DE24C876129B0F408B8B8DC8CA140440843D3F63915709C0404BB2034B16F6BF808596BF01280340C2125C6DBAA4E8BF0DF718B0B831FBBFC405FCE6C02E1840EC5E6E56B10E01C024CDDD99439A1FC0EFCA3A6F1FBF0240EE7FCCD3AF9803407190F617B80214C06576319432D8F73F0EEC2C18716E19C02F5AEB4C4707D5BFBD97BFE73D7A07C0B683B5A330BCF9BF206D1E115612C23F1F6AADCC41F613C005A9FB9C596A06C0D25F6B45B04EF6BFB08AD4471AA8F4BF16B7EDF881E4E03F221818C7AD93EC3F6ED21D4DCDBC114092B694CE485400C0F0B9B9A74C91E83F9CA8EFD6FD4CE53F169DFEE5495B1C40E46ABBE2D26E01C0309FA5B39DE21240D1C88540AEB10E40BE0AFEF6ADD7EB3FF05664B78F0B11C0BEE62F61BE8201C03F4ED91E8B1DCDBF0E7EC69BA4D30240F3A73CE3ECA0FDBF972240B42443F63FCDBCE4A4CF851240EAE012501CEA14C04D9881AAC2A913400066E61D1046F63F0C37A75A1D6302C09B6050D5895A13C08FDAE6FAC632064007DC91A42C390A40DC40B28EFC6AE73F701A835E0D0DF23FD4D245C226DD04C0402B73A5878ACEBFA3C21D2D9B290BC0939D74CE0B5401C0EC3A13470844F23F40588D5824C4F93F2803C95D65B702405C7B52780838FC3F46C71CC0E413194084D359B88845C1BF5A9199C7CD5CCABFA78F2DA1D510024015F11CD048DC004021EB5673B41C0740C1FC6186A08703C0C3302F49D28FF23F7A4C1BEA75BDD6BFE1E59B1AE5EBF63FDF346AC375280340439C08961DA505C0285FF71D7FD1AA3FC44F8DFEFF9CD5BF7CD56DC72C740F40BA2C015545C31840573994C7C7DF034082B8B4D93B9BF3BF63EA7FF125E713C0F775449571F116C0409FC80784B30B40C4C4B0B877E10C408CC2FDC41CF50BC09B55FDF23316FA3FB169B6AA740AE43F044D9E522F571040E8B02CE4BE6603C0650ECC5D77290CC0FEEA7C11627FCEBF2C111BEE8BD805C0FC84AA9E82BD10C079FA87814F2CD93F61C10B0C5F2B0A401AEFB67C5CD806C0EE2D2E4C06FDFBBF7C754E875ADB18C0273AF835DE39E5BFACCA3106A04EFF3FC13FB4506FF1E6BFF3C3EF82286F0440B41491BE545B0A4068F3103B1812FB3F5EE5741C8DC80DC0FCDE6741B0920FC023F381457D74E8BF9F8F7599707D01C034788ACA486813C0947043D92B93F33F2338D5FBC5A1ED3FD2E5A47C494013C088715EB4C88B02C03CA5AEF79BBFF2BFB7817500F7EFE0BFEB037DD5D15FFDBFF45630124377F03FEEFF41A313A2F73FA016373A3ED010405E4EE1273F470F40ED340E0A02C720C0E012BBF8D55615C015430732E638E4BF54F1908663A3ED3F2617DB96DEB013C036902F4029750AC0B131003D963AC1BFCB36CAA83A63D2BF4E917DACA36408406A58C63AD9DA00C086F736C28DF608C00C27376C6AC1E2BF7A0B5B19C13DC73F660928DB2EA9EB3F0B719C8B9167F0BF126418F331A9DCBFFD17862D06CF10C022AF73079CEAE6BF79C3DA831F3701C044173F67E111E2BF10F25939064C08401E0167EFD7CF15406E3F05CAD5F80CC0F2D5ECFA0A94E6BF7B94BBD96A5A00409AFD67C36F9C074062AFF9B401A2BDBF86B753B3D37DEABF5E14706DBD5589BF08EBCE61D32E11409A5CA5D29315FE3FD906AE54099A11403E67CC07F004F8BF809CA44DE7DEE0BF6AD4FABE0E230140695656924FA71BC0070F6B29F5D3F93F0E1A16F51FB801C04E63ACF240C8DABF628B4F3D361D174049D2B49B504016C039309C464B9311C0462D8E35CE1F03C0BD2EAEB563DA06C0E4613E49F7EA0540328C7353C09D07C0DE0FD4F7D226DCBFA681AC299A701E40D81E596B4DCAD0BF82561B2027930440084A67E58A20E83F8F0393031AB804400AE3AF173F7C16C026C3B99FA85ACEBFF0D8E345FC5E1240D88CBF38EAC5EFBF24608EC5AE7BF5BF"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[[2.2251468677827151, -0.77201898786074441], [-3.379688705120552, 0.53696752818767146]], [[1.3294654891950075, -0.50912646562896935], [3.2073725836762872, 2.567234881069429]], [[-5.1444842956312682, -5.2384840601737412], [-8.7921203898760165, -1.5785161550406872]], [[-7.1071654273139719, 3.1813142514377186], [-2.114031439944414, 1.3643422461385686]], [[-2.0096320449831362, 0.45560615508016516], [-3.6510776147929924, -0.21112933587325927]]]> : tensor<5x2x2xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE08279E64A71FCBFF932A67B34900F40B9D28277910BE9BF540DBC97984409402E7D4E6B24DDD9BF01ADAE36A15813C08A33E221A89703C0CC526A1270FB01408F74CF1715DCE13FCCE98506FDF010404637279F108318C0EEA86F163D39F63F9C54F485629B0640CEC31AC0EBC91640107B16DAEF3D1BC0D021E1FDE62C01406F3AEB74BF64034000025E3D0E69C1BFEF05E9736322F23FA9E1A652803310C0872C23DF994A0AC0C04326B7D3F0CDBFE60E11E8DE1FE6BF98C00ED097A40EC04A126F0B38510B4000A5156FD93E03400A7209131D1E02C06BDC4CD51E56FEBF59E9646788850FC0C0BA28F9116FD9BFA8980759AF9D08C0047DFFB7401C1240DF4E15F556A9134012B2EC14CC49034099FC9495BB6F17408FA93C40C563DE3FEEBC2F3872BB1140DE24C876129B0F408B8B8DC8CA140440843D3F63915709C0404BB2034B16F6BF808596BF01280340C2125C6DBAA4E8BFCCA71355ECB0D7BFC405FCE6C02E1840EC5E6E56B10E01C024CDDD99439A1FC0EFCA3A6F1FBF0240EE7FCCD3AF9803407190F617B80214C06576319432D8F73F52185FBF2F530EC02F5AEB4C4707D5BFBD97BFE73D7A07C0B683B5A330BCF9BF206D1E115612C23F1F6AADCC41F613C005A9FB9C596A06C0D25F6B45B04EF6BF7C03CB127CCDFCBF16B7EDF881E4E03F221818C7AD93EC3F6ED21D4DCDBC114092B694CE485400C0F0B9B9A74C91E83F9CA8EFD6FD4CE53F169DFEE5495B1C40E46ABBE2D26E01C0309FA5B39DE21240D1C88540AEB10E4076A963394F4F1040F05664B78F0B11C0BEE62F61BE8201C03F4ED91E8B1DCDBF0E7EC69BA4D30240F3A73CE3ECA0FDBF972240B42443F63FCDBCE4A4CF851240EAE012501CEA14C04D9881AAC2A913400066E61D1046F63F0C37A75A1D6302C09B6050D5895A13C08FDAE6FAC632064007DC91A42C390A4050CE1B1F94A611C0701A835E0D0DF23FD4D245C226DD04C0402B73A5878ACEBFA3C21D2D9B290BC0939D74CE0B5401C0EC3A13470844F23F40588D5824C4F93FAA9C6027615AE83F5C7B52780838FC3F46C71CC0E413194084D359B88845C1BF5A9199C7CD5CCABFA78F2DA1D510024015F11CD048DC004021EB5673B41C07406A3F8D6D05B81EC0C3302F49D28FF23F7A4C1BEA75BDD6BFE1E59B1AE5EBF63FDF346AC375280340439C08961DA505C0285FF71D7FD1AA3FC44F8DFEFF9CD5BF7CD56DC72C740F40BA2C015545C31840573994C7C7DF0340579DF848F80824C063EA7FF125E713C0F775449571F116C0409FC80784B30B40C4C4B0B877E10C408CC2FDC41CF50BC09B55FDF23316FA3FB169B6AA740AE43F044D9E522F571040E8B02CE4BE6603C0650ECC5D77290CC0FEEA7C11627FCEBF2C111BEE8BD805C0FC84AA9E82BD10C079FA87814F2CD93FFDD820801AB00EC01AEFB67C5CD806C0EE2D2E4C06FDFBBF7C754E875ADB18C0273AF835DE39E5BFACCA3106A04EFF3FC13FB4506FF1E6BFF3C3EF82286F0440E1678781C0A2124068F3103B1812FB3F5EE5741C8DC80DC0FCDE6741B0920FC023F381457D74E8BF9F8F7599707D01C034788ACA486813C0947043D92B93F33F1C8CEB30E36D1040D2E5A47C494013C088715EB4C88B02C03CA5AEF79BBFF2BFB7817500F7EFE0BFEB037DD5D15FFDBFF45630124377F03FEEFF41A313A2F73FA016373A3ED010405E4EE1273F470F40ED340E0A02C720C0922E20A19ACB1DC015430732E638E4BF54F1908663A3ED3F2617DB96DEB013C036902F4029750AC0B131003D963AC1BFCB36CAA83A63D2BF4E917DACA36408406A58C63AD9DA00C086F736C28DF608C00C27376C6AC1E2BF7A0B5B19C13DC73F660928DB2EA9EB3F0B719C8B9167F0BF126418F331A9DCBFDEE01E29E3D818C022AF73079CEAE6BF79C3DA831F3701C044173F67E111E2BF10F25939064C08401E0167EFD7CF15406E3F05CAD5F80CC0F2D5ECFA0A94E6BF9754EA8B0C54FD3F9AFD67C36F9C074062AFF9B401A2BDBF86B753B3D37DEABF5E14706DBD5589BF08EBCE61D32E11409A5CA5D29315FE3FD906AE54099A1140EE97CD59C6BAF0BF809CA44DE7DEE0BF6AD4FABE0E230140695656924FA71BC0070F6B29F5D3F93F0E1A16F51FB801C04E63ACF240C8DABF628B4F3D361D174049D2B49B504016C039309C464B9311C0462D8E35CE1F03C09ADDF1F1E5071AC0E4613E49F7EA0540328C7353C09D07C0DE0FD4F7D226DCBFA681AC299A701E40D81E596B4DCAD0BF82561B2027930440084A67E58A20E83F8F0393031AB804400AE3AF173F7C16C026C3B99FA85ACEBFF0D8E345FC5E1240D88CBF38EAC5EFBF24608EC5AE7BF5BF"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
