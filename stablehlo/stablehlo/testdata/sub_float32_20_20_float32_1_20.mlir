// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xf32>, tensor<1x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#1, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = stablehlo.subtract %0#0, %2 : tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}, tensor<1x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xB2B6D3C0479872C06CFFD1BF40F73BC0B82F80C0C1E490401181D53ED561E1BD16C286C0D3389B3FD1C75540BC2B313FB61FE7BF52A42F40D693B440232087403862883F91642DC014AB28BF110DC93FEED0BC3F9F3F8BC09C5BADBF30E02A3FF6118B402D3F85C0693A913FF68FFABF70CB2A40087D5CBF5CA9554003E700C0C92C653F261BD0402350683FE29400C02FFE6C3FA7A1EFBC1C0187BF32FF343F8C67BF3FF4BD33C023F6EF3F14ED07C0BDBDCDBFE8661D40A09265BF9B824E4027184640380C8D3F62A5CD40180238409739A7BF8C248DC0881D1340F9F66C4010B34A3C6C12A53F2811F4BE7672C0BFBC77683E548246C042E4F53F3EB6FBC07A3C733F5B29EA40CB5BB73F5C9974C0D7EED03FA879D4BF6ADC923F553A0440B366DEC0634A4ABF371699C04DF43EBFD57918403EFC8FBE48AB34C038D111C088F400C0E96C88BF0DFEDDBEF7E37BC02A9308C07A62713F408F2CC0B546394077BC96BEFB4692C05425E93F37E065409679843F4CA641C0E502BDBFE27CF03EAC4CF2C0C3EA7940BA28B240618D89C01FD4973D11A3B33F43E007C0C43EA5BFB8071CC0459BF1BFD44C8D40FAB295402F629BBE7363F6BFE2412240F1E8BA3FBAE801404F998740CAE7453F921BBCC0650316C0B3182740E8785B40D91AA5C08F41333FC1DA4FBFF6CDBFBE20A902C0E6960F40623B573F793902C0127E9B3EBC1D35C052DC8DBF588D0740CC264BC0E85FB23EC994E13EF199E2BF67019EBFC99F8B3F8F33C4C0E3C9AE3F10B242C0F12576BFC23346BF52EC6FC060F01FC096847A406ADB9F40E337B8C0B6A576C0A19553C0ABD68EC0A0668140A2E0323F6B05D0BF3A2D04C0F871E9BF6D3E83C0E0ABB9BFB65709406DC506405E97ECBE850929BD7C2D61BFFCB4F8BEFF949F40DD462C4095E6693F2256E340AA4AE83F44509D40DCCD3ABE384198407EB9AFBF307D4E407F13A0C01FFEF83F57FB1AC08EE415C0BFFBD53E8AF786C0B1AA80BFFE9A0C4052FFA63F8750E7BF85F539C0634377C0D61E7FC0BEDB11BD409A58C07DD900C0B2C0123F77C44F4077EDA74046B529C0D55E9F3E15DCB440E3648DBD92F9813FC6BE62BE0D7EB53F8FEBA6BE0F314FC0785C563FA18E77BF75CB68C0D94915BEA62AC03FABEFAD3F88342A40C3C91BC00EE3EDBFF7A61CBD2CA8074041F79D3F0D99503F8197C53F7621BCC008B308402D46A53F0D574B40B93B0F40145DAC4039E99DC01E57273F2DB7E73F1F1E95406D6249C077441940E4180A40AEEBEABFF380953FF2EF11404167134023C242C0F00BF4BF6DC7F43FD6A117C0F6FD78C0544D15BE09E8E7B8F84682C054D836C0BAC8D73FB97DA2BFC0D542C0ABBA613D70469E3ECEC1ED3EC0069F3F36BAB3403D7C88BF15A30A40E1061ABF567A93BF6FF96EC0C8C9F24003764140CD1DA03E66ECF8BEC42F7840A6BE34BED53AD33F9FC5C7BEF037B2BFB20B05C077B1824060326BC02255273D731D70BF323847C0146891C096EEFDBD4FA1B33ECD64CDC0D41D54BE5B43D6BE10AA813F2866C53F06F6843FA1517BC09A57C0C0B660C23F16383C40BB3A703F0C1F803E636F11BFA83000C01391033EEE86ED3F001D663FD7E0EABEB7F1D33E78C5644033DDE8BF136546407164BB3FE457BCBF705104401ECEEC3F9C53C9C07863953D6BDB27BF4C3A3B408A392B4004F590C0AB1C8ABEDAF0C33DBEFAD5C0F4F8A3C02A920CBF98A33F3D3605543F8E603B40F8DBDFBFD2F20E409F6235C0BD91B2BF78DF0E407275403F741EB240BB68C53F0A455EBEEEB98B3E24464F3DEDCB5DBF25C87B4035E545409D8391C0F7EB1B401EF8B53D1584FBBF95296740F03618BE490FAB40D7F0F5BF2B3A013F3AB27440F24CE43ED547953FCDE416C0DB4497405FCC93BDE98E573EA832EFC07E32BABFD05598BD854382402A26F43FD673E3BF3239044035C2A7BF40A8AB40505BF83D2C45923EB343C73EA53CF340D6B8B43F3D734640FDAA7BBF9F83F8BDD226363E91A29FBED29112C0239C04C156FAE53F83E6F23F6909C5406AE3383FC92344C0FAF3D23EF1807B40937EFA3FFBB5BDC008829D40433A933F478704C09C04534073A0123F5D75314033AE07C0CBFD2C3FF2EB983DE76A43C09339C2BEE28E00400DFDB4C07CC79C3F7A360CC001362BC0DB438040913A883F51BFE73FA06723C06D510B407C9F1BC09F0EF93F74BB2BC07FD5F3BDE0DF303F1609DEBF1DF6113F"> : tensor<20x20xf32>
    %cst_0 = stablehlo.constant dense<[[-0.370302677, 5.47239923, -0.623100519, -2.345783, 5.09209824, 2.43723726, -1.24062657, 6.36053324, 1.21303213, -0.114138119, 7.13908052, 2.34094715, -5.64296436, 5.38564396, -1.51352215, -0.191716373, -0.485118151, 1.86591887, -0.608985186, -0.69162321]]> : tensor<1x20xf32>
    return %cst, %cst_0 : tensor<20x20xf32>, tensor<1x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x2DDDC7C0043514C1AA3D82BFC45717BF189111C1D0CD05401E2DD43F040FCFC03F93ADC0E7D4A93FE11E73C04A0ED3BF79967540120A29C09C02E540AD428D40927AC63FE46792C0004A4CBD16CA10400237EC3FC22E1DC1B4333BBF5BD9404010043FBF063DD3C0A2031840BD1605C13D52BA3FE0443FBF563D73C08C5C8BC0C338D140D00F8F3F95F11A409A9FE8BF7297B43FF594F2BF8837E4BEB506B33FA0CDEE3F707E04C1F2DB1F40B043633EE761D6C0009BB53C280EB03E5F9048C0ABEBF03F4CA89B3FB86F36BF10C0083FC4C48A40DFBD1CC114FB73400E3C794000B7FE3E048813BF8077073EB4D64FBF17EA183F882F09C102D3224096A5B0C0E98A84C0822B9C4052142B4016EB22C1D0A8D63E94DDC5BF3EBCBFC0F8BD8CBE244EA7BF7EA0C5C0E24E51C0FADF0DBF02863740BF6A09C0ABB10DC0541BCBBFFC82D2BF1F39D1C0F611423E5085CBBF0D3CE7C02746BFBFA651BABF45CC5DC0C1F3C0BFF69F8EC0042AAAC0461CA03F90B1D5402C9506C16006173DC452293F96C6E2C08C7F024088A5C54034D766C0588DE33E213582C0C4FEBFBFDA03873F54F6F0C0AA648AC00A00B5400C5AD7BF2F1DC2BF5FC7E7BF685293C06E7661BF8787F5408CF792BF7E57124008F9B5C070EEEDBFF0B53E3F4239814012F98EC0DC06893F3D19C9C024727E3E78C19B3E0A4E36C0B359CCBF304C4BBF9CD1C1C0076081C07C807EBFADACA0C0707CB0C028B9BF40E53D9EC0647B83BE3E7785BF23B8C93F2AE9FFC01DBDFC3F826E16C0C95917BF5DE4C7C0710B48C010F11CBEB4C096BF22BB2340AC8490C02C6E23C1F99B90C0A62F8BC0721946C0D733D2BFCF918040CF6DEEC080DB9EBEC5377AC00C2777BFF8638F3E0ABF2D40240A6B3E1F77A83E9443CBC018A40C3EA6A5EA40139E19C01A04C3BFAC840541D27691C036FE6C4079DA8BBD426418C0D3AE6DC0E1E80D41583526C19C5C5D4042B60EC0C2B0EDBF7E57B9BF77F566C0548EA0BE084E2440105E85C0C58E97BFD8500FBF154A0FC1448DCDC0FC3D9A3F4EEB1BC1CE7B4EC0DAF82F3F3B2279C0DA083A400E713F404561A2C0DB4AE540B53DFB3DEC11C03F239705C0A4B80140E130BB3E057E37C0565294C03A16B0BE4C54A5BFC79CA7C07C996FBF425E264072DE6CC0146C69C0FA46DFBFA7ACE5C0809E62BEFA10DC40104492C04CA94340ECFEB5C035BF2740822013BFAA507240477F3B409936B8408F8326C1516DA33F73FE84409045DDBE10AFB2C0E4AA68400B7D86C0281843C0071DA43F607B9BC0C0B41ABD316426402E5AE9C042415B40C15C0BC0C9F159C00CC000C035DF1B3F624A58C04A251FC06D5772C0EE7725BFC4D132BF032FA1C0E43208C04E3DDA3FCDC7A3C00DE98C4052C073BFCE219FC0CC533CC094B48F40F5E911C1479C114118BB4D409A3F4C3FC48816C0B0948F408EDE033F745001403F9ABBC05CEC44BFE8AC883E040481BF0997C3C08307A43F2B8DE9C0426D8AC00FC18DC0136BE8C0D4BBFEBF188D46BF21F8B2C0412A8C3F3A349A3F41BF0140D0C053BF045854C0D335AAC0CAC6F13FB40322C020DFC73F302526406420B5C02D168EC0FC3EAF3FC22790C08CD8A0BE8770B0BE3E34D7C0C8E69D3FBAB77440514912C0C48F3E40BACDA3BF9D5D2340001482BCCED6B5C0A7BA433F861E92BE7E0123C06B1A5340B9C80BC04394ABC02BDC15C08847AEC038C137C1B88DE1BF86C9243EB2F2C9C0E839163F5838794092BB49C0260AA9BF94079ABFA5EB2D40B59B8EBF429BC540ECF70E4096EB1C3E4662A6C0E6772C3FA85CBD3F963994BF0CA6273FCDA053C003277BC021E58FBF01E8ECBF1DBD61C083551FC03AD12F4168D3E9C0172C0140A77B80402D576E3F321D33BF60D6DFBFA266AD4038A5983E6E61A8C03842DBC04020643FCF53A5C0B016D13F82794940393302C1825B5A3F212699BF642CE3BF3A0F0EC07DB7BD40F7E29FC0B6D511410043CD3F6A7F6540F65536C000ACF93EEC975E3FF8AD6F3DCE66F8C0D647F5C03D8F8440AE714CC020176E408F3EFB3FB1CD16C1490F4DBF7D678140B4D3A5C0824F04C1990A2941A18887C0ECA60EBFB1495F409468873F9828683F2C69C1BF0206AF3F4CD3E33EAC6908C1EA9A793E18588B40C2F72BC1E82F9BBF344073BF3F9210C164E53240A5D6963F8583AAC0DA9C9CC0E03BFA40F026FAC0DC645D405F761FC0086CBB3E7E6696BFDC1590BF2A82A13F"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
