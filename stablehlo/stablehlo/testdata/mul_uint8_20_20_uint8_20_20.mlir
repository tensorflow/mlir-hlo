// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xui8> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xui8>, tensor<20x20xui8>)
    %1 = call @expected() : () -> tensor<20x20xui8>
    %2 = stablehlo.multiply %0#0, %0#1 : tensor<20x20xui8>
    stablehlo.custom_call @check.expect_eq(%2, %1) {has_side_effect = true} : (tensor<20x20xui8>, tensor<20x20xui8>) -> ()
    return %2 : tensor<20x20xui8>
  }
  func.func private @inputs() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}, tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x01000803010204000004020300010107070200000401000001040000010000070001010404000402030307030100040200010102020504000002000106000107020102030304020600010201020101020006000401000202020100000000000108020204010105010001040107010101010600030001020105040002020301010300010103010100000101050001000401020001020201000400040000010101020100010102020A0102000302010405040401000000000201000004010200040205030502000405010101010003010405000000000303000200010400020101040105040000020100060003000003020000030304010703000204000101020201010201020202040000040100030504020404020305030000070102010100010006070000010501050700030A010402030000000001020103010006010201030200010402020001050504020301000801000302000104000104000102030003030201010102000400010307030003040004010000020106020103010102010501000004020303020001030503020500"> : tensor<20x20xui8>
    %c_0 = stablehlo.constant dense<"0x03040102010004010004010302000300020301020303000101000003040102030002000303010402030200020101020201000000010201010101030101010203000003000302030300040203030202010200010000000303010200040103010403010201010301010004060102020101020605000102030405020100000501000003000200010005000004020001010300040307030102010000050303010002050500030200010200030100020105000403040004000301020003000000040000000200040202000301030301010000030003040100040106000701000101020101030300010000000203000003010202010103000203040101000000010502040203010002000301000300010405020301020303050104010305010608020204000301030101000400040001030100000202010400000100000200000102020301070402050502000206000301020002030502010200020202000101000101010205010104030207010101010203010400000301030002050204000001010006000400000100030201000302010301"> : tensor<20x20xui8>
    return %c, %c_0 : tensor<20x20xui8>, tensor<20x20xui8>
  }
  func.func private @expected() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x030008060100100000100209000003000E0600000C03000001000000040000150002000C0C001004090600060100080400000000020A0400000200010600021500000600090806120004040306020202000000000000060602020000000000041802040401030501000418010E020101022400000002060419080000000F010000000002000100000000040A0001000C000800070602020000001400000100020A050003020002140006000004011400100C0400000000020200000000000000000006000800080003010303000300000F00000000000C000C0007040002010204010F0C00000000000C000000000304000003090002150C0002000000010A04040206010004000C00000C00000C1908060408060919030000150502060800020000150000010500140000000A0304000000000000000001000000000002020606000710040A0002000A18000901000002000F0400020000020800010200000303040501010800080001030703000904000000000006000C0A020C000002010006000000000300060001000F06020F00"> : tensor<20x20xui8>
    return %c : tensor<20x20xui8>
  }
}
