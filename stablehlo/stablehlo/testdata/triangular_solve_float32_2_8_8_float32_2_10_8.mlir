// RUN-DISABLED(no interpreter support): stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<2x10x8xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<2x8x8xf32>, tensor<2x10x8xf32>)
    %1 = call @expected() : () -> tensor<2x10x8xf32>
    %2 = "stablehlo.triangular_solve"(%0#0, %0#1) <{left_side = false, lower = false, transpose_a = #stablehlo<transpose NO_TRANSPOSE>, unit_diagonal = false}> : (tensor<2x8x8xf32>, tensor<2x10x8xf32>) -> tensor<2x10x8xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<2x10x8xf32>, tensor<2x10x8xf32>) -> ()
    return %2 : tensor<2x10x8xf32>
  }
  func.func private @inputs() -> (tensor<2x8x8xf32> {mhlo.layout_mode = "default"}, tensor<2x10x8xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8E4907BE1FC0923F2434C43E4AE30ABFA9EDB63F5E1E34C0B42C164004B0B83E0D6890C03D130BBFAC5B9C408F138D400F4005C0C843464099E88D4087EAE83FD3BE1940D4A5A2403DDFC13E6251D73F2DF611BFAC62B73F94E59B3F1775DBBFA66C54BF5DEBAEBE386B09C02C84FF3C933A9ABF44C9883F04EF72C090398E3EA7F68DBF233F45406825F9BFB6B54A3F5DE4A03FEE789C3E905E0E401CFF113F4EEBB140E464BABFD44475BFCBC9E5BF3BA62840A9EC8A3FD64AE8BF0C2F933DAE7052BDF36F55C0607BF43E6228AEBF0277A24065CFA23F24FFA6BF252B18BE9FEA9AC074D0164049C40540F91BBCC067391840CD3EA040B2F78A4049E8333F69A520C0AD6482C07E3DD3BFC2614840769AAABFFCC885C03F52AA3E7338BF404D966DBEE96E42C0AACB26BFB813EA3FDD510DC0231D03400C43D0C0834FA63FC2A9EDBEF845D7BD50599FBF8CE5D33F60466DBFAF1854C029CC47C087379B3FD5A009BF7AB402BFC543EFBF3E3C123F209392BEA99ED5BEC971B34063F419BFA3BCAF3E9ED83DC0610F0AC0E6336240D65B8340881CD93E12BFCC3F24BE82BE6669674029BD0C3E7257C9BFF34A6D40EB7FC540DB891A40C78CA340BBA891BF5C64B6401B689ABEA6A038C0918E283FD7360AC0B7A7503F169CE9BE14A68C40679FD14070220640E7AC13C0EF3EDA3E7D5E7D40B99F0F40EEFF4640931F5340"> : tensor<2x8x8xf32>
    %cst_0 = stablehlo.constant dense<"0xD0BE6BBFFA7E743FE0DFD2BFE0C4D5C000BA3F40CFC48F3F20B07B4054BB6240E8D9F0BE5CEF9B4096A00BC0F6E67ABF2A00E03F102DACC0B954A8C014BF2CC01FFBA5BF77BB1B3F643F30BE1526AE3F8D933F3F13E9973F6B3F94C070B8C3BF985D5A3E8E73A53FEC5B0740D59934C06C5F87BF24120940B64ECEBFEB5415C000C560C0CE85DCBF309FA13FFD4DE63E86A21E3FF7DA5AC0FC82573F495E3D404C93353D8F9F5C40BDDEC4BE2BE905C0192211BF6B5780BF7AE185409F6C11C021C8673F2E4504C038117E406C42143F02870BBFF0AFF03E3027834093CF50BFF36BA23FB5705040D7E597BDF69D0CC010937A406E1609C1494B91C066A0CF3FAEE3C63F285D6CC08065D9BF915BAE3F07E3BEC0D46A4B40A63D15BF34566E40FD3A4A40F9049ABFEED460C0B1BA73BE62D38C3EDE67B4BF512994BF69924140C2ACA6BF4920BFC01CCDA03F28CA113F308053C0DD08BB3FD245C7BEAA4B12406D64D5BF481266401661AEBFB702E2BF2DB48BBF9886A53F4AD7233FC52548BF9B630BBF414DDAC0E3CEC6403359F8BFC1E698BF400EFE3F575EA7BF1FA493BECAE4FDBFC7D03440030F9EC0EAECDEBFB216EA3FBD6C3FC0378CFE3E136588BF0915A2BF3F8D1D40597187BF1DF619C0901D2240252E45C0F80BFC3F5FA8DDBE7DE46EBD9649D53EA29C7DBF844784404CD48340432DDCBFCEA79640449F04404D099DC00434B0BCF03BBDBED06410C019BE9BBE75D524BF0F1C93C092783BC0A94F484079D9BEBF0C6591C078AB22401D9B87BF24DF303F4E61A5BEE327BDC0A7A7903F666DA63FDB78953F9C4AEBBE347F153F5F1106403472A2BF931550C0D2465EC040C6F23F00908B3ED09895BFEFBD92C0646C3CC074C8AFBFA0B77A3E"> : tensor<2x10x8xf32>
    return %cst, %cst_0 : tensor<2x8x8xf32>, tensor<2x10x8xf32>
  }
  func.func private @expected() -> (tensor<2x10x8xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xFC0BDF40693A4F41E28832C350C8F045F2C6E445215813C6BED23F45C306F5C5ABE063409852BABFC0B2164140DA87C3909F82C3608AA8432010DBC2B06C8D43500A1D41B9BF9C41B09C83C3CBE335465CD52C4650C95EC67AD79145A0E338C66C9ACEBFFA23B9C010C1A3426E4868C5F4E05CC546858E45BAB0BBC404556B4586A9D44171156D42B41945C4D13A0747EE7F004772AB25C77FCB5846877A09C773CBABBEACB6E1C0C2AFB44288C476C5A6B86AC59860974512B5C7C460AB7A45F54BDBC0E4872AC1E8F31A43DC37D9C5FB58CEC557FF044653E32DC50F7ADC4539AC19C12F1DD2C12938AE4301546FC64E6863C628939246B975BFC557617346142D3CC1092D90C12CF96F43C8EE24C6A7BB1CC640F34946702384C5A0D027465156BFC1800941C2A46A1F4472B1DAC668C9CFC69EEB05471D142FC64D6CDE46B6CD043F5295A23F272417C038606E3F96E1D7BE662725C00C599DC18097CC41F7062A3F5EBE04C08C52A63F09DA76C0D21D92BF2C679840B7BFAD41017FE9C122205E3E702FFA3F05A2C9C0BE5DED4074B798BDAC0AFAC04010AD4198D9E8C14B4C4A3FE9B3FEBFE1887D404DD847C18A96B0BEDF06A540C25EC0C25468FA42EB24013F0E54BEBFFF9D753F2BE49FC0126E1ABED463AB3FF3F710C20C103C426958BE3C3B532CBE65615A3FCE9FA54086B1BC3F526FA33F2CB08A42B61CB5C25F3FFA3FFB5E27C058176DBF8DFF66C0EA47A7BF7F006B401B523D42203A83C2BA9A9FBF33720A40F17485409848F7C0DE46673FCB96053FBF8D11C33DDB3E435584E6BECC1D343E8FD0DDBEFFC2164067ED203E80828DBE0285EA41972B1BC2291BB13FA9BA1EC0C25141BFEA3AFF3E1BD008C0AD2A2D406E0193428781C4C2"> : tensor<2x10x8xf32>
    return %cst : tensor<2x10x8xf32>
  }
}
