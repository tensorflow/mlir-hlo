// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xf32>, tensor<1x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#1, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = stablehlo.add %0#0, %2 : tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}, tensor<1x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x9E98504039AF81C08E129240F9DABFBF33EDA940F9F9C03D940BC63F9A7A3BC0BFE76FC0E1CACC3F6440DE3FDC244640A09E5A3F2A0765C0DF47F33EE0C3C43F668C0CBFE068B540763833C0D2AF4C3FB5A5AA3EFCC440C02F553740C832F2BF9387A73F2AB90F40F345E3BF2DE299BF8A1962C0A7EBF63E9644213F4D1B403FB083BEC07BAF24C012E432C05A61A43E79E7BE3FA24E45C092C2D5BF960D7CC0F79200C02451E3BE3CCB813F8B3A5CC0E05E933C0FD484BF40D97D40E01A443FD65B004010100CC0BCEE3FC011D002C06B21503F94F07C406F3AA1BFF0365440716D1B40CC7FCCBF92539C40DF66EC3DAF176CC03FF6F2BFF1BFA4C0FA102EC08C1AF43F02B221BF0243743F3BFD09404B640A404A1880408C3241404899EABE6FA592C0C20D8EBF3D7D1240E6B5933F48620EC00DB95E403D1F904029E983BFE0B76AC0206AD5BEF59ABA3C532C8540E71B44BFE52B65C0897339C0E354A7BECF143A40E5CBDBBE64E404C17AF2A4BF4F6242C0343292C0C62A1EC0909C1A40C0CD3AC05161B33D301802402CA1BAC0DAE20FBDCBD7144127685EBFA9881ABFAC7EAF4037DB0B40D15343BE7DD1F2BF22FDD03F0B166EC0C284DBBFABEFE3BF52363B4036F243407751B33DDEC75CBE6EE167BF949EBE3EAA9E11BF462571407652413FB86784BFAF0807407FA68D404ABE83BF0F70AC3FD432AD3F68D567BE59CDBD3FC6846A3FA789173F396BD740F22253BF9D249240335893C0D0A99CC089010B40CD9D6340267A8D4066237EC000FEE53FD8A3A93F7ED1113FF61B3AC01D827E40BB1094BF41E50DBFFB6B853F738356C004854FC028B328C0E38FC7C0B525703F772EBDBF31353B3F6B3A613FCEA89AC0A8A52DBC4BBFCD3F62D77C407BBFB23FDF13E6BF2119B0409CA0CBBF4F13D6BF802B6BC0F7E0D13F97CAFA3FAEE754404D0C78BF6FFE0A3E896CD3BF545DD93E7AE22CC0AFE18ABF3D62E2BF353C14C03D4ACC40EF211BBFE97F4A4085DF3A3F869073BFC7D83640DE1083C0C3029E40EA9F65C09A7CCFBFA266AC3EFE5E714076131EBFF0513D3F5C941D4022010D40B3C1B93FEBE08240B6A5114020902540C3586040E54F29BEC62286C0B2469A40F75F44C06264BFBF25CE11BFB76D0FBEBFD49940135A41C080866CBF3DF00840F01D1BC0B5307C404829274004AEB9403D178FBEA02B6FC088906CBF8ECB324077DBE33F0224923EA333ADBF94AE1040F28B7840D93740C08FBC16C0844CC8C0238C91BD7CB15B40A1A19740E16778BFB35B0A40F72DBFBF4D1F1AC062FB97C0CFB4193FECB8CEC0362AB83F7E586CBE7E47B23F7083C3BF6166243FA0368D40AA13423F9349DBBF461D6C40CE9925C0759AAC401A8F38C06CF94FC0210125BC55120D40E0C19ABF5B6AE240172C853C303D3140313BA13F4E92773F6014B1BFC8477EC05CFE32C07BB72C3FA0BC2C409E3C7B402F88C3BF69BD5F3E7EBB74BFF87A1FC0C20749C05A7329BFABD44E40F09F99BF6DDF303F95B8C8C0B4231DBFBB39B24067976B40A22C2040E65D50401B43373D5549FBBF86D28BBF1822A340BC6A0AC0E5B5BF3F161B823F4C9C943E985BA3BFC0AB45C047A11DBF588022BF1E8A90BE6AC401408A27A64083213CC0B14829C01BD5574054693C40F48194C0A3E4CDC0F13EAD4019C3733F678DC83EE5A69EBEF4CBFC405C379BBFD5A53440E372A33F9EF97DC0EFAC86C0953E0B40E02624C08695C9BE1B1D304086199E3FAEBC61C045BE943E43ED1ABE54D897C02642C63E95EDDD3F831C9CC038313540185D7EC0C37E334056A25BBFC3B09C3FF267D0C03DF0253FC55C9ABFB3B211C003F34B405E52B3BFA2CBF7BFA4F4923F838126BF5532903E2CD68040D5302E4012FEC63F936D27BF7A098DBFC17A29C08F8F8A3FE2BFF33EFD0C1EC0554FF1BFFDC843C0033AC53F39DA763F3133613F20BC80C0D63100BF14DC0CBF3539843D0E76F7BFACB21A3F89880BC03A6654C0F353C6C0B8842F403275DE3F13EB2640B12A8AC06311824055FC413FBBA19C3F9EF68CC02B7ED13F97D6DDBF6355A9BE0FCB3D40851C13C0A224B9C07A9E87C03D6D8B3E27B79A3F0D9EAC4052F00CC0F68071403EE7C63F63DB76C0786B834015D81BC0A422E4C0450051C004E00FBF05EB5BBF318061C0652BC140D61818C0F5C09CBFF1EB34402927ADBF5AF13C4006A24F3F35415E406DCDB5BFC23094BF40C59D3F015ECA3FD73FD940"> : tensor<20x20xf32>
    %cst_0 = stablehlo.constant dense<[[-1.85382164, 0.334314197, -0.233398959, -1.88425553, -3.99776316, -1.40665197, 0.2456294, -1.014974, -1.61709976, -0.127296031, -0.492320806, -3.35963559, 1.81458068, -0.868138253, 1.0084343, 4.25321627, 0.564420462, 0.0634559467, -6.43683719, 5.23544693]]> : tensor<1x20xf32>
    return %cst, %cst_0 : tensor<20x20xf32>, tensor<1x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x35E7B33F0BF96DC08D9A8A40218558C018FEA73F8CFDA7BF5D7CE53FF06F7CC028B3ABC0A47FBC3F063C9F3F48FB86BEBFC92A405F4B8EC058E6BD3F514BB940805D7C3CB570B74066CB13C1C21EC1409AA0C2BF955F2BC02D65284008B171C090172CC050CA563F2AD5C3BF6CE60DC00DCCA4C0B5BEB53E66EF0C3E72FD26C0A47284C00F3F5CC0C4B3E4BF6F60924034930340F83E41C09BB501C1F407A63FFA3777C0A497E0BD6FD6473F1869AAC09CB47EC09E701CC0D2C88640D8E97EBE30EAC63EAE3514C0EB705FC02BEAACC0722A2840006145403C9880BED135F240E88C3F407960C4BF009CC6BF633AAB40595EB1C0702BC8BFF237ACC04F5493C014CE05C0167302C04A92993FCB0F923FEC960B3FF60A78405DB021406E5774C0C72831C0EA2CFDBF6D075340D207AD40A285D4BFB7C86240546DF7BF7E8E864072AEB0C094FBA8BDC4AC57BE02C111402A7198C03E999FC025BB29C0E4BFABBF7E2CA53F6C7C0EBFF0C40CC1C1BE94C070809CBFFEF9ADC02C41BBBFA168D54049AE16C041AB1A3E7AEE8CC020C318BF1EC9F1BF25311A4118148DBFCF391FC0FC43BE3F8452473FD4C9603D145E3AC08000803CA93B76C090440DC00D7EA4C034AC9740A2620C4077498C3F1A34814024C7AEBEE01BDF3E672EE0C0B60D1041CCA08CBFD23933BF5A31F03F5AB5224040DDA0C0A0A373BD9DA3CC3F58E59EBF387E09BE4DEE493F5407CC3D2DD257406A657D3FA6B96C40362666C0B87B24BF00212F4077AD6740D80001C054DCA13FE08069BDA76ED43FEA22AC3ECD5999C0809EACBCF40E24C05F079EBE0054E03C02019FC0A2AA57C0573548C0038919C1842B3040CF2616C0F8AEDE3FA641A440129988C0F880583DBF8A9AC03CFA1241302AEABE1049BBBF20A1A840F2675EC08172B5C00B99A2C0C051F13FD8BF713F3CD2DA3F63518CBF4292B6BE455DA0C0C24D0F400E7264C0F0D49CBD94031F407C39E0BF1252CE40D05EE1C05E64064144DA8FBFE8FA1DBFC5E82740B05CBFC0B0A8703F40D39FC0D10BB0BF05A22DBF6EE00940EFA93EBFCE247D3EA4BF65BF9C9180401745153F0326A34034EDD04097AF49406D6864401145D3C00898853F60E83D4090FA2EC06644DDBF2E0B1DC01B6984C0E8A25940AFA131C0EB2DF8BFB4C6053F8E4323C086AE5C40F46B3FBF10BFF340F7E492BF70A12EC09010554005EB5640CAFAEB3F52D8C4C0BE777840844CD03EADF88640DB274FC01AAA87C0181D24C1EE25BDBFE0696B40EC4D6E40889825C0153602405532FEBFC991B8C0ADD43BC0001389BED473AEC0E624B64079CFAA3ED166BA3F6EDBFEC09415BC403CC82340A4D48B3F9729F9BF430BE73F94BAD2C0542E7F40B6D628C0617788C02247D0BFB7EC04403EC6D9BF71D06D40DE58EA3F385BF33FC8271140A30CA740E4AA51BF1E387AC0E0BC13C1B71FBD40725E583F035188403368E1BF9C37D5BF1D859EC08E8179C05E4F39C058A4D6BF36ACCE3F2CEBA9BFC25A4B3E5C1D1AC154B2993FF1719640CC109640AA30D8405D7D7440BE96DD3D746606C1269484402C9F4F40A90AEABFE1D5A13F66285EBFD0476DC062B42BC05CF335C04EBBD0BFA61E10C010B7D1BE7684C43F9E95EA3FD8FE8FBF45D860C0A62F8C40034FE640387282C0CEDCCBC084EE82BF2B01C640AD26BBBF6045C83CF353F540523346C00A6B96BF48D204BE3A416EC09A27A7C014000F3F7E4C2CC080D362BFA89C1BBFDA2E434021A68CC0F143A63FEF42834098C885C072BFE63E2D7F96C050C4B63ED2307A3FB1F768C0C18E24403A802FC0F88231C03D6BFDC0CED1643FB8230EC0433179C065CD4340BC56F2BF0B75A9C0699C3D40E95FC2BFF520A53F427804414C505240651DCF3F44E8E2C06A468440E20F90C05E5AB53FA17F783E51528BC08241BCC0CAE78EC0CCAAE43FD0B14FBD0FC73CBFEFCE84C0923A7EBF4A3B7AC0C187F03F9B4A33C0B66DCE3F29AC0440C34630C01E4CC4C06C706CC01426DF403E18413FFBEF7EC0C43275401E3190BF7C8A31C0E9F9B9C0F4EEF03FA1E02FC07952F9BF71A53540B49E32C0625312C1DD1A1BC0B08718BFC4E50D40335C1A41B6A1D1BFA0907540C2409CC05A6CB03FEC311040AE7206C0A59AEBC0F5CBA4C0AEE991C0570111C0CDC751C0BAB0A04066977FC0320CADBFC2691540EDCB96C0B889984090C469BDB2658F40FC4D3540A8E317BF93E4A53F12639BC050644041"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
