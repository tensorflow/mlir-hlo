// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xbf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %1 = call @expected() : () -> tensor<3x5x40xbf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<bf16>
      stablehlo.return %3 : tensor<bf16>
    }) : (tensor<3x5x40xbf16>, tensor<2x1xi64>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> ()
    return %2 : tensor<3x5x40xbf16>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16> {mhlo.layout_mode = "default"}, tensor<3x5x2xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE5BFB4BFAABF48BF4F4024BF61408FBEBBBED5BD634009BEBBC04AC0A13F2840313F3440C9BFE83FC84080C0B6BE25C0A940D4BF09407040F03FD13FD1BFF0BF953F823E9E40663F07C0863FD8BDDA402A3D7D40FFBEFEC098C067BFAE3FB1C073C07B40533F8DBFF93F2AC0B6BF83C029C068BF4E40CDBEDCBF284030C040BF393F39C0F73F83C03FBF21C074C0943F5C4087C030BF0CC0E43F933F5C3F013E15C0F83D51401A408AC014C004406C400AC0AFBE32C05F40A8C0ADBFBFBFC7C0DA3FC5C0713FD33F143E9B3F84BFAB3F1B40723F3940D03F06C168BF403EC34007C0D44079BF873E21BF5A402CC0CA40ABBF26C062BF7CC0A14003C018C08DC0DABF65C00B3E6DC08640CA3EA8C0853F11C03C407240823D27BF8BC0874089402B3E86C0CEBF863F33C002C077BF45C0EBBF53BF05C0163E203E75BFA3BD94C062C0653FAFBF2C40B93FA140403D2C402FBF31BF0EC086C050C08C407E401340CDBF42BF6240BDC010BDDFC01A40C74093C0AA3F9DC095BFE1C001C0B9BF16C0E1BFB9BFA33FD1BFA2C0C93ED1BEDD3F0B40283EE9401040603ECAC034401DC08CBE743F1940573FFDBDEB3FE9BF42402DC051400540183F093F0F3F90BEA73FBA40B63F19C0B14024419DBD4CBE1640AB3FEC3F0BC0CD409F3E4FC01D3F97C0333FFDBE40C0244021C0E44015BFD3BFAF3A663FBFC0A540D6BE8FC0A8C0F13F0CBFB03E43BF04401240853F783F8A3F94C0E8BF2E402DBFB6BF39400CC05940D73DF53F883E93C0ADBF584023C00A4091C0113E22BFC93F1F40104134C04FC03CBFA1BA43C09ABE01C03D409DBE783F7140094011C0253F46C00D40CA3EC8BFAC3EB13F72BFAD3F653F0BBF50BFBE4061BF6A40BA3EB94082BFE7C0AE3F034125C0DB3E423FF2BF66C0863F80BF843ED53E84C0B0BFD6C011BF91BFC5C064406BC01940A5BF9640E240EBBE883F73C022404740A4C0F63E263E2240AD4070C0DB3FBF3EA540CB3FFE3F474095BF1C3CE5BFFDC07D3F66404CBFA73F49BF8B408B4034404FC0A3C054C024C046BF9C3ECE4064C060401EC0FA40FA3E3AC08F4089BF4E3F08C09DBF96BFF13F2BBED33FE0BE04C0F33EEE3F2440A5BF94C0F5BF5840E9BF0E408340F33D20C0DFBF0FC0C0409EBF0FC0D1BE0CC032C0CABFCABF26BEBA408940C1BE7FC099BF90BE31C02ABF57C00BC01140E1BE2CBF92C00DC0D83F8DC09F3F14BF79C09340074064BF56BF35C01EC0BA3F5F401FC0ABC084C05C3F57400CC08F405C4085C08CBFDA40294016400740BBBF72C03FC08FBFBE3F14C034BFB9BF06C1F63FE0BFAE4033BF03C007C122C02640DDBF8DC0AA3F14C050403E40164001C1B3BEE73FBD3F1C4058C07C404BC0EEBF9340223F6AC094BE5BBDAB3F5A3F43401640D84081C0913FAC40A23F2540B13FAB40F1BF793F4AC0F33EC540DBBF1E3F344017BFB4BF49BFABBE3E3F28BFAB3E4B3FC1BF8740883FF9BF103EA040F0BE4BBFEE3FEA3FBF405BBFEFBFDCBF8BBF8CC08AC068C0603F28BF0DC0373F7C3F73C0D43F58C05B4017C04EC069C08F400EC036C01AC0EB3F3140593DF9404240F93E40C0DBC00FBE2DC0A2BF363F10401F400F40CCBFC8C097406BBF0EC029BF823F85BF41400B403D40B63EE74022C0A5C01E402140BDBF1CC05C408FBD674075404FC09240BDBF"> : tensor<3x5x40xbf16>
    %cst_0 = stablehlo.constant dense<[[[5.250000e+00, -4.718750e+00], [1.812500e+00, 1.101560e+00], [-5.843750e+00, -2.531250e+00], [-2.148440e-01, 1.406250e-01], [-8.300780e-02, -1.054690e+00]], [[-4.437500e+00, -9.804680e-01], [-1.460940e+00, 4.031250e+00], [7.617180e-01, -2.234380e+00], [1.632810e+00, -1.359380e+00], [-5.875000e+00, 3.531250e+00]], [[-4.031250e+00, -2.015630e+00], [-3.000000e+00, -2.515630e+00], [-8.203130e-01, 3.609380e+00], [1.884770e-01, -3.078130e+00], [-1.710940e+00, -1.992190e+00]]]> : tensor<3x5x2xbf16>
    return %cst, %cst_0 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> (tensor<3x5x40xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE5BF0B42AABF48BF4F4024BF61408FBEBBBED5BD634009BEBBC04AC0A13F2840313F3440C9BFE83FC84080C0B6BE25C0A940D4BF09407040F03FD13FD1BFF0BF953F823E9E40663F07C0863FD8BDDA402A3DFC40FFBEFEC098C067BFAE3FB1C073C07B40533F8DBFF93F2AC0B6BF83C029C068BF4E40CDBEDCBF284030C040BF393F39C0F73F83C03FBF21C074C0943F5C4087C030BF0CC0E43F933F5C3F013E15C0E53F51401A408AC014C004406C400AC0AFBE32C05F40A8C0ADBFBFBFC7C0DA3FC5C0713FD33F143E9B3F84BFAB3F1B40723F3940D03F06C168BF403EC34007C0D44079BF873E21BF5A402CC0CA40ABBFA13D62BF7CC0A14003C018C08DC0DABF65C00B3E6DC08640CA3EA8C0853F11C03C407240823D27BF8BC0874089402B3E86C0CEBF863F33C002C077BF45C0EBBF53BF05C0163E203E75BFA3BD94C062C0A03DAFBF2C40B93FA140403D2C402FBF31BF0EC086C050C08C407E401340CDBF42BF6240BDC010BDDFC01A40C74093C0AA3F9DC095BFE1C001C0B9BF16C0E1BFB9BFA33FD1BFA2C0C93ED1BEDD3F0B40363FE9401040603ECAC034401DC08CBE743F1940573FFDBDEB3FE9BF42402DC051400540183F093F0F3F90BEA73FBA40B63F19C0B14024419DBD4CBE1640AB3FEC3F0BC0CD409F3E4FC01D3F97C0333F3A4040C0244021C0E44015BFD3BFAF3A663FBFC0A540D6BE8FC0A8C0F13F0CBFB03E43BF04401240853F783F8A3F94C0E8BF2E402DBFB6BF39400CC05940D73DF53F883E93C0ADBF584023C00A4091C077BE22BFC93F1F40104134C04FC03CBFA1BA43C09ABE01C03D409DBE783F7140094011C0253F46C00D40CA3EC8BFAC3EB13F72BFAD3F653F0BBF50BFBE4061BF6A40BA3EB94082BFE7C0AE3F034125C073BF423FF2BF66C0863F80BF843ED53E84C0B0BFD6C011BF91BFC5C064406BC01940A5BF9640E240EBBE883F73C022404740A4C0F63E263E2240AD4070C0DB3FBF3EA540CB3FFE3F474095BF1C3CE5BF24437D3F66404CBFA73F49BF8B408B4034404FC0A3C054C024C046BF9C3ECE4064C060401EC0FA40FA3E3AC08F4089BF4E3F08C09DBF96BFF13F2BBED33FE0BE04C0F33EEE3F2440A5BF94C0F5BF58406DC10E408340F33D20C0DFBF0FC0C0409EBF0FC0D1BE0CC032C0CABFCABF26BEBA408940C1BE7FC099BF90BE31C02ABF57C00BC01140E1BE2CBF92C00DC0D83F8DC09F3F14BF79C09340074064BF56BFABC11EC0BA3F5F401FC0ABC084C05C3F57400CC08F405C4085C08CBFDA40294016400740BBBF72C03FC08FBFBE3F14C034BFB9BF06C1F63FE0BFAE4033BF03C007C122C02640DDBF8DC0AA3F14C050400DC1164001C1B3BEE73FBD3F1C4058C07C404BC0EEBF9340223F6AC094BE5BBDAB3F5A3F43401640D84081C0913FAC40A23F2540B13FAB40F1BF793F4AC0F33EC540DBBF1E3F344017BFB4BF49BFABBEDCBE28BFAB3E4B3FC1BF8740883FF9BF103EA040F0BE4BBFEE3FEA3FBF405BBFEFBFDCBF8BBF8CC08AC068C0603F28BF0DC0373F7C3F73C0D43F58C05B4017C04EC069C08F400EC036C01AC0EB3F3140393EF9404240F93E40C0DBC00FBE2DC0A2BF363F10401F400F40CCBFC8C097406BBF0EC029BF823F85BF41400B403D40B63EE74022C0A5C01E402140BDBF1CC05C408FBD674075404FC09240BDBF"> : tensor<3x5x40xbf16>
    return %cst : tensor<3x5x40xbf16>
  }
}
