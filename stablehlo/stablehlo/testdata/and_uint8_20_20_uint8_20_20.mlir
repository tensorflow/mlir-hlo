// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xui8> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xui8>, tensor<20x20xui8>)
    %1 = call @expected() : () -> tensor<20x20xui8>
    %2 = stablehlo.and %0#0, %0#1 : tensor<20x20xui8>
    stablehlo.custom_call @check.expect_eq(%2, %1) {has_side_effect = true} : (tensor<20x20xui8>, tensor<20x20xui8>) -> ()
    return %2 : tensor<20x20xui8>
  }
  func.func private @inputs() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}, tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x02040404040400080200010001000003010004000001040101020001020100030302000100020002000001010305020101010100050304000503030303010102020402030003000001020100010603030101010001010000010207030104000001040400010200030503000103040402040100030601030302020200020100040100010100050001040303050102030201020701020200030202010603020400060602000003010202040002030000000105010201040203030200040000020202010102020100010300040201040401010203000104040105010204020500030301010201040400020004040502000200070001040302030101040202030603000203000501050000020700000401010400000106020002010502000000000203010002040203020202020502000001030500080101030001010102000501000205000203060000000300020102000200030105030301000203020300010401020202030300020100040201010200010001010000020300000204040001020201010003020100030000010006030201"> : tensor<20x20xui8>
    %c_0 = stablehlo.constant dense<"0x03030101030202060200010400020208040505040004010100030303030001020001020101060203050401000001020004030000000000000002000503020302000103010300010400020000050800000200020401000503030503000201040106000004020100020101020502010103010501000203080000010302010302030100000601030202030102020701050304030108030202010602010204040502090001040302010102010102020202030203030302020402020501010200000400020205010200050104010000060801040202000401020401010204020200010402030503030203010100000203020204020400010102000201040101000002020108020004010002010004010107010101080000030000050400040102030001020303010609010101030205000002030100020400020000000002020101030200000400020200000200070300040200040400010404030001000403010201030002000004020002000301000109000203010100020304030103000001030100030200000002010502030300010001"> : tensor<20x20xui8>
    return %c, %c_0 : tensor<20x20xui8>, tensor<20x20xui8>
  }
  func.func private @expected() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x02000000000000000200010000000000000004000000000100020001020000020000000100020002000001000001020000010000000000000002000103000102000002010000000000020000010000000000000001000000010003000000000000000000000000020101000102000002000100000201000000000200000100000100000000010000000102000100010200020100020200010202010200000400000000000002010002000002020000000001010200000002020000000000000000000000000000010100000000040001000202000000000001010204020000010000010001000000000000000002000200020000000102000001040000000002000000000000010000000000000001010000000000020000010400000000000001000002000201000000020000000000030100000000020000000002000101000200000000020000000200020100000200000000010000000001000000010001020002000000020000000201000000000001010000020300000000000001020000010000000000010000010000010001"> : tensor<20x20xui8>
    return %c : tensor<20x20xui8>
  }
}
