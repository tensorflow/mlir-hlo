// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2xi64>, tensor<2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xAA8E9AC08F4AC5BFB0F40948A0331C4015244417772BF3BF1FD1DA5DB3B6034028DB3F22D73E14C0246345E1C013D2BF66C116785EDBF7BF4874C00E47F7FA3F6B349A4687E302C0D20B27F22F24FBBFBBF20AB1A11BDE3F8B110916711801C0931C0285C733A2BF96072F7A8111164066B7BC44114913C045781B0A4670C33FB0E32578EBE305409A7159648E0F08C01A938A41F8BF01C0C1C1F800669CB73FFE18DB416A00CB3F30FCB486FE08FFBFFCDD6798335EFFBF570B416BA8F11AC048433AC86D1610C0920A822B6F3FF13F4ED66C39163D04C098C1050EC20D0B40F07057E53BDC054010D5637F5704F13F4F27777904EAE9BFD8963BF22BBD0440477607720BB302C05CA5AC1007CA1A4008D1C2B8522414C0A5FE60A521700540F602D8A4BCE903C062096ED4852806406C6546BE4352CEBF5E6779B5C6CFBC3F6CD7FD4264FADA3F3F28E045E57D1B400CFB1A2ED3800F405DFA96B9A7AAF03F72F8A4946917F73F4CA3C640280618C0BD2606ED6B55FC3FDEE67FB243E7264080202E445BEE0040B9D89271C81C1040E0F1A19A2F19EE3FEC4678E5522502C0BEC01826DBA506408EDFA4E1BEC2F83F87C268078C2D0D40BB44477D3A20F13FDC4E351E5440F9BFFA3F504F77DC83BF8EE434E93D5AD9BFEC118B72769112C0A82B27A83BE2E9BF1405F0774A12F53F9C387AA4DE66F73F7BFAED2029A11AC03DD1C3C48A410440F61F0AA067F200C0E467E9912198B9BFA9562440A6F9EF3F0132BF0120D1CABF8AFBD448673C02C043DBFE8D48D3C63FC253021AD2DA53BF0FA8B6989850E5BFA055C6A5F8B10A4037A72BE6B4711040ACDDDF1FF136F33F8E57FB0DDC8001405E9E48470D9DFF3F7714EC7EE1210EC0D7EA7DEA19EDECBFCEFF6385273809C08AECAB444F50DFBF326AE74C9F220C40889BA2A0DE8805C0C60D95221078A4BFCC6DB3EAABBF0140EB64C17412EE0340D874E3DF798A0FC00188EE97E503D9BF2B381A5EE5C201C09E4ECB2BAC0F01C097490DD79D5CE9BF1A54A3BE47A2F83F23F58FA667831240BCF8C95B463314C0F48ADCC30FD4EF3F38089A49A8BEB6BF9871084CBC1D0240931B013618DCB1BF58F6B2D4679F1A4009762801403DE23F5DC11932114B0EC0CAC78D3C348406C068A81A98E109BA3F70CDB128E038CABFE7DEF2860C41613F8F7DC656D68412404C3B41C1FFFF0CC052E0E14D8EC0EEBF4A1161E660C8D43F2F87B7DE0DEDC53FC64994896F52DEBFFCDD1B54AAC8E8BF85C3E79B7F7107C0120C5866FB6A02C0D6BA0366B2D910409E077C91A6E3FF3F5A7436A9CEDBB23F68743FA3BD49064015F08770FC6010C03E32CD552A5510408268DB6FDCB308C0B9F5951DC66E21C04581262170B2F0BFDE54AF227888F43FA0E0E6C0EBF1EE3F2E2F21810555D63F7CEA53A617A5F2BF49890077E3D71540CC596B18B6FB01C0CD0D780ED58BF0BFF13580C1B267FF3F2F0DA7D60102FEBFF63DB84AE542EEBF5D408BC77CB5ECBF5EB9F9CC3A740140D1D20DE03E78D53FAC9ED3C6F89EF8BF557E1E2ACABBF8BF7C2C9386E71FBC3FA5D3A099CCADFD3FDA45BDAF908AD8BFB835277FADFD0FC0C634E674A96D02403051C57E6B1E17C0822266D213D2EE3F9A56315B61D097BF8DAF01A4E32D0B40F862A7B01E5204C0B2AF0C38ABD707C09C509BBA0EA219C0B51897DC63B9F03F6FD6F1C2451816C030BDB47BAD0BC33FAE3FCC1A12E0E03FDC7309DE16C509C0508EEC183DD9E4BF1E6729F0B421E73FD811A24825DA0640270FBBAF6682F8BFC0AC8DA4B27FF33F30FB9834E728F63F4CD6EFAC6D7200C0D0981B133957E13FB618D30AFAF30B4070121D8C82C4F13F03128BBD802AEE3F3EE05C4F9E8B03C008E405881E2485BF57B09D06B49FD33F8A3EA0425DEDFE3FDC6E7A5F65E4F33FECF8B4B910AAFF3F1A5989283A00D6BF7E7CC2D42A61F0BF4E4D2AF15F23E63F5E9A0BB2DA04084058244EE89CCE10C061E2B158E406F3BF6C11A8C21B661540739DAFC8B03BE73F41B75A6506F9E6BFAE29664901F9EA3F54809B97A1150B40B9505582641A0040810F27CEF786E5BF164E69D61CB007C0D65F4FE537EA04408EFE2F7780A4FABFF2AE409EE9570D4089C53263790B0B402BD071394141F43FE08082FAAF63F8BF2495DBD32C1C9DBF9F1648EEC493F7BF30302852444AC13F9FA327BEFCECF33F445CAB91326BEDBFCA31182A8297F6BF6AA703149EA5F03F2710490A7AA714C001E69C5ECD21E9BFF627D639106FC83FA57B4B85C4A5E5BFBA2580682F7015405EFFF3078DA4D03FF481C7F83875214016275733A4541BC021B260EDF18A07C0B446EBA4505903C0"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[-1.8993788750587131, 3.836038380540848, 1.3664814346150358, -1.3045315357788276, 1.0611404883091027, 3.6192060744329027, -1.7156887630939326], [-0.42013392750845086, -3.5355669496532722, -4.9377261676609487, -0.77414078598445002, 2.2898664380447915, -2.294018790273971, 2.4434327157292701]]> : tensor<2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xAA8E9AC08F4AC5BFB0F40948A0331C4015244417772BF3BF1FD1DA5DB3B6034028DB3F22D73E14C0246345E1C013D2BF66C116785EDBF7BF7472711ADB63FEBF6B349A4687E302C0D20B27F22F24FBBFDD54AC755CDFF4BF8B110916711801C0931C0285C733A2BF6EA6790F7673FBBF66B7BC44114913C045781B0A4670C33FB0E32578EBE305409A7159648E0F08C01A938A41F8BF01C0C1C1F800669CB73FFE18DB416A00CB3F30FCB486FE08FFBFFCDD6798335EFFBF570B416BA8F11AC048433AC86D1610C0920A822B6F3FF13F4ED66C39163D04C098C1050EC20D0B40F07057E53BDC054010D5637F5704F13F4F27777904EAE9BFD8963BF22BBD0440477607720BB302C05CA5AC1007CA1A4008D1C2B8522414C0A5FE60A521700540F602D8A4BCE903C062096ED4852806406C6546BE4352CEBF5E6779B5C6CFBC3F6CD7FD4264FADA3F3F28E045E57D1B400CFB1A2ED3800F405DFA96B9A7AAF03F72F8A4946917F73F4CA3C640280618C0BD2606ED6B55FC3FDEE67FB243E7264080202E445BEE0040B9D89271C81C1040E0F1A19A2F19EE3FEC4678E5522502C0BEC01826DBA506408EDFA4E1BEC2F83F87C268078C2D0D40BB44477D3A20F13FDC4E351E5440F9BFFA3F504F77DC83BF8EE434E93D5AD9BFEC118B72769112C0A82B27A83BE2E9BF1405F0774A12F53F9C387AA4DE66F73F7BFAED2029A11AC03DD1C3C48A410440F61F0AA067F200C0E467E9912198B9BFA9562440A6F9EF3F0132BF0120D1CABF8AFBD448673C02C043DBFE8D48D3C63FC253021AD2DA53BF0FA8B6989850E5BFA055C6A5F8B10A4037A72BE6B4711040ACDDDF1FF136F33F8E57FB0DDC8001405E9E48470D9DFF3F7714EC7EE1210EC0D7EA7DEA19EDECBFCEFF6385273809C08AECAB444F50DFBF326AE74C9F220C40889BA2A0DE8805C0C60D95221078A4BFCC6DB3EAABBF0140EB64C17412EE0340D874E3DF798A0FC00188EE97E503D9BF2B381A5EE5C201C09E4ECB2BAC0F01C097490DD79D5CE9BF1A54A3BE47A2F83F23F58FA667831240BCF8C95B463314C0F48ADCC30FD4EF3F38089A49A8BEB6BF9871084CBC1D0240931B013618DCB1BF58F6B2D4679F1A4009762801403DE23F5DC11932114B0EC0CAC78D3C348406C068A81A98E109BA3F70CDB128E038CABF69AFA56979E3DABF5FA22C53D7480CC029D4DA493BC013C052E0E14D8EC0EEBF4A1161E660C8D43FEA160586265A02C0C64994896F52DEBFFCDD1B54AAC8E8BF85C3E79B7F7107C0120C5866FB6A02C0D6BA0366B2D910409E077C91A6E3FF3F5A7436A9CEDBB23F68743FA3BD49064015F08770FC6010C03E32CD552A5510408268DB6FDCB308C0B9F5951DC66E21C04581262170B2F0BFDE54AF227888F43FA0E0E6C0EBF1EE3F2E2F21810555D63F7CEA53A617A5F2BF49890077E3D71540CC596B18B6FB01C0CD0D780ED58BF0BFF13580C1B267FF3F2F0DA7D60102FEBFF63DB84AE542EEBF5D408BC77CB5ECBF5EB9F9CC3A740140D1D20DE03E78D53FAC9ED3C6F89EF8BF557E1E2ACABBF8BF7C2C9386E71FBC3FA5D3A099CCADFD3FDA45BDAF908AD8BFB835277FADFD0FC0C634E674A96D02403051C57E6B1E17C0822266D213D2EE3F9A56315B61D097BF8DAF01A4E32D0B40F862A7B01E5204C0B2AF0C38ABD707C09C509BBA0EA219C0B51897DC63B9F03F6FD6F1C2451816C030BDB47BAD0BC33FAE3FCC1A12E0E03FDC7309DE16C509C0508EEC183DD9E4BF1E6729F0B421E73FD811A24825DA0640270FBBAF6682F8BFC0AC8DA4B27FF33F30FB9834E728F63F4CD6EFAC6D7200C0D0981B133957E13FB618D30AFAF30B4070121D8C82C4F13F03128BBD802AEE3F3EE05C4F9E8B03C008E405881E2485BF57B09D06B49FD33F8A3EA0425DEDFE3FDC6E7A5F65E4F33FECF8B4B910AAFF3F1A5989283A00D6BF7E7CC2D42A61F0BF4E4D2AF15F23E63F5E9A0BB2DA04084058244EE89CCE10C061E2B158E406F3BF6C11A8C21B661540739DAFC8B03BE73F41B75A6506F9E6BFAE29664901F9EA3F54809B97A1150B40B9505582641A0040810F27CEF786E5BF164E69D61CB007C0D65F4FE537EA04408EFE2F7780A4FABFF2AE409EE9570D4089C53263790B0B402BD071394141F43FE08082FAAF63F8BF2495DBD32C1C9DBF9F1648EEC493F7BF30302852444AC13F9FA327BEFCECF33F445CAB91326BEDBFCA31182A8297F6BF6AA703149EA5F03F2710490A7AA714C001E69C5ECD21E9BFF627D639106FC83FA57B4B85C4A5E5BFBA2580682F7015405EFFF3078DA4D03FF481C7F83875214016275733A4541BC021B260EDF18A07C0B446EBA4505903C0"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
