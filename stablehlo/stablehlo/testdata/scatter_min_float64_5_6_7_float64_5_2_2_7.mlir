// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x1xi64>, tensor<5x2x2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xC523B6711E2BD83F5A3147B41391F93FC2D2956F0A3E174021CECB5A8282E43FD2A894BB40680DC038F09DD05F840040CE9C7039E604D8BF01C008FDA92F07C08159E527B4A1DF3F1EB7E22ED39BD2BF40107E184C65D13F00E233135F141340924AE94B14591140CEEED9B66C3BAEBF2FBEE1F2CE3DFC3F4B2820AF6AF9F13FDA5C61329927FB3F4124B88AF521E7BF5CB95942F669FE3F17A9341402841740F841516956F0EE3F221F137F66D8FC3FC2712302DCCCFBBF8E3CBB1BC3370040526DEFFDAA3A07C0568D730CB6EAFCBF776E34A8C93E1DC0E03D728D2957E13F70457CA6C75715400E456E7C17A4FBBF768D8F88074308C06FED42DA8ADA0DC0C2E5C2136014FA3F2A6FA5D1E89D08C00411C1A7257519C0B23B18B04A4B064091106FCA77470AC0D7A00C9C704AF0BF2CF79276A51BEA3F0DCA8D303229E43F8C2F347FD1E20040ECC90C3DB446EB3FC6E6D0CA475A0EC0F21F984B91B5E93F1B16CFF6F2EDE43F0C0290C55C1514C070614854A91FF63F92471A50E5EBE4BF889C4376C5D005409B9174A18E2F0140D88577EAD443B13F2D2E7E900DB3DDBFA645E0424ACDFABF4CF070D4BD8CD7BF9CE0682BC8241DC036E9BB3E62C7F03FAD2A264BD82A0AC08A18F8C44E560AC0B84D095A5B02FB3FBACE0F737F55FBBF0ABEAEB94913F03FDE973D2BAE6CF9BFDD89B113CCD105C080C32C47F175E6BF68184291DFED0A402B27852B9EB300C080693561BAAB11C057B38FDAD42D14401CB9B8BDBD1614C0524EDEB1CDC5E8BF3E67683860C5E93FA4EF307E5D4AD63F2FC69533E3F4C13F2DEE99555AA9D2BF546D1CE8172CDE3FFB1D890C2B7F00405C808614FCDCF8BF9808ECF7E65DEABFACBC51B96FD5E0BFDC38079FB23BF03F5A0E29AEFA600740335C929CEC331840FA2D332046BE20C0AA85AA4FB287C73F48B9736023A008407DFF416D412411405B910700C5370B40D0BA36C1526C12C0AD10B58BC82DEABFA50A2952E94C03C07468FFE765000940E82C560DA9A9F73F9B9A68188AAB19C00B7F80256E36F93F66275FD55C880DC0DA2087180AE0F1BF0FDF5A6D34A7EF3F60A89EA8C06FF53FF4FC22E72F29C93FF6E1466ED7201040FCDA36460ED7E2BF5A4999560A2CF0BFB7F9641682C902C0BCB808FD03DEE9BF95A55831494F18C00A1FA4D89F8A04C0A488949F0C0CF3BF3FBE2243D39307409DF49D4F4A9FF6BFFC7E2B9FC6670040545E2D6E86310DC0EF5015B851BCFD3FC84330C64904F5BFFA321B30E95A03C09430910A1FAA09C0C1910A7CEB43D7BFFB1271AA304F0640800407FABC10E6BFB8D52BD1810402C003A4A42F87CAC43F442D4926C55DBFBFE27485BBFD8EFD3FFB8D8CEDF527EB3FBD31526263EFDEBF7D93B21A427BF93FB03FE353BFE608C067BE3D20C08202409FC44473387F1040F4875BF761A5FE3F9C88AA301549E83FC0F5E218EE1B0B4088656000FABEF4BFBABC8F7FC231E43FD64AAD7628FA08C0C8956FA32D7D0BC09B0540BEA892DC3FC8E650793878FABFCCA759BCD462FE3FDAA336842F3EF5BFA80F6AB99FED07C0600F198BCA9B0F40F7E263AF2C13E83F1EC94ECD536EF43F1861A7D0D5DC084067905E4FAA3909C02E424D1C940F03C05EA77ABBCCD508C074E416A71A39C53FAEA5AAAED1C4EC3F376F6E674A3C16C0FA3E46D5D27E1E400977744E2613FDBFD5280DEA30BFF6BF10C52DD9B705FF3F06DA1D16413208C0D53500088F9B16C09F0C2A747213E5BF26CD531A7F2AE8BF043AA27ECAC303C0D5CA7BBA4FBB02C094AA2441F024D13F3C414269C4A7D9BFCC54CAF6B6EB1C407BA77A5D9200084029287441E40AE23F6CF025A31ABC0F40427D1BB0461100C0FDFF4A82D28DF43F3A24DE9883120DC0DC0D065B7C8B0F40300704D6AF4602C0D60E3B191B3AFFBFF9996B62B6D010C0FC93E0B9120B084099EEBC30246001C0080579A119980EC0AC0A157050F9D4BF86C7FD3A9C0618C0F4224F04ED580140B44C9AB10CFB1240531CE2573BC4F73F3063898F66E4F53F7A79D96A099DE4BFC6FF64DA70CE09C03CC8CF74534A054034660E9918EFB53F4E365AF49D9D14401896C5A72E74F33F69D9B04ACB9F1540F1D70F673A0A0E400CDE710BBD9D00402C4F53787F650D40BB56EAFC2080FABF0685F5E13E12DC3FD26B340D6F54FD3FD2DC7DD696082140259E233B3C89B8BFFAF46ACDE036DBBF29BA3F11294DEFBF89DDE5150C85F2BF8C46BE30C6720940C5E8B6EA1958C5BF5E223FBB37390DC01E6ECF7F83C3EB3FDF3EDD39D415D13FBCA5ACF105B6E73F695C1B50DAD203C021EF30921256FEBF447841C843CEFCBF1A53D08607070940"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<"0xC0E7D10FAB0E03C04EDC569D6D56F3BFA6F54CB86A650540C3F5684E4A7C1540808FE97FBC2C17407C88C9AD68D4F5BF55656081789EE23F656E7BC06057E43F9F87C3394F94EFBF1E8E5ECD15C41640720C70946F0FBEBF567F40BCBCD3F43F66230C381FA59EBF22D7F217E3A30A40D83C0124694D02406416005C1D49054080282C6C9E1115C0DC1CAC3B31E1174089C03669ADF81BC072A0F57DC96CF1BF63DB24CCD8500FC077D0BAE21A1D16C0F014A0DF3D3FE2BF96869BC613F3C43F22D70582419C0FC06E9E5787AC1B024039ADF335EE40F83FCBCC81A6B73FF1BF3FF36B3DEB5AE63FD97F285D349F12C094164F4E65C005C0C92082466DD402C0DA11B13A228FF8BFBA72640216B215C0F51A21CB98C1F33FE8C9630FBDC8F1BF440EED967E921240915E3F57DFD9FABF9D91C54D0664DABF59AEEE362CCA1B40E44E680F9E220F40B9961F7BCB5005C0D21E7BD8EAAEF2BF064864C7DD90F2BF5ECC740911C2F23F5D62EAE56793FDBFF491D8BD9D1E11C09E1313647CF7F3BF6DB8D188A55B16C05E5FDFBB8C1D09C00A710BAB792E0D407618DDB6EC1F19C0CB526B8DE4BC01C0B5E526B0A7C7F03F368AC6E17494E9BFE98C81612718F6BF1D520ED6F3BEF23F4FF304043E72C9BFE6464F7662E009404469127B1109EABF54A3376745C30340F8A0226AF515F5BF1B4B54481E4C0A401AA143F15460E73F9CEAD01F363A1F408E8933B0F51F12408E96A2DD996B0BC0C191D0D03DB80B409C786E1B152A1540E47662471EB2B33F36F423FD3A9CF8BF7AE54007E5B5AB3F6E9CE5E86585D2BF6017B8C63C44174012DAA4454F35FA3F26B2C6C6BDE7F03F7424257865B5CF3F64B30FC960A612404E237143AB00E4BFEE7EB58282DA0040F83CFFCFE561E9BFD35DC51467D7FC3FE717A2BEA769F23FA0ECDBE5A3DBF23FEA499B1432ABEFBF4396BBA73ED2C0BF50211EFF2F6A1A406028CFA10C2CF83F6FF0A9F8838801C0CCABCD7D3D66CC3FDF47546C1EAA11C057B8E9F6764303C0EC2B455FC81DFA3FF357453DB5E6D53FFC928584EAC0F43FE19E2E3A066A11C0FE720535E99220C0FA52DF98749F0EC09C9A6488603CEDBF2BA55076763001C097E4789FA2A609C00247CC81F18211C02F8B1CF3EB0AF7BFBA8CB7F9121D10C029BF9202D7DF154082F2E2778611FFBF558EBB68A65206C0A8ADF55F88E1FEBF2CCB71C8F8A1F3BF6746B5571B22FDBF58D327805AD50DC02B1BC42671AE03408966195085B0C13FB4C03444F01300C015C624D8C96DD6BF7897140406200140DA7CDA660DAEE83F123358E173020BC00C3835FA7F99EDBF7E91ADB9FA49E93F6C8266B595DA10401C87C1A3C6A010C08545712496641540A098FD6B7AE9D0BF1A99BEF3F026FF3F685BDCED2D72C2BFCE508469E61DE43F6C7F3202A0C80F40F64CBA72AAC711C05A52DF969C3E11C0DB8C37B145F60EC08CA565589D9EEA3F5087462D1000FEBF5217B35F6644F43FACB3D59316EFE73FA9064FE3BD1AA53FE64A65D55691EE3FEC09C19E59AC00401A619E7D1EE6EEBF607FB44AFE0FF43F"> : tensor<5x2x2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xC0E7D10FAB0E03C04EDC569D6D56F3BFA6F54CB86A65054021CECB5A8282E43FD2A894BB40680DC07C88C9AD68D4F5BFCE9C7039E604D8BF01C008FDA92F07C09F87C3394F94EFBF1EB7E22ED39BD2BF720C70946F0FBEBF567F40BCBCD3F43F66230C381FA59EBFCEEED9B66C3BAEBF2FBEE1F2CE3DFC3F4B2820AF6AF9F13F80282C6C9E1115C04124B88AF521E7BF89C03669ADF81BC072A0F57DC96CF1BF63DB24CCD8500FC077D0BAE21A1D16C0C2712302DCCCFBBF96869BC613F3C43F22D70582419C0FC0568D730CB6EAFCBF776E34A8C93E1DC0CBCC81A6B73FF1BF70457CA6C75715400E456E7C17A4FBBF768D8F88074308C06FED42DA8ADA0DC0C2E5C2136014FA3F2A6FA5D1E89D08C00411C1A7257519C0B23B18B04A4B064091106FCA77470AC0D7A00C9C704AF0BF2CF79276A51BEA3F0DCA8D303229E43F8C2F347FD1E20040ECC90C3DB446EB3FC6E6D0CA475A0EC0D97F285D349F12C094164F4E65C005C00C0290C55C1514C0DA11B13A228FF8BFBA72640216B215C0F51A21CB98C1F33FE8C9630FBDC8F1BFD88577EAD443B13F915E3F57DFD9FABFA645E0424ACDFABF4CF070D4BD8CD7BF9CE0682BC8241DC0B9961F7BCB5005C0AD2A264BD82A0AC08A18F8C44E560AC05ECC740911C2F23F5D62EAE56793FDBFF491D8BD9D1E11C0DE973D2BAE6CF9BF6DB8D188A55B16C05E5FDFBB8C1D09C068184291DFED0A407618DDB6EC1F19C080693561BAAB11C0B5E526B0A7C7F03F1CB9B8BDBD1614C0E98C81612718F6BF3E67683860C5E93FA4EF307E5D4AD63F2FC69533E3F4C13F2DEE99555AA9D2BF546D1CE8172CDE3FFB1D890C2B7F00405C808614FCDCF8BF9808ECF7E65DEABFACBC51B96FD5E0BFDC38079FB23BF03F5A0E29AEFA600740335C929CEC331840FA2D332046BE20C0AA85AA4FB287C73F1D520ED6F3BEF23F4FF304043E72C9BFE6464F7662E00940D0BA36C1526C12C0AD10B58BC82DEABFA50A2952E94C03C07468FFE7650009401AA143F15460E73F9B9A68188AAB19C00B7F80256E36F93F66275FD55C880DC0DA2087180AE0F1BF0FDF5A6D34A7EF3FE47662471EB2B33F36F423FD3A9CF8BF7AE54007E5B5AB3FFCDA36460ED7E2BF5A4999560A2CF0BFB7F9641682C902C0BCB808FD03DEE9BF95A55831494F18C00A1FA4D89F8A04C0A488949F0C0CF3BFEE7EB58282DA00409DF49D4F4A9FF6BFD35DC51467D7FC3F545E2D6E86310DC0A0ECDBE5A3DBF23FC84330C64904F5BFFA321B30E95A03C09430910A1FAA09C0C1910A7CEB43D7BFFB1271AA304F0640800407FABC10E6BFB8D52BD1810402C003A4A42F87CAC43F442D4926C55DBFBFE27485BBFD8EFD3FFB8D8CEDF527EB3FBD31526263EFDEBF7D93B21A427BF93FB03FE353BFE608C0EA499B1432ABEFBF4396BBA73ED2C0BFF4875BF761A5FE3F9C88AA301549E83F6FF0A9F8838801C088656000FABEF4BFDF47546C1EAA11C0D64AAD7628FA08C0C8956FA32D7D0BC0F357453DB5E6D53FC8E650793878FABFE19E2E3A066A11C0FE720535E99220C0FA52DF98749F0EC09C9A6488603CEDBF2BA55076763001C097E4789FA2A609C00247CC81F18211C067905E4FAA3909C0BA8CB7F9121D10C05EA77ABBCCD508C082F2E2778611FFBF558EBB68A65206C0376F6E674A3C16C02CCB71C8F8A1F3BF6746B5571B22FDBF58D327805AD50DC010C52DD9B705FF3F06DA1D16413208C0D53500088F9B16C09F0C2A747213E5BF26CD531A7F2AE8BF043AA27ECAC303C0D5CA7BBA4FBB02C094AA2441F024D13F3C414269C4A7D9BFCC54CAF6B6EB1C407BA77A5D9200084029287441E40AE23F6CF025A31ABC0F40427D1BB0461100C0FDFF4A82D28DF43F3A24DE9883120DC0B4C03444F01300C0300704D6AF4602C0D60E3B191B3AFFBFF9996B62B6D010C0123358E173020BC099EEBC30246001C0080579A119980EC0AC0A157050F9D4BF86C7FD3A9C0618C0F4224F04ED580140A098FD6B7AE9D0BF531CE2573BC4F73F685BDCED2D72C2BF7A79D96A099DE4BFC6FF64DA70CE09C0F64CBA72AAC711C05A52DF969C3E11C0DB8C37B145F60EC08CA565589D9EEA3F5087462D1000FEBF5217B35F6644F43FACB3D59316EFE73FA9064FE3BD1AA53FBB56EAFC2080FABF0685F5E13E12DC3F1A619E7D1EE6EEBF607FB44AFE0FF43F259E233B3C89B8BFFAF46ACDE036DBBF29BA3F11294DEFBF89DDE5150C85F2BF8C46BE30C6720940C5E8B6EA1958C5BF5E223FBB37390DC01E6ECF7F83C3EB3FDF3EDD39D415D13FBCA5ACF105B6E73F695C1B50DAD203C021EF30921256FEBF447841C843CEFCBF1A53D08607070940"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
