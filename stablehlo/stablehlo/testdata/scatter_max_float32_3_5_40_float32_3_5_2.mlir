// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xf32>, tensor<3x5x2xf32>)
    %1 = call @expected() : () -> tensor<3x5x40xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<3x5x40xf32>, tensor<2x1xi64>, tensor<3x5x2xf32>) -> tensor<3x5x40xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xf32>, tensor<3x5x40xf32>) -> ()
    return %2 : tensor<3x5x40xf32>
  }
  func.func private @inputs() -> (tensor<3x5x40xf32> {mhlo.layout_mode = "default"}, tensor<3x5x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xA72B89400C10D63FAAF0CA3F00C85F407C9853408F2B44BF85ECEF3EFDDDE63F530B33BE7211FD3E49AD1DBFEF1F63C0BA8C383F7F0D244018F8D1BF9CCE4A40A566263F56E46CBE2D9F0AC0646E98C01AF1463EE9845A409AFC6FC028BF9AC048AFADBECB1CE2BFD8CB8340797DBE3E120113BF7FC638403382A6BFD30C9740F65666401B42803F7D1213C0DE1740BEB7A225BF1922F3BE53D5E63FCF98A43EE076FDBFF607AAC0C0EE76404B224B3FDA3838C0292D7B3FD9AC8BBF8E0B25C0B71E56BF1C5D3CC0E6BD7CC0CBCA71C0F14135C015DA923EB1DF63BF9BF720407CA4F33F9440DD3E0ACF163E2E4067409ED98C40BDEF32C018540C40190E10C0B5D9233FB25CC5C0B17EEEBFF144BBBD02AC8840C471B73F50EF9DC066DEA1C0ABEC2D40C50EE7BF1AD8284078B53BC0E510C43EBD6CFABD69521B4005506B3F12C52A40E76090BF279FD33CD6CDE2BF4D7A0AC02D2939C026BDEB4021635A40FDA49DC0712813C02DCDFD3EF15B3140E86D6D3F1E50D53F0BB14440BC94183E39833D409E72BEC0C853AC407303D2BFDD7B663F0DB6DDBF4F3B40BEC74B7240C720F440488D8CC039C179BE069319C0548AB6C07A5A94406782B93F3F616A406A0EE6BF6C22073DC5014C40AAE1974073EBE33F0E43FDBE820F434091B7363FB27C1F40F66FC93FE6D557C00AFFBBBF67108EBF44254D4053631B4028B9E7BF0F758A401340C1BFAED864C0BB1160BF8F3F8C3F83F6854097ED63C0D8483BC0747B9A3F414D4C40B125953D630B54BFCAC20D40D7EF5140E769C3BFA30F6FC0ABFEF8BF15FB14C000ACDA3F0F721240AB44CDBFB7ADA73F379A413E27FF2F3EC417B63E5B2735BF07F66F3EDBC7A43F348813403587CEBF375761BF412A5CC0811E43C03BDBE8BFEC727D40395F8C4073C5B3403C5012C0124719C03E9AA7BF51DB0DC0C19D77C0CC84D43F76B5D7BF53810F406834BC3EAD275C3FDF72F43FAA0231C079D8F63F68EEA6404CF13F40BC693C40659871BE14795E3EE04C4CBF281214C0940F3D3F7FDC333F71EBB73E3C81EEBEE75A1041E8AB03C0BD2C8C404448C33FC5B6CBBE84012CBF539F2240D5489DBF25E0E33FC192513F5C8800BE9FC2834059ED0E3FC68E5FBF485E9ABE6DA4663F937E333F21DBEA3F96BBE93EA9F4A7BF91574440ED64B13F74C98140B7F4B83F244DC6C09537D04097732BBF40FBAD3F6BB0F1BF8E8DB43DF47EF03FE111D1BF0402F6BFE7A00B4071D20940A70787C0567D81C0104F8740DD51DEBE6B2F2DC0ADF4EC3F92C046C0C996A5C021A4843FA8F0E23D069A38409BC7EC3F75EEE53ED4BA66BF40FBFC3FBBF5BB408C94B94037DD10403D8CFCBFD3558340CB584A3F923E1A3EB9BAEB3F3A173B40DD2547C0B72935BFF26A9A400847B33FBFEA713E279778C01669EBBEAA53DBBE39BF6A3FEF2EE93F9ACCFD3F29B568C031752340E5FD6D3F6E63D7BF2AB62C3C3DFB94BF510C813F4295CA3F4A575FC0C8B7AD40080B733FDC74093F689DD2BE5749A5407AE664BE9D986140E095E4BF73C02CC00DD6153C4080AEC081002ABFD357974019CB873F93F103BF7C2C46BF304D454089ACC4C03B87F8BECF13FBBE16978EBF837D3940C1D654BFC5051BC0DA4B4240555E31402F0C8840C45910C01AC65D40034CDD4087496AC039EEA53E006DCBBED148D8BE121E88BFA56C11408EB78EC0BF6F83C01AA82FBF5EA8AFBFB712E9BF27E3F23FD89F2540D44045406A770FBE634C25C0440260C0F9DE0F40ABDB1B3FF43B34BF6D6DB540FAC0BE406558F840F14AAF3E5C88B2BFB7E7693D512BBEBF7706DF3F7DA0A93FD81C2440E5C09E40AE663E40E26551C023D4D6BF709B6FC0B810AA404237ACC0CF953AC085D88640844E98BF1B411540A5216D405608F83E397261C0E9F121C08D5438BF17AC0FC0731EC43FB51BB4BE1CBD3CC0B15CA1BF56D2ADC0D8F4D7BF6E2951400BA590BF11DA2BC0575DA13F1981533FB04162C02A40C33F7DF8D13F49E95E3F9E248CBFBA4D02BE21A486C04097C53FE8639F40AFFB9CBFF8BDC9BF1C60873F451A9F3FC8A8D4BEFA9830BEA03EDE3F5346AEC0B77C6640AE3498C0C15F5640C2789DBF63C8E93F7988CB3F279984BF275E03C1CA50F1C0E4C5F2C0D23E82BF910309BF05F1FABF6E20EC3FBC8BDF3E0FE415C051EEA34058DBA0BFF3EC1B3FD99FECBFFA49D8BFEC0253404EFC634038013140DDF0AA3FF0D31540E77BFF3F2AC56E3F23AAFF3F7BA0E03E63897FBD8E41464052C35E40B394044034EE65402EE211401A4550409BDD2AC006D9E03F80804B3F677DE140419007C0FB9D934004F27DC0AC6A68C0FBC74AC0F0584FC00025753FF91BCFC08A856740E97DF8BFF7C73F407B0C8FC05C2769C05B6BAE3FB26DF2C0FEE4AAC0884EAD3FBAEBCD3F8009D53E0CB1873F6811A13F637F9EC058299F40D864F63EBF7A3040B3B243C09FACD13F638D25C04F7CE9BFA2CDBC402C2B18BF91D84040EB82C0C031A0403FE39DA0C0CC1AFA3FEF7C6440585C483FD8B589403354813E29DA7940F279403F4997B7C0561933C099BD1CC0D8D44040B6E2C1BF30D63CBCA363C1BEB332A9BEB5EB9F407365F5BFDA339FC00B10963DEA92E63F27BFD73F9FF8C740BD3E933F4989B6404D18E63DCA1FC7409FC33240A79474C074AF08C079E38C40D9687A3E70793540B6A684BEF2650BBFB70725BF50EEF9C04F90B0BF765E8BBF8256933F13534CC0607938BD2FF22E3F27F4CB3F7AE9DDBE71183F3FCCE6AE3FA7DAE2BFEF8D46400DE2EFBFF63645C0FE60D9BEC4CF8E4068205640C5C4DEBE02BBA1406281C83F2CD55040629F0ABF353F12403280B1C045F103408247BCC087F60E3FC4D54B402DF89C3F275615BF5898B73F0D2D0F40B8D2B2BF80A72B407D3E72C0AED358C0420E353D3C98663F84327340B9567EBE25915540556A2EBF6CDB77BFE35570BF1B1CD13FBD442DBFDBD482C097BC41BF0EFD6540AF5D4BC0C2AC144041A011407C4C34C005A933400C28F6BFD3FD053FF0C0FEBF9CF2F3BE6299D53DFA9B6E3F57DE9FC0455FFE3FE043E13F226BB4BF463BC6BFEBC395C03DC56BC04C6C7240E281E840906DD23F504513C08BE7A5402CDA19C0CAFFB83FE24E6BC0CB71A13FDC2637C09A788B40E3D62B40A5A8743FAEE715BF550E80BF9F328740D060313EFC6FF3BF41DD2DC0CB38913F0CD9C840765333C08B0B45BF56A3C83F26683941287344C074A0953F2951563FE8EE93403038A3BF355C043F155CE4BE1DBB2EC0F5726840888ED3BEF931CB3F20AE194040B8E64005988E40747F7C3D327389C05060D13F59D38F402D83B1BF5B0FC63ED5D56BC02BAC5E3F79EFC9C0"> : tensor<3x5x40xf32>
    %cst_0 = stablehlo.constant dense<[[[2.5601778, 5.97798252], [0.696015536, -2.15867186], [5.26290894, -0.225048497], [-1.87461543, 2.51068687], [-3.80757093, -0.468016624]], [[1.76945961, -2.65166378], [-2.65723014, 0.2993837], [-3.23903298, 6.06646395], [-1.24211431, -2.55722642], [0.962707698, -0.892589628]], [[5.25273275, 2.12454128], [1.62191403, 0.984814524], [1.69339347, -1.53476846], [0.329176188, -2.90754247], [-1.63863921, -3.02100825]]]> : tensor<3x5x2xf32>
    return %cst, %cst_0 : tensor<3x5x40xf32>, tensor<3x5x2xf32>
  }
  func.func private @expected() -> (tensor<3x5x40xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xA72B8940A24BBF40AAF0CA3F00C85F407C9853408F2B44BF85ECEF3EFDDDE63F530B33BE7211FD3E49AD1DBFEF1F63C0BA8C383F7F0D244018F8D1BF9CCE4A40A566263F56E46CBE2D9F0AC0646E98C01AF1463EE9845A409AFC6FC028BF9AC048AFADBECB1CE2BFD8CB8340797DBE3E120113BF7FC638403382A6BFD30C9740F65666401B42803F7D1213C0DE1740BEB7A225BF1922F3BE53D5E63FCF98A43EE076FDBF132E323FC0EE76404B224B3FDA3838C0292D7B3FD9AC8BBF8E0B25C0B71E56BF1C5D3CC0E6BD7CC0CBCA71C0F14135C015DA923EB1DF63BF9BF720407CA4F33F9440DD3E0ACF163E2E4067409ED98C40BDEF32C018540C40190E10C0B5D9233FB25CC5C0B17EEEBFF144BBBD02AC8840C471B73F50EF9DC066DEA1C0ABEC2D40C50EE7BF1AD8284078B53BC0E510C43EBD6CFABD69521B4005506B3F12C52A40C069A840279FD33CD6CDE2BF4D7A0AC02D2939C026BDEB4021635A40FDA49DC0712813C02DCDFD3EF15B3140E86D6D3F1E50D53F0BB14440BC94183E39833D409E72BEC0C853AC407303D2BFDD7B663F0DB6DDBF4F3B40BEC74B7240C720F440488D8CC039C179BE069319C0548AB6C07A5A94406782B93F3F616A406A0EE6BF6C22073DC5014C40AAE1974073EBE33F0E43FDBE820F434091B7363FB27C1F4018AF2040E6D557C00AFFBBBF67108EBF44254D4053631B4028B9E7BF0F758A401340C1BFAED864C0BB1160BF8F3F8C3F83F6854097ED63C0D8483BC0747B9A3F414D4C40B125953D630B54BFCAC20D40D7EF5140E769C3BFA30F6FC0ABFEF8BF15FB14C000ACDA3F0F721240AB44CDBFB7ADA73F379A413E27FF2F3EC417B63E5B2735BF07F66F3EDBC7A43F348813403587CEBF375761BF412A5CC0811E43C0E09FEFBEEC727D40395F8C4073C5B3403C5012C0124719C03E9AA7BF51DB0DC0C19D77C0CC84D43F76B5D7BF53810F406834BC3EAD275C3FDF72F43FAA0231C079D8F63F68EEA6404CF13F40BC693C40659871BE14795E3EE04C4CBF281214C0940F3D3F7FDC333F71EBB73E3C81EEBEE75A1041E8AB03C0BD2C8C404448C33FC5B6CBBE84012CBF539F2240D5489DBF25E0E33FC192513F5C8800BE9FC28340A77DE23FC68E5FBF485E9ABE6DA4663F937E333F21DBEA3F96BBE93EA9F4A7BF91574440ED64B13F74C98140B7F4B83F244DC6C09537D04097732BBF40FBAD3F6BB0F1BF8E8DB43DF47EF03FE111D1BF0402F6BFE7A00B4071D20940A70787C0567D81C0104F8740DD51DEBE6B2F2DC0ADF4EC3F92C046C0C996A5C021A4843FA8F0E23D069A38409BC7EC3F75EEE53ED4BA66BF40FBFC3FBBF5BB408C94B94037DD10403D8CFCBFD3558340CB584A3F923E1A3EB9BAEB3F3A173B40DD2547C0B72935BFF26A9A400847B33FBFEA713E279778C01669EBBEAA53DBBE39BF6A3FEF2EE93F9ACCFD3F29B568C031752340E5FD6D3F6E63D7BF2AB62C3C3DFB94BF510C813F4295CA3F4A575FC0C8B7AD40080B733FDC74093F689DD2BE5749A5407AE664BE9D986140E095E4BF73C02CC00DD6153C4080AEC081002ABFD35797407920C24093F103BF7C2C46BF304D454089ACC4C03B87F8BECF13FBBE16978EBF837D3940C1D654BFC5051BC0DA4B4240555E31402F0C8840C45910C01AC65D40034CDD4087496AC039EEA53E006DCBBED148D8BE121E88BFA56C11408EB78EC0BF6F83C01AA82FBF5EA8AFBFB712E9BF27E3F23FD89F2540D44045406A770FBE634C25C0440260C0F9DE0F40ABDB1B3FF43B34BF6D6DB540FAC0BE406558F840F14AAF3E5C88B2BFB7E7693D512BBEBF7706DF3F7DA0A93FD81C2440E5C09E40AE663E40E26551C023D4D6BF709B6FC0B810AA404237ACC0CF953AC085D88640844E98BF1B411540A5216D405608F83E397261C0E9F121C08D5438BF17AC0FC0731EC43FB51BB4BE1CBD3CC0B15CA1BF56D2ADC0D8F4D7BF6E2951400BA590BF11DA2BC0575DA13F1981533FB04162C02A40C33F7DF8D13F49E95E3F9E248CBF0374763F21A486C04097C53FE8639F40AFFB9CBFF8BDC9BF1C60873F451A9F3FC8A8D4BEFA9830BEA03EDE3F5346AEC0B77C6640AE3498C0C15F5640C2789DBF63C8E93F7988CB3F279984BF275E03C1CA50F1C0E4C5F2C0D23E82BF910309BF05F1FABF6E20EC3FBC8BDF3E0FE415C051EEA34058DBA0BFF3EC1B3FD99FECBFFA49D8BFEC0253404EFC634038013140DDF0AA3FF0D31540E77BFF3F2AC56E3F6316A8407BA0E03E63897FBD8E41464052C35E40B394044034EE65402EE211401A4550409BDD2AC006D9E03F80804B3F677DE140419007C0FB9D934004F27DC0AC6A68C0FBC74AC0F0584FC00025753FF91BCFC08A856740E97DF8BFF7C73F407B0C8FC05C2769C05B6BAE3FB26DF2C0FEE4AAC0884EAD3FBAEBCD3F8009D53E0CB1873F6811A13F637F9EC058299F40D864F63EBF7A3040B3B243C09FACD13FE19ACF3F4F7CE9BFA2CDBC402C2B18BF91D84040EB82C0C031A0403FE39DA0C0CC1AFA3FEF7C6440585C483FD8B589403354813E29DA7940F279403F4997B7C0561933C099BD1CC0D8D44040B6E2C1BF30D63CBCA363C1BEB332A9BEB5EB9F407365F5BFDA339FC00B10963DEA92E63F27BFD73F9FF8C740BD3E933F4989B6404D18E63DCA1FC7409FC33240A79474C074AF08C079E38C40D9687A3E707935401EC1D83FF2650BBFB70725BF50EEF9C04F90B0BF765E8BBF8256933F13534CC0607938BD2FF22E3F27F4CB3F7AE9DDBE71183F3FCCE6AE3FA7DAE2BFEF8D46400DE2EFBFF63645C0FE60D9BEC4CF8E4068205640C5C4DEBE02BBA1406281C83F2CD55040629F0ABF353F12403280B1C045F103408247BCC087F60E3FC4D54B402DF89C3F275615BF5898B73F0D2D0F40B8D2B2BF80A72B407D3E72C0AED358C0C889A83E3C98663F84327340B9567EBE25915540556A2EBF6CDB77BFE35570BF1B1CD13FBD442DBFDBD482C097BC41BF0EFD6540AF5D4BC0C2AC144041A011407C4C34C005A933400C28F6BFD3FD053FF0C0FEBF9CF2F3BE6299D53DFA9B6E3F57DE9FC0455FFE3FE043E13F226BB4BF463BC6BFEBC395C03DC56BC04C6C7240E281E840906DD23F504513C08BE7A5402CDA19C0CAFFB83FE24E6BC0CB71A13FEEBED1BF9A788B40E3D62B40A5A8743FAEE715BF550E80BF9F328740D060313EFC6FF3BF41DD2DC0CB38913F0CD9C840765333C08B0B45BF56A3C83F26683941287344C074A0953F2951563FE8EE93403038A3BF355C043F155CE4BE1DBB2EC0F5726840888ED3BEF931CB3F20AE194040B8E64005988E40747F7C3D327389C05060D13F59D38F402D83B1BF5B0FC63ED5D56BC02BAC5E3F79EFC9C0"> : tensor<3x5x40xf32>
    return %cst : tensor<3x5x40xf32>
  }
}
