// RUN: stablehlo-opt --chlo-pre-serialization-pipeline -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s | stablehlo-translate --serialize --target=current | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<1x20xf32>, tensor<20x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#0, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = chlo.next_after %2, %0#1 : tensor<20x20xf32>, tensor<20x20xf32> -> tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<1x20xf32> {mhlo.layout_mode = "default"}, tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<[[0.483832061, -1.03918183, -3.86444163, 0.753092408, -0.777551233, -2.54203701, -2.41574287, -2.0275836, 3.93960309, -2.94567752, -1.17154133, 3.11126733, -1.41024363, 0.0605086908, 1.87132907, 7.58319282, -1.88469386, 1.41506553, -0.309088379, 0.839651882]]> : tensor<1x20xf32>
    %cst_0 = stablehlo.constant dense<"0xC5C703C04EBA9FC0B8CDFB3FECE2C43FDD80153F3F441D3E79946D40589003C05BA63BBF23722C3FDB550F4070BF46BFB54EB93EC32530C09779C73F1355A840755B8D40E0A2A8BFBB4189BFF8F797BF24F7093FA04C6C3F2E9708C0BB20D8BF51FDF13F0FD9753D9EC268BE07B9063FC0261B3F13F007C0BAB208C073777E408F5E11403132F6BF1829473DFAD977C0C89C2F402B4F7DC06E7BBABF149144BFA0280440398935403335984009D60C40B9B900C0D4FFD8BF9EFDDC40CE17B14059078DC0D14AD2BFC0BD2DC00C8835409C2DDABFAC8C45C0D7121D40A0357F40AAA33BBF2545D0BF3DC0823F8A7D1C4098326840CC752BBF5F369B3FE3D1083F77A5CE40ED9527402B6BA7C0ACEA8C3FB247833F5D8C0BC0C5E6403F45DE8D3F1BC20A4084370CC039CB2740FFE081BFB30072C0BD38A9BFEC8416BF650DAE3FD819913EA6DA6FBEE860CE3F8154DC3FF3F1913EC41642C04DEE35C0546E4440F9800ABFDC8F8D3F91C57EBFFC98063FDEFBDBBF0BD103C046C9D1C0D425C6BD63E4BF409C3FE03F72533A404165EF3F2EA450403F44AC3FAF9AC23FA460A440461FB6BF94D38EC01540AE405B26BD3FD2A211C0819662C0B9F9D0BF5BCEDB3ED900C03FC7D5B840FE222AC098BA86BFA7187A403F224FBE0C723CBF22E023400DAA94BFEC14E63D56854240C77C8640198E9CC0528370C0D2EB87C062290340290009C0663F423F6A8A10BF231CA23FFB3A0D4026569A40D93CE43F71D19840BCD0004081A127C0EA04A03FF718D93EBE71BC40E052F23F558D1C406238DD40CD0CFABF9F66E03F4B7752BFA70A00C1C5B078BF4BDFBB3FF3B2193FF1D2A0BFDF66ACBFBB2E1B406B48513F5360783EE0F1773F2E082EC071C48F3F9DE50540684B6FC02260A33F97B2C840E8B8E63F488CF2BF560029BE130F66BF6F2F18403C6AF740490180406E7909C0FDD11FC0A1BC33C0FA81BC40DAB70CC0080D2CC09FA14B40811A1B4020E57E3FD6945740AAF855C0E68A17C0D8BFD7BF35AE8C3F085EAB402BDABDBE99F342C0840B2EC0317015BF9EB55F3F138273BE651622407B6849BE1AAB01C0680870C0D2F9D53EE768773F102DEC40DEFD133C6F28CE3FAF6891BFF84F0AC0431A3DBF3400C0BF36427DBF23E944C0A64BB7BEF1F22AC002BD4EC0F3390C3FAAC4A63FDB2D24C05A2363BF423738404E84183F4D5B26409A8794BF90ADDCC0C9E915C01ABB72405F69803DBDBD8940AA6F17C0347D8CC041E1AA40019321407CC358C07AA05940D26313BFA7BDB3BF6EB281C0D6E91B3FE6E0873F9B5E823E57EE39BDF7ECCFBFDDD3A5BE2A3208C0C34503C0ECEF5C4049D607BFE1297CBE11F9BE3E227B8740678DA440EE763E403D2900404E694A40CF1A69C0B2AF89C04EFCB0C001779F3F1DBE914085F837BE13B65740FE0326C09D07C040B9887D40674222C062B57ABF073383C061CF65C086B3BE401E6A9CC0AC3F50C007BCC7BFB636D93FE8E60ABFE11CBFC0EDBB623FE1A23340B71415C0BC0CB8C0764823BFBA522CC089739ABFCB4DD3C0403C16404E14DFC041A89F40E14CEE3FE922D83E942498C021C3C63F4C3A9B3F4BBC6EC092923B40E91BD64064E1BEBFB203CBBFC3A069C0795B11C0AB9BAFC03F75E0C083173BC07E087BC051A128C01CAC18C03396CFC0360F5A4080A3D7BFB3646BC030F1CDBF6F0E14C0465F14C0B6204F3E554C06C04A8B4C406E5C98C08F8E08408523923F0844F63F90E9B83ED1C221C02215F13F190F4240852B1540CD7D3B4042CE78C0D095C5BF95B1E9BFFAA127C0DB161BC016DB24C0F406CCBFD0D1F3BEABF6FE3F27491C3E6014B23FA60E99BDD3369BBECEDC5C40F679B13E9A1C61BEC120D93C4CC4903E3D1BE1BD3F1C37C026C15C4030E23EBF062405C087BDAFBF4F2B2F4081371D3EAC0F84C078EF4C3F437239407457BA3FEF94A6C0BA98B0C00A196540319EFEBF9A794B3F010233400C0E863F2721773F8F97FF3F30CBA5BFAB0DBA3F621C9540F44A423F9AAAC9BFB8AD0CC05BDC16409557403F9219B6BF2E62DEC0DC932BC0CB45FC3F167B4240930BE6BFC010BC405EECACC06ACD093EBE7E633E9DEEB3BF5F7EE93FE31A66400CCF3BBF97BD823E967C813F3AE9853FA8EF8E3F2575B4C089F4EA3F358B8BC0325B42BFA4D0E03F043DC540A1F0423F86101EBF587B37BFE8746D4018611540C79D1AC082285FC0809BBA40A02A34BF983FAEBF14482BC0"> : tensor<20x20xf32>
    return %cst, %cst_0 : tensor<1x20xf32>, tensor<20x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xD5B8F73EEA0385BF025377C0ABCA403F980D47BFBBB022C0879B1AC0EFC301C074227C40FA853CC010F595BF001F4740DC82B4BFF5D7773DB587EF3F83A9F240A53DF1BFDD20B53FD6409EBE6CF3563FD7B8F73EE80385BF025377C0A9CA403F980D47BFBBB022C0879B1AC0EDC301C074227C40FA853CC012F595BF021F4740DC82B4BFF5D7773DB587EF3F83A9F240A53DF1BFDD20B53FD6409EBE6CF3563FD7B8F73EE80385BF025377C0ABCA403F9A0D47BFBBB022C0879B1AC0EDC301C074227C40FA853CC012F595BF001F4740DE82B4BFF5D7773DB787EF3F83A9F240A53DF1BFDD20B53FD4409EBE6EF3563FD7B8F73EE80385BF025377C0A9CA403F980D47BFBBB022C0899B1AC0EDC301C074227C40FA853CC010F595BF001F4740DC82B4BFF5D7773DB787EF3F83A9F240A73DF1BFDD20B53FD6409EBE6EF3563FD5B8F73EE80385BF025377C0ABCA403F980D47BFBDB022C0899B1AC0EDC301C074227C40FA853CC010F595BF001F4740DE82B4BFF5D7773DB587EF3F83A9F240A53DF1BFDF20B53FD4409EBE6EF3563FD7B8F73EE80385BF025377C0ABCA403F9A0D47BFBDB022C0879B1AC0EDC301C074227C40FC853CC012F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD6409EBE6EF3563FD5B8F73EE80385BF025377C0ABCA403F9A0D47BFBDB022C0899B1AC0EDC301C074227C40FA853CC010F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD4409EBE6CF3563FD7B8F73EE80385BF025377C0ABCA403F9A0D47BFBBB022C0879B1AC0EFC301C074227C40FA853CC010F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD4409EBE6EF3563FD5B8F73EE80385BF025377C0ABCA403F9A0D47BFBBB022C0879B1AC0EDC301C076227C40FA853CC012F595BF001F4740DE82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDF20B53FD4409EBE6EF3563FD5B8F73EEA0385BF025377C0ABCA403F980D47BFBBB022C0899B1AC0EFC301C074227C40FA853CC010F595BF001F4740DC82B4BFF5D7773DB587EF3F83A9F240A53DF1BFDF20B53FD4409EBE6EF3563FD5B8F73EEA0385BF025377C0A9CA403F9A0D47BFBDB022C0879B1AC0EFC301C074227C40FA853CC010F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD6409EBE6EF3563FD5B8F73EE80385BF025377C0A9CA403F980D47BFBBB022C0899B1AC0EDC301C074227C40FA853CC012F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD6409EBE6EF3563FD5B8F73EE80385BF025377C0ABCA403F980D47BFBBB022C0879B1AC0EDC301C074227C40FC853CC012F595BF001F4740DC82B4BFF5D7773DB787EF3F83A9F240A53DF1BFDF20B53FD6409EBE6CF3563FD5B8F73EEA0385BF025377C0A9CA403F9A0D47BFBBB022C0879B1AC0EDC301C074227C40FA853CC010F595BF001F4740DE82B4BFF5D7773DB587EF3F83A9F240A73DF1BFDF20B53FD6409EBE6EF3563FD7B8F73EE80385BF045377C0ABCA403F980D47BFBDB022C0879B1AC0EDC301C074227C40FA853CC012F595BF001F4740DE82B4BFF5D7773DB587EF3F83A9F240A73DF1BFDD20B53FD6409EBE6EF3563FD5B8F73EEA0385BF025377C0A9CA403F9A0D47BFBBB022C0879B1AC0EDC301C074227C40FA853CC010F595BF001F4740DC82B4BFF5D7773DB787EF3F83A9F240A53DF1BFDF20B53FD6409EBE6CF3563FD5B8F73EEA0385BF025377C0A9CA403F9A0D47BFBBB022C0879B1AC0EDC301C074227C40FA853CC010F595BF021F4740DC82B4BFF5D7773DB587EF3F83A9F240A53DF1BFDD20B53FD4409EBE6CF3563FD5B8F73EEA0385BF025377C0A9CA403F9A0D47BFBBB022C0879B1AC0EDC301C074227C40FC853CC010F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD4409EBE6EF3563FD7B8F73EEA0385BF025377C0ABCA403F980D47BFBBB022C0899B1AC0EFC301C074227C40FA853CC012F595BF021F4740DE82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDF20B53FD6409EBE6CF3563FD7B8F73EE80385BF025377C0A9CA403F980D47BFBDB022C0879B1AC0EDC301C076227C40FA853CC010F595BF001F4740DC82B4BFF7D7773DB587EF3F83A9F240A53DF1BFDD20B53FD6409EBE6CF3563F"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
