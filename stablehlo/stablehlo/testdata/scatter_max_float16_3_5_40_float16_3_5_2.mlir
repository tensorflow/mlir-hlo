// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %1 = call @expected() : () -> tensor<3x5x40xf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f16>
      stablehlo.return %3 : tensor<f16>
    }) : (tensor<3x5x40xf16>, tensor<2x1xi64>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> ()
    return %2 : tensor<3x5x40xf16>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16> {mhlo.layout_mode = "default"}, tensor<3x5x2xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x6DC204379842E1C23EBF38C2A7C2F5BDFAB955B052B10BA5494532C4B5B58DC6BBC33CC4FDC0EBB9E33E393C7F3C42292D44FF39E545FEC32038F33B9BC3144342C15D3C2336DDBE45C1594032C4F5413AB6A0BB0245AAC379C668C5EC3EC2B574BE53C018C43DBB22C372B90844FB418F4071C22BC24EBBA3B9883CF6C0C13FFCBFD2BF1546F23ED32F9CBD69BE9EB97F3C293816C55640B2C23C43EA46E9C80BC038C495C0CCC099A814C241C048C075450C3C9CC2FAC0F940F6449F3CB23EA3427B43FE358D466EC6194213C001C7A5C36C41603CFDC2BF37FBBF1FC3153E83BA1B30D930823ECB3E6E3DA5BFAF3D2C2E1ABDF93BF945CDBFE2C5A9AD203FCCC0E0BD2F4434C2E23E023F814401C36A41C043A3396F3C89459CBF43C27D3A64440D487CC502C2A74079C314B4D545B7C3E8C789C0AC48924279B99EB9B3C0B7BCD643C2411336A13FE83C9DC88136D3BFE5BCC044B8C71F3449B92D34E9407037EB3F4EBC244282C5B13BF3AF1AC2D1BC972401AD064100C5B5C02243FDBCAE42FD42FD3A77C736424DC4A9C72B3C033CC9C0C2C16A407A3FE441B0BF21BE32BF2CB570C69BBCDA3E043F08BC043B1FC142BA4B38133C14C5CCB8F644EDC37DC1A04309C499B457BC41B6D2C1E7BD9ABEA0416F41FA421E421D3A8FB6E1414BC19FBE67388BC34540CCC2483F0DC2D9B30A44483EB6C138C053426A420AC513C1EA427740E338EE455DBDC042D84325418439A8C242C5293B3944E1B56B339CBBE1392F3EF64229A6FBC2E1B4034404BA95A94A331B42D6434D3E55BDB53EB34082C07ABDDB429639AF41ACB40AC5D91374C4A9B5B6BD8A3B1C44723DFCBF41C2CFC5D1BC0F3FA23B2A412842B0C13BC598410A426628AC41DCC4A5C025B997BE02BC913F7EBE204228BE28C579C4763CEC3BC343C1BF073F00C145BFEA3F694059422DC182C34C407B424BBC9DB9C7C090C0243C90C0104328B911B1B0408BBA11C077C0ACBBD2BF1329CDC1F6C5CC4088C3E73C7341633869C855C5669C9644003952B502C226458A29CBC2D0B8F4BCE5B721C1A735C3453F32FF43EAA35AC262C4D6B05EC866448B4496C10D43CAC4343BF93137B4D3C74945A1BED9BBA74681C318400432C0BD9C381C3E24C32041D445523DBF47E8421D4067C35640DFBF76BA5A330ABFDC4416C1E3BF2D45334265BCBBC2BFBCE5BE0D2A24C592C5803638BC97BF67C3E22D0ABD41459F3EC641F3C0133830431EBDD2BE25B32EBD78BB56C5CCC0A439244450328D3AD9452BBD39C41C40CE459A3F3FC0CC3CBFBCEB3D15C26638E3C74228C640623D0243B3BC964028C3DC3CFCC119442A3B4945613F544071BDB83D50C3EC4578BF003C62B985416FC2853F50C43CBCFF38EF34F93A48B4393ADF435FBE71BDF8430A3B9E405840A53D90C1C0408E3F42C6A6C63EC13941FFC2D13E653ECCC08CC1E3415E4036406FBD3BB8D7C14E4187C4E530B9BDA53C863C4D40CF3D16C368C1B5C032BD5844574486C09A3C81BFA13CC839483CFF424744B2C5AEC2DFC2AEBF8BB95939E1AD49C23D4126B96DC33AB8C83FA4B3E42D2ABBFC2689C4AFC2F7BD9CC0C7C4ADB99FC0F83780C10A42053FA4C0FDC00A4232A5803C42B58F41283DE04119C405C6C61F4DC49EB8813E98B979C5AE3C60C38B3D82C407C008C00A3F50C1"> : tensor<3x5x40xf16>
    %cst_0 = stablehlo.constant dense<[[[-2.990230e+00, 5.632810e+00], [-1.313480e+00, 1.966800e+00], [-6.539060e+00, 2.171880e+00], [2.562500e+00, -5.648440e+00], [-1.778320e+00, -2.147220e-01]], [[6.284180e-01, 3.167970e+00], [3.093750e+00, -2.454830e-01], [2.062500e+00, 7.739250e-02], [4.332030e+00, 2.900390e+00], [1.978520e+00, 2.693360e+00]], [[-3.527340e+00, 2.561040e-01], [2.500000e+00, 5.738280e+00], [-3.394530e+00, -1.513670e-01], [-1.883790e+00, 4.222660e+00], [-2.236330e+00, 1.792970e+00]]]> : tensor<3x5x2xf16>
    return %cst, %cst_0 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> (tensor<3x5x40xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x6DC2A2459842E1C23EBF38C2A7C2F5BDFAB955B052B10BA5494532C4B5B58DC6BBC33CC4FDC0EBB9E33E393C7F3C42292D44FF39E545FEC32038F33B9BC3144342C15D3C2336DDBE45C1594032C4F5413AB6DE3F0245AAC379C668C5EC3EC2B574BE53C018C43DBB22C372B90844FB418F4071C22BC24EBBA3B9883CF6C0C13FFCBFD2BF1546F23ED32F9CBD69BE9EB97F3C293816C55640B2C23C43EA46E9C80BC0584095C0CCC099A814C241C048C075450C3C9CC2FAC0F940F6449F3CB23EA3427B43FE358D466EC6194213C001C7A5C36C41603CFDC2BF37FBBF1FC3153E83BA1B30D930823ECB3E6E3DA5BFAF3D2C2E2041F93BF945CDBFE2C5A9AD203FCCC0E0BD2F4434C2E23E023F814401C36A41C043A3396F3C89459CBF43C27D3A64440D487CC502C2A74079C314B4D545B7C3E8C789C0AC48924279B99EB9B3C0B7BCD643C2411336A13FE83C9DC88136D3BFE5BCC044B8C71F3449B92D34E9407037EB3F4EBC244282C5B13BF3AF1AC2D1BC972401AD064100C5B5C02243FDBCAE42FD42FD3A77C736424DC4A9C72B3C033C5642C2C16A407A3FE441B0BF21BE32BF2CB570C69BBCDA3E043F08BC043B1FC142BA4B38133C14C5CCB8F644EDC37DC1A04309C499B457BC41B6D2C1E7BD9ABEA0416F41FA421E421D3A8FB6E1414BC1304267388BC34540CCC2483F0DC2D9B30A44483EB6C138C053426A420AC513C1EA427740E338EE455DBDC042D84325418439A8C242C5293B3944E1B56B339CBBE1392F3EF64229A6FBC2E1B4034404BA20404A331B42D6434D3E55BDB53EB34082C07ABDDB429639AF41ACB40AC5D91374C4A9B5B6BD8A3B1C44723DFCBF41C2CFC5D1BC0F3FA23B2A412842B0C13BC598410A426628AC41DCC4A5C025B997BE5544913F7EBE204228BE28C579C4763CEC3BC343C1BF073F00C145BFEA3F694059422DC182C34C407B424BBC9DB9C7C090C0243C90C0104328B911B1B0408BBA11C077C0ACBBD2BF1329CDC1F6C5CC406341E73C7341633869C855C5669C9644003952B502C226458A29CBC2D0B8F4BCE5B721C1A735C3453F32FF43EAA35AC262C4D6B05EC866448B4496C10D43CAC4343BF93137B4D3C74945A1BED9BBA746193418400432C0BD9C381C3E24C32041D445523DBF47E8421D4067C35640DFBF76BA5A330ABFDC4416C1E3BF2D45334265BCBBC2BFBCE5BE0D2A24C592C5803638BC97BF67C3E22D0ABD41459F3EC641BD45133830431EBDD2BE25B32EBD78BB56C5CCC0A439244450328D3AD9452BBD39C41C40CE459A3F3FC0CC3CBFBCEB3D15C26638E3C74228C640623D0243B3BC964028C3DC3CFCC119442A3B4945613F544071BDB83D50C3EC4578BF003C62B985416FC2853F50C43CBCFF38EF34F93A48B4393ADF435FBE71BDF8430A3B9E405840A53D90C1C0408E3F42C6A6C63EC13941FFC2D13E653ECCC08CC1E3415E4039446FBD3BB8D7C14E4187C4E530B9BDA53C863C4D40CF3D16C368C1B5C032BD5844574486C09A3C81BFA13CC839483CFF424744B2C5AEC2DFC2AEBF8BB95939E1AD49C23D4126B96DC33AB8C83FA4B32C3F2ABBFC2689C4AFC2F7BD9CC0C7C4ADB99FC0F83780C10A42053FA4C0FDC00A4232A5803C42B58F41283DE04119C405C6C61F4DC49EB8813E98B979C5AE3C60C38B3D82C407C008C00A3F50C1"> : tensor<3x5x40xf16>
    return %cst : tensor<3x5x40xf16>
  }
}
