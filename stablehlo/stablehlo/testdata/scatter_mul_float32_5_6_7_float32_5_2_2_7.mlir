// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2x7xf32>)
    %1 = call @expected() : () -> tensor<5x6x7xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<5x6x7xf32>, tensor<2x2x1xi64>, tensor<5x2x2x7xf32>) -> tensor<5x6x7xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> ()
    return %2 : tensor<5x6x7xf32>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xC95743C0EAD4ADBE8E47F7BFFA11824017E93A3E44F625BF726F4440344B84C027D88FC0D9022AC07AF24640646FC14038B090C094820841C6A952C0C1F53A3F75E4D2BF9D9B8DC05FC61A4038EA16C0AF9E0140928F973FB0E0E4BEF987A23F7CEA10C0D3306ABED6C89F3D17FD0D40381A7740651325C01AEDA3BEEA258ABCE625BEC01C22823FE83F2A400AFEA5BE5A7CD4C0433E01C08A2FBDBFB6971EC0F7BEA3BF9E66A03DBE981BC0022022C0D1D904C00250793F31FF9540BC9C08C06929333FFCE495408331CCBF640122C0AB2D57404A9D7E405DB0033F2F23464073BEB6400899BE3F1CC6703F5C2F96401D10873F1BD64F4073819DBF0F992ABE9BC711C0531BB4BE03E7DBC01DDBD0403B84A840A1406BBF96763540B27071408C4EC4402E5DB03F04CF8FC066357A40EB8A4940339DE7BF5D2080409A9CE1405A291F3E5B4D02C0EC3A9FC033A297400C24DE3FE55FBC3FA86F02C04340E53FD3AB64BF5DF2EA40080063C0E421C73F440474BE7DCD29BF30802E416CDD16408C9E81BD0C5B63BD659F3E3E539BDCBF5F3996BEEA688E3F51011AC0F769A8C01FF44F406486D53FC5D9E040A8FDA53FE16FB5C0790166BF9F230CC07C0B1B408D2F174022FCF6BF28E1C1BE3AF3C9BE3C5537C0728CCD3F00071EC0DB94CD3F4BD04FBF87E985BF0F2546C05FC7433F1DAE69C0E2AA19C0974F1540668F94BF5AF8EFBEFD38E3BF9BD6E93E98D4BF3F7390D14042BD77BF5FC7A93D50B0703E35D44DBE7DFBCF3EA123FCBF9B4A37C0407DA53F3EEE853F5DDA854023D60BC083557FC0396AEA3E676811BFADD85FBFAA653A406D880BC0374E7CC083EE16C0966FDF3FC509B9C0E95F1A4023767D40DCF10D4045EDCEC0C7551B3E261DB3406F10633EAEAB1A3F190D9FC0E529A2BF1B668FC0C936284095082BBD306A10C07E1366C0E37E9140320FDFBEA9E176C04A45C33E9868503F46EA034045B171BE4457E7BFF7B217C0CF5B454086920640D3A88DBF97295140B828EABF20FCC43FAAD70E3F3E97A13FCA161EBF7A71EEBDD26A8A400744803F27D528405AA45A40B709B8C0B73C3F40A869943E7AD3073F036C783F15E36ABF6CCF0740028C083F66881BBEF75E1E404127743F29AB2040B6A20FC06600ED3F53E9CA400C191BC08F15993F6986CF40"> : tensor<5x6x7xf32>
    %cst_0 = stablehlo.constant dense<"0x0EDEE6C0A0BC503F820325C03A590E40EDC9483F581A84402CC9AE3FBC7A9F3F6BE8493D296E874082F5993F47842040A20800401D2028C0D93D863F21BC1C40CCB1CB3F6978C23FB2D258BF2F31A440B90B204074027040BE434E40B32974400DB04540805C444034CE4C3D9860BD3F1288C340488D0240C6CE7DC03B88A7C003EBFCBF5F8FF03FD3DADB3F8097AF3FC5E16B40B51E11C0D5F933BFEBE57840A30A5A40FC8AE9BF348616401C797EC0E50726C075A92C401214D5BEE1ECBAC041F15B3F0A3E453F6901E6C09FE4E8C0C3C982BF60B08BBF0F3F2CC06B1B3DC026233EC033638F40904B7EC0BE9F2940430EC940F23445C003FD1DBF72E889C074A1523EB6764C40EA95E9BF2A802E4037985940C1A1A040E57EA0BC9A31924040EA0640B8570A40EF2D69C00F38953F973C0FBF6BD397BD5FFDF5BF8D87253F2B0610406672F1BDB33EFDBF832504416E1612C0225BEA3F50B9594013493BC049F7303D4B8314BF6E602040241C04C06BA400401C1590BEB0500440892C844043EDA83F68B1C5BF3D949740A8178640C0E29EBE7CBC71C06CE13F3EF6ED4B3F9B2B7DC0B452BD3FD9259B405B7D4340005C53BF8A7C29BE4E4EAA400CBF8C3E8C51F4C06A6566C06D609A3F30DBAA3F0AAAAE400A7DCCBF30CC13C039828C3DC1B22840EFE828BEE2919340B4D4964012F71BC0251655C04C5E1C408AD38940837FB340BB606940E9AE8140B685E6BF9FAC02BFDEC33D3D783084C0FF3C823F6DDD2D40B9649EC0BACDF13E3E2E1B40"> : tensor<5x2x2x7xf32>
    return %cst, %cst_0 : tensor<5x6x7xf32>, tensor<5x2x2x7xf32>
  }
  func.func private @expected() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x4F2AB04113BD8DBE82649F409DA610418899123E1E482BC01D1E864045D4A4C09DE662BE52E133C16C4B6F4023937241FAB910C1A24DB3C185EF5CC04CEEE43FA1CD27C01025D7C0C21603C0159641C13A12A2400D188E405E69B8BF13049B4034D0DFC000A233BF7DA97F3BDA125240381A7740651325C01AEDA3BEEA258ABCE625BEC01C22823FE83F2A400AFEA5BE5A7CD4C0433E01C08A2FBDBFB6971EC0F7BEA3BF9E66A03D1AB06DC1745BA5C092B60341DD27A3C0E73014C1725F80C092DD993F7BA0CD408825BCC071ACB740ED4617C00C8D77415053E03F98C1B4C0C8E656410176BDC0E3271CC077964A41FED5E0BEE0C197C12C5287BF207103BE23FA82419BD923403FB1E040BBEDE3C0B4C462C1E9C72D4096763540B27071408C4EC4402E5DB03F04CF8FC066357A40EB8A4940339DE7BF5D2080409A9CE1405A291F3E5B4D02C0EC3A9FC033A2974041FDA4C01F05D3404991014179E69740A697B3C019FDB4C15F170C40E58BD6C065C548BD7D9E07C0DC389FC10EACCD40ED585CBE8FA88EBE38046FBBA8F6FBC0FB561EBFB4EA1940D5460C411C55C4C02AB5E8BF3845FDBDF40E58C1C3A8563F9B264CC12BEED83D87A18A404811A0418D2F174022FCF6BF28E1C1BE3AF3C9BE3C5537C0728CCD3F00071EC0DB94CD3F4BD04FBF87E985BF0F2546C05FC7433F1DAE69C0E2AA19C0F268AAC0F6FF07C03A17CCBF7D3BA6406BA5A13C94925EBF38498341A3B1FF3F74A12A3E067787BD96C4D4BEB6C3D63F116126C06E8B8D4069F9C340294E8C40A926A6BF8C0B0441A3613FBF21BCBA3EF2CC0F40498BA5BF39EE61417C1AD5C0234F5040C3D9C73E72A41441DD76CBBFE95F1A4023767D40DCF10D4045EDCEC0C7551B3E261DB3406F10633EAEAB1A3F190D9FC0E529A2BF1B668FC0C936284095082BBD306A10C0DE93DB41A3F182C1298306BF3CC5A4C0CC3A05402479A6BF7B5198C0E4A784BCCE7298C0F42EC83E5E88634155931E41DF9B2C40B2192EC111078FC0661BD440E44F4840B64F9340FE2A20C07EB6563E294F0DC0B8283E3DBE5B2EC11C775E407FFB79C16EA56CC1BC2E0C3E28ABA43F036C783F15E36ABF6CCF0740028C083F66881BBEF75E1E404127743F29AB2040B6A20FC06600ED3F53E9CA400C191BC08F15993F6986CF40"> : tensor<5x6x7xf32>
    return %cst : tensor<5x6x7xf32>
  }
}
