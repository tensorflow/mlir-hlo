// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xf32>, tensor<3x5x2xf32>)
    %1 = call @expected() : () -> tensor<3x5x40xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<3x5x40xf32>, tensor<2x1xi64>, tensor<3x5x2xf32>) -> tensor<3x5x40xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xf32>, tensor<3x5x40xf32>) -> ()
    return %2 : tensor<3x5x40xf32>
  }
  func.func private @inputs() -> (tensor<3x5x40xf32> {mhlo.layout_mode = "default"}, tensor<3x5x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x9151E240EC08B93E71FF963F90BDB2C081C38E40F04881C0E32B8F3D1F25E4C07AAEA4402D7211401611F8BDC65751C0F25562BF46DDE63E54ED9A4003D08A407A62C7BE801A8ABF5F8C9EC079B124BF4DB9B13F5EC57EC0557106BE97C49CC07AE8CFBF734C6BBFD1798440E1B5BBBF35C41D3F6E80D33FC89D6BC00E1CAC40678B5840F5BF0EC0955A593F5D093A40427084C02F1ECEBF69578E40D33ADEC05104BB3F36FCB9C0D2B18FC0F9F38CC09A8082C0660E8BBF48660DC0C37C823FDD2A8340497FEA3FB287863E460084BF81CC30405C8826418879C3BFB1B3AAC04CB422BF4F4BC9BF6D95C43F42D0E33F8026843FBC6425C00801ED3FAB91EEBFC4318240543ADD408B383D3F6E65BD40E6A9A2BFE556A03E357323C0725583C0496A7FBF12E5423FFF99923F2BA25EC0550C2F3FB010E43EA4ABFF3FABB19CC00EA693402529524083D890405F06073F7272033EDBCF8140AD0D76C00AC89DC025E1ABBF447132400CF48540E17C2040A96D8A4006ECC8400107C5BF4B53B4C098EE3CBF5D9F47C072CE55C061CE76C0616DF3BE8DE7E2BF1C3746C0F9F214BF592013C0DE69673FFCB62CBF385719BF36BA49C09CA50A3F81415540759010BF63698040F1760DC02B8E16C0338B6F3F913EE2C04B38A3BFC2E9D83F99FE05C0848A6AC0234689BFC9E521C05E006440CCBE70BFDB3E5CC01FAEBD3E13AD79BE3DCDE93F83CA67404CD40E40C137BC40983C3EC044C18940939CA33EE75FA6C07BC14440763978C0F2195040900B8B3FC413E7BFE3C9C33FEC11503E07C390BE6D60FD3F3628DAC01D7B17C056B0DBBF1330B7BF789B4CBFBD499E3C4883CD40100DACC02EE65F40423DF5BE7E2B03C0E98E7DBEBD33EA40D7A990BFC03C63C0D3587340F1AE0F3FFA8483C01C123D40A60A56C00BE18BC095AC7A3F2D5BC73DB5EFDF3F66169F3FC72B0A3FEA72F240F3BD76C00A899BC02C1460C0C2D3ADBF70C914BF1D4B52BFFE890B3FB90B86C0E1FD3DC09A9ED83E09D887C0D8D12740E6F20DBF92EBECBF859216406B101F403DCB1740676DE23FA72882BF4B885DC01EA69DBFB17ACFBFDFF43EC01C3F8640C2A3BD40DF2838BEE8853B40E142473FB89B88C0DAFD75C06EA483BF8F64A93FA778F03F5111193ED5E1F73ED9601D3FCC13CF401907383F29C49840A48C0FC04364813FD514DD3FBDBEB6BE5ACAEF3FF074CF3FCB5CD0C0352A5E403F02BC3FFDAA7E40643E9CBF58972EC0DE539FC07D58E0BE1D5996C0B0F0AE40619BA03F3505D63F966EC040E62F10C00B1ED03F1ED0D23D144621C03D663540E4E78340CB95BA3EB7F389BF45B02D405FFE393F7A8C6E3F9C0B2AC0FFFFC2BF6A770E4012901840BDB4E7BF304E29408E88B33F178AA5C0EA2C0D4000A14F3FCF6F9BBFC8CF133FD6AD86C0C2A03E3E56289C4060CA0E40ECBD46C0224765404E9C0C40E3D4A1C0C323A5BF31CCB440C95B5640817127BFEA3C4BC074D8A5BFC078BE404A96A440F82907C0C94A174080DA21C0309B15BEC09D824028CD903F922979C0BA792AC07A2F33BE7ADF8C3FE63C634060141EBF6EBBC9C061F5A7408A5EC1BFFDB3C53F1DC6E7BE971AF53FE2D1EFBE824E58C0DE50433F8D362240D24DA53DF93696BF1C42254099D7C8C02EF9C740DEF7BFBFD694773F9C018EBE42ECB73E0DD07940B99543BFBF71D6BF98E7DD3FEA718ABF541294BFEB6866BE13A66C4007ACA4BE36BEDBBF970F7CC0C5BF483F3031BC3F51E4A83FDA09B4BFF3DD913EAA980540A0A2BB40102CCCBFF99294BE449A1BC0A546A9BF17F24CBDBFFD13C0C801C0BC59DE1B40949747C0270E823F53CEE13FA6F0953FCE23603F3F3C36403C2B14404162963F8970133F5D8A0B40741B8D4076855C405B6AA1BF44A431C0C5A769C070AD71BF1E92E93F7C3B0AC002BA02C1940630C08D18DD402DE7E23D709E3FBE688F3AC0480E7E408D0E11BF9AF097BFBC3C21C0545F68BFC7B9294024E82F4061291140FF23254023E8383E4DA78CC0A314883F09E1B3BFB6ED8140B6AD6CBDD261AF40BD8007BF02998EBFECB13B4099C8693F5C57D73FC8F14C405234B1400DF6C5BE44B611C0BE5FC8BFCD54FF4018F69B4090F8B83F226C54C0A83544C07B6F3CBFA5F94AC00E56C8BE8E69314090090440DD5CB23FFDE03D400F0DA74044181A402B32C4BE5DD0B7BCE86CE940D20DF0BEF8754A40165EBD4052979C3F8B8CDB3EE6CA85C065D191BF7AB0BE40FB976C407E4B8C40A767CFC07080F9BF6E4E6440E739D53F1301ECBF50B79F40FEA12E40B6C06FC080BC10C07B43D5BE05450540BE6C40C078AAC84059929A40008B53BF48BE3AC05B193740B85F79BF2291FE3F837E81404FCEBA3F94063FBF39E365C0FE93103F7AFE9F3FDDF505BFDFE9973F6BC901C02652D53EF5C5903FA9791C3FCA2485C029C7DE3E21E8B2BE71DF4D406DD49EBEC18A51C006324ABCD11BDEBF2BF12A3EA5D167C074C87CBFF3002C3FF0ADE0BF4E9223C09534F43F1FE517407E6D36C01AD659407D2C3740E9B48D3D0DF3BC3FFF9898C0BE7534C054E1B640B71E2B401C5724BF95AD64C003A89B3F064E5CBE401AAF3F6207F3BF3DC4B3C0A449F23F77B916C0DC13AEC0FAA8F2BF7F86573E4C114C3F3F2703C03149C73FA0ABD440B62492400859C2C0CC6B8F3F4AB9E0BFF7E547C05B04723FDB19263F37BE9BBF9DE9D5C09E2B6B3E963352C006EF6CBEDD8355C089E820C0C33248C06E21AAC049C502BF54BAF43FC1BA3A3FD23506408CF4B4C06AEC3F4095A7463F323C06C093FA923F37EE983F8424B4BED8D097BE53EB13C0B207D63D9BE505BF96212D40097A71BF2AD1803F05DA36C06DBCD73F087DC8406E5A653F911AED3E17C3EABFC228AC3F975B923F1966E64099D57340DC9D2E40A00670403A82BDBF0B526040CD10713E7E96EBBE3AADFF3FF2C8BB3F846BC5C0D75A4DC07F99DAC06B641A3F758F3CC0C4DD1C404EFABA3F72985640684193BF01E070BF72411B40FDBB7F40CCE874C0AD6B853F6F00053F3432854074339CBF4E35973EABA7323F3B6275BFA81DED3F1E3F68C0570D8DC0DA9845BF26C623C048684FC0E1981BC0D0A20740AF01B83FD4A010402318DDBFE4E53ABF3DFD9CC031FB604024C0A53F975C65C0351A0FC02C0A863F5DA549405CED5BBEC86E70C046461F40522C80400085383E3106AA401EBC9AC0E9F80941AA443AC073562FC0631F8AC08CA85EBDBAF4404084EA6C4068DA8ABE23BC48C098BC58C02FCBB2C0B70B1EBF615D22BEC6BE6EC0476081C031EE0F3FEF6D043F44CE47C0E5FF5C40A217A53F96A62F40DE532B4026E5DDBF1729D340D9C976C0785821C029D01D3D"> : tensor<3x5x40xf32>
    %cst_0 = stablehlo.constant dense<[[[-4.99789095, 2.33390641], [7.03577518, 3.57126427], [-1.77882564, 5.39374781], [-1.18690205, -2.88029718], [1.7030853, -1.25391018]], [[-4.2325592, 2.83463645], [-4.58797455, 3.29174757], [-2.58465862, -2.00781226], [-0.670561254, -3.9738059], [4.73114681, 0.461345702]], [[3.5491569, -2.64427924], [3.04316306, -1.20045412], [3.57643342, 3.3781786], [0.134554774, 1.36528969], [-6.15568924, -5.12605906]]]> : tensor<3x5x2xf32>
    return %cst, %cst_0 : tensor<3x5x40xf32>, tensor<3x5x2xf32>
  }
  func.func private @expected() -> (tensor<3x5x40xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x9151E240C0E586C071FF963F90BDB2C081C38E40F04881C0E32B8F3D1F25E4C07AAEA4402D7211401611F8BDC65751C0F25562BF46DDE63E54ED9A4003D08A407A62C7BE801A8ABF5F8C9EC079B124BF4DB9B13F5EC57EC0557106BE97C49CC07AE8CFBF734C6BBFD1798440E1B5BBBF35C41D3F6E80D33FC89D6BC00E1CAC40678B5840F5BF0EC0955A593F5D093A40427084C02F1ECEBF69578E40D33ADEC05104BB3F6D0912C3D2B18FC0F9F38CC09A8082C0660E8BBF48660DC0C37C823FDD2A8340497FEA3FB287863E460084BF81CC30405C8826418879C3BFB1B3AAC04CB422BF4F4BC9BF6D95C43F42D0E33F8026843FBC6425C00801ED3FAB91EEBFC4318240543ADD408B383D3F6E65BD40E6A9A2BFE556A03E357323C0725583C0496A7FBF12E5423FFF99923F2BA25EC0550C2F3FB010E43EA4ABFF3FABB19CC00EA69340A10CFCC183D890405F06073F7272033EDBCF8140AD0D76C00AC89DC025E1ABBF447132400CF48540E17C2040A96D8A4006ECC8400107C5BF4B53B4C098EE3CBF5D9F47C072CE55C061CE76C0616DF3BE8DE7E2BF1C3746C0F9F214BF592013C0DE69673FFCB62CBF385719BF36BA49C09CA50A3F81415540759010BF63698040F1760DC02B8E16C0338B6F3F913EE2C04B38A3BFC2E9D83F99FE05C0848A6AC0FEA46AC0C9E521C05E006440CCBE70BFDB3E5CC01FAEBD3E13AD79BE3DCDE93F83CA67404CD40E40C137BC40983C3EC044C18940939CA33EE75FA6C07BC14440763978C0F2195040900B8B3FC413E7BFE3C9C33FEC11503E07C390BE6D60FD3F3628DAC01D7B17C056B0DBBF1330B7BF789B4CBFBD499E3C4883CD40100DACC02EE65F40423DF5BE7E2B03C0E98E7DBEBD33EA40D7A990BFC03C63C0D3587340486B99BFFA8483C01C123D40A60A56C00BE18BC095AC7A3F2D5BC73DB5EFDF3F66169F3FC72B0A3FEA72F240F3BD76C00A899BC02C1460C0C2D3ADBF70C914BF1D4B52BFFE890B3FB90B86C0E1FD3DC09A9ED83E09D887C0D8D12740E6F20DBF92EBECBF859216406B101F403DCB1740676DE23FA72882BF4B885DC01EA69DBFB17ACFBFDFF43EC01C3F8640C2A3BD40DF2838BEE8853B40E142473FB89B88C09A7538426EA483BF8F64A93FA778F03F5111193ED5E1F73ED9601D3FCC13CF401907383F29C49840A48C0FC04364813FD514DD3FBDBEB6BE5ACAEF3FF074CF3FCB5CD0C0352A5E403F02BC3FFDAA7E40643E9CBF58972EC0DE539FC07D58E0BE1D5996C0B0F0AE40619BA03F3505D63F966EC040E62F10C00B1ED03F1ED0D23D144621C03D663540E4E78340CB95BA3EB7F389BF45B02D405FFE393F7A8C6E3FA2812042FFFFC2BF6A770E4012901840BDB4E7BF304E29408E88B33F178AA5C0EA2C0D4000A14F3FCF6F9BBFC8CF133FD6AD86C0C2A03E3E56289C4060CA0E40ECBD46C0224765404E9C0C40E3D4A1C0C323A5BF31CCB440C95B5640817127BFEA3C4BC074D8A5BFC078BE404A96A440F82907C0C94A174080DA21C0309B15BEC09D824028CD903F922979C0BA792AC07A2F33BE7ADF8C3FE63C634060141EBF82DC02C261F5A7408A5EC1BFFDB3C53F1DC6E7BE971AF53FE2D1EFBE824E58C0DE50433F8D362240D24DA53DF93696BF1C42254099D7C8C02EF9C740DEF7BFBFD694773F9C018EBE42ECB73E0DD07940B99543BFBF71D6BF98E7DD3FEA718ABF541294BFEB6866BE13A66C4007ACA4BE36BEDBBF970F7CC0C5BF483F3031BC3F51E4A83FDA09B4BFF3DD913EAA980540A0A2BB40102CCCBFF99294BE449A1BC07C8861C017F24CBDBFFD13C0C801C0BC59DE1B40949747C0270E823F53CEE13FA6F0953FCE23603F3F3C36403C2B14404162963F8970133F5D8A0B40741B8D4076855C405B6AA1BF44A431C0C5A769C070AD71BF1E92E93F7C3B0AC002BA02C1940630C08D18DD402DE7E23D709E3FBE688F3AC0480E7E408D0E11BF9AF097BFBC3C21C0545F68BFC7B9294024E82F4061291140FF23254023E8383E4DA78CC0DD82144009E1B3BFB6ED8140B6AD6CBDD261AF40BD8007BF02998EBFECB13B4099C8693F5C57D73FC8F14C405234B1400DF6C5BE44B611C0BE5FC8BFCD54FF4018F69B4090F8B83F226C54C0A83544C07B6F3CBFA5F94AC00E56C8BE8E69314090090440DD5CB23FFDE03D400F0DA74044181A402B32C4BE5DD0B7BCE86CE940D20DF0BEF8754A40165EBD4052979C3F8B8CDB3EE6CA85C065D191BF7AB0BE40C3C60AC27E4B8C40A767CFC07080F9BF6E4E6440E739D53F1301ECBF50B79F40FEA12E40B6C06FC080BC10C07B43D5BE05450540BE6C40C078AAC84059929A40008B53BF48BE3AC05B193740B85F79BF2291FE3F837E81404FCEBA3F94063FBF39E365C0FE93103F7AFE9F3FDDF505BFDFE9973F6BC901C02652D53EF5C5903FA9791C3FCA2485C029C7DE3E21E8B2BE71DF4D406DD49EBEC18A51C006324ABCC0D9CA402BF12A3EA5D167C074C87CBFF3002C3FF0ADE0BF4E9223C09534F43F1FE517407E6D36C01AD659407D2C3740E9B48D3D0DF3BC3FFF9898C0BE7534C054E1B640B71E2B401C5724BF95AD64C003A89B3F064E5CBE401AAF3F6207F3BF3DC4B3C0A449F23F77B916C0DC13AEC0FAA8F2BF7F86573E4C114C3F3F2703C03149C73FA0ABD440B62492400859C2C0CC6B8F3F4AB9E0BFF7E547C05B04723FBBD9FA4037BE9BBF9DE9D5C09E2B6B3E963352C006EF6CBEDD8355C089E820C0C33248C06E21AAC049C502BF54BAF43FC1BA3A3FD23506408CF4B4C06AEC3F4095A7463F323C06C093FA923F37EE983F8424B4BED8D097BE53EB13C0B207D63D9BE505BF96212D40097A71BF2AD1803F05DA36C06DBCD73F087DC8406E5A653F911AED3E17C3EABFC228AC3F975B923F1966E64099D57340DC9D2E40A006704077418BBE0B526040CD10713E7E96EBBE3AADFF3FF2C8BB3F846BC5C0D75A4DC07F99DAC06B641A3F758F3CC0C4DD1C404EFABA3F72985640684193BF01E070BF72411B40FDBB7F40CCE874C0AD6B853F6F00053F3432854074339CBF4E35973EABA7323F3B6275BFA81DED3F1E3F68C0570D8DC0DA9845BF26C623C048684FC0E1981BC0D0A20740AF01B83FD4A010402318DDBFE4E53ABF3DFD9CC031FB60404F712342975C65C0351A0FC02C0A863F5DA549405CED5BBEC86E70C046461F40522C80400085383E3106AA401EBC9AC0E9F80941AA443AC073562FC0631F8AC08CA85EBDBAF4404084EA6C4068DA8ABE23BC48C098BC58C02FCBB2C0B70B1EBF615D22BEC6BE6EC0476081C031EE0F3FEF6D043F44CE47C0E5FF5C40A217A53F96A62F40DE532B4026E5DDBF1729D340D9C976C0785821C029D01D3D"> : tensor<3x5x40xf32>
    return %cst : tensor<3x5x40xf32>
  }
}
