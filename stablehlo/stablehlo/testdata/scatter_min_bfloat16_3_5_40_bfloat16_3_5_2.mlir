// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xbf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %1 = call @expected() : () -> tensor<3x5x40xbf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %3 : tensor<bf16>
    }) : (tensor<3x5x40xbf16>, tensor<2x1xi64>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> ()
    return %2 : tensor<3x5x40xbf16>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16> {mhlo.layout_mode = "default"}, tensor<3x5x2xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE14095BF00C0DB3F10C0F13EC4BFE83CD7C0873F5A401CC00DBECBBE33BFAE400FC0AF3F59C049BFB23D83C01FBE33BF32C03640A0BF41BEA4409D3EEFC07F3F57C0C4BF89C0F93E07C09B3FA44071C053C040404BC096C0E03F90C096C0723FDDBF154059BE1CC0F1BF1140D9C0C8BF384072C0463F1040213F7BC0AA3F0D40C93E69407240FD3F05C089C0ED3F59BF0DC01040AD3F483F044077C0D13FA9402CC018BF0E40E63C9140BB3F05BF6DC02D3F06BE39407D4012BE43BE14C051C010BFD7BE0FC092C03A40B0BF4D40944096BCE6BFD83E0DC072402B3F7A407640C1C025C0464010C083C0C3BF9CC07BC022BF38405C4072C0F83F163F3740A440E8BEF2BFB43E03C0B7BE18BE5240BCBF1A4011C0374008C0133C02C02EC0A140E43F01BF0D4036BE89BF1F3E4E4025C0CB3F42407DC033C0A63DA640B83EF3BF4B4094C0823F933F2EC024403340774091C09EBFDABF76401E3E8F3FC5BF663F65C08340CFBF7BC06FC082C0A0C01CC0D8C0F93F15C0D9BFC53E25C094C088BF4FBEA5C03DBF8DBEF140984081C0EFC085BF024024408CC0953F9540563F5740BE3F3C3E9B4019C01C40F4BFA1408EC0634000C0623F73409E40D1BFABBEFF409DC0CEC052C0F9BF1C3E8BBFA53F8DBF9C3E86C083BFE9C093BFBC3EB43FB8BF99BFB2C0FABF074092BF1EC0643EA53EA7C09440D73F14401EC080C0AF3F4340A6BFD2400240D5BF78C067C0983FD93F854053401C407EBF61BE93402DBE03C034C0833DD73F9D40323F26409E3FEABFD03FAEBE16BE4D40223F42C0ACBFC2BEE0BF2BBF1A40DBBF45BE3C3C60C0213F2B408BC0EF3F8D3FBE3D60C00940D93FBD403FBE4EBFE2BF13C0F9BE38C0B3C08ABF0E4081C05AC041C025C0A6BF2C3F613BB3BF9840BBBF8440BA400BC0793F834013405AC09B40F3C0A0C09F3E85BF3AC03E3DD640C33F96C0A5BFBDC0E43EFE3FCABF4ABC9D40FDBF763EE63F57C0103EEA3FB6BF1D405840B83FA240384014C0AB4082403DC0CDBF23C0C2C09ABF38C048C041BEE13F5E40693E20C0903F24C0A8C0E13FAA3E27C019C097BF394038BFA2BFF23FB2BF81401BC0DCBF9A3E7940A7BFB8408FC0BB3F94BF824015BF454021409040DABF9BBF87408BBF9B4096BE3E3FC43F8F3FF53EBB3E84C09CC0BAC0B9BF524094C09A3E90C0674033402DC06D40A0BFD43E2D4033BC2240B2BF9C401A406540C2BF85408B3F723F12C01AC082BF123FFE3F92C08BBF63C002409D3F31BF21C0C53F6940E0BF0940D340E14074C02FC046BEEE3E1540273F4DC08A3FC7C08AC00C3FCC3E903F40407B402FC0564076404440FA3E7AC0373FA93F4C40AB3F27C0AB3E9040E5BF6DC0A8BF22401240CF3ECE400B4170407940B9C07840A23F0F3E9D3F1AC051C0083F9840B54020BFA3BF1CC094BF1CBE85BE0A40824042C09BBF363F0BBFA6BEB13F04BF11C0B040924089C084C0514016C0BE3FCFBF184026C0A53F2CC0F23F093EC3BF653F64C06ABFE7BF78C0B0408D3E37BF863FC23F25BF5F3E06C07EBF353EE6C0A13EBC400E40FDBFA9C0B3BF0E3F53BF43C01B408DBF5A400FC0E7BF4C3E993F463FABC0F3BF98BF1AC0D7C03F4081C04E408AC0ED3FB140B54093C09ABF64C08DC027C0814029C0C73F5BC007C08340F2BFE8BC1040C73F4B40A340274032C0"> : tensor<3x5x40xbf16>
    %cst_0 = stablehlo.constant dense<[[[4.718750e+00, -1.343750e+00], [3.875000e+00, 5.937500e+00], [-1.117190e+00, 1.328130e+00], [-1.523440e+00, 4.500000e+00], [-1.718750e+00, 6.031250e+00]], [[6.437500e+00, -4.750000e+00], [3.250000e+00, -2.859380e+00], [-1.093750e+00, -3.859380e+00], [-3.562500e+00, -7.382810e-01], [1.347660e-01, 1.250000e+00]], [[-2.656250e-01, -2.156250e+00], [3.562500e+00, -8.828120e-01], [-1.625000e+00, -2.953130e+00], [2.687500e+00, -1.257810e+00], [1.585940e+00, -2.937500e+00]]]> : tensor<3x5x2xbf16>
    return %cst, %cst_0 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> (tensor<3x5x40xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE140ACBF00C0DB3F10C0F13EC4BFE83CD7C0873F5A401CC00DBECBBE33BFAE400FC0AF3F59C049BFB23D83C01FBE33BF32C03640A0BF41BEA4409D3EEFC07F3F57C0C4BF89C0F93E07C09B3FA44071C053C040404BC096C0E03F90C096C0723FDDBF154059BE1CC0F1BF1140D9C0C8BF384072C0463F1040213F7BC0AA3F0D40C93E69407240FD3F05C089C0ED3F59BF0DC01040AD3F483F044077C0D13FA9402CC08FBF0E40E63C9140BB3F05BF6DC02D3F06BE39407D4012BE43BE14C051C010BFD7BE0FC092C03A40B0BF4D40944096BCE6BFD83E0DC072402B3F7A407640C1C025C0464010C083C0C3BF9CC07BC022BFC3BF5C4072C0F83F163F3740A440E8BEF2BFB43E03C0B7BE18BE5240BCBF1A4011C0374008C0133C02C02EC0A140E43F01BF0D4036BE89BF1F3E4E4025C0CB3F42407DC033C0A63DA640B83EF3BF4B4094C0823F933F2EC024403340774091C09EBFDABF76401E3E8F3FC5BF663F65C08340CFBF7BC06FC082C0A0C01CC0D8C0F93F15C0D9BFC53E25C094C088BF4FBEA5C03DBF8DBEF140984081C0EFC085BF98C024408CC0953F9540563F5740BE3F3C3E9B4019C01C40F4BFA1408EC0634000C0623F73409E40D1BFABBEFF409DC0CEC052C0F9BF1C3E8BBFA53F8DBF9C3E86C083BFE9C093BFBC3EB43FB8BF99BFB2C0FABF074092BF1EC0643EA53EA7C09440D73F14401EC080C0AF3F4340A6BFD2400240D5BF78C067C0983FD93F854053401C407EBF61BE93402DBE03C034C0833DD73F9D40323F26409E3FEABFD03F77C016BE4D40223F42C0ACBFC2BEE0BF2BBF1A40DBBF45BE3C3C60C0213F2B408BC0EF3F8D3FBE3D60C00940D93FBD403FBE4EBFE2BF13C0F9BE38C0B3C08ABF0E4081C05AC041C025C0A6BF2C3F613B64C09840BBBF8440BA400BC0793F834013405AC09B40F3C0A0C09F3E85BF3AC03E3DD640C33F96C0A5BFBDC0E43EFE3FCABF4ABC9D40FDBF763EE63F57C0103EEA3FB6BF1D405840B83FA240384014C00A3E82403DC0CDBF23C0C2C09ABF38C048C041BEE13F5E40693E20C0903F24C0A8C0E13FAA3E27C019C097BF394038BFA2BFF23FB2BF81401BC0DCBF9A3E7940A7BFB8408FC0BB3F94BF824015BF45400AC09040DABF9BBF87408BBF9B4096BE3E3FC43F8F3FF53EBB3E84C09CC0BAC0B9BF524094C09A3E90C0674033402DC06D40A0BFD43E2D4033BC2240B2BF9C401A406540C2BF85408B3F723F12C01AC082BF123FFE3F92C08BBF63C002409D3F31BF21C0C53F6940E0BF0940D340E14074C02FC046BEEE3E1540273F4DC08A3FC7C08AC00C3FCC3E903F40407B402FC0564076404440FA3E7AC0373FA93F4C403DC027C0AB3E9040E5BF6DC0A8BF22401240CF3ECE400B4170407940B9C07840A23F0F3E9D3F1AC051C0083F9840B54020BFA3BF1CC094BF1CBE85BE0A40824042C09BBF363F0BBFA6BEB13F04BF11C0A1BF924089C084C0514016C0BE3FCFBF184026C0A53F2CC0F23F093EC3BF653F64C06ABFE7BF78C0B0408D3E37BF863FC23F25BF5F3E06C07EBF353EE6C0A13EBC400E40FDBFA9C0B3BF0E3F53BF43C03CC08DBF5A400FC0E7BF4C3E993F463FABC0F3BF98BF1AC0D7C03F4081C04E408AC0ED3FB140B54093C09ABF64C08DC027C0814029C0C73F5BC007C08340F2BFE8BC1040C73F4B40A340274032C0"> : tensor<3x5x40xbf16>
    return %cst : tensor<3x5x40xbf16>
  }
}
