// RUN: stablehlo-opt --chlo-pre-serialization-pipeline -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s | stablehlo-translate --serialize --target=current | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xbf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0 = call @inputs() : () -> tensor<20x20xbf16>
    %1 = call @expected() : () -> tensor<20x20xbf16>
    %2 = chlo.digamma %0 : tensor<20x20xbf16> -> tensor<20x20xbf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<20x20xbf16>, tensor<20x20xbf16>) -> ()
    return %2 : tensor<20x20xbf16>
  }
  func.func private @inputs() -> (tensor<20x20xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x47BFA83EAEBE2540DAC012BF85BF39400F407740244087408DC09640703F06C017C0B23F0B4034400AC04DC03EC069C014C062C0BC40B9C05A40BFBF59C086BF34C0A3400F4092C03840283F96BF8DC0A94093BF5540B23F43BFBE3F0AC00C4015BE993F88BF8A3FBCBFD43FBEBFBDC08940BE3F823FB33F5CBFDCC000C0EC3FB2BFE9BEE3C0AE3EB840B1BE86BE43C009C0253F2740C7BFF33E0C409E3FB0C0AEC0D6BFBAC0F33F74BFD8BFD83F56C047C0BE3D7BC0BB3F103EB23F1C3F7C3F8A3E4B3FB5C0183F19C052BF4AC03AC0A7BE9FC03EC0B8C075C0293FC33F1A407340EA3F8ABF034010C09EC042BFE7C0F2BF683F1BC0003F803FBCC090C0BA3C443F8D4059408E3FB0BFDC4066C044C019404BC0F43FD43E5AC01B4051407A408BBF0BC0E0C041C094403340003F883FBE3F5D3EEDBEF13F6DC0B9BE51BFE4BEEA3F203E9440904002BEA8C09F40FA3C193E0640DFBFE53FA84052407A3FD5BFD6C0DFBE61C04D3D2B3FA3BFC63FCD3E05C0F6BF67BFB13D53C039C06D3F713F90BF0E40C93F61405EBF0A404D403BC090BFE0BF3E400D40353F08C0B33FC14007BE86BF18BFBDC020C03CBF0240CDBFA4C0F4BEDC40A73E6CC09FC00F4012406FBD4D401840453F61BF4CBF35BF42BF45400740DCC0C63F75BF83BD0740A13F723F70C00B408A3FF3BE96BFAA3F85C02FBE70BFBEBF81BEB4C0F4403BC0FABED93E72BE3EBF6FBF83403E40B54033409BBFACBDAD3F8E3F37BE1DC0AD4009C07CBFC03FBE3EBDC0BE3FF63D7AC0E63F14408140AF3F02C0E3C023C0E73FA4BE4B3E97BF8CBE6440B2BFC1BE41C00DC0B1C0EC3EEABF4E3E4840AA40703F89C046C04CBF00C03BC00BC019C01141A6BE03C002BF8A3F83406B40E7BF97C0233FF93FBD3F9B4007C0A5BE3E40E23F6BBFFBBF25C0B0BF08BCAFBF6BBD5D3F2DC0E5C0833F7140EF3F0940B3C00EC057C00E3D03C0F23F18C0D23F184087C08CBF2D40AB3F603DB5BF83C0A3C0A0BEFDC0FD3F7BBF5EC078BF1E40E13F43C02CC040C0A1C035BF45BE60C0EE3FB5BFCF3F77406FBEA63F2DC069C0953E3A40B83FA7BFD7BEC73F47C0B5C06F3E883F07C00FBF1AC0A1BFA040054066C0374013C0"> : tensor<20x20xbf16>
    return %cst : tensor<20x20xbf16>
  }
  func.func private @expected() -> (tensor<20x20xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x5EC04CC0CD3F3E3F2EC01BBFCF41613F103F9C3F3C3FA83F2340B83F2FBF3541234091BD073F593FDC40B240F5C180BD49408B3FD73FFFBF893F473F1F40AD4160C0C33F103F803F5F3FADBFB9402340C93FD840863F91BD48C0B23CDC40093FC14097BE8241E9BE7F3F313E5A3F08C1AB3FB23C0DBF81BDCAC0B3C0C07FA23EE33FE13E464144C0D43FC53F2D40B441F440B2BF413F3D3E06C0093F7CBEE53F1A408DBF37C0B63EA6C1A7BF4B3E4240214133C131C130BAEFC091BDC1BF1ABF7BC07BBF0F3EC8BF0C4095C0E64012C1E23FF2C1F5C1A7BF72C0ABBF6E3D283F993F9C3E5041E83E854062C143C0BC40FDC03EBFEF3FFBBF14BFB7C0CE3F32C286BFAF3F883FD2BEF83FED3FEB3E8941263FD140B93E1EC014402A3F833F9D3F3D41C740C07F8242B63F573FFBBFF5BEB23C9DC0BD3EB03E64BFAE3F91C0073F9C3ED8C0B63FB23FE2409D40C03F05C2E2C0F73E0BC08E3EC83F843F1EBF80BF01BE1F3F9F3FA4C1A8BF5340A33D24C058413AC119C140C16B40F2C035BF2EBF01410E3FCD3D8E3FD8C0053F803F35C1014115C0693F0C3F9ABF094181BDDB3FD940AD4155BF08C18D3F27C0E33E92BE15417C3EED3F4DC02ABFF2C1103F173F8441803F243F85BFF0C07DC00BC043C0743FFB3EB3C0A33DB6C16F41FB3E5FBE2CBFD9BF073FE9BE873EB9400DBEED409E4077C15A3F3840033FFB3F35C1113E19C04C4030C067C1A43F693FD23F573F92403341E6BDD2BE9640C73FCC3FF4407EC2153D32C008C1B23C0CC10EC1913E1B3FA23FC4BD03424641273F943EEC3FABC0B0402140903FE33F993F8242A840BF3F0BC08CC0A8C0793FC93F2FBF85403A417DC0C07F35C1C7400C400940E63FB14109BDE9BEA43F943F68C06DBFB5BFC63E6B3CBC3F1C41E93F693F853E39C1C5C1AF3EF83FF0420240864154BF95BFFD400ABF983FAB3E023F5B3F9B403640EBC1B141B33E1740243E243FAC402D414C3F04BE96C1C43F3E414141F93F04C1D13E4BC2D83FFCC1303F823EB44170BFC07F06420BC08840B23FA83EC43F103E9C3F4F4031BE95BF80BD67C0633FC1BC3440443FB13D21410F3E91C0F5BE1C41FDBE02406440C13FF23EEB3E5E3F5740"> : tensor<20x20xbf16>
    return %cst : tensor<20x20xbf16>
  }
}
