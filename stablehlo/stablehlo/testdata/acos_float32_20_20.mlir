// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0 = call @inputs() : () -> tensor<20x20xf32>
    %1 = call @expected() : () -> tensor<20x20xf32>
    %cst = stablehlo.constant dense<-1.000000e+00> : tensor<f32>
    %2 = stablehlo.broadcast_in_dim %cst, dims = [] : (tensor<f32>) -> tensor<20x20xf32>
    %3 = stablehlo.compare  NE, %0, %2,  FLOAT : (tensor<20x20xf32>, tensor<20x20xf32>) -> tensor<20x20xi1>
    %4 = stablehlo.multiply %0, %0 : tensor<20x20xf32>
    %cst_0 = stablehlo.constant dense<1.000000e+00> : tensor<f32>
    %5 = stablehlo.broadcast_in_dim %cst_0, dims = [] : (tensor<f32>) -> tensor<20x20xf32>
    %6 = stablehlo.subtract %5, %4 : tensor<20x20xf32>
    %7 = stablehlo.sqrt %6 : tensor<20x20xf32>
    %cst_1 = stablehlo.constant dense<1.000000e+00> : tensor<f32>
    %8 = stablehlo.broadcast_in_dim %cst_1, dims = [] : (tensor<f32>) -> tensor<20x20xf32>
    %9 = stablehlo.add %8, %0 : tensor<20x20xf32>
    %10 = stablehlo.atan2 %7, %9 : tensor<20x20xf32>
    %cst_2 = stablehlo.constant dense<2.000000e+00> : tensor<f32>
    %11 = stablehlo.broadcast_in_dim %cst_2, dims = [] : (tensor<f32>) -> tensor<20x20xf32>
    %12 = stablehlo.multiply %11, %10 : tensor<20x20xf32>
    %cst_3 = stablehlo.constant dense<3.14159274> : tensor<f32>
    %13 = stablehlo.broadcast_in_dim %cst_3, dims = [] : (tensor<f32>) -> tensor<20x20xf32>
    %14 = stablehlo.select %3, %12, %13 : tensor<20x20xi1>, tensor<20x20xf32>
    stablehlo.custom_call @check.expect_almost_eq(%14, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %14 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8A98C4BFE1AF1B3FD44B99BFAFE54ABF5C34C7C01D86173F79B3C6C0EB0C15C024A543C064CB2340E84D1B41114084BF6A08253F0366FB3F0C31D0BFFAF7E44034A2193F9BDE41409F47F6C082CB8F40453B443F1D42CCC01922A4BF3495104062081CC0D3A421C00D446D4036FFA7BF02639740C700B9BF33E711C004E9E83FA4D08640D5B23340F74831C03F9FDA40D7465F40AC900A3E59AEC64019F54D3F03DB80C017C0B44091B993C0C398EC4091F90C40F3D2813FE4A95E40A591E6BEFBDD7940ADD7A940A46F96BFFBBCA8404E4F983F3572B23F97AAA1BF4931B3BF51F20B40E9F92DC0DD38DA3F2A7FE1BF9E0312BFED9D59C0D7F68DBF9AAB01C0694631BF116DF83FF3C765BF9BD152C0E49636BF3CB6A13F1D20BBBF8EEB6640762E18400C937F3F79AF0A3D4073C73FE624E73FF4BA7DBF2504BBBFD99EA53F9657143F21CAC6409CAB3C40726242C01230053F189D8EC075F8433E3DD282C045A6833F9E3DCC3FB3634B40BD79D6BF01C4F83F05412D3E4F0831C071873AC089FF623FE07A2ABFF647BF40A5185740C98DB0C0B8290940DD4D2B4091A7A3BFD3F6F3BFB8ABA43E052C3DC0DCA1D23F50707DC034BD733E331CAF3F946403BFF37502BF2B04C63F15FAD8BF64841C3D3F83CE3F9419414032D292C0F215E2BF7CAA00C0DC3E4940414B4ABF58B82E40EF2E94C0D738963F1B442840CB6B0AC0FBA69FBF36A9C140923488BEE671C1BF58530E40432E06403BCA61405363593F8BEEC8BE361926BFE31B333F7EFC923F0033F53F2AA889C01D9653C0B8CFE63F0ADEA9BF648A2A3FB5AC4E3EAFF22D40AC3169C0926A7E3D38D4683FFF0238C0D709FCBE4840F2BF4DDDE53DBCFD70C072B5104057F1EA3FFE49BD3EC51CBCBF33CEA94062FD563FD3B487BF88567FC01A497040251A8ABF3738A14079EAA8401882833F622C2540DDD66F3F7D334CC082753F3DAF71D93EF4DF2540DEBF42C0416AD040A51E95C04636BFBF1B1D1CBF6609754096F8A1C0929473BFFA1AA7BDE5E9EFC04B6B3640D9C121C0DF7F20C01F99E9401CB08DC08C77ADBFDEF44A40AFE3E93E015499407D2D4740CFE2813E5C4489BF3D7112C05BC9B14024B75C3D64ACBC3EBCBE083DB4CB9AC00D2037C074E2A7C0AD04C6C0B07413C0FB9DC7BD332E9E4026398FBF7B454B401ECCF6BFF5C05040E8C443C0C4934B3FA20D4EBFDE7349C09B86FABFF24D12C0A404FA3E629687406B9D4EC07599B7C0FF117CC0335372BFF32579C0DA16A2C0D5CBC33FA9F1083E2AAA5340580AB8BF51891EC05D200D3FCC7227C0C4284AC0FBA28EBE30CA9A3FA2D25B3E18393940D07AC7C0E00906C03673CAC0E0238E40B89514C05338BE3E5CD4AF3F6F74AFBFEC80F33F4E23ED3E28C736C0B2FE2BC03C39184012261F3F426D22405D172E40052741C0EB6AA74038DC35C0C192AE402DDC66BF6EB7123F813199400114F43F4098C73FBDDAEEC007D2E4409A9784C0B4C023BFDCA2BAC08D3FE7BF3DB9E03FE405FD409533A0402489C2BEF15FBAC063A7053E73379C3FFFF78BC03703FBBFEADCA5BF097B564065F199405EB8F8C0982EB0BEAC8152BFB354DEBF296818BFFB68703FAF3E7EC06FB8CCBF5A6052C05AA8CB4054519EBF597793404EEFB73F5F5BAE3F5239C5BF4FEFBE3F310BA8BF84E14BC0F0FB66C008DD1A3F1BEE3C4087E7BBBF168B8AC0039C1140B4BD8540DC60A4BE6920A24054F7EDC0C43EAB3DF6880440A902AAC0044E064029AE4EC01E9A2C3F569672C0F68CA8BFA80C7FC0F1CB3E40B653B6BF40A600407BF83AC02922D6400D0A4CC0A2E1D23D340C863FA8D237BFFCA81E40F5C08D4085D8EC3F9B14043F091BBA3F11FB38BF458B863FE5E10AC0840155C0D9A8C74038ED78BFA63C96BFBF1CABC0E09B0EBF5B7714C0476CFD3F883926BF1F82093FDF167E3DCB06DEC0DD25A23F972751404614B33F0D32A5BFA1E94DBF4A7D84BCC8B82AC06396D23F7444C8BF71122C40AB7ABB40415B73C009826840EF5F31BE9A0D3F40131EC1BFA33F8340696CBC402D963940B2F8BEBF01C219C162F734C0C9821A40DA2C72BF91A608BF116E51407BA7ACBFDF0ED53F1C525F3FE089A13F9D466A401BA837C002AEE1BF087970C04800DA3F3B4320414BEB6EBF833B29C02178403FACA68C3F42942F40EAA066C078B9BFBF788BB2BF07C00240D579283F0E624DBF4815363F1D20E03D380308C03389983F606071BF"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x0000C0FFCAC46A3F0000C0FF69171F400000C0FF17F96F3F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFA2C65E3F0000C0FF0000C0FF0000C0FF77586D3F0000C0FF0000C0FF0000C0FF4B87323F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF20B0B73F0000C0FF27CC223F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF766D02400000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF40600B400000C0FF0000C0FF0000C0FF687C15400000C0FFDED72B400000C0FF9F5A17400000C0FF0000C0FF0000C0FF0000C0FF17386C3D28BAC43F0000C0FF0000C0FF838840400000C0FF0000C0FF05E6733F0000C0FF0000C0FF0000C0FF7C06833F0000C0FFDF69B03F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFEE4CB33F0000C0FF0000C0FFEB12F63EC32B13400000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF37269F3F0000C0FF0000C0FF0000C0FF9C4CAA3F0000C0FF6F06074003C106400000C0FF0000C0FF6A2BC43F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF42D81E400000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF3C87EB3F0000C0FF0000C0FF0000C0FF0000C0FF006F0E3FCEAEFC3F9DB71140E5BF4B3F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF917B573F850CAF3F0000C0FF0000C0FF361BC13F7784DB3E0000C0FF907805400000C0FF42AABA3F0000C0FF0000C0FF0000C0FFE296983F0000C0FF0000C0FF72E9123F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFA0E5B63E0000C0FFA013C33FF9EA903F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF15810E400000C0FF0000C0FF7A0B35408484D33F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF54568C3F0000C0FF0000C0FF4E3BA83F0000C0FF0000C0FF0000C0FF4729C23F47C1983FB1C9C43F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFCE8ED53F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF7AC3263F266720400000C0FF0000C0FF0000C0FFF1C2873F0000C0FF0000C0FF0000C0FF0000C0FF7D0C34400000C0FF0000C0FF0000C0FF7AE4B73F0000C0FF0000C0FF0000C0FFC8A57C3F0000C0FF0000C0FF0233ED3F0000C0FF585EAD3F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFBC56983F0000C0FF0000C0FF0000C0FF2E6C8B3F0000C0FF0000C0FF0000C0FFFC60663F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF12762C403DE3753F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF52F310400000C0FF0000C0FF0000C0FF0000C0FF0000C0FF05F3FA3F0000C0FFB14EB83F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFCA06F63F755122400000C0FFCE570D409D9AB33E0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFFDCD6B3F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFBBE5F23F0000C0FF0000C0FFBB58BE3F0000C0FF0000C0FF0000C0FF0000C0FF81B4543F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFC3DBBB3F0000C0FFA5CB17400000C0FF0000C0FF0000C0FF31AC833F0000C0FF7A3618400000C0FF0000C0FF0000C0FF0000C0FF73FB39400000C0FF0000C0FF64580A400000C0FF0000C0FF3CC21140EE7A803FD51DC13F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFFE572040D621CB3F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF9F58DF3F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFD6EE3340669108400000C0FF0000C0FF0000C0FFBCC4023F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFFC8C31400000C0FF364F383F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FFE83C5A3F141F2040948D473FA606BB3F0000C0FF0000C0FF4C533340"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
