// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x30xi16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0 = call @inputs() : () -> tensor<20x30xi16>
    %1 = call @expected() : () -> tensor<20x30xi16>
    %2 = call @integer_pow(%0) : (tensor<20x30xi16>) -> tensor<20x30xi16>
    stablehlo.custom_call @check.expect_eq(%2, %1) {has_side_effect = true} : (tensor<20x30xi16>, tensor<20x30xi16>) -> ()
    return %2 : tensor<20x30xi16>
  }
  func.func private @inputs() -> (tensor<20x30xi16> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x01000000060000000100030000000400FEFF0000060000000000010000000000FEFFFEFF00000100FFFFFEFF0100020000000000000002000300FAFF01000000FDFFFBFF0100010000000600010004000000030003000500FEFF00000500FFFF0000FCFFF9FF04000900000001000000FDFF0000FFFF0100030002000100FCFF02000200FFFF0200FBFFFFFF0300FDFFFEFFFEFF0400FEFF01000100FFFF0300010000000000FCFF010000000000FEFF0000FDFF0000FDFF0000FEFF00000100FFFFFEFFFCFF030004000000FBFF00000200FCFF0500FFFF0200FDFF020005000000070000000300020000000100FEFF0100FBFFFFFFFEFF0000FFFF0300FFFFFFFFFBFF0000000000000400010001000000FEFF00000000FFFFFAFFFCFF000001000200000004000000000000000000000007000000000004000000F8FF000000000200FDFFFCFF0400FCFFFFFFFEFF0000FFFF0400FFFF0300000000000000010001000300FEFFFEFF02000000000000000000000001000300020000000100FEFF0400FEFF010004000100FDFF0000FEFFFFFF0100000000000100010004000300FEFF0000FDFFFCFF0100FDFFFFFFFAFFFCFF0200000000000000FDFF0000FEFFFDFFF6FF04000200FEFFFDFF000003000000FDFFFCFF01000300FCFF02000600000000000000000000000100FFFFFFFF01000000000000000100FFFF0200FFFFFBFFF8FFFEFF0100FFFF00000000FFFFFDFFF9FF0000040001000000FFFFFFFFFFFFFEFF0100FEFF000002000000000000000000FDFFFFFF0600FEFFFFFFFFFF0300040004000500FBFFFFFF0000FEFF0200FFFF000003000100FCFFFDFF0000000002000300FCFF0100FFFF08000000FDFFFFFF0000030001000100FBFF0500FCFF00000100FEFFFFFFFEFFFEFF0300060000000A00000004000000FEFF01000100010000000000FEFF0300FDFF03000200000000000000040008000100FEFF00000300FDFF01000300FDFF00000200000000000300FFFFFAFF000001000000FFFF0000FEFF00000000030000000200FCFFFFFF01000300FBFF00000000FEFFFFFF03000000000001000200010000000000FDFFFFFF040000000200FFFF0200FEFF010005000000000003000400FDFF00000300000000000000FDFF040000000100020000000100FFFFFEFF00000200010002000000FAFFFFFF0200FFFFFBFF03000200FBFF00000700FBFFFDFFFDFF01000500FEFF0000FBFF00000300020003000000FFFFFFFFFFFF0200FFFFFDFF0100FEFF0000FDFF0000FEFFFFFF030002000000FAFF03000200000002000100FEFFFFFFFEFF0000FBFF0100020002000100FDFF010006000300000003000000FFFFFBFF0000FDFF0000FDFF030004000000FFFF0000FEFF05000000000000000000010004000300020002000300FFFF0200010000000600000004000200FCFF02000200030000000000FFFFFDFFFBFF040001000100000003000200020000000000FAFFFFFF00000100FCFF0000F8FF010002000000FBFF05000100FCFF0300FEFF00000100000002000300FFFF04000000FFFF0200FDFFFCFF000000000600FFFFFFFF0600030002000100FDFFFFFF0000FDFF000002000300FFFF0000FBFF0100010003000100060000000200FCFF0100FEFFFCFF0400000000000100"> : tensor<20x30xi16>
    return %c : tensor<20x30xi16>
  }
  func.func private @expected() -> (tensor<20x30xi16> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x0100000010050000010051000000000110000000100500000000010000000000100010000000010001001000010010000000000000001000510010050100000051007102010001000000100501000001000051005100710210000000710201000000000161090001A1190000010000005100000001000100510010000100000110001000010010007102010051005100100010000001100001000100010051000100000000000001010000000000100000005100000051000000100000000100010010000001510000010000710200001000000171020100100051001000710200006109000051001000000001001000010071020100100000000100510001000100710200000000000000010100010000001000000000000100100500010000010010000000000100000000000000000000610900000000000100000010000000001000510000010001000101001000000001000001010051000000000000000100010051001000100010000000000000000000000001005100100000000100100000011000010000010100510000001000010001000000000001000100000151001000000051000001010051000100100500011000000000000000510000001000510010270001100010005100000051000000510000010100510000011000100500000000000000000000010001000100010000000000000001000100100001007102001010000100010000000000010051006109000000010100000001000100010010000100100000001000000000000000000051000100100510000100010051000001000171027102010000001000100001000000510001000001510000000000100051000001010001000010000051000100000051000100010071027102000100000100100001001000100051001005000010270000000100001000010001000100000000001000510051005100100000000000000000010010010010000000510051000100510051000000100000000000510001001005000001000000010000001000000000005100000010000001010001005100710200000000100001005100000000000100100001000000000051000100000100001000010010001000010071020000000051000001510000005100000000000000510000010000010010000000010001001000000010000100100000001005010010000100710251001000710200006109710251005100010071021000000071020000510010005100000001000100010010000100510001001000000051000000100001005100100000001005510010000000100001001000010010000000710201001000100001005100010010055100000051000000010071020000510000005100510000010000010000001000710200000000000000000100000151001000100051000100100001000000100500000001100000011000100051000000000001005100710200010100010000005100100010000000000010050100000001000001000000100100100000007102710201000001510010000000010000001000510001000001000001001000510000010000000010050100010010055100100001005100010000005100000010005100010000007102010001005100010010050000100000010100100000010001000000000100"> : tensor<20x30xi16>
    return %c : tensor<20x30xi16>
  }
  func.func private @integer_pow(%arg0: tensor<20x30xi16>) -> tensor<20x30xi16> {
    %0 = stablehlo.multiply %arg0, %arg0 : tensor<20x30xi16>
    %1 = stablehlo.multiply %0, %0 : tensor<20x30xi16>
    return %1 : tensor<20x30xi16>
  }
}
