// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xbf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xbf16>, tensor<3x5x2xbf16>)
    %1 = call @expected() : () -> tensor<3x5x40xbf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<bf16>, %arg1: tensor<bf16>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<bf16>
      stablehlo.return %3 : tensor<bf16>
    }) : (tensor<3x5x40xbf16>, tensor<2x1xi64>, tensor<3x5x2xbf16>) -> tensor<3x5x40xbf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xbf16>, tensor<3x5x40xbf16>) -> ()
    return %2 : tensor<3x5x40xbf16>
  }
  func.func private @inputs() -> (tensor<3x5x40xbf16> {mhlo.layout_mode = "default"}, tensor<3x5x2xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x64BFB9BFC640C63F1E40334019BEBDC06FBE02C04BBFAEBF7DC00CC081C05ABF5CC0B2BF1040313F823F83BEEABFA4C09B3F8D3F93BFC9C0213F6F40C3BF964013C0AFBF723EA93F64BFD1BCC03FEB3F9BBFE8BE0140E4BFC5BE16C020400DC03140F23F19BEB03E5BC09C40C63F39C0173F4AC06EBD55C04ABF2DC05840A8C0D83FFB3F0DC0AFBF69402FC0CF40AFBEBB3F0A407F408F40D4BF8F3EFD3F81402ABFDDBF80C04440433FAD403AC02B406BC0A8C0F5406EC012408840674086BFA4BFE5BF40C03240A1BF34C046C0573F55402740373C79BF0AC04040BCC061C008C088C04A3E03BF94C0CCBF773F9C3F5DC039BE86BF7E3F82BFBB408D3FC23FE23F5DC060C0BDBFD940573F344096BF34C094BFAC4056C0FF3E84C03DC0B83E09393DC00940A3BF553F0940A33F6BC0BC3FD33F01BD3A40D3BF4C3F98406DC0A33C90BF80C08F4050407EC0B8C002C02F40A4BFBA40D93E3AC0BAC03C3FFEBFB4C04ABEB940F0BF9C40CCBF81BD873F0340A33F5A3F7BC025BF63C00C404C40E43F933F08BFB9BFE8BF90C0EABF003FB6C008C0483F3740AC3FF6BE02C081C03C400840F8BFA6BF84BF8B3EACBE3B4021BFCBBED640ACC0533FABC0CABFF2C01FC038405840B8BF5A4081C08D3F78C0074008C014C037C076BE7F403DC09A40C83FA6407B408F40BF3F6C400240503F48BF58409B3F893FDE3DA3C0753F86BD164040C08840A7BEB740834006C0FEBF8340E2BE6F3F1E407B40B13F5BC04B40EABF8ABDEFBF84C0D53F27BF9C3F8A3F0341B5BF9A4054BE99400B3F783EFC3FCB3F80BFA04089C076C01ABEFEBF2E40673F43C0F03D87BF1B4075BF6A3F34C0F7BF9E3F7840D43FCA4044C0F9BF24BF1FC016C182408A40D240E53FAB3E6840FBBF9F40DDBF0D3FF9BF34C0A240A93E95BE514063407840E2BF7DBF88BFDD3EB63F4D40B2BF03418DC04F3FA54065400EC054C01540F73FA7C073C0D7BF9C40384002BF8040E7400C4071C06840AF3F1F3FCFBE17C02840FDBC42BF9C3F5540B0BDD03F7CC00CC043C003C0D5BEDFBE81407CBFCD3DBBBF33BFECBE7B3F66C0B33E9F40F63E28BFD33F43BFA2BF0DC001410F3FA93F9FBFA340AA3F9BBF57C05F40954039C01240B2C0F2BF46C085C021C05BC00F410DC025C030C00BC066C0BDBF8040F33F104093C03B4062BE29403EBF313F0C3E97BF573F4B40023D93BF33BF98C057C0BE3E6CBF73BF583E223F28409E407B402DBFE6BFB93EC8409C3FF1BF30C02CBF33400BBF7FBF4540834036BF0EC08ABF8BC073BFA63F3C40D03E92C08B40134081BE0140B73F2E405F4006401840A3BE94BF03BF873FD8BDDCBE86C0D8C0C4C032C015BF5640CBBF6FC088C04E4041BFF23FF1C025BF903FE7BE5DC0484020BE953FF73E0BC0CF3FA6BF30C0C9BE4B3D3EBDC5BF853F7840F6BF873E36404C3FBC3F49BF49C043C0E13F893F064060BF503F3EC0F13F9FBF53C017C01EC0C3BF15405D401C40D3BFDE3FD33F92BFFE40663E1B4026401C404DC0443F1FC053C09A3FC13E49BFBBC08C40864009C04AC0844010407B404040A94077C05D4061BF6140C9C04A3F55BF52BF22404C407040B43E8B40124011BE83C0CE3D04410FC058409DBFF7BF82BF7840A9BF99C0E13F3AC03AC09EC092C0FFBFF63FCF3FCA3F1AC0AFC0AA40164153C0"> : tensor<3x5x40xbf16>
    %cst_0 = stablehlo.constant dense<[[[-3.546880e+00, -2.171880e+00], [-2.734380e+00, -1.046880e+00], [7.250000e+00, -7.656250e+00], [-1.281250e+00, 2.937500e+00], [3.546880e+00, 2.390630e+00]], [[-1.851560e+00, 8.085930e-01], [1.765630e+00, -5.718750e+00], [-2.281250e+00, 3.250000e+00], [-1.312500e+00, 1.500000e+00], [-2.890630e+00, 3.554690e-01]], [[-1.843750e+00, -3.390630e+00], [-7.148430e-01, -4.687500e-01], [2.593750e+00, 4.812500e+00], [1.347660e-01, 2.093750e+00], [2.640630e+00, 6.757810e-01]]]> : tensor<3x5x2xbf16>
    return %cst, %cst_0 : tensor<3x5x40xbf16>, tensor<3x5x2xbf16>
  }
  func.func private @expected() -> (tensor<3x5x40xbf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x64BFB9BFC640C63F1E40334019BEBDC06FBE02C04BBFAEBF7DC00CC081C05ABF5CC0B2BF1040313F823F83BEEABFA4C09B3F8D3F93BFC9C0213F6F40C3BF964013C0AFBF723EA93F64BFD1BCC03FEB3F9BBFE8BE0140E4BFC5BE16C020400DC03140F23F19BEB03E5BC09C40C63F39C0173F4AC06EBD55C04ABF2DC05840A8C0D83FFB3F0DC0AFBF69402FC0CF40AFBEBB3F0A407F408F40D4BF8F3EFD3F81402ABFE84080C04440433FAD403AC02B406BC0A8C0F5406EC012408840674086BFA4BFE5BF40C03240A1BF34C046C0573F55402740373C79BF0AC04040BCC061C008C088C04A3E03BF94C0CCBF773F9C3F5DC03C4086BF7E3F82BFBB408D3FC23FE23F5DC060C0BDBFD940573F344096BF34C094BFAC4056C0FF3E84C03DC0B83E09393DC00940A3BF553F0940A33F6BC0BC3FD33F01BD3A40D3BF4C3F98406DC0A33C634080C08F4050407EC0B8C002C02F40A4BFBA40D93E3AC0BAC03C3FFEBFB4C04ABEB940F0BF9C40CCBF81BD873F0340A33F5A3F7BC025BF63C00C404C40E43F933F08BFB9BFE8BF90C0EABF003FB6C04F3F483F3740AC3FF6BE02C081C03C400840F8BFA6BF84BF8B3EACBE3B4021BFCBBED640ACC0533FABC0CABFF2C01FC038405840B8BF5A4081C08D3F78C0074008C014C037C076BE7F403DC09A40C83FA6407B408F40BF3F6C400240503F48BF58409B3F893FDE3DA3C0753F86BD164040C08840A7BEB740834006C0FEBF8340E2BE6F3F1E407B40B13F5BC04B40EABF8ABDEFBF84C0D53F27BF9C3F8A3F034150409A4054BE99400B3F783EFC3FCB3F80BFA04089C076C01ABEFEBF2E40673F43C0F03D87BF1B4075BF6A3F34C0F7BF9E3F7840D43FCA4044C0F9BF24BF1FC016C182408A40D240E53FAB3E6840FBBF9F40DDBF0D3FF9BF34C0A240A93E95BE514063407840E2BF7DBF88BFDD3EB63F4D40B2BF03418DC04F3FA54065400EC054C01540F73FA7C073C0D7BF9C40384002BF8040E7400C4071C06840AF3F1F3FB63E17C02840FDBC42BF9C3F5540B0BDD03F7CC00CC043C003C0D5BEDFBE81407CBFCD3DBBBF33BFECBE7B3F66C0B33E9F40F63E28BFD33F43BFA2BF0DC001410F3FA93F9FBFA340AA3F9BBF57C05F40954039C01240B2C0F2BF46C085C021C05BC00F410DC025C030C00BC066C0BDBF8040F33F104093C03B4062BE29403EBF313F0C3E97BF573F4B40023D93BF33BF98C057C0BE3E6CBF73BF583E223F28409E407B402DBFE6BFB93EC8409C3FF1BF30C02CBF33400BBF7FBF4540834036BF0EC08ABF8BC073BFA63F3C40D03E92C08B40134081BE0140B73F2E405F4006401840A3BE94BF03BF873FD8BDDCBE86C09A40C4C032C015BF5640CBBF6FC088C04E4041BFF23FF1C025BF903FE7BE5DC0484020BE953FF73E0BC0CF3FA6BF30C0C9BE4B3D3EBDC5BF853F7840F6BF873E36404C3FBC3F49BF49C043C0E13F893F064060BF503F3EC0F13F9FBF53C017C01EC0C3BF15405D401C40D3BFDE3FD33F92BFFE40663E1B4026401C404DC0443F1FC053C09A3FC13E49BFBBC08C40864009C04AC0844010407B404040A94077C05D4061BF6140C9C04A3F55BF52BF22404C407040B43E8B40124011BE83C0CE3D04410FC058409DBFF7BF82BF7840A9BF99C0E13F3AC03AC09EC092C0FFBFF63FCF3FCA3F1AC0AFC0AA40164153C0"> : tensor<3x5x40xbf16>
    return %cst : tensor<3x5x40xbf16>
  }
}
