// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %1 = call @expected() : () -> tensor<5x6x7xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      stablehlo.return %arg1 : tensor<f32>
    }) : (tensor<5x6x7xf32>, tensor<2x2x2xi64>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> ()
    return %2 : tensor<5x6x7xf32>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}, tensor<5x2x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x346C4DC0FCBB263FF28D13C033E145C0E8B4D63FEA0785C061067EC0FBC462BFB3BF923E635091403A6CE23FF861753F95D7204072FA3E3E790D59C0CD63D0408DBCC0BF28BA8040823DDA3FC3722C3FD94141C04193B83EDBCAA83F2111603FE62E8F3EC87FE2402CDE0FC0D4599DBED86134406EF3A6BC4B209340BDC2F4BF95648340FEE096BCF0CB3BC00DC16D3FC94A69BFE47F49404DCFEEBDF4689C40DC8E5AC00CB863C0CA7E7740646FE0BFDBCC6DC0AE790B404FB4243FB56F7E3F9F7F0841588314C08B691740E6FA33BF1EFEE3BFE9EE6840919C6140392B56BDEC99D8BF069B2CC09B1A1D3F93F79DBFFD1840C0FA66EC3FC71C4FC03979C6BCCDC28DC036190BC08B90D0BE39EC223F87455A3EDAB36A3FC711F140908366400937BD3FDF4B47C0765845C0D075EB3F304758409CBD9440D2BB8E3F356AA0BFD8E5403E8D373A3F354D9C4021398EC07C670DC0F1C5114017781BC0997E433D624689BED7DCF13E44FB8E3F086F2E3F88BF43BFF9BEB0BE37BDAB3E91C624BEB457083F5010614090F409BE9D548B3F06AC05BFD16C2D404ECCF8BF8FB281BF87AEC13FCFEFA1BE058FD8BF06ACB7BF1D8EDF3F92EBF73DEDCE60C0850F1FBF9150D93F2421513F3296A13F602762BC9DF4073F312F094126328CBF9064C63EAD18EBBE6D75B7C01FDE69C0A7EEA2C0A11B8C4075DA573F2AC55FBF9DF2D7C0E58956C0BB7EB83F53E022C07AEFDF3FAD800140F11E5440D9FB97BE94D257C0ABD910409F174140FB3239BFDDB40EC097E830C03D1609BF003E53C05531DC3FCB0911BE2940753FA55805C0B91195C0125CE3C0F7518E3FB1D197BF015047C0A3F22E40DC35CA3F6B185EBFA825A7C0B3D7B340165D6BBF46244D40F55FB13E26D106C0615325C053C6A03FD692D940F6C97F401F375C40D3F067BFA583983FAD6E423F69354C3FB64BBABFA0A73840E98D11C09C460A3FC3D5263FBBDFAE3F4A92A03F5C05E2BFE41BDF3FF85A1740E31116C0D089C4BF88F5E4BEA9167EBF4C7697C04A6FF63ED10EA5403A964FC0D78739C0DC9B90BFFF5A523E8AC90FC010C328C0C99C98BF135225BE40D79D401149BA3C00FD984031CC493F5D10233DABFFABBECDF6083ED44F173FC6C9913F24B8843E447C1BC0800F44BDF31B82C05B06B8BFC7C3FF3E"> : tensor<5x6x7xf32>
    %cst_0 = stablehlo.constant dense<[[[6.24649524, 2.08229446], [-0.944173098, 2.64017892]], [[1.87537599, -1.83636093], [-2.78156734, -7.40136099]], [[-4.70128107, -1.35021031], [-2.68029976, -0.31766665]], [[0.455216348, 1.29136562], [0.247529611, -0.779549777]], [[5.76326847, -2.00456238], [0.601839244, 0.353696078]]]> : tensor<5x2x2xf32>
    return %cst, %cst_0 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x346C4DC04AE3C740F28D13C033E145C0E8B4D63FEA0785C061067EC0FBC462BFB3BF923EB1F828403A6CE23FF861753F95D7204072FA3E3E790D59C0CD63D0408DBCC0BF50440540823DDA3FC3722C3FD94141C04193B83EDBCAA83F2111603FE62E8F3EC87FE2402CDE0FC0D4599DBE54B571BF6EF3A6BC4B209340BDC2F4BF95648340FEE096BCF0CB3BC00DC16D3FC94A69BFE47F49404DCFEEBDF4689C40DC8E5AC00CB863C0CA7E7740520CF03FDBCC6DC0AE790B404FB4243FB56F7E3F9F7F0841588314C08B691740F3D7ECC01EFEE3BFE9EE6840919C6140392B56BDEC99D8BF069B2CC09B1A1D3FE00DEBBFFD1840C0FA66EC3FC71C4FC03979C6BCCDC28DC036190BC08B90D0BE39EC223F87455A3EDAB36A3F330532C0908366400937BD3FDF4B47C0765845C0D075EB3F304758409CBD9440D2BB8E3F356AA0BFD8E5403E8D373A3F354D9C4021398EC07C670DC0E57096C017781BC0997E433D624689BED7DCF13E44FB8E3F086F2E3F88BF43BF34A5A2BE37BDAB3E91C624BEB457083F5010614090F409BE9D548B3F06AC05BFB1D3ACBF4ECCF8BF8FB281BF87AEC13FCFEFA1BE058FD8BF06ACB7BF1D8EDF3F92EBF73DEDCE60C0850F1FBF088A2BC02421513F3296A13F602762BC9DF4073F312F094126328CBF9064C63EAD18EBBE6D75B7C01FDE69C0A7EEA2C0A11B8C4075DA573F2AC55FBF1E12E93EE58956C0BB7EB83F53E022C07AEFDF3FAD800140F11E5440D9FB97BE939047BFABD910409F174140FB3239BFDDB40EC097E830C03D1609BF003E53C0784BA53FCB0911BE2940753FA55805C0B91195C0125CE3C0F7518E3FB1D197BF015047C0A3F22E40DC35CA3F67787D3EA825A7C0B3D7B340165D6BBF46244D40F55FB13E26D106C0615325C053C6A03FD692D940F6C97F401F375C40D3F067BFA583983FAD6E423FB26CB840B64BBABFA0A73840E98D11C09C460A3FC3D5263FBBDFAE3F4A92A03FA717B53EE41BDF3FF85A1740E31116C0D089C4BF88F5E4BEA9167EBF4C7697C0C04A00C0D10EA5403A964FC0D78739C0DC9B90BFFF5A523E8AC90FC010C328C0C99C98BF135225BE40D79D4023121A3F00FD984031CC493F5D10233DABFFABBECDF6083ED44F173FC6C9913F24B8843E447C1BC0800F44BDF31B82C05B06B8BFC7C3FF3E"> : tensor<5x6x7xf32>
    return %cst : tensor<5x6x7xf32>
  }
}
