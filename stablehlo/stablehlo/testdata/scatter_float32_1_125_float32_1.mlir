// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x125xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<0> : tensor<1xi64>
    %0:2 = call @inputs() : () -> (tensor<1x125xf32>, tensor<1xf32>)
    %1 = call @expected() : () -> tensor<1x125xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      stablehlo.return %arg1 : tensor<f32>
    }) : (tensor<1x125xf32>, tensor<1xi64>, tensor<1xf32>) -> tensor<1x125xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x125xf32>, tensor<1x125xf32>) -> ()
    return %2 : tensor<1x125xf32>
  }
  func.func private @inputs() -> (tensor<1x125xf32> {mhlo.layout_mode = "default"}, tensor<1xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x0EDF5A40527317C0562F84BEAEB1843F5CC6DDBE10080E409653B6BFD1C04BC0605A7A3D74BDA43FA77B85C0C05AF6BE8D890B4018575B3F54F25F3D9E68563D6275DFBE9DC56540BF5DE83E1F7612BF794FF640AD013740E62F78C0362851406EB2FE40E65280C099010640ECDF88BE02403440444ADC40F57361C058EC94403B05833E1D18AEC0049D66BF7EE625404E19873F2DE154BF197808BF47B516402A11ECBF930631400409FCBFCA7B363F54219E3F29F1FB3F1AE644407E6EFBBEDA27C6BEAA9CA6C0522B8140AFCA06BF91DB9E4030CF744086E7E34011E44B40B0870DC0837956C0858F6B4049D557C0334ADFBE71D58E4070CB99BE649B2E40A571D83F3DB86FC0870622BE33DB1B40DAF0F2BF45B860BFE87C61400BAEF93FABC83E3FAE74033F9907304014089C3D0607A33FDD5377BF5A00354067C0ED3F47E5DF40DD72AD3FF77C90BFE70C5A3E42B88340B02730406E0648BEACC78740D3EC31C0374B64BF9E264140143555BF241F79BFE4A5C1BE554BB140307B7740AE30E2BF4176F8BF3A9D83C0D7699CC06AFA60C09984D040D40BCEBFAD40024029A232403F2D41BFE936623F3DD3093F4C560D3F88A9FFBFAA3322407F1EC8BFBC1DD13F213B2040642B193F4F8C8A401054ACBCECD50540948CCDBF5C661740E83A883F014443409A8BAB3F6754C73FCB86863F"> : tensor<1x125xf32>
    %cst_0 = stablehlo.constant dense<-2.46289706> : tensor<1xf32>
    return %cst, %cst_0 : tensor<1x125xf32>, tensor<1xf32>
  }
  func.func private @expected() -> (tensor<1x125xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x1BA01DC0527317C0562F84BEAEB1843F5CC6DDBE10080E409653B6BFD1C04BC0605A7A3D74BDA43FA77B85C0C05AF6BE8D890B4018575B3F54F25F3D9E68563D6275DFBE9DC56540BF5DE83E1F7612BF794FF640AD013740E62F78C0362851406EB2FE40E65280C099010640ECDF88BE02403440444ADC40F57361C058EC94403B05833E1D18AEC0049D66BF7EE625404E19873F2DE154BF197808BF47B516402A11ECBF930631400409FCBFCA7B363F54219E3F29F1FB3F1AE644407E6EFBBEDA27C6BEAA9CA6C0522B8140AFCA06BF91DB9E4030CF744086E7E34011E44B40B0870DC0837956C0858F6B4049D557C0334ADFBE71D58E4070CB99BE649B2E40A571D83F3DB86FC0870622BE33DB1B40DAF0F2BF45B860BFE87C61400BAEF93FABC83E3FAE74033F9907304014089C3D0607A33FDD5377BF5A00354067C0ED3F47E5DF40DD72AD3FF77C90BFE70C5A3E42B88340B02730406E0648BEACC78740D3EC31C0374B64BF9E264140143555BF241F79BFE4A5C1BE554BB140307B7740AE30E2BF4176F8BF3A9D83C0D7699CC06AFA60C09984D040D40BCEBFAD40024029A232403F2D41BFE936623F3DD3093F4C560D3F88A9FFBFAA3322407F1EC8BFBC1DD13F213B2040642B193F4F8C8A401054ACBCECD50540948CCDBF5C661740E83A883F014443409A8BAB3F6754C73FCB86863F"> : tensor<1x125xf32>
    return %cst : tensor<1x125xf32>
  }
}
