// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      stablehlo.return %arg1 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x1xi64>, tensor<5x2x2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x74A406198695D13FF79A5A33FD48F13F3610A32C14CFEB3F6F8A1EDFCB9FA7BF3E56BB96579CE1BFA53E1941AA0818409160913F8BE202C099E8FF08D0B607C007464059AC9AC53F63785A955B8010C0C434167BC55DDBBFDD2DA5F7A1DA054068B3824366A8FB3F76162EF3F998FA3F0AAFC2D9F93A0BC0F67F97CEB814D8BFA569C5D2F018FCBF0DC4785AAE9902C08D2FCA49CEC7E43F0DCB1AD93CEFE7BF009D13F8C02C09C07E4495DFAB57F9BF840CB6FFA8F506C03C1DDB2A0A27F0BF26F998851E02F4BFEEA004869EB5E53F8602A6E86F3814C0CECA6606223CF8BFA9B6DC18437A11402618D3C9F9F20F40286FAE851038D4BF9EBEEBD37A9701C0DCA7AD76962CFCBFF80F789D02EE13C04704520C37E103C0FEB947C11B22E4BF638C76744338FCBFF771E062AAC88CBF2DC5F05E7AEEF8BF6A36F61C20C8F93FE2608BFD91CEEA3FE8F99E82FBDC10C09BA35DC68EF603C0D6F5B3B1C5CCFFBF9819FA254AF8FE3F9D287CD238BF10C01061CC2A211106C0957DFCCBAE6D0440897BBB4C9D2802404F417A50FB1EC8BFC1C04528870301C07B812CC400D5E1BF0171897B965F03408A7FF4F8068DC3BF345766191296EC3FB4CE7BBE92F5EE3FD9FC34D90E33F53F822BAA36FACA08401E2C0F260BA80E40585797FE861300405D987C82B21FFEBFE2950F576CD3F9BF98531D3B9074FB3F750AA5DF503813C02E703DEE17DA08C0448A021C8F42D83F641B5FD6DF01EFBF7DCDF742EFF7EDBF00E4BC538CC8ED3F92622397AB1A01C0A4FC7F0DF94B19C0ECEAC62BD17CD2BF4FA95D56E44FF7BF3219790547061AC02AC8722396391F40FAAFAF5F182CF8BF82CE99F38911FABFDE3DCB922B0606C017601980BB0B1040068A312467F604C08BB84D521A981040403D4D2D368A0540899D3894DAC915C081E32235887406C0BE17296F0C291340F23F2CE3B07DC63F16CC85F5188CEF3FA050029EB031F33FB1DC70D22119F5BFE86DCC908B9DF43FB56D114E8191F6BF6CDF4222DB4915C000BF4EB7B38F1BC0C00858036926F93FAD9D264F2BDB1440665917FEEA8BF3BF62764B8545A4F03FBCD75F47E9DDEA3FD662A938EF91DE3F76A7394011D0FE3F30858ED21123F23F387C70F2B8C1D13F5DBBD4FED60FF43FF21E4B26201D10C04F925F013F4800C04C0DAAEE448B1140C26B224DD3D3CEBF1CE34BE71D5E04C05D94E3738FE7F1BFB15E5874496810403E7AE6D1616405C04EE8E79FA764F63F99EB4865106910C0684A088AD06906C05E2155AEA4AEE5BFBE4A09D8D15218C03C685E06971610C0A690967E4BFCFF3FF618CDCA47740140998AEA99469B1840DD4920720689F73F6AF7E2097B9E07C08E767395AF88D23F0D1D345F11E50640B82ED143E4820740614AEC5D3C1FF63FD4131D01A871DC3F548ABCA6915DEABFD64F82B352300840201ADFC48A5711C0B6955EBE2A5DF63FA0682251701DFA3F40C8E5DA1AE4EE3F586AAF003BEEEEBF961C3435CDDAFABF3C3B8AB68184DA3F6C8BB9E67FE7E13FF8185339F83A2040CA1309D968730640F2B48F9D7177FA3FD1D78CB665EAE63F52DFFBB53F3217409B4B4399F1460640D6DFEC53FF8E1040D7D202AA4BF0F83F4DA10124C7EFDFBF40A3244E26050740A74CBAD6092B10407E31E156192F18C0931574D304C11740CF9234595F9FE2BF70260F82E256DB3F12D82564DC2F08C0A433C61F59AB16409059C9D15A1ADDBF44E29694004E1540F1EB9E172EA0054042A157AD10E3D03FA998E161891916C0A3B6A638C00D0A40D0C95FE210C21EC02814CF53FEC516C08A7BE0D0A4F7FDBFC335B9C32779F2BF121F6513E2DEFE3F85E2E23F548C0C4001C8AFC2DE3CD2BF72E98938B83A0240FCC3A2FE367A0DC0D6AB2A28CEE50340249B480FDDB30A40627484F6F5BF0240A6CA92FAD806F4BF4E1AE9BAFFC5E13F7859933DFAD50A40E06ED997D48F0D4018519DBFFBEF0540541FD82B940512401013622D8046054050343C93AE9AFA3F540755580596C2BFCE7DE5A23B38CBBF336A201586B3104000608FAF2B1A0640B679CFC33431C33F1E70248DC1D6F9BF1E5A97AC3419F8BF445D7977615DECBFED717BEF03B415C0A0ADE6884EE20D40735C77318C0CD93FF6AA5D20E973F0BFC3E4919A5E60E5BFC4DA793C452F06409CF9A4D2D3B311403A6599F909AB943F079A0C3D28BC0340DA7BD98FF32ACABF265652CBAA65BBBF973795465F0CE3BF28345CC45155F0BF4ED87806140610C08414F3938B4C9BBF9A071DE33334F03F27DBC3084D9F75BF6DD44A82F85B10C0867811A54084D83FAF943F8CD0D412C0C7A4D1C75D7A0C401DB792C16BA408C0"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<"0xFD40F10E17220CC098551484887DD1BF48E1571FCA57FABF7505BF7F8606D2BFC2EA57D0886415405CEA09C789DBDCBF037FFBE1C32DF03F104A4BC7D8D4CA3F90BA7B95F338F9BFA4A4BC8E24ECDFBFB3544BE5E0D6DBBF1CB0AAFD0ADE0D407C9FFF7E21A1F73F8CCBA57E329B194007DBEDB376FEF4BF92575595E94D03C0C4E7EE1899D90440EE9C5999E8AB16C052E2D32A9A1BFDBF1744221DFDD4CD3FC4CDB9BF0A3FE83F8A6CA21091C713406E38C42A95E81CC0594390313029FB3F35C9FEB93F9402C03C7C0C945883DA3F61ACE875FE40F6BF469547A2B95013C037E53F0281F812408ECDB255928C02C090502D1E32400DC0B18280A293900E405CCB6A2DB12ED13F1318E24024D5D43F81EC22380335F63F1352CC9C8098F03FDD9BEB4669B3D0BF395E39DE112C01C098A325EC0C3E0CC08EF06FEEE18FED3F245E1A9F42970BC04A12DE50CDA4DBBF1E4337B8DA420AC06E87E9EB2808F9BFB0BF984EEA5710C09CE78B94DDCBC3BFFAF5BB73A9CBF73F9F7B5B77870C08C09F4A2531752B0F4012D2650E378318405A85E6347EB4F9BF1ECD0A862F000C40E674D144542CCFBF0264923DC7D00E4084265C3A91A2FBBFBA44B1EC036104403B037CEB297D07C009DEC4F3DDFC12C016CDFE53DA1D0DC0CA771DA45022EA3FAA4A36BD541C12C0B4EFC13E5E8FDF3FA4A353BA07480140F671F4046BEBFFBF175A28A889AD13C06C72DBE275341D40ECDB9743013C03408D70B26B625C02C00AEF722231D0DB3F2EB000DA4F15FC3FA60949566CF801C082E2ECA478B1E63FE160F72DE24F1240220A27223DD7F3BF5486AA66D444DDBFC2BEB2C7FFE3FB3F673E774B79EFF43FD8F69A13B47DFFBF44EC79ED8708D23FA4AD572408EF06C07907D6E3C11BB3BF7AF7B6EE613ADDBFD2EA5DD41B19CBBF286B433B2D8F144098C754E9224A15C043546BF1E644D9BF2A81BBBD1613943FD5E770CEFDBF08404652316D4A28E53F3C629263F66BDBBF898C53EDD57916C0564980E5312FFBBFA7E022D28E1A11405ADD3933F63CD5BF4EBA6F01BD7FBB3F8C6F6EB2A5FC00C0F101AEF3BC5516C059C659577C30D93F92B47FC0FF1019C0A25952A65F26F73FD8C247C0DF290F4058196BCD72E0EB3F969561F55B36034059FBF2574B360EC03EDC608EA2A91240986943CF8126F0BFE2B061C1CCC20640A4E77D54E297C83F50323FF2CD2BCDBFB91627E80AA60340A46919C2D6D8F23F6E32CAE8D1120B40EA06E8310006F4BF4CBF90AD6B2104C04A1DC80F056011C06E9E5C2E57CD02400CE9EE814DB7FBBFFDD055059594094084D2F5305E7F1440CA86FEDFE76B0C40946ACBF877D70540078821F79F2201C076591F7FDD63F0BFD91E26E0F4E01240C8F970D00880FBBF10838DA52984EEBF5930EE9752D61540CD38804F63A80B40E398DBA42615F23F002B902CD63C0DC002186E05FE521A400D1DAFFF6E4AFF3F3718F46EC586F93FC2533A769F510840E488CB62BE83E93F6F5DF4F1D5B2F3BFED48E097B437034084F3BAFAAA37FFBFD123F938D58105402AF3719477A80A40"> : tensor<5x2x2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xFD40F10E17220CC098551484887DD1BF48E1571FCA57FABF7505BF7F8606D2BFC2EA57D0886415405CEA09C789DBDCBF037FFBE1C32DF03F104A4BC7D8D4CA3F90BA7B95F338F9BFA4A4BC8E24ECDFBFB3544BE5E0D6DBBF1CB0AAFD0ADE0D407C9FFF7E21A1F73F8CCBA57E329B194007DBEDB376FEF4BF92575595E94D03C0C4E7EE1899D90440EE9C5999E8AB16C052E2D32A9A1BFDBF1744221DFDD4CD3FC4CDB9BF0A3FE83F8A6CA21091C713406E38C42A95E81CC0594390313029FB3F35C9FEB93F9402C03C7C0C945883DA3F61ACE875FE40F6BF469547A2B95013C0A9B6DC18437A11402618D3C9F9F20F40286FAE851038D4BF9EBEEBD37A9701C0DCA7AD76962CFCBFF80F789D02EE13C04704520C37E103C0FEB947C11B22E4BF638C76744338FCBFF771E062AAC88CBF2DC5F05E7AEEF8BF6A36F61C20C8F93FE2608BFD91CEEA3FE8F99E82FBDC10C037E53F0281F812408ECDB255928C02C090502D1E32400DC0B18280A293900E405CCB6A2DB12ED13F1318E24024D5D43F81EC22380335F63F1352CC9C8098F03FDD9BEB4669B3D0BF395E39DE112C01C098A325EC0C3E0CC08EF06FEEE18FED3F245E1A9F42970BC04A12DE50CDA4DBBF1E4337B8DA420AC06E87E9EB2808F9BFB0BF984EEA5710C09CE78B94DDCBC3BFFAF5BB73A9CBF73F9F7B5B77870C08C09F4A2531752B0F4012D2650E378318405A85E6347EB4F9BF1ECD0A862F000C40E674D144542CCFBF0264923DC7D00E4084265C3A91A2FBBFBA44B1EC03610440A4FC7F0DF94B19C0ECEAC62BD17CD2BF4FA95D56E44FF7BF3219790547061AC02AC8722396391F40FAAFAF5F182CF8BF82CE99F38911FABFDE3DCB922B0606C017601980BB0B1040068A312467F604C08BB84D521A981040403D4D2D368A0540899D3894DAC915C081E32235887406C03B037CEB297D07C009DEC4F3DDFC12C016CDFE53DA1D0DC0CA771DA45022EA3FAA4A36BD541C12C0B4EFC13E5E8FDF3FA4A353BA07480140F671F4046BEBFFBF175A28A889AD13C06C72DBE275341D40ECDB9743013C03408D70B26B625C02C00AEF722231D0DB3F2EB000DA4F15FC3FA60949566CF801C082E2ECA478B1E63FE160F72DE24F1240220A27223DD7F3BF5486AA66D444DDBFC2BEB2C7FFE3FB3F673E774B79EFF43FD8F69A13B47DFFBF44EC79ED8708D23FA4AD572408EF06C07907D6E3C11BB3BF7AF7B6EE613ADDBFD2EA5DD41B19CBBF286B433B2D8F144099EB4865106910C0684A088AD06906C05E2155AEA4AEE5BFBE4A09D8D15218C03C685E06971610C0A690967E4BFCFF3FF618CDCA47740140998AEA99469B1840DD4920720689F73F6AF7E2097B9E07C08E767395AF88D23F0D1D345F11E50640B82ED143E4820740614AEC5D3C1FF63F98C754E9224A15C043546BF1E644D9BF2A81BBBD1613943FD5E770CEFDBF08404652316D4A28E53F3C629263F66BDBBF898C53EDD57916C0564980E5312FFBBFA7E022D28E1A11405ADD3933F63CD5BF4EBA6F01BD7FBB3F8C6F6EB2A5FC00C0F101AEF3BC5516C059C659577C30D93F92B47FC0FF1019C0A25952A65F26F73FD8C247C0DF290F4058196BCD72E0EB3F969561F55B36034059FBF2574B360EC03EDC608EA2A91240986943CF8126F0BFE2B061C1CCC20640A4E77D54E297C83F50323FF2CD2BCDBFB91627E80AA60340A46919C2D6D8F23F6E32CAE8D1120B409059C9D15A1ADDBF44E29694004E1540F1EB9E172EA0054042A157AD10E3D03FA998E161891916C0A3B6A638C00D0A40D0C95FE210C21EC02814CF53FEC516C08A7BE0D0A4F7FDBFC335B9C32779F2BF121F6513E2DEFE3F85E2E23F548C0C4001C8AFC2DE3CD2BF72E98938B83A0240EA06E8310006F4BF4CBF90AD6B2104C04A1DC80F056011C06E9E5C2E57CD02400CE9EE814DB7FBBFFDD055059594094084D2F5305E7F1440CA86FEDFE76B0C40946ACBF877D70540078821F79F2201C076591F7FDD63F0BFD91E26E0F4E01240C8F970D00880FBBF10838DA52984EEBF5930EE9752D61540CD38804F63A80B40E398DBA42615F23F002B902CD63C0DC002186E05FE521A400D1DAFFF6E4AFF3F3718F46EC586F93FC2533A769F510840E488CB62BE83E93F6F5DF4F1D5B2F3BFED48E097B437034084F3BAFAAA37FFBFD123F938D58105402AF3719477A80A40079A0C3D28BC0340DA7BD98FF32ACABF265652CBAA65BBBF973795465F0CE3BF28345CC45155F0BF4ED87806140610C08414F3938B4C9BBF9A071DE33334F03F27DBC3084D9F75BF6DD44A82F85B10C0867811A54084D83FAF943F8CD0D412C0C7A4D1C75D7A0C401DB792C16BA408C0"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
