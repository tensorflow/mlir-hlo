// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2xi64>, tensor<2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xCA37086C5828FB3F8679E56E0D16F6BF5839D98A2DCAE8BF54432B8A5A66F03FB802088A6DB4F8BFE061CD595F560DC01E91B403DF8F0B40B6414B4FF78E15C05F53A680D1041D40B6975659F0350AC0748185DAE6B7E0BFED7E7340DD68F63FA557C8DA7CA3DEBFA852062FCF930A401367F396DC9383BF0AE8C9FD3B320040F7406C94E05DDCBF7395B463E9780CC0E2070FF5E5ACFABF9B986D94BFB1D7BF9C2BF8A808E200C05E99FC95D30B0E40169A042C76C419C016562688F5540B401426E8F90DE8E5BF9CC044738295E63FC6EE7B83E8D504409EC52789EF8EDF3F7EE1A9D426D0084075DA745934B9CB3F289098E01B9011C08D080EEB178905C0E338B6EE611B1740739DABEA82B5C3BF1F2139B0895CFDBF1E676B25FD51FEBF840E83D53D3902C0F542648CA90DD4BFBC6CA499CEB2ECBFFC539D13F650EBBFB5E6ADF3C3C102C09021EAFD074604C02AB32148AB290940080CC33A9D5114C09ACC584C6C48FE3FD7A1C5A670B90DC0C309C4EFD3ED0A401B960F2800EA01C09594C38C5733E93FD32045528ADCEC3F305EED002E52F83FE97448C92379E5BF45393CF5C0D80F40CCBCA19B85111540E469117032B00E40955965ED384DF03F6DAA845A4F3BF83FD5FB87126652E13F2F4B6460CC66E0BF87ED0C27D0F218C0F77B6E0A275A1740A1FDD18042790FC07C48E8DBDAABFF3FFCD98CC5CF0B0D40E2839A6412780540EAD211770F3CF3BFA968B0BC2ECFE0BFEEE7521E2B5A19C0EAE234F2AB88DC3F5460A4CBB08BF83FE7002644E4B51440DE00B72352790C4015D7F129F69FE0BF84E57DCFD639064099E5ABA7B55C10C04034C401C29B0AC0737565A052D40340B2D473091DFCB23FCA2DD473B4CFFE3F4572321959D10740A2CBE67BEB27E4BF902D74F4BAF3E8BFDCCFCDDA2A2703C06687DC0F1306A9BF44F44914A1DB09C050F43642F90606C066650EEC587907408250F821C56B1040ED6421384D28F7BFF27C3BC6EF24DEBF84DD6403BD0CEEBF213361B50CE5F63F232D257D4CFD10C0F924013529340140A28A3C2942BCE03FEA9D5B4554AE04C0DA33B5DB0AE219C04223388CECCEF1BF92E324EE2288D13F017832B06A90F53FA4D184DD723FFBBF82BDAD340772F33F91A5A81A1DFFFC3FF996FFF082A6074017873C3909A701C07553E16E1F5AD53FD5ABD3FC98B6F53F0A6B87D412E808406CE29BE82F2CECBF31819758797312C0CE08ED173883F83FF5A8517D2B250040D80723D3DDDBF03F4A59A1FB0D19E2BFA4DACC2D1681D7BF6C2F0278BE0FFEBFAE55C9E1DB72A7BFB0E6A95BE858F23FFF54556EAD971B40D39AC5A0BC4E0AC000F5B6B4D6CCF13F2BE6B602612D0FC0EA1B64D7481EF83FEAC1589727CA08C078397FD86C8406400241398D2D30ED3F0672656AD20B09C09CF862826F2B1340AC152FB64FB30D40CA8A80119108BDBF93EA20EB0D550C40EAED94A5E713004054188A8B0B2CEA3FF6A9B597134EF7BF843EC350D7991840ACCCE579AE30F03FCE83A1A1D522EABF922B0B0FB2F30F403663EB6DF43F05C02EC05F37B3AFF23F6EC6C5DBB814D5BF9C15A3F5757EF3BFBA4BFD08C377024026FFE4238790F53F8A11D792CE75D8BFFE3E9EF5AEE1A13F9065AAEC945301C09CC7293C67AA00C07AF2EC342132FD3F833F6DCCF2DFE8BFAAB085C811C40BC07C21E30F7DD00DC0D674F5BA91C20440AB3573E9C18DEBBFB48CB9B047EDEEBF4025CDA25B75F2BF0FF2CC0CF23C1540CB6E64FE8703F13F562902313C58E9BFCBF3293CF2BB10C0B2D10D98D1AD16C0222FF598AC6EC83FBE86D47847B303C0D0D16B3E68ABEB3F60EBA77BED1C20C0C77E1792A6AD11C0362C259B25E605407A97E10E1B4100C02CA8DE6AB257FC3F77B3A19C2329D73F1A7ECD3A69E90BC0FA766E219D59F13F4CB1554A44261BC0D6BF34872410FB3F7ABCF226C33EDCBFB74284E1636702C096957D5D27BD03C06AE2633A81C0FB3FE4A2D03D50F2F43FD1CF63BDAF4A00C02164A4714A3D10C0CA957B6380BCD53F77F0F1B9320BFE3F5C6FABC28AECD5BF908FA89441D5E93F041DAAB24B2C0C40BF0D1C0461AE0EC099394C3D83210DC0940BE27F8C700B402ED60329B74CFEBF224EFAF282ACF73F02D8CAA72AE3E63FD66496ADAD31D5BFD06AF13DB93C0B402613670E0B1AFEBF11F3527A8CE717C03E90FB1484C8E8BF2038F39D4FF5E53F660EF6C08DF5EDBF6A423E365ADCE53FAA9BB60ED5D7E6BF9462913E8C0EDA3FC29E75FE1CF412C0123A3468F2F8F13F6AFFEC03BEF8D8BF34338706CF4DFEBFE59BA4E6B14E11C01831997821110E409DB4F455BB8E17408394B8B32703EE3F"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[-4.3168294414051482, 1.7854274040637961, -1.1126860250919948, -2.6537242719439966, -1.9290906570315935, -1.3781952968350077, -0.46143246289140316], [-1.0118330153615056, 1.1359002806393441, 1.9999692718477629, -2.5463258229429551, -2.1990144754496335, 3.9372180331548359, -1.6501595570333762]]> : tensor<2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xCA37086C5828FB3F8679E56E0D16F6BF5839D98A2DCAE8BF54432B8A5A66F03FB802088A6DB4F8BFE061CD595F560DC01E91B403DF8F0B40F1FAE4EF6E4411C05F53A680D1041D401AC887DC8FCDF1BF748185DAE6B7E0BFED7E7340DD68F63FA557C8DA7CA3DEBFA852062FCF930A401367F396DC9383BF0AE8C9FD3B320040F7406C94E05DDCBF7395B463E9780CC0E2070FF5E5ACFABF9B986D94BFB1D7BF9C2BF8A808E200C05E99FC95D30B0E40169A042C76C419C016562688F5540B401426E8F90DE8E5BF9CC044738295E63FC6EE7B83E8D504409EC52789EF8EDF3F7EE1A9D426D0084075DA745934B9CB3F289098E01B9011C08D080EEB178905C0E338B6EE611B1740739DABEA82B5C3BF1F2139B0895CFDBF1E676B25FD51FEBF840E83D53D3902C0F542648CA90DD4BFBC6CA499CEB2ECBFFC539D13F650EBBFB5E6ADF3C3C102C09021EAFD074604C02AB32148AB290940080CC33A9D5114C09ACC584C6C48FE3FD7A1C5A670B90DC0C309C4EFD3ED0A401B960F2800EA01C09594C38C5733E93FD32045528ADCEC3F305EED002E52F83FE97448C92379E5BF45393CF5C0D80F40CCBCA19B85111540E469117032B00E40955965ED384DF03F6DAA845A4F3BF83FD5FB87126652E13F2F4B6460CC66E0BF87ED0C27D0F218C0F77B6E0A275A1740A1FDD18042790FC07C48E8DBDAABFF3FFCD98CC5CF0B0D40E2839A6412780540EAD211770F3CF3BFA968B0BC2ECFE0BFEEE7521E2B5A19C0EAE234F2AB88DC3F5460A4CBB08BF83FE7002644E4B51440DE00B72352790C4015D7F129F69FE0BF84E57DCFD639064099E5ABA7B55C10C04034C401C29B0AC0737565A052D40340B2D473091DFCB23FCA2DD473B4CFFE3F4572321959D10740A2CBE67BEB27E4BF902D74F4BAF3E8BFDCCFCDDA2A2703C06687DC0F1306A9BF44F44914A1DB09C050F43642F90606C066650EEC587907408250F821C56B1040ED6421384D28F7BFF27C3BC6EF24DEBF84DD6403BD0CEEBF213361B50CE5F63F232D257D4CFD10C0F924013529340140A28A3C2942BCE03FEA9D5B4554AE04C0DA33B5DB0AE219C04223388CECCEF1BF92E324EE2288D13F017832B06A90F53FA4D184DD723FFBBF82BDAD340772F33F91A5A81A1DFFFC3FF996FFF082A6074017873C3909A701C07553E16E1F5AD53FD5ABD3FC98B6F53F0A6B87D412E808406CE29BE82F2CECBFE8E4BBE6949701C0C2F80C2B6C7F0F40F5A8517D2B250040D80723D3DDDBF03F4A59A1FB0D19E2BFA4DACC2D1681D7BF6C2F0278BE0FFEBFAE55C9E1DB72A7BFB0E6A95BE858F23FFF54556EAD971B40D39AC5A0BC4E0AC000F5B6B4D6CCF13F2BE6B602612D0FC0EA1B64D7481EF83FEAC1589727CA08C078397FD86C8406400241398D2D30ED3F0672656AD20B09C09CF862826F2B1340AC152FB64FB30D40CA8A80119108BDBF93EA20EB0D550C40EAED94A5E713004054188A8B0B2CEA3FF6A9B597134EF7BF843EC350D7991840ACCCE579AE30F03FCE83A1A1D522EABF922B0B0FB2F30F403663EB6DF43F05C02EC05F37B3AFF23F6EC6C5DBB814D5BF9C15A3F5757EF3BFBA4BFD08C377024026FFE4238790F53F8A11D792CE75D8BFFE3E9EF5AEE1A13F9065AAEC945301C09CC7293C67AA00C07AF2EC342132FD3F833F6DCCF2DFE8BFAAB085C811C40BC07C21E30F7DD00DC0D674F5BA91C20440AB3573E9C18DEBBFB48CB9B047EDEEBF4025CDA25B75F2BF0FF2CC0CF23C1540CB6E64FE8703F13F562902313C58E9BFCBF3293CF2BB10C0B2D10D98D1AD16C0222FF598AC6EC83FBE86D47847B303C0D0D16B3E68ABEB3F60EBA77BED1C20C0C77E1792A6AD11C0362C259B25E605407A97E10E1B4100C02CA8DE6AB257FC3F77B3A19C2329D73F1A7ECD3A69E90BC0FA766E219D59F13F4CB1554A44261BC0D6BF34872410FB3F7ABCF226C33EDCBFB74284E1636702C096957D5D27BD03C06AE2633A81C0FB3FE4A2D03D50F2F43FD1CF63BDAF4A00C02164A4714A3D10C0CA957B6380BCD53F77F0F1B9320BFE3F5C6FABC28AECD5BF908FA89441D5E93F041DAAB24B2C0C40BF0D1C0461AE0EC099394C3D83210DC0940BE27F8C700B402ED60329B74CFEBF224EFAF282ACF73F02D8CAA72AE3E63FD66496ADAD31D5BFD06AF13DB93C0B402613670E0B1AFEBF11F3527A8CE717C03E90FB1484C8E8BF2038F39D4FF5E53F660EF6C08DF5EDBF6A423E365ADCE53FAA9BB60ED5D7E6BF9462913E8C0EDA3FC29E75FE1CF412C0123A3468F2F8F13F6AFFEC03BEF8D8BF34338706CF4DFEBFE59BA4E6B14E11C01831997821110E409DB4F455BB8E17408394B8B32703EE3F"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
