// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x30xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0 = call @inputs() : () -> tensor<20x30xf16>
    %1 = call @expected() : () -> tensor<20x30xf16>
    %2 = call @integer_pow(%0) : (tensor<20x30xf16>) -> tensor<20x30xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<20x30xf16>, tensor<20x30xf16>) -> ()
    return %2 : tensor<20x30xf16>
  }
  func.func private @inputs() -> (tensor<20x30xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x15C47AC391BAB1389142FDBD3BBB77AFC546FAC0FB30A2C1CA38F6BD98B938C57B33DA33B6414F457A3C62C00BBBD5C064B47C3EDFBD403C21408EC53E3F21C3F3C0FC3F61BC18C198BF414204C307C12F3626B848434446CD37DAB495C0023797BCC542A8BC7CBC9C3E8044923143434742BABF474252C4173F2FC0ECB8D7B1F6C371466D3A8BBDFBB162400041DF320AB39CB655C2D1C567443EC401C0CAB21FA99AC176C0133C19494041B2BD1341F03A21C66F1E4E425AB9A93B2EC1F9BA20C18BC2C5C4243DB243A44487C5D7C4DFC3D2C4413F87C56618DB3E06405EBE86408BB54A28D62D433FCEBA8438DEBAE4C3CE418EBD573F3CC0FC36213963402A44354881B97E3A033DC9C501AFE04138C771BEDFBFE2C459C0653F32C389BB863B9D3861429339A042B8C6D3414F44A5C31B3E5E43D94135C0FE484C3D96BDF3B572C1063E182BBDBF7C3EF83D69BA77BE18BAB63F1545503EFC41E4374FBE4044103AADC72BC3123C57405B3B033F87C14AC01A3861C25834DDBA3341D6C20EC37E3668458839143AB8BA8538C6B917C1F13FCEC568B04242B73E82BE474297AF9AB6B740F7C46E4238C67DBF9030B9C17B43F8BDDFC263BD25C0C1C1D7AD2145C64224C203C87234BA4404BD383B4A416B43F4BD424100C6F9B911BC8440BA4001BD25BA5EBF5139513E54C017BEF2C54A3501B84BC020BD434631C277C173C58CC260C1DF4120C04A44A53E713A83B60F38D6443EBFD73D964161BC75B9CBC24A3DB0C2C7C0793CCDBD1045BAC1094453BC44BCD0C265BDADBCE03F463A99334F4024B9FB3FED3E30BDF9BF64446742A833BF4104C08FC264C549B56843F3417BC10841FCC031BD6EA428C21DC1D7BC0CB85D3CB13D4E2A06C49EC421C467BB1943403B863F44C48144EA45743E1C46D9C0DD42D8BA1B3B81B19EBCB93D063AC542593163C58BB83142BDC12E3D8AC407B877BF03BFEC3DE7BB0A3EF4C2F23FA8C072B4723F1A3C41462CC036BC6C3D8C3E7B3A0B46E7B8A6BE38C40AC0CABCF43583B3B4C22EBE6AC1A230C1C4B93A7B449A3B50433FC3DC3C813A3BC0C03A9FBD3FC06A3E77B8CCB9D3BF45BA943D30BCD2233FC561B2584308352DBD353FDD37B54043BDE83E97BD83C4D044DB45CF42133E373BF0BE4DC02C46EAA235B9A93841BDB0A59239CF42CBC227BF65445F43B6BFBE39A0C09D39AEB7873C1F44F7B45B3418C03CC181C0AC430646ADC40BBAA8BC44B6A1AB86C461C35CBE47C47A41D9C4C4B94345BD3A1D384340B7383B3E8FC0673DAAC15F4179C6034060C056BF16C449C0214699BF8DC186C4E1BC27B74D402F419A4468C2FBC0F7C091B80DC53AC51541E139EEB90D484DBFAE3DF244B83FCDC6B8C6D0C4F2357DB78CC09DB70E32784186B983BD4E4304C866C546BFD143EABEBAB170BE6E34053F993BAC4133BCD741A03637416DB93BBFEC4192BB29C48BC2A744EA3BE93891C436C17EC242C1943CC8C208B93B3D304406C42BC14AC0E84417BED23E8CC063C3CC4459C6B3C07642A2C392C49CC2B0C401C00AC019C024C26E456ABA8BAC90C053C00E4355483EC6F746383B69BABEB2344145B5DC3F30397D416E3A894417B641BCAFC42C3F73C163B7B745D044014425468042C8BBB6465E458B454B305AC1A3C1BDC569432B4596BA04BAAC3840BE"> : tensor<20x30xf16>
    return %cst : tensor<20x30xf16>
  }
  func.func private @expected() -> (tensor<20x30xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x565C1B5A4437932F445707455739100A1968CB50CF10DE531C30EE44A733CB611E1A6D1B28543562483EC34DCE384250CF1DE946A444193D8A4C71635F490B59B050F04BBE3D43517E4AFB55BB58FE50B725A02C7E5905663B2B5320E44EB728EF3E1958593F523E7547685E86136E591156F54A1156735DF048C94C95308A14D85BBA66A8365F430015C34DE2505B18CC18752748567964DE5D105D044C26182B00B153314E4D3C4671EF511C442E518638836500002C566932BA3A9F519E38645129570B607441D95A3E5F4A634960805B386069494A6300005048184C6B468C4E5F23150088046E4930387F2E5838925B6F547143AB49074DA6286931CA4DB35CE66C2C33F136EF406064B408A6544F69BA46804B7160964DD7493D594C3A413A142F77568C338557F7677E54625DAB5A6E45C1599154E64CDA7027429B43E624DF5224459E00014BE946F5449936D2466235E84A366134460355922B3146195D4735C76A2859493C8A4DB739B8484A53494D6D2C7756911D5538B5514358D758F126AD6250335435F737842E58343E51C44B6F64E50DFD55F147014711567B0A6C27B94FC060AD56D965244AC50E31541E5AF5445B5894429B4C47548A0469611C588F550C6C1B1ECD5FF2404F391D52EA59E844F8511065FA34453C7F4ECD4FE7409135C1493E3239467C4D6045E1641D22042C4D4D64410266BE55F752E3622E578552A454864C495D9E47BA3606273D2C46605F498A449B53BE3DEE3229581D42D0571250403E6D4421613354245C773D2D3D35589D42773F824B0C36821A624D7431EC4B7F48A841E44BCF5D9156B61A4354104C395799621922E059E6540C530151D250AD4102009D5557514940312CA93D1A446300185C195F8A5CDC39F5586539414A2D5D6D5EC764C7467065505055584938FB382C13193F31442435195863129462A82EBE553D549F41A35E1C2C104AB848CD449D3B32459158C84B594F1B1E014A6D3CFB65BC4CEA3CC0422E47E43637658330A147F35C284C1C40E824391AE357B245B652340FFA5FFA374D5E853A955962595B40FE36004D0E38CC43154D9B46362E6934524B09369043CD3C0100EA617716AF5901219A414549782BAC4FFD417148A1437A5E30609764325852454B398648594DAB650100BE315F2FF54104008633325829581C49D45DC559E84A3F34264FC233CB2A913E825CC0209F1D644CDE516D4EC35A2465775F3735593F0526D4008C5ECA5963463B5D085350605234FD610738792C274DB92FE245BF4EA84206548052DC660C4CB94DA8495A5C444D8365824A6B538C5E6D401C29594DA551015F9456CF50C050CC2E1661D4613651AB34D434356C8D491044AC60F04A2E68F7673060E124242AAD4E902A4015FD52463335438F59106CA26278494A5B77483314B546051EBE48823A0A54DD3C8A548527C651C5325749CD546A3AAF5C2957515FA93B8B30CC5EC351F156F851DC3E22580131D941CD5C185C9251494D886060453B48AD4ED159236057669E4FCF56A15AD25E75578B5F044C284C694C8F55CB629B36AA01C54E774DD758816DEF6598684F3999360A18BA510622744BA8311753AD369B5E60251E3D855F2B49E352D1292A643060045C9165F9562A3BEC677C625F634D0D6952E2533D64E359926159371E35722FF645"> : tensor<20x30xf16>
    return %cst : tensor<20x30xf16>
  }
  func.func private @integer_pow(%arg0: tensor<20x30xf16>) -> tensor<20x30xf16> {
    %0 = stablehlo.multiply %arg0, %arg0 : tensor<20x30xf16>
    %1 = stablehlo.multiply %0, %0 : tensor<20x30xf16>
    return %1 : tensor<20x30xf16>
  }
}
