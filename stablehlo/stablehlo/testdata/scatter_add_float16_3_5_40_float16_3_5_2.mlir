// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %1 = call @expected() : () -> tensor<3x5x40xf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %3 = stablehlo.add %arg0, %arg1 : tensor<f16>
      stablehlo.return %3 : tensor<f16>
    }) : (tensor<3x5x40xf16>, tensor<2x1xi64>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> ()
    return %2 : tensor<3x5x40xf16>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16> {mhlo.layout_mode = "default"}, tensor<3x5x2xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x06C0ADC122C2F93DE2B5003FE843FB3AA63CEDC1F0BB9B3A843F63C59E44DCBCF1BD9ABD6FC081B9C13A6636F2334C1E6642ED439243743EC2BD9BB300BDF9BFB04166C4C4C24F44A74001C4853B0E34F3B9F4C159BE41C5CFC67EB3DE3E6EBE392E51469CC281310F446EBCB835FF2DB53248B9E63A76C37A38C2363BC0C9417F407F3D85BF25B3E8BF473A96BCAD3F6039FC3D3EBB84BB96BFFBA52242FC3C694296C1D936BBC6CE441FC0EDB6C43D9A408A340D39333D49460F40593BC9BCD23DD73B9D4384BFD3B4F2C05FBCF5C17444EFC0F6B7803E13C41734E0B9744100B89F40A4BCB1C0F440CC3B214184BA72B4C1BBBD403B3C27395DBBC0C215C234411E44323EEA40DC2C7BC24D4346C253BDEC3D95C53441AFBDB6C14737E8B992B906C8D5C695414A45EBC4D24345BE974160B83C3F343E1E419EC14D40C43D4C4554429441AE48F32C60B953C38B3B4DC0BFC18A3F74B558C3E1BD2E4285C419BA1A40A53B99C404425841804299B84CC554412342164007C0993DC8C133C4D344F4B5613701B7E4BDA63AA5C47EBF2945DD45FA3E26B5C63A373F2B445943BFC4C0C43BB99CC496974AB4724270B7B6BAFEBBBC3D403D02C075C5FCB99B397041BCC4EC39FEC146C27FC3BF3B30C3CF44D93C583F9CBE283ACEB3AC43E3C47BB66E430F3AE7BD3F46A135A0BC3B4509B9C6BBAC37C1C527BEE59E214211C5C73555C6203D534495BCD2304E384DC12DC335C8683C73C42146653D9BBF83C417C4883CDDC07B3DC73F78424AC5324261C28A3C7AC4D7C0E8BC32C0253A89BDA0BCFF42044538C466B85A46CEC7A340ABC1D14192C3BAC6402E692E6CC0B7BDBBC5BE44CC3D81451141BCB6942E30C8AF43474447410045E6C32A3F9C38F5C51E3C3E43CCBC46C6AEC132C5D647A9414745063D28BB0C3AEA44E23A1742FFC29134EB4271C10140334063442D19372FC140F63FDFBC6DC09743B634704442C2FE44993D19481E464744193F31405CC0EB3DC8C2BAC0CC3AC439C538C640BD43DCBAFA3D3735B24164BB0F44CAB9253EAF45263D5348B5392A34153739C1634610C66C4274C230457F447F469D43053091C369C11A40A9392741DAC17FBCB239E0C49C3047400333C5B9F53A6AB146BEC2C0E7C2CE3C5839D8BD843895B8C8BD723D8440A140823E8D37C041B5BC703E93413A450D388140B844EBC20246DF427B3DED38923B0F385BBD19BF4E3E93C4F64197BF233F7ABCB83EB3C008448F447BBFCEBD7C340C3CAC2A1146233D53B6A33F30386F41DF3DD8C0DBBD7B41D6C174372A3C8B3A313D79463043263DF841A143D2B8EEC1B54117409543E03C753D87C13AC27CC3D0440E43DC370E38363778BFC1C17F4109BAAAC4C5BE58BC6D42643CAFC6CF3AB441C03F06B97E410343AEC165C45CBC504393C076C36FBF3939B1410D458BC2AAC5D035A644773D714000B9DC38F741DAC32043FE3D45BDCC432CC5AC4350C4F124EB3D25C2E0384CBA3A40A341E2BB3F448F3DB144F04001B874BD0741863F19C5C5BA9842F1BC923771381A457F3DD2BCCF4167C004C305BC04C13A9D782F99345BC6E941C43E8F3AAF3E80C05DBF9B4492B7FF30FD3BD2425A3BDEC2D6BE02C4D23FC63739C67B24B0B504C202C42FC09CBCE8C58E3D8ABD533D25484CBB3AC341399546CF3E7B38"> : tensor<3x5x40xf16>
    %cst_0 = stablehlo.constant dense<[[[3.364260e-01, -1.047850e+00], [3.459470e-01, -1.932620e+00], [-2.550780e+00, 2.115480e-01], [-4.160160e-01, 5.371090e-01], [-7.914060e+00, 1.046880e+00]], [[-1.201170e+00, 1.182620e+00], [5.128910e+00, -2.939450e+00], [-4.339840e+00, 1.388670e+00], [5.300780e+00, 7.421880e-01], [3.789060e+00, 6.796880e+00]], [[-1.998050e+00, 3.121090e+00], [-7.453130e+00, 1.531250e+00], [-2.345700e+00, 7.082030e+00], [-2.662110e+00, -3.498540e-01], [4.050780e+00, -6.867180e+00]]]> : tensor<3x5x2xf16>
    return %cst, %cst_0 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> (tensor<3x5x40xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x06C01AC322C2F93DE2B5003FE843FB3AA63CEDC1F0BB9B3A843F63C59E44DCBCF1BD9ABD6FC081B9C13A6636F2334C1E6642ED439243743EC2BD9BB300BDF9BFB04166C4C4C24F44A74001C4853B0E34F3B990C459BE41C5CFC67EB3DE3E6EBE392E51469CC281310F446EBCB835FF2DB53248B9E63A76C37A38C2363BC0C9417F407F3D85BF25B3E8BF473A96BCAD3F6039FC3D3EBB84BB96BFFBA52242FC3C694222C5D936BBC6CE441FC0EDB6C43D9A408A340D39333D49460F40593BC9BCD23DD73B9D4384BFD3B4F2C05FBCF5C17444EFC0F6B7803E13C41734E0B9744100B89F40A4BCB1C0F440CC3B214184BA72B4C8BABD403B3C27395DBBC0C215C234411E44323EEA40DC2C7BC24D4346C253BDEC3D95C53441AFBDB6C14737E8B992B906C8D5C695414A45EBC4D24345BE974160B83C3F343E1E419EC14D40C43D4C4568C39441AE48F32C60B953C38B3B4DC0BFC18A3F74B558C3E1BD2E4285C419BA1A40A53B99C404425841804299B84CC554412342164007C0993DC8C133C4D344F4B5613701B7E4BDA63AA5C47EBF2945D945FA3E26B5C63A373F2B445943BFC4C0C43BB99CC496974AB4724270B7B6BAFEBBBC3D403D02C075C5FCB99B397041BCC4EC39FEC146C27FC3BF3B30C3CF44D93C583F9CBE283ACEB3AC43E3C47BB6E8450F3AE7BD3F46A135A0BC3B4509B9C6BBAC37C1C527BEE59E214211C5C73555C6203D534495BCD2304E384DC12DC335C8683C73C42146653D9BBF83C417C4883CDDC07B3DC73F78424AC5324261C244BF7AC4D7C0E8BC32C0253A89BDA0BCFF42044538C466B85A46CEC7A340ABC1D14192C3BAC6402E692E6CC0B7BDBBC5BE44CC3D81451141BCB6942E30C8AF43474447410045E6C32A3F9C38F5C51E3CD548CCBC46C6AEC132C5D647A9414745063D28BB0C3AEA44E23A1742FFC29134EB4271C10140334063442D19372FC140F63FDFBC6DC09743B634704442C2FE44993D19481E464744193F31405CC0EB3D3247BAC0CC3AC439C538C640BD43DCBAFA3D3735B24164BB0F44CAB9253EAF45263D5348B5392A34153739C1634610C66C4274C230457F447F469D43053091C369C11A40A9392741DAC17FBCB239E0C4123D47400333C5B9F53A6AB146BEC2C0E7C2CE3C5839D8BD843895B8C8BD723D8440A140823E8D37C041B5BC703E93413A450D388140B844EBC20246DF427B3DED38923B0F385BBD19BF4E3E93C4F641D2C7233F7ABCB83EB3C008448F447BBFCEBD7C340C3CAC2A1146233D53B6A33F30386F41DF3DD8C0DBBD7B41D6C174372A3C8B3A313D79463043263DF841A143D2B8EEC1B54117409543E03C753D87C17C3E7CC3D0440E43DC370E38363778BFC1C17F4109BAAAC4C5BE58BC6D42643CAFC6CF3AB441C03F06B97E410343AEC165C45CBC504393C076C36FBF3939B1410D458BC2AAC5D035A644773D714000B9CFC0F741DAC32043FE3D45BDCC432CC5AC4350C4F124EB3D25C2E0384CBA3A40A341E2BB3F448F3DB144F04001B874BD0741863F19C5C5BA9842F1BC923771381A457F3DD2BCCF4167C004C305BC04C1A4C1782F99345BC6E941C43E8F3AAF3E80C05DBF9B4492B7FF30FD3BD2425A3BDEC2D6BE02C4D23FC63739C67B24B0B504C202C42FC09CBCE8C58E3D8ABD533D25484CBB3AC341399546CF3E7B38"> : tensor<3x5x40xf16>
    return %cst : tensor<3x5x40xf16>
  }
}
