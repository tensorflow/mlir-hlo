// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x50x3xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<32> : tensor<1xi64>
    %0:2 = call @inputs() : () -> (tensor<1x50x3xf64>, tensor<1x3xf64>)
    %1 = call @expected() : () -> tensor<1x50x3xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      stablehlo.return %arg1 : tensor<f64>
    }) : (tensor<1x50x3xf64>, tensor<1xi64>, tensor<1x3xf64>) -> tensor<1x50x3xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x50x3xf64>, tensor<1x50x3xf64>) -> ()
    return %2 : tensor<1x50x3xf64>
  }
  func.func private @inputs() -> (tensor<1x50x3xf64> {mhlo.layout_mode = "default"}, tensor<1x3xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x10161F0B312A1C4023B71F3A05F618C03AC3793F0DB1F1BF521F17078EF214409C77A758FF4DD2BFBADB8FFB61CCFE3F95BEBAA3BF8C0C40E8B90393B2E003400E68B35F56A7FABF2E751769455F17C0AA9FEE3E53BC08C0EAA79FD4D27F16C0089D279614C200C0E8434390FD9F01402C0E939D6D950C40A2B4D0B5DBAAA13FB621610C63BF0140B6BC7F8FEE440F406913E17A6E2AFF3F7E91ECFC9969ED3F32FCEB9C43060340CE1BB63B49D7FCBF54CDDD0C4808E9BF2A01F2649027EE3F04270103816311C08AF9AB27F1D1F1BF82A07EA3CFB11A400588E56C5CF6EBBF0FC7298742810440D7DD23F6C410DFBF9B7C38B0833018C006234E41395A0C40EA895A2777C615C0B0B60B49890EE9BF94856286D32FE93F8AC5C449C843D63F44F5EB6F0D94DABFD35EA5F3355CF1BFFE6F57FA3AE5184094EF8586A806FD3FBDC55A302618F4BF7AF1AFFB91A90CC0F0FA4B6AFCFB00C0B28F987CCF2DF43FCB0DFE1C6222F03FA0D2B53C77AFFEBF22BEB8AE1CF009C018F51523AF440FC03E04F29D6CBBCF3FDCF7E548D7720EC072266F40C85C09407E090365936E17C080DB81CC4248E9BFFFAF295A93AE0E4008538C440BD5F53F6035612031E409C0DEFDE0897AB501C0E8A9C1C1E6B711C0B0AF63BB96DA0FC09B7286519BC506406862534227480640382517535CDA14401767852143461B408E2ED0042A0AF83FD13CF779A3D1F4BF44E6584BF7D4D43FCB6E2159755D16C08C39B55790FEEB3FBD703B6F031454BFA4AB7A08EA6B11C014FC0DF94A8712406A5BED1BEB800F408802103DE53AEABFFE065A5C1C6F0440CFD1EC8AFF810AC0B6A0070AFDBBE33FBB8058142FF4F4BF7C1E803B389B04405BAF4449CE69FD3F9A14C151612B0EC0085C02BFACA916C0F1F45B925E61F0BFBA1FD0F596890EC0345FC2EABAF3FBBFB74BD56F1A22FEBF6A3B9B20241E0E40B26E7B892ECFE8BF48C3ED11C24114C0C76F9390EC1D0340A846B805377F07C038D140BABDD9EE3F9B3D233B66AF11400ABAFB91C4EAE53F98382A6CC9EF08400AF0DB9DE5E815402A09F93F64AEE5BFCEBFB43C0FACFA3F96B9CACA351415C01A3E063E5330DCBFBD5EBA9BE75E1AC0A9F13625397110C053F4CC1FBCF81FC0248222CB71A9EABF3E066B3215CF1CC073B2632F61071340D4BED3C19DCFF2BF8CE5039A451C0040661D68C1CB06F03F9890F31E587CF7BF911F6A9F38A0DE3FB35455A3A932E3BF18D4E99F20FDE5BF7854AD1D974E0E403168B1D2C422F43FECAE8544B1E8E63F1AAB6F8AE3D9D1BF0E2BDCC463A100C0FE07568B0913E7BFF416F6C4695905C096EF5D7DEF0DF23F363F64494058FFBF3C948A809332EBBF0696EC132ABA1A4022E9278AFD2BFFBFC10FA858BBADE6BFCB9A8291464F1040F2678F05BEDCEEBF8A8C030A3963BE3FD68DB17CD5B3F1BFF3DF46165C1E02C01789EFF2CF5D1140A873AE977EECE6BF58B6A8358CB6DFBFFC8E35296784FF3F98A0D0D73E580140D47D5B42E1361CC0D44611A400ECE3BFD7689A9B69510440B99006C00BD718407B708A85B68B12C0F989DCED95020A40C061FA04EE03ED3FB15F635CE3F105402063957F95F7EB3F7507A2C38AE60840CA617DC4E89CF63F10462AD325BAE03F3D5D563982E0FBBF2C6CC87BBBED10403801F34DBDABDF3F"> : tensor<1x50x3xf64>
    %cst_0 = stablehlo.constant dense<[[3.3018082689589168, -1.6995670439616246, -5.8434561376198069]]> : tensor<1x3xf64>
    return %cst, %cst_0 : tensor<1x50x3xf64>, tensor<1x3xf64>
  }
  func.func private @expected() -> (tensor<1x50x3xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x10161F0B312A1C4023B71F3A05F618C03AC3793F0DB1F1BF521F17078EF214409C77A758FF4DD2BFBADB8FFB61CCFE3F95BEBAA3BF8C0C40E8B90393B2E003400E68B35F56A7FABF2E751769455F17C0AA9FEE3E53BC08C0EAA79FD4D27F16C0089D279614C200C0E8434390FD9F01402C0E939D6D950C40A2B4D0B5DBAAA13FB621610C63BF0140B6BC7F8FEE440F406913E17A6E2AFF3F7E91ECFC9969ED3F32FCEB9C43060340CE1BB63B49D7FCBF54CDDD0C4808E9BF2A01F2649027EE3F04270103816311C08AF9AB27F1D1F1BF82A07EA3CFB11A400588E56C5CF6EBBF0FC7298742810440D7DD23F6C410DFBF9B7C38B0833018C006234E41395A0C40EA895A2777C615C0B0B60B49890EE9BF94856286D32FE93F8AC5C449C843D63F44F5EB6F0D94DABFD35EA5F3355CF1BFFE6F57FA3AE5184094EF8586A806FD3FBDC55A302618F4BF7AF1AFFB91A90CC0F0FA4B6AFCFB00C0B28F987CCF2DF43FCB0DFE1C6222F03FA0D2B53C77AFFEBF22BEB8AE1CF009C018F51523AF440FC03E04F29D6CBBCF3FDCF7E548D7720EC072266F40C85C09407E090365936E17C080DB81CC4248E9BFFFAF295A93AE0E4008538C440BD5F53F6035612031E409C0DEFDE0897AB501C0E8A9C1C1E6B711C0B0AF63BB96DA0FC09B7286519BC506406862534227480640382517535CDA14401767852143461B408E2ED0042A0AF83FD13CF779A3D1F4BF44E6584BF7D4D43FCB6E2159755D16C08C39B55790FEEB3FBD703B6F031454BFA4AB7A08EA6B11C014FC0DF94A8712406A5BED1BEB800F408802103DE53AEABFFE065A5C1C6F0440CFD1EC8AFF810AC0B6A0070AFDBBE33FBB8058142FF4F4BF7C1E803B389B04405BAF4449CE69FD3F9A14C151612B0EC0085C02BFACA916C0F1F45B925E61F0BFBA1FD0F596890EC0345FC2EABAF3FBBFB74BD56F1A22FEBF6A3B9B20241E0E40B26E7B892ECFE8BF48C3ED11C24114C0C76F9390EC1D0340A846B805377F07C038D140BABDD9EE3F9B3D233B66AF11400ABAFB91C4EAE53F98382A6CC9EF08400AF0DB9DE5E815402A09F93F64AEE5BF34BA26741A6A0A400CCB72366D31FBBF0CC03AF7B25F17C0BD5EBA9BE75E1AC0A9F13625397110C053F4CC1FBCF81FC0248222CB71A9EABF3E066B3215CF1CC073B2632F61071340D4BED3C19DCFF2BF8CE5039A451C0040661D68C1CB06F03F9890F31E587CF7BF911F6A9F38A0DE3FB35455A3A932E3BF18D4E99F20FDE5BF7854AD1D974E0E403168B1D2C422F43FECAE8544B1E8E63F1AAB6F8AE3D9D1BF0E2BDCC463A100C0FE07568B0913E7BFF416F6C4695905C096EF5D7DEF0DF23F363F64494058FFBF3C948A809332EBBF0696EC132ABA1A4022E9278AFD2BFFBFC10FA858BBADE6BFCB9A8291464F1040F2678F05BEDCEEBF8A8C030A3963BE3FD68DB17CD5B3F1BFF3DF46165C1E02C01789EFF2CF5D1140A873AE977EECE6BF58B6A8358CB6DFBFFC8E35296784FF3F98A0D0D73E580140D47D5B42E1361CC0D44611A400ECE3BFD7689A9B69510440B99006C00BD718407B708A85B68B12C0F989DCED95020A40C061FA04EE03ED3FB15F635CE3F105402063957F95F7EB3F7507A2C38AE60840CA617DC4E89CF63F10462AD325BAE03F3D5D563982E0FBBF2C6CC87BBBED10403801F34DBDABDF3F"> : tensor<1x50x3xf64>
    return %cst : tensor<1x50x3xf64>
  }
}
