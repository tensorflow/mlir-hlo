// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x1xi64>, tensor<5x2x2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xD819FA64341608409C14877E9987FDBF60B65634A4EBDABF90D07D72CA40F83F15A5D779235DF23FBC810C23E92BD6BF49BCD9B457CC97BFAA0A2585B182EFBFEA6CE3967C77F7BF0E555F7116E90040B86BA0FC74930EC070E62BEC452DFCBF227827EB6389F8BF4D530833DEC817C05814951BFE5FCD3F646794D3848416C07DBD521837F7144070483BB91F0200403C7B45124B60F43F104735CEC978DB3F1A30A7E4B0C5FC3F5092A14A54F101C011BBED9A5FFDE03F08C5CBD1F28801C0FF8997F0A560F8BFAA7038D7F59D0240E0A3A6247C541240669DE244759C0E40496CC9BCE2E3FB3F4DC4F53B065D17C0F1D0F8B1370E004032C1FD674987E63FA631E1DEDF73FE3F093D374B3DEF11C0BEC5D7E6EDEC0E40DE871324635D0B4020DA65881B7407C0A028D498478A114071F1E8B6EA6417C0E89BBDFC37F10740FD377804C231E0BFB7456876ED7AE0BF4E75B66076E0F53F8646C0848712F33F5EFEA4E65B7DF33F061DF65FC350084085428EE87D3906C0BE58502614F7FEBF3BEDCB801BD2F1BF248D264E9D68F1BF9113DEF8A313B7BF1E2814AF462ACABF7BBEECCE841008C022AAC4EB75380EC087F2B09C159BF2BF64DAAF01176B05406D54745B4786FFBF64DB340A3217D33F0A0216FED6810740D211EBADFE5B14C01C300C9801050FC079871684FF1200C0B2AFCB0128FCFE3FC792FEBC705613401B723B777BE0084076798C42D37805C041D885E70C4CCD3FFBAF17604776CC3F88F23BFD906B03C00507A3C533C40AC0900968C5901C0B4086DBA4171DE1FBBF4C07E0EE5001F73F40636857C2DBF9BF1495D0143446D03FEA9251C65D1F1340928FA1725607F5BFB4EB16035CDE1A40C0AFD5FEB26603C0B291E71F0924F83F32DCB9F4CC8F07401088E59F6ADFF0BF9457FFF872D506C0024CBED1622201407A104FA572510C4046BAA2F62332E23F72E4A4B5FE4DE5BF281A18C30B290140C256ED5E6EABE13F508E873FDA70E1BF185FE8E0FC73EFBFEAE5233D1C0F01C026221D618F92F63F78980AC9C30508C0CB3C18BC6D58DEBF6E778A75704DE8BF9AA2D0BC8F36CEBF62464F803B621AC07C70EF39FF3712C0542B0A269B5911C087B8B23014D20DC01ABF9DE8A4EA04C055D298B1748300C0F87E4E33BF4E0140D61ABE4967DBD13F1564E995444D03C0937479A7491B08C04A8D46DF62AF0AC0FF976F7EEDADF8BF58721A640835F53FCA09BAE17EB600C0BEFB0E53FC0B07C0F87DF7BC0ED303C07A3DB0AF286202401956BCB93679044027A48408DAE216C0BC7AC13595F9FE3FF6EEDF010BC3EA3FB7A2E27E7096F43F7C0490E13E7FB53FF56DDEAFA5F3DA3F5E24F756D4FE0140B2EFE22C0F18FC3F5342EF5B62AAF53F59F8FE4FC4421540B8ECEF93642E0CC06415713402B20C4016C6E3001D3703403069E1D12B92FABF7D2F74ED0867E5BF70079558F33BFDBF6883FF819BC0EABF7A80F96FA59F0BC0FFF56156FCF8F5BF422FF8A77B4501C071A9B1ED189CF13FF7D88B2902DFC73F5D7C3272B7EB03C034CEBC37F377C7BFC2FB5039234C0340B8580EF3632E06C0B99B1909B6B4E33F65FCD08C061FF2BF0181B7F742C1064020FFF7D0DC3012406C84821068FBEBBFEF78B8A3647D00C0BD23F8BDD5FE18400D309DE39AFDF7BFA4D61AAE8E5C1540672A8D55F0F9F9BFA7FEBBE6C765C7BF5A2965045DE721404D6D38B20964064054A4DF77087DC3BF50F242DEC18FF6BF8FD69A5B168612403D1B94AA37C9C4BF4460E0DF50E80540F654D3E4CB551040B4F645526D55E13FEE443B91D1A70DC01EEB29C86B780C406CDA2382FC0E0140C96522AB61371540435ABC4EB7D0D3BF55758F064B7D1340DCFD840B206EFBBF4278E593D4230B408C3C27D0FE8322C0EFE66E6D34C7F0BF104DCCAAA91FFDBFC42B7D480E3FFF3FF25BDDD1CD7813C0DCE08C27858410C0D0E36187D59517C0393F77E59960F83F82B1E0507EF9D4BF04D50D2DBA9CF4BF71C5CC5AE6DF11C00FE1D5C3325E12C0C2B0C64A1D5317C0DBD4244F080401C01CC26936D49AEEBFD4F0F1D530030AC0C2C854793D6AF6BF80EAC603685FDCBF443470AFB826F83FF2AA19FA8E0EF4BF1D60C8D04821F23F89A7272FE83ECBBFBCD2418BE296144040BBDEB42DB1EDBF8FFCDAE86FF708409ECFCDEE30F8FA3F808A9734D2E2D7BF05E44BC7C7E3F6BFD3FDA5D11949FE3F4A1A571C0F670AC03268DA00AA4BEF3F50DCF82D073301C01657B6FBFF3A22C0B2CBEA0E2CE614402DC30050E03C00408C29090E01A8B93F5E0D14FD2EE601401A2969F42A9B1240BBF09603100F0FC0BE9AF208A73E06C092F087F31DDB0EC0"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<"0x1892B041C3680BC0E3BE89543EB706C092C029C8272BE43F46A59D993C142140BE21BECB6117FB3F6A5652803E14E3BFAE16D12E5987DCBFFACCB41F79D1024062A690D008F4F13FCAF3401D7FBB0140CB4A8FE1ABA60A40671B5C68E44D10C0DE459B08F7E2EFBFB281689EC380EC3FA2D72D064FB3FE3FC3D52208666DD2BF7963C306074110C0CE3FD043A40B0DC037C94EA8DFEB0EC01564C3C3F7CED13FA6290AE0DAC5D4BFA27DF226EB7D0CC0F0C3BB158A4D0CC04F47553E851EE23F5C38EF36A2D11C4088AD502F3E5B00C01EA3CAC3EB14F13F2FC97CFBB436F1BFAD5F786E03DC1240B649F35EEAFCF53F9A4378B2038B03C06ADCAC0D410C04406338D2530621F73FD4ADDF2A74D805C018F34FE564D9F0BFB90CC8C9B923034010C1D6D5D0701840C6C75E0D1392FEBFADCA8164B7ADF1BF25AB4C7B442611C0CC8D0672661810C0E44751D0688EF13FEE42FF53103407409832A33FE75DE4BFB04FB7F7C49B0DC09FCA35F154FD1FC006CD34FDE2E10DC09483CFC57C0A0340755C7CD3DAB605C054DAA359E7BDDFBF0126FA9934A70A40880A589C8B4DF0BF2469B7A8D929FEBF5344AB192C0208C0729BBDE79C4304C0005952B374F4C93F6B4BBA39206208404A916158691603C03A7F783EA04DF5BF7555B70C0C1D074004419848BC9414404C705B8502D00EC00CF0044673F8D7BF3A85652E61F807C0B4FA313D4D3403C0197BEDDC2E4AF9BFF769ADAAF416F1BF7E9B1C4664550BC0B046DEA59DF4104034A75A1B2976F93FEFB6F0F100EBF23F20C0F6AE0DF4FA3FAEA4E0CB5F6DD43F2390BEF87DB3FE3F9E907A127DAC14C0E871287DC48E01409F70B86EB4D3FC3F0A1009A39EA7F93F3073B42774CAF33F0435D906DCD7DE3F92761BECDE0AB33F869B1BB05CB4E3BF1E3BBA6FADF0EFBF6C7BE971FAEA0840E5F1BDF83FEB1C40D59D06A5C8FEF2BF1062EC5C50DC1DC019E68C4BA7FAE23F3E3407160B4B18C0CAEF91CA5A06EC3FE2C77C82E2ABF73F72DD1B20529216C04A214561645CF03FAA0CE1DE4953EA3F7A8B5304C494EABF4224CD0496620EC033A348A4379CF1BFB0CFF2FFCA0F144046E8F65346B91A407B69453FAB58EDBF6F329DA3A4DE1040FA29D55166C7F9BF7617692E588E11C026CE478E686103C0C26A39CA2B4E03C0E85C9AAF01570D40E8A1B1C8CBF11740D292706B6FD80AC0298B05D2C99B0D401E71DE997DA9F43F0CA7DC5EC2F9FABFFCB3A7CB68DD00C0CFD0B4502A3302C06694D415FA93FF3FF0BE675D0FA8E13FAB1BD9C61F4502C054927122B9800F406FA4792493B9F63F026E8281EAFD18C0E06F99672BCAD23FC6245D9CF1EADE3F269F22E9E413CB3FC1842E792B6901403ED9FFD292DDFD3FC8CB8781C13D0A4046B7897AB9CAEC3F49736ADF7A50B5BFC43DF2FB914C04C0DA5DC5AF1985044025203CB538A0D13FC2C08415B83D23C09689B6E092CC01C0FB1EF9D8EC4FC2BF27D391F3293EDBBFF8B9A9EA80F3104006137E02745B0A40D6D38EA249BF04409B4A907C87A0D0BF6432267A317D14C014EEE4535601E7BF"> : tensor<5x2x2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x7B7C3C5897A124C06BE7848152F614407D88F0BC94F7D0BF657E86F283E32940150A1AFF0118FF3F647303593270CA3FDEA766237537853F5854BAB7C88702C07A76F279DF54FABF2697CF67D2BD1240A8B69F37107729C03A5A990972B61C4043AA8F882073F83F7FE73A4B772F15C0A975EDB9972EDC3FFE642ACF0BEFF93F34642A9D6C4C35C0F736294F7F0F1DC0142EA6F277B013C03E8022FAB293BE3F7E321E6474ADE2BFA7ED549988F31F408C26A64BBD0DFEBF452E01FA83DBF3BF485D710144F425C085059798200813C037074C9BBB91134011DC2273737710C0496CC9BCE2E3FB3F4DC4F53B065D17C0F1D0F8B1370E004032C1FD674987E63FA631E1DEDF73FE3F093D374B3DEF11C0BEC5D7E6EDEC0E40DE871324635D0B4020DA65881B7407C0A028D498478A114071F1E8B6EA6417C0E89BBDFC37F10740FD377804C231E0BFB7456876ED7AE0BF0907A13958C91940D603D414CD35FA3FA0FF2DB132CE07C09FA45DA793771E4026CDFC2D421010C0F31F4D6A99231540C4D562763DC4F23F39750FCA19D304C098036D5216A0E1BFC755AABA12FFD83FF35CF28BD3960A40E975B45D22323040E35B5E5E75B712402A55EC2C6B8007407FA89393CDDB16C087E66D4A094DC8BF425DE07018C025C0A75BFE184C5A44409C26CEAD80F72C40A7F283A6182113C06D804F47880615C0DD1F1C8F7F2E03C054F2B2B960B824401842B816E4E0054029CFC4CF9C9DDBBF2DA6FE25A45AE5BFCF1FBC1D86981840D067641AC2B5E5BF900968C5901C0B4086DBA4171DE1FBBF4C07E0EE5001F73F40636857C2DBF9BF1495D0143446D03FEA9251C65D1F1340928FA1725607F5BFB4EB16035CDE1A40C0AFD5FEB26603C0B291E71F0924F83F32DCB9F4CC8F07401088E59F6ADFF0BF9457FFF872D506C0024CBED1622201402B249EEFEB932540801AE37307B5F5BF305B5407BB5DEC3F8B7D303A28CA18404A3013A28BBA0640BA8BE8852BCB00401B691DF7918FD73F3328AA6A8A8E1940C27FF58CD3170BC0BF89F47731FC1240B3247D1BBF34E03FBD9B23BD30C20440ED70B4BE3C02F0BF0DF0109C2AFE24C0EAD74DA9968A15C0ABB95C72413A1DC0C58CDF783909F3BFAA4FB47B4D1114C01D40861A58562540E6E973931AFE124042B382C11D16E03F4DC2CC05F1F20EC010FA6AFA6ED10DC096091C8D6EB8F9BFF88F02944E5FBDBFD6C4A16F091EEABFDC6C41377EAE0040735E184339F221C0F87DF7BC0ED303C07A3DB0AF286202401956BCB93679044027A48408DAE216C0BC7AC13595F9FE3FF6EEDF010BC3EA3FB7A2E27E7096F43F7C0490E13E7FB53FF56DDEAFA5F3DA3F5E24F756D4FE0140B2EFE22C0F18FC3F5342EF5B62AAF53F59F8FE4FC4421540B8ECEF93642E0CC0C94D968BB6EE394031378984FCCF06C026470D5E67CB2840718E1DBF3363D9BF75D58225853126405F27F715D86DE7BFB45FAE8C1F6F14C0CC6780BD4BFF1E4060B9428A37A901C06204119153F9EC3F4B38E9642BD4C3BF1022C6405BEA2240AD23E48B95D4C93FB0F5993E3832284095EFFE261E8632C02C817B615F12E2BFBB0F047F2F1B13C04E1532ECC65412C08D8B4887C0F533C0C627BC4A73F2004039EE71EE77E51340D23C66DAE7EA36407AFA5F118EF321C087925411AFEB31C0C7A41046F80818C0CE6B0C9C1437CEBF75C9263E712F2EC02C0A651FE29917C054A4DF77087DC3BF50F242DEC18FF6BF8FD69A5B168612403D1B94AA37C9C4BF4460E0DF50E80540F654D3E4CB551040B4F645526D55E13FEE443B91D1A70DC01EEB29C86B780C406CDA2382FC0E0140C96522AB61371540435ABC4EB7D0D3BF55758F064B7D1340DCFD840B206EFBBF2073ED2219DF1EC0A7900AE87D4532C0C6B37677E383E2BF0B1391A1B8A01040E2AE87D5C6C21E40D0BEA1DEF2A71BC0342FA34CE9CC394048EC7FDB93B2FBBF6FAE22BB8A8DE73F94ECB0C18CBFB1BFC1E3F756026E06C0A9E89314ADAE20C06EE5BDC4F71F2EC04B7A287C7DFC14C021D4C4BDE1AAC63F90098BF8FF6903403C7610AA30AE20C0AAA0642957B1D8BFDBB42FD85E0F1140BDF0AAA1EFDD0AC09E7B09A291F4C63F7180C4639BDEDEBFDA534E1C8FDDECBFB943F1C96FF530403F89E06C3A4003C0CA9112B2EDF1E9BF22CF62C7A14421C0A8B0929C062CD13F05E44BC7C7E3F6BFD3FDA5D11949FE3F4A1A571C0F670AC03268DA00AA4BEF3F50DCF82D073301C01657B6FBFF3A22C0B2CBEA0E2CE614402DC30050E03C00408C29090E01A8B93F5E0D14FD2EE601401A2969F42A9B1240BBF09603100F0FC0BE9AF208A73E06C092F087F31DDB0EC0"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
