// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xui8> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xui8>, tensor<20x20xui8>)
    %1 = call @expected() : () -> tensor<20x20xui8>
    %2 = stablehlo.shift_right_arithmetic %0#0, %0#1 : tensor<20x20xui8>
    stablehlo.custom_call @check.expect_eq(%2, %1) {has_side_effect = true} : (tensor<20x20xui8>, tensor<20x20xui8>) -> ()
    return %2 : tensor<20x20xui8>
  }
  func.func private @inputs() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}, tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x06020103010006010000000000020400010200000401050101000201050000030401040101030202050302050201010201010300010301000102010100020104000001020400000402020303060400010100040403030402020302040001020004060101000402020000050105060000070201040001000101000400010203020003090301020003040605040301030000050301020201030004080203000302020200010303000402020202010000010603050300000003020005010103010001040304000104000200050401020404000200020202050300040202020105010005020100030400010304000101020001050600000300060205000100020000020205000000010401000003010104000200010101000100050202010501030304000302000101030301030100000206030201010002040302000301000200030000040405020003040703010400000202000300030000010003010402010102000104020504030302010203010103010200000300000402000403020103040002040700020500000101010504070504"> : tensor<20x20xui8>
    %c_0 = stablehlo.constant dense<"0x02000201070401020101040202030401010000060206010204060306050303000401010204020201010300010103000000040004010401040000010600020201070202000301000000040002020100020004000102020003000905010303010000050301010000000106020002010102040304020301000102000301000303020400030103010003050501010401010200020403030506000300000003060203050102010202010300050400000103030004010003000203020004020904000300010100010506020000000200020300060700000102030100060200030100040301000000030001030101010103010801070301020402010204010100000302000104000304000101030402010003040106020300010107020106000401020001010101000101000001020401010400000201030101030001010103070303020502020203000101000503000305010000010604020405050601000100010101000000030401010201010003000502010102060400020200000302010501000100010102020101030401030001000002"> : tensor<20x20xui8>
    return %c, %c_0 : tensor<20x20xui8>, tensor<20x20xui8>
  }
  func.func private @expected() -> (tensor<20x20xui8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x01020001000003000000000000000000000200000100020000000000000000030000020000000001020002020100010201000300000000000102000000000002000000020000000402000300010200000100040200000400020000020000010004000000000402020000010101030000000000010000000000000000010000000003010100010000000002020000010000010000000000030004080200000000000100000000000002000002010000000600020300000000000000000000010001020104000000000200050101000004000000020100000100000002000005000002020100000400000102000000010000000000000000030000000000020000020100000000010200000000000100000100000001000000010100010000000302000101000000030300000000000006030000000001000301000100000000000000010100020001040000010000000202000000000000000001010202000001000104000002010001000200010000000100000000000102000000010001040002020300000200000000000502070501"> : tensor<20x20xui8>
    return %c : tensor<20x20xui8>
  }
}
