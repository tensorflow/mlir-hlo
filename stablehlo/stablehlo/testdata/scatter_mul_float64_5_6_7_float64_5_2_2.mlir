// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x2xi64>, tensor<5x2x2xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x365C7998D967F93F137EC60B7C4D00C00AFAA09C92929EBFBAF2B1B175FBF3BF5853A50CB68CAD3FD8FCBBCBACBD0640260E696A47AC03402A9BB9CD8B7F1B409988994FEEDED13FBCCB23AD8ED8ECBFE8AFF94FB62D05405F0CA860DC3611401C43F55AA05EF8BFAAE599D450B503C0A6636BFC4DF6EDBF46102D672886E5BF94A9929E384DE2BF1A1A3A2BFD5E0140A84FC4BCA070ECBFF8A12C06D68ADC3FB2E4F54DC28BF1BFF2D9B068204A1040D2A88A2EB5770A404C85114E855FC63F7CC4D418EA8507C04C33A4E1E519F43F380DE4D364230240268506322339F3BF16E5D949F3EF19C0301E6FD1F817E1BF78BD27FBFC02FDBF892E77B87A06024022368E91BFE90EC06446FF68D2B019C0E085970B83A26DBF4984CE5C5B0AF1BF4DAB83748DA6F0BF16640E3A88A80B40E4FE11F7395EEC3FA3D923D81FBFEA3FF26C051E4FFA05C0553D75AA837011C09A6CF4CCB8B9ECBF1BDA2DA441FF0B409A083C0CDEFE11407BD9D75EFDD805C05DF91A40110DE03F51129CDBD8F003400606EBAA8556C7BFD811C0FE17790EC05AAACB4F8340ECBF8BFD10370363F73F1B9E89476FD9DD3F2E43FA46F3850640F62FE4C6C0D80B400CC4E8F5881FD1BF8AB2B94E0B11EEBF8EC4256B8944F3BF147AB4459BA8EDBF7E09DAF4B30C01C03A69A698F627064015B4C08427E1E53FB0AD7E115F3D0BC0FD31F5C9F62001403AEC7E03B09B03C031C9BB3D5EFF03C002FBDFE37452DBBF6C711447BC90F33F4A641B8C83C713C0173F41F4CE32D6BF8CD07652AA96D33F4E0EED85A93EF8BF788E15768CFF04C0CCDBF1ABAC9FF7BF43C16A7DE48613406A167CB726C0004074F2BC17D9D70D4078E2FDE730A50540268660458545D0BF68812C9F81F9DEBF1031DF984C2CE43FE4A87DC8F83E19C0E7FBE2A9A3510540149759E40A5FE7BF962B68929862EBBF0879B7F626EDFABFF7C5FD0A2BFEF03F662FB1420E0BFBBF5DF30A29B124F0BFF8897B83A4AA03400EFD462C63BE0E40600654A1080EF6BF64F6C2CE8049044010DB0A48A5E013404C91A695F9441C4086A23A89FA05174038868045F5FE10C06238D5E0F7B702C0D2645E9B86B2FD3F5F41114028A0E4BFDA37885D43F2BCBFDC742D27F6B50040E00A9D15BF76E2BFEA6888DAA289DEBF02E0B502319CF1BFF38E97BFEB1008403241739382FAE5BFFE83BF5242DD11408C8A76C5DADFDFBFE2034BA6337313C0CA39303F06700740E7652DBD417C16C0F3FAB130CAE8D53F2A6D60089A1CFB3F433CCA2ABA3AF23F9103B848586FF73F98D941BF18E401C0062AA08E6F0AF73FB01F520A9EB1CD3F8A191A7053E509C044EF85C84B670140D13B2789AD13FEBFD8A76C21992B03408B67BC9C4494FABF0391AD6CAD8A05400F0E7462301A02C0258E2034AD65F7BFA4E4CE553934ECBFE0BA73704ECBC73FE0EA936B36FCECBF1C30375493D1F63FF8D18980A21EBB3FED44F6840B3006C09D29146FDDE3F1BF845AE274289A15C0CB92A0BB6E0211C0FA928E2F5BE909C044BFC0B2B65103C0F6B2C80C18CBEABFA3908E2C032A1040BCDF64BBE19215C0F4904AC9C262E33F8B899A6AF90DE5BF953BDA3C037814C01636B252AF84154048002E212CF40E409C79B0089CB7EFBFAEF9676EDF7012C0A846970499AA14C05B2F95AD6E360440CB42C8AAD80702C0A73E3A5D43D010C0723157647477D0BF2EF29F56E01DF4BF7BC4DABA25DC06C0AE3BD7D0CF8BC33F34DCF28DE06406C00A0642A15BD9064073877327BF76E7BF80F495CE1FD4FF3FCD9554F3DDA559BFA8760E245BAEDEBFCEF066D6CB67F13F2080B8C8F3A31AC0F8767B57F08204C03B268D081B14E63FFCF4D137EB91D3BFE14F53FCCC080CC096220D6C723DDE3F153370AADA73F43FA8B1EB93AD3D10406451E1FB5BA5F9BFB2B91C9505A012C0FA1464DFB817F23F649B73A1F0380C4065253CBB5114E3BF76CF00250872EF3FE25CA80A7E30E33FF8EA567C0CFFD5BFA416EA31227FFA3F564A0B0F7DDEEC3F208EC581ADAFEFBFCB1E7AB3912FD0BFED957F85897DE0BF60266F13D35E13C07467308AE5B8DCBF1A5CE2C3B03504C06CE6C3E5F31ED23F1D17FB3B4041F33F1541C2D3EAE8F73F74247B6A293F164081C47671C6DFF93F46801C39583DE43FE7DBBA815B5D12C080DCA1AE5732A9BFAB30308E6E79D23FE29C98002C921340398830E1179D1140BBB146A1A623FDBF8A798BA03B4901406342B5486CB1064052B2783535CB0940C24CB62084E509C03895B3B30B56FD3F0F9A83BA29B60AC07F71F245AD73F43F55BB585A30D70FC04150D80FB5B10240CAF701CE5AEC08405405A64681E40240"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[[-0.70812381932480761, 4.5547296433774269], [-2.4227548448377902, -4.0561687967762143]], [[4.0785973150282215, -0.64336943328055496], [-7.0321171918869965, -1.5486892173363178]], [[2.5300188320092163, -1.2463151055749064], [0.063854068729195412, -2.5211895849264305]], [[-0.78612193254623086, 2.4372070710741887], [2.4373889910680901, -0.76698390735421396]], [[-1.2098141810970025, 3.3489574392129855], [-0.002857589794523073, 0.47673284770215529]]]> : tensor<5x2x2xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x365C7998D967F93FAA228909B016F73F0AFAA09C92929EBFBAF2B1B175FBF3BF5853A50CB68CAD3FD8FCBBCBACBD0640260E696A47AC03402A9BB9CD8B7F1B409988994FEEDED13F15E382B440400D40E8AFF94FB62D05405F0CA860DC3611401C43F55AA05EF8BFAAE599D450B503C0A6636BFC4DF6EDBF46102D672886E5BF94A9929E384DE2BFE1EC4345B5C72340A84FC4BCA070ECBFF8A12C06D68ADC3FB2E4F54DC28BF1BFF2D9B068204A1040D2A88A2EB5770A404C85114E855FC63F7CC4D418EA8507C04C33A4E1E519F43F380DE4D364230240268506322339F3BFAA0C37667C6B2F40301E6FD1F817E1BF78BD27FBFC02FDBF892E77B87A06024022368E91BFE90EC06446FF68D2B019C0E085970B83A26DBF4984CE5C5B0AF1BF4DAB83748DA6F0BF16640E3A88A80B40E4FE11F7395EEC3FA3D923D81FBFEA3FF26C051E4FFA05C0553D75AA837011C09A6CF4CCB8B9ECBF1BDF8C93168C2C409A083C0CDEFE11407BD9D75EFDD805C05DF91A40110DE03F51129CDBD8F003400606EBAA8556C7BFD811C0FE17790EC05AAACB4F8340ECBF1CC926CA021C02C01B9E89476FD9DD3F2E43FA46F3850640F62FE4C6C0D80B400CC4E8F5881FD1BF8AB2B94E0B11EEBF8EC4256B8944F3BF147AB4459BA8EDBFA21F80A13BF0F53F3A69A698F627064015B4C08427E1E53FB0AD7E115F3D0BC0FD31F5C9F62001403AEC7E03B09B03C031C9BB3D5EFF03C002FBDFE37452DBBF6C711447BC90F33F4A641B8C83C713C0173F41F4CE32D6BF6944D7DAF63701C04E0EED85A93EF8BF788E15768CFF04C0CCDBF1ABAC9FF7BF43C16A7DE48613406A167CB726C0004074F2BC17D9D70D4078E2FDE730A50540268660458545D0BF68812C9F81F9DEBF1031DF984C2CE43FE4A87DC8F83E19C0E7FBE2A9A3510540149759E40A5FE7BF962B68929862EBBFDDE13483F30711C0F7C5FD0A2BFEF03F662FB1420E0BFBBF5DF30A29B124F0BFF8897B83A4AA03400EFD462C63BE0E40600654A1080EF6BF64F6C2CE8049044005FAE15DB80E29C04C91A695F9441C4086A23A89FA05174038868045F5FE10C06238D5E0F7B702C0D2645E9B86B2FD3F5F41114028A0E4BFDA37885D43F2BCBF30FD2C26B0D304C0E00A9D15BF76E2BFEA6888DAA289DEBF02E0B502319CF1BFF38E97BFEB1008403241739382FAE5BFFE83BF5242DD11408C8A76C5DADFDFBFE2034BA6337313C0CA39303F06700740E7652DBD417C16C0B7F116074E62963F2A6D60089A1CFB3F433CCA2ABA3AF23F9103B848586FF73F98D941BF18E401C0062AA08E6F0AF73FB01F520A9EB1CD3F8A191A7053E509C044EF85C84B670140D13B2789AD13FEBFD8A76C21992B03408B67BC9C4494FABF0391AD6CAD8A05400F0E7462301A02C0258E2034AD65F7BF2AE67AF6F92BE63FE0BA73704ECBC73FE0EA936B36FCECBF1C30375493D1F63FF8D18980A21EBB3FED44F6840B3006C09D29146FDDE3F1BF845AE274289A15C095AFC5338F170A40FA928E2F5BE909C044BFC0B2B65103C0F6B2C80C18CBEABFA3908E2C032A1040BCDF64BBE19215C0F4904AC9C262E33F8B899A6AF90DE5BFEA6AE1787FF128C01636B252AF84154048002E212CF40E409C79B0089CB7EFBFAEF9676EDF7012C0A846970499AA14C05B2F95AD6E360440CB42C8AAD80702C0A73E3A5D43D010C0723157647477D0BF2EF29F56E01DF4BFD0084ED4FADB1BC0AE3BD7D0CF8BC33F34DCF28DE06406C00A0642A15BD9064073877327BF76E7BF80F495CE1FD4FF3FCD9554F3DDA559BFA8760E245BAEDEBFCEF066D6CB67F13F2080B8C8F3A31AC0F8767B57F08204C03B268D081B14E63FFCF4D137EB91D3BFE14F53FCCC080CC096220D6C723DDE3F814B2E1E69BEF8BFA8B1EB93AD3D10406451E1FB5BA5F9BFB2B91C9505A012C0FA1464DFB817F23F649B73A1F0380C4065253CBB5114E3BF76CF00250872EF3F02A75F97E44BD23FF8EA567C0CFFD5BFA416EA31227FFA3F564A0B0F7DDEEC3F208EC581ADAFEFBFCB1E7AB3912FD0BFED957F85897DE0BF60266F13D35E13C0BF99FB6C220CF8BF1A5CE2C3B03504C06CE6C3E5F31ED23F1D17FB3B4041F33F1541C2D3EAE8F73F74247B6A293F164081C47671C6DFF93F46801C39583DE43FE7DBBA815B5D12C080DCA1AE5732A9BFAB30308E6E79D23F347351ED4FA28CBF398830E1179D1140BBB146A1A623FDBF8A798BA03B4901406342B5486CB1064052B2783535CB0940C24CB62084E509C03895B3B30B56FD3F0F9A83BA29B60AC07F71F245AD73F43F55BB585A30D70FC04150D80FB5B10240CAF701CE5AEC08405405A64681E40240"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
