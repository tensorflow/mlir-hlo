// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<2x3x3x2xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<2x3x9x10xf32>, tensor<3x3x4x5xf32>)
    %1 = call @expected() : () -> tensor<2x3x3x2xf32>
    %2 = stablehlo.convolution(%0#0, %0#1) dim_numbers = [b, f, 0, 1]x[o, i, 0, 1]->[b, f, 0, 1], window = {rhs_dilate = [2, 2]} {batch_group_count = 1 : i64, feature_group_count = 1 : i64} : (tensor<2x3x9x10xf32>, tensor<3x3x4x5xf32>) -> tensor<2x3x3x2xf32>
    stablehlo.custom_call @check.expect_almost_eq(%2, %1) {has_side_effect = true} : (tensor<2x3x3x2xf32>, tensor<2x3x3x2xf32>) -> ()
    return %2 : tensor<2x3x3x2xf32>
  }
  func.func private @inputs() -> (tensor<2x3x9x10xf32> {mhlo.layout_mode = "default"}, tensor<3x3x4x5xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xF886BABF2ADC60404BD8E5C01471A83F9FFB18C0FDAF8FC0E1B0D73F52782A40A384B5C006E84EBDDF7D0EC038F79640E091E93F09E28E4057F145C0B0C7FEC06187DBBF4EDEA8405B4F46C07851BDBF49E82D40F7DF57BF513BED3FA7834C40CCB2E63E680B3940D79867C03778C7BF3639E53ECF86A03F962F34BF19B8A64026535C3F8A181BC0C0605F40E0431540989C3A40AB5A2DC0F66ACFBF7AE242C0CC17ACBEC4A2AE3E0CD10840EBF7B7C0984CAB3EDE3C023FFC71883FB9A507402FC8EC3F8ECFD4BF756EB340F491C63FE4EBAB407D0A09BEF9B99E3EAC3CA7BFD1A884BC76D8C3BE81CF5AC0955591BF4AAB634014CC933F286255402B580FBE8F99903FB0EB00C0D6EF383FE195D03F5BD461BEBB995DC0E3CFB93F5695D8BF113314C017F17DC026DE943FD348663F699F2B3F609A15403854443F6B63144005EE02C1602208C030D5773F51B5A4BEAD5B39C07098AEC0753E68C0CB32633F3BA959407238BB4084F6CBBEB0B99FC0B89540407D69B93F65AFA1BFA54A65C04304C94059C69C3F996582BF8F9F694032B9A53F6CB947BF46485A40E16736C050107FC0A20F383FBF6238C08B63B3BFF68DB7BF95813EBF1AC9A4BE252A954068676CC0C68EC2BFBB00BE3F8637224005B260BDFC424E404E9C7EBF513079409815153DB22FFEBFB762DEBEEB4F4C3FBA054B3F7C5410C0AE9802C0EEF76040CE028C4054DF8ABFF8DF9ABE02FF7440E343B13F4D89B3BF252A5FC07CCEACC01C0BA03E09B64E40FF5D1640B0A9194013329A3D0B2DAEC0F299B63E0F6D5B40F5D055C01B38DE3EBE55AE40E67D3140AE821740FBF13B3FC32E66BFAB2741BF0D73F83F8F1F1BC05AD5B6BFFA8CC93FB6E2D73FD0F59F3E4DA3B2C04A8A833FE6F8013F430FBC3EC085FB3F9C2D28C19814E83F37EB12BFB997D03F19022EC0B87F7AC0BF2760C0F1B898BF8B40AD3EC081AFBFA2EC0840011B8A40335BA53F386BDC405A58944075B8A1BFE8919B40E8F4CAB9AD0C0D3F52DD9B3F065280BE01FF23BC2ADAA640FB4FC13F383B15C041F7B6BFBDCBF33ED87861BF07B171405F668F3F626576406DA78D4026520E40597A97406B3CBEBF99A33340FAE00CBF11B674C018B3A44058250640CDF83CBF465C34BF7FE294C0F0490ABEBAA553C0D82138C06592383FDD69DE3FF75E04C09CD48DC0F60BCDBFE68BEFBF7F8B803F47AABC3F3B7B8B3FD2FE9D3F68CA3BBF5830D23F0BA480C08C14F83FBB76BD4047F8FC3F188C06C11DC088BFBC36A8C00C4E8BC0DC77873EDD0CE7BFA31C0AC0B5DCAB40746D27C0140B453F648E9540A3A9573DE22267C00CCCEEBF12BBF53F9B1BFC3F795D97BFA355D33F6D55034047008840760757C060E5984099930240BCF2EA3E2DCD97BFF6DE3540E1FD9140343B1BC05BEC15BFE21AF43F67EB90C0B21E4A400ED635C0AEA5353F80CD91C0F4005CC0B69815C0E7AC273FE8A88540E145A6C0D6FD37C06622FDBF27EB90BF7D652E403AC6884092DF16C0EFD2B6407A727CC050907A404A0D9FBF86728F40B1AE8F40CB64D53FDB0819407B7EA03E7BC0C7BD2523C63E01D017C04D6AE33F530AF8BF8A06663F5DF332C0C11405C04D6AD0BFA535BBBF39820A406AFF26C0C23EB3BF7C09E2C0C28453C015993AC0B1B402C0786FB9BF2EDF58C0667C1ABFBA19F13FD8428EC06B485E40D32F21BE0C6AFB3FBBF7B33EB673A8407DB09CC0FE291240610A8840358F92BF5D1231BF56ABB4BECF1C8EC09ACE233FF93B3F40E843FF3F0EFD78BF5C26AB3FB8CD21C096C7FE3F6B232F408446A3C0BEE3A93F4D203BC0E3497AC0D6509A401A5EDC3FEF86934082F893406552C4BD2C1FFEBF1B883D40C5B84440D07403BFA0FEE13FC9AFCDC03ADF8EC0F5F58BBF1D0DC3BF0A47C43F236A9B40BC1C6F40F385B5BF31D9B93F4A29AD408CE186C0EBD8303EC3194B3F3A08DB3FF83D57BF6BD83340B6DC02BE272A7440EE5E85BFFE33B940674592BF8BAAA0BF094AD7BF895638C028B649C0AD9DB2C03F91BBBE00B455BF54EF7EC0E028B1C0B2B231C06861F13FDE47133F019CAE3E71D48640A8993C40A02A52C0B631AEBFFA80563ECD6306C096CD55BF03E502C0AD7E82BF8134F73FF580F2BF5A3016C0BE379D3F75AF95407948844023F75F40F3531E3FFF22B4C02EB938C07859A43FB679C0404CEB1640F382A0C073B485C0109C79BF453285C08242A340B7D6A2BF83360A4019B714C0B49885C0D48FBF4066AB0F40763114BF24E53740558E13BF3DB281BE24B603401221DF402C2EFC3F9DFBA8C0B17D5F408B7D80BF4FD7FFBF5D70AE3F09581C40D1F7574050015A3EA0513E3FDC841BC06A1C72BFFB2B6DC01F297740C53A3BC0262F99BD968E9A3FF58607C07462CCBFE8AC993FEFD2FABEE921DFBF7DC047C07A213A4021E0C640CAC34A409AB03EC0147A23C0663C84C007A624C030AD463F0B50DDBF0AE88EC040AF6CC09A5FDD4091DFE8C0EE50C7C0E1DE86C0C3FD18C035D5E8BF1D987A3FEC1CB43F188A9ABFD8D03BC063833B3EEA5B8FBE5BC92FC0A77D9ABF08C5853F6B3A06403475D73FDC5F103F4511823C96DEE9BF821031C04DE48FC0D6435FC078A5634046CDC34066AB343E391FAFBF18D40A402D720640137BC6C0BECC5C40B4722440490FAABF8A77003CAA7E93C0172A19C08F67D73FD315044184598640A95D9F3F0CD73F4030FADD3FFFF6E3BF6319A13F66C23140B22E5A3F66DDD1BD9472FB3F9FC3E83FF9C67FC0AC684DC007D182BFCE600B417222E1BF4DA582BF68BBA03FE52FAFBF0EAE24BF183995408BF982C0BAADA5C07079B13DD4061241FFA025C0623676BF1C7B3540F5942C405E42C7BF7CDE4EC0902E21407D5A4CBE1913A14056BED5BF70A579BFF41C03C075C1434000D413C07ABE21BFC28E203F606FCA3EE5A168C0761D0DC1348D0F3FC64E2340CC063F4084E0BB3FA7BAA8BF550250BF3DE018C02D1A0AC00FB738402F074B4063D7523E96A3833E0BE39240C455BBC017EF44C0"> : tensor<2x3x9x10xf32>
    %cst_0 = stablehlo.constant dense<"0xCC980C402860B9409DA05ABE0FE8C53F389F7ABF4360ED3F5E8143406215FB3DF207A33FD04402409425C43E4252603D87B34AC05687C53FCFC8713E58A1DABFE9A94A40247A9B3F1BA50F401466CCC0F21CBCBFBEFCFDBD3F2E0B4013CB013F2A3AA33ED7DDD73DB7E8FE3F0182FE3E924AE43FDF410BC026B6E13FE1C39EC0B8AF04BF69EF5F401F315C4038DF0840651328BF654D51C0732A02BFF890BD40A4129B3E921AC53F0A1EF93E7A0E77C021C0E73E9E22533F206ECBBE25CCD2BFD1AF6A40D43C3AC002D83340E91F2AC0FB1171C0B11E343F045A2D3ECC76C13E6395DABFAC9DC9BFD5AC4BBF0077354062157FC09F91243FCFE03A3FF445584034EF27C05F9712C02D179E3F4760BABF4BEAF33E53F859C01ED9C5BE2F05E93E1EBFB33F9E058BBF5332D1C0942E373F5448D9BCBB8C4AC0ADACD6BD88BA3FBFF2548540B0ECF93FD5AB9DBEE237F83FC1E3963F19E9A940286F2A404A210041FFDD1DC042D71B40F9E44F3FEB46BC3FBAA28C3FA7E07D3F5615224088720F403C370540426B0D4102E8B2BFA50B293FD01A3140252D0EBFE42F3640F8B61FC03DE543C0A32C174124700FBF9CBF3040D96D7F406662B4BF49E138BF46C4D33FE696A43F250B7140FD57B240C5AC6040472B3E40493553BF64E1D2BF2DB4F03E5DEAA13E9434BC3D0A011140DEE743BF7D6D43BFF26A13C113A74240CA2FBC402D7F1FBEC8BEC3BFF0348CC07D27C0BF0773EF3E21DADF3C4C6534BFA532D23FC934D03FB8CE0440FDA921C0610D07C0050C7B3F650166C0135F6640111BCE3F31ED23C00CFA4AC021FC6F3E1ACCC93F34D97740B0FF80C039E276403270AEC049464CC032174D40C306B3BF19630A40FC4B86BF4D2898407895C53FF392DD3FDC58AEBFB1DB03C07E20373F2C06EC40A56C793D5461DC40B3AECCBED1468040C4A86240EA67C03E99C618C1465512C0891529409D148040AB6BA93FDEA1A04070DBCAC0B2A5CEC0A113524066857A40"> : tensor<3x3x4x5xf32>
    return %cst, %cst_0 : tensor<2x3x9x10xf32>, tensor<3x3x4x5xf32>
  }
  func.func private @expected() -> (tensor<2x3x3x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<[[[[-72.6189117, 92.4113845], [-57.7773743, 10.0726128], [-35.2772675, 11.2349119]], [[-58.2023544, 76.8860626], [90.5843811, -48.7821922], [0.169175148, -29.5787315]], [[-83.9007187, 22.4493313], [55.4377747, -54.7087784], [54.0642128, -138.339722]]], [[[6.51235103, -26.6552353], [1.64347076, -23.0090141], [-72.7459106, -42.2077675]], [[74.4403458, -0.970511436], [51.3326797, -85.0978928], [-0.0708017349, -17.9700069]], [[-114.3657, 12.7015133], [180.450241, 102.203232], [-57.2844963, -61.305191]]]]> : tensor<2x3x3x2xf32>
    return %cst : tensor<2x3x3x2xf32>
  }
}
