// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<4x5x6xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<4x5x6xf32>, tensor<4x1x6xf32>)
    %1 = call @expected() : () -> tensor<4x5x6xf32>
    %2 = stablehlo.broadcast_in_dim %0#1, dims = [0, 1, 2] : (tensor<4x1x6xf32>) -> tensor<4x5x6xf32>
    %3 = stablehlo.power %0#0, %2 : tensor<4x5x6xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<4x5x6xf32>, tensor<4x5x6xf32>) -> ()
    return %3 : tensor<4x5x6xf32>
  }
  func.func private @inputs() -> (tensor<4x5x6xf32> {mhlo.layout_mode = "default"}, tensor<4x1x6xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x9E536FC00DB0283F2C76CCBDB866B6BF4226B73EF9A4C8BFCDDB01401664B93E069B3B3D2A20BC3F883723C0D2F0943F2A0B7A4011E4A93F8F5B89C073B86240D221463FBD5E26C0EA61D5BFD01A80C0236911C0C10113C1CA2E72BF1E1C92BFD17284BD37838CBFC0FBB9BFEB7C254083058FC0B717944002CF2DBFF97214C0F78789C0EA2314C04CF82E40BB1A8B4007084A40B9CE17BFA4318340DFE936BEDA6AAB40DAC7AC3D023C42C015F1893FE5D08F40B75C13C0EC4DE63FEF718C3F82DA0F40F93E9F408C6133BE9668943D6F0B7D3FF60D97C05ED13840DA8550C07AF02140425E61BF136CE53FA1462D3F6718253F4982B43FBEE0B940CC2893C09D664DC08FCFBC3FC01BEC3EB93B4840F76D1BBF41B222C0CB8CB1BFEF1479405516CCBFD3AE87BEF646E9BFDA709F3E863A4ABFBF2DA1C05B213D4079AA0C406824B740A5F60D40159DC93D4CC88C40C060CCC0AB9FEABED05E06BF38302ABECFCC1440011941BDBF3B31C0414CEF3FEFCDB2BFE98A27BFCC4249402FFAE2BF52E8473F9C778DBFB5B7514040458BC07F7993BF10B0594080DF27408A8D08C0C5259AC00CCC38C02FD7E8BF34F58B3F9D4709C0A03ED5BF5019953F5A2B90BF4658DA4046495DBFD34A90C0BF0A993F36EE6140CCCD39BFC3CA0BC0925E6F3F"> : tensor<4x5x6xf32>
    %cst_0 = stablehlo.constant dense<[[[0.651324808, 2.02667141, 0.132446691, 0.239629611, 1.69004953, 1.09671891]], [[-2.08576226, 0.123407297, 3.11704373, -6.0501442, 1.6086694, 0.410978824]], [[-3.60492229, -1.12466776, -4.340168, 4.05589962, 3.38688111, -6.66334295]], [[-3.51096058, 0.268347532, 1.26000166, 2.80574083, -2.40355325, 4.81853485]]]> : tensor<4x1x6xf32>
    return %cst, %cst_0 : tensor<4x5x6xf32>, tensor<4x1x6xf32>
  }
  func.func private @expected() -> (tensor<4x5x6xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x0000C0FF6ED9DB3E0000C0FF0000C0FF0533343E0000C0FF40EFCA3F15AB023E172B2A3F9E5F8C3F0000C0FFB323973F4D791B406233E33F0000C0FF2651AD3F5605263F0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF0000C0FF13B9A03F0000C0FF2EBFAB400000C0FF0000C0FF0000C0FF0000C0FF9B5BA1403B26EA3F7039BA3D0000C0FF0092A2420000C0FF700F6E419354B93E0000C0FFE22F813F7977D8420000C0FF33A42440ADF9843F45153D3E4C089C3F0000C0FF6366F04A38437B3F0000C0FF1F3CE03D0000C0FFE57990410000C0FFC6A02340A80F5A3F23909B4085EA2D3F5621FD390000C0FF0000C0FF889E993D914A824126F58D3E0000C0FF0000C0FF0000C0FFC301F5380000C0FF0000C0FF0000C0FF7F59103C0000C0FF0000C0FF2ACFA43C722AD33E43FA063A177FCA413AFFCB39428258380000C0FF0000C0FF0000C0FF0000C0FFC75A8B410000C0FF0000C0FF9166973F0000C0FF0000C0FF986D823D0000C0FF4A8218400000C0FF08C48E400000C0FF0000C0FF4B4AB6432FAA0A3D0000C0FF0000C0FF0000C0FF0000C0FF5DD6C43F0000C0FF0000C0FFF6219B3F0000C0FF4122223C0000C0FF0000C0FF7749863F3ECF9C400000C0FF0000C0FF2237393F"> : tensor<4x5x6xf32>
    return %cst : tensor<4x5x6xf32>
  }
}
