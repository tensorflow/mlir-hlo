// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.add %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x1xi64>, tensor<5x2x2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x089C58CD5868DEBF5D2701808C4900C030EB9BFC68C40EC06C78E96B46C90CC00E1BB7E4A8DC04C00CBDC99706921CC057B4EA517F4C004094A576BF02FABEBF2103A147BAB4F4BFE3166015F0910AC0681E7F18A7E41140F4678EC68C540740A444C95B079EFC3FEB278FB8B00D01C01F225EB82285F83FAEFD2D120348004047AE88AEC2C91F40B8062E7E81F700405C9BFCCC3B6A10C0B7E2BC9BDCF0E8BFC0FFD5569E5512404A3D511CB8D7E0BFABB420370CBFD6BF4A610D324E5AB1BF208EAB80393005C09D9B9D61D54AED3FD2AADCBCA564F63FB61AF354B154F3BF7824AB2C24D315C03BB5567F828BE43F8D98856E7C4B06C07C1E00423C14DCBF5C4565111CE1F33F943D644B1657D8BF5A40074B2FDE0C409633D783FDA3FDBF842D992D85B400C0B21C85CF18DBF73F03CF367A636F96BF3E92C359B526F13F26D85B0EC01BF6BF88DDAEFFA20EF13FE78965A6D389F73F33BEF2D65816E53F34ABFDAFDD70084002D9C3170DAEF3BF9406CDC65EE2D53F00A515B915AA0DC0A6484C1945D5F4BF90D4871EB1E9094054B5BDF79DBC1B40314C5F6A24B7F93F4E87EE865DC6DD3F18C03FE28854E23FF6AC03D95138FABF0A3629FA7108E1BF62DDFD5CFD9AE0BFE0A07FA92D59C53F40EBA0DBAEA1F53FD6DD455057A5F43FD98764E364A6F7BFC6F2731397541240B884E9A6455CF13F4C05FA5BC17EF6BFE9E4FEF6C35100C0DC46B76F22F60440821B3C4550B3C0BF30C425E063410C4092D2F45448DC17C03471673B956110C08E40EA4717120740FEE3AC7C00C20140FCC242F1E0E00840D253F8F3E99AE33FEEB040429F36E03FD3660809FA2207C08C9DB45E2CE3B13FDCAEC4F4603D0540D6510904CD43C03F4C2F3CA58047E0BFA0E5016265FA0740F2ACDC75C2AD0540358072DB52F6D6BF279FB106CD711640CB8B184058531340AFE3EBC0052DD63FDA184E31A03D0EC0481C9D4A0725E63FF35C3CE0ED24004058C6FD3F7C4813C0340E877D3AFD13C069882781F023084028F5795FD9D71340F6A37889EBC91FC039DA6A75FB0201C009AA6CE3B198873FEFD454B411470F40206ED833C595CBBF346AD65BCE3EAB3F9BBDC410500004C0976BD4DED2C500C0DC254A791627F53FD576A5D836E50F403CF7F373915F124026F3B6332D93EBBFC5A57C3671A3154047C50FE27A1EC53FC0E9CB0FEBE708C08D86DE5D426E10C024EF51F756DDF13F870B8FF8B1C5E33F75FE288E998107C01DF9B73277EC1C40509BA4933E95E6BF64DAD3706DA4FFBF065E4F1D12710540A4BC9DE3FA43A0BF2DE7A2C0F3F416407E9398146D75C4BF2464F597F752EF3F443A82C6672D0740CF68A6EF28EDE73F826E91DE950A04C0843AF6BA59D2F0BFCCD0D4CA3856F0BF124377F1590EEF3FC0DAC34F0D2FE73FF7ACB3ABFAC8E2BF85E7E0FD4937F7BFB057604BAFF50640F2C8B18EA869F83F5372955BAB200D40E081F157602A02C021D33688A9D716C01437DE548E6C00C032A1FB2A74A3D4BF665422199BB103C067704C8A31FDF33F12F608834EB60CC061DE15D2893F26407BCF5CC5ED3704C0E5821A34D0A30A40863F11808CEC09C08E01D36BE94ABEBF72E96FB67250ECBF387584131AA8C0BF73B2074A3C49F4BFAD106F58C57508C07C55A441B3610B4049A73DD0067806C0FD800EB0CDA917C0F7E1DD107A18DB3FE1C462833583EB3FCA6A027A5FBDE93FC03EED032B5BE3BFAE93BE43874BF43F3F836A010A97B8BFBCA6CAD60243BE3FE85D0324097FFABFD2422BEFC58813C09A2EDD38E067F9BF384860877AD106C0AC7CC6858C81CABF681336F3BDF412400CC7858F5BCA01C0061017F6404AFE3FF8456ADAE1EA1D40E0E97554A27101C03C949F7CB7F08F3F75DF96233F3C02C072132FCE9F9F06404E2D6B4B681F15C09844B475E499F93F20CBAB7A3D0F0D4046D5AB64FAA8C73FA8C1934ABFB5DE3F26C8D5E39B33E7BF4ED3846617BED7BF4CACF8D235211BC02E831745C1CBF43F023390EEC90FEABFCA4E14873775F23FCEE3EE52116E0740E35D10BA9FD901C0BDB274A2DE7B0040086E01CEC40B1440C6C1B26368540C40AC2FBD162448F03F0D0871963647B7BF9439401F5CADFA3F587AAA61D981154029D641CB2795FB3F09BFDB6DEB3E14C00EB7BA4E65870D40A3E0A4A91D39C7BFE3417F901EC91340A6B67F45D21BFCBFDD8110B94DB30BC01A76DB533EBB0AC0027F3CA8A9B5963FE1D48240CE8BEABFA2AE8CA70F17C43F4C4130E59B3C19C0F0EC6DE3D6EA14C0085DBD1CCB44CDBF3EA3C06FF00E02C01A555E5A6ECAE33F680EEB43FCEAFFBFEAF632C7F328FEBFA86DA0D11695F0BF"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<"0x97A18A1669C011404AE3A7E40B5A0FC049C70A3D50010740256FA30F89EFF53F12366AE85103F03FC0AF5F300361DB3F67388F132EACDFBFFADB47F632DEF7BFB544AA3B64D6E8BFF4ACD2CECF8212400BD3A35E6DD900C06D254AEB538EF5BF81CAA0D100BE1640860B079B440FF1BFF4992CC13450FB3F1C5461E991F2FC3F32435F44D68C08C08A9F1DDE17C60E40C3A2BDFF66D40FC01CA86CF719DA08C0D25E222C82080C40BED13BB0AC3012C0B4A825938D0A05C0D40AF052DF0A0040C9410C45A02EF23FC1C5DBF64B65F93F3688C936B05B0240C88E02AEEEB6124055FA275C369E1140C27AB84CB3EADE3F9C919BF53015014048BBF4C388740340A8B5B8E9CA68F8BF44123AF360AE03402E2FB89065E312C0CD3C4C9967D110C01A14990D224A09C0B425756F4451EC3F59F9AD54D6600940FE5240A8C16B0340F747BB96A34AE23F99F4CC4007FAFD3FD9F76DB5142A04C0D5E94562D8EE0CC0D94C72ADFA5102406F4706B235620740903EDAB0F0FC1AC0DE950703A9130740E26B65F01576A93F8A8086F7DC1CFF3F3B4A6AB90D9C07405A074D013ABE0640689632EB375FF93F8DB970FBF1A606C02E471ECEB4C711C03470D1785CF4E63FF1591E861443D2BFE806C0F721E4F2BFDB2D2CCC51BFFD3F37C0328DE89AF9BF50906EE9EB4D14C02A2CC586338FF7BFB2D86C03D3E2F93F329CEEA0CF1607C00C9ABF706492F5BFC46FA284FA18C93FEA0AFB37354B10C02E476646F9AFC2BF9F291B7CF72911405F03DBE25AA90A405994D71CB962DD3FFBBC9763593A04C06D3E282690821540348885E97FEDD13FA07D19046B6412C08E11060F162BE03F9F57A683759BE0BFF80802963FAC00C0DB3A46C80C1D0EC07EF0FC7D1927E03F0C2ECE41596AF63FB4C27A6E2D7E03C044C7B202C2EF15C0C20384697610FCBF6C192C96BABBDB3FDC6D05AF5ABB11406C42618123520FC002B00B8DD1061540FE4C787495D6F9BF779140456A3CD73FB87BD7AEC6E109C06226168F9ED300C0F0C2A2EF7D5803C0080BB48993D711400AFD23584DFC054052A91A130AE2C33F86FEFED4B6CDF23FB18E9F866A4DFE3F02A639FD8530D1BF88518F27737D0D409DD0AAAB1409E23F96595A76C0050DC0D04BBCAE8E3310407851669C73C31DC06F8FE3B59B451340D5FB4DD249FCD9BFA48EA82F84D7F83F9528CB51B64E17C084E0B99404FE18408A84E13B292106C050E2169BCD10FEBF2883AF0B1B5E0DC00C32C3FE457AF3BFDC02D0E0A2BADFBF54869F7B5A63FE3F29BF7D724C7F13C0A70F1E2C9D1B0C40C008A1FD68F414C06385D47AFF59FA3FB6100D851D3DFBBF5C61C317018EF0BF2079075A4A1EF03FDEE4BB0CBCF302C0C8A94634CD1609C0F7DD857B1435FFBF5C0F876EBE3E05C0D2D73305F6E4F7BF794AE467E141E8BFDE0D3F9581A1EE3F727DED5CFF35FFBFC749E39B443B0AC05CD74E7F8A1B05C0D957784D30CD10C057D240989D8E0340AD09AA46A060FEBF4876927925EDFEBFDA3D345E9376ED3F3A35741AAA96FC3FCC26BA34A2AA0840245FCCFA4BDEF03F"> : tensor<5x2x2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xAD2F6A13C7B30F4054855432CCD117C09C8F44FE620CEFBFDAC017E481D101C00A0004E1FFB5F9BF10C2C364F6DB1AC0949AF11EF3ADF83F53463F22D3CDF9BFBE12BB32F68F00C00A868A105FE7F43FC5695AD2E0EF02407BAAD2A1C51AF93FAA1B93A882E51D40AEAD1206539509C00A5EC5BCABEA0940BCA7DE064CC10E40AE0C598C5783134021D325AECCDE17405FB66DA6372A20C0CAE05B1E51160FC0949773B6EF2C204067F9C5B3A34B14C049BF091A6FE207C0933FBFC21900FF3F77DA4ABCD231F8BFC849D5535B0504409FDD3715038E0D4035908BB184C30B407824AB2C24D315C03BB5567F828BE43F8D98856E7C4B06C07C1E00423C14DCBF5C4565111CE1F33F943D644B1657D8BF5A40074B2FDE0C409633D783FDA3FDBF842D992D85B400C0B21C85CF18DBF73F03CF367A636F96BF3E92C359B526F13F26D85B0EC01BF6BF88DDAEFFA20EF13FCF5CC145AB801740CA7DA73ED945F23F689ECC5207C314408E9D2570043BF33F0374053833F0F2BF7825B78B69F7F3BF58410BD7B61818C02894425078E4EEBF8E56E2E1192F0E4086EF0C51E3EF034043CA8B05A2190D400443D0E0E3000840FA08A60D0013F1BF9459B843CE75F53F326FAD0CD45008C0C7EFAD8745990BC079C2421BD2220D402D9B14AD70DA104043B0D9F4447320C0B5BDF7946BDE1D4017B06C56F627F23F7CF61837373CE13F4895AD092729ED3F1B2782382EDA1540F8128BE2CD48F73F8C2AD492C769E63FE08C8991FED124C05B869A5813060BC08E40EA4717120740FEE3AC7C00C20140FCC242F1E0E00840D253F8F3E99AE33FEEB040429F36E03FD3660809FA2207C08C9DB45E2CE3B13FDCAEC4F4603D0540D6510904CD43C03F4C2F3CA58047E0BFA0E5016265FA0740F2ACDC75C2AD0540358072DB52F6D6BF279FB106CD7116402CA6B6F7262F1240F81B0A0FC1B1EABFD9037096EEBBFEBF2664C8CFC910EDBFADC3A0F2E97608C06211AF21492C19C00FB057790B090BC070C38E030ED2C03F4A1D948680E60C40789053B523011FC00678B0F2B2CC18C08D7C2F286E36C1BF0BCA222BC06620407D7C9D8FFEEF0840D03029744965E03F4B3D2EBA541D14C043117C6D4D3F0A40E987AB7376A2F93FAC1136BE7C8EE3BF6EB9D435F464144062A5AE5B5117F6BF9242F7D6A29A0A40873E251A25CB0CC0A0AD4CB024DE04C014F6D51A58A705C04496A3E5031FF5BFD3E5A0C30B7713C02B807561EAC412C01DF9B73277EC1C40509BA4933E95E6BF64DAD3706DA4FFBF065E4F1D12710540A4BC9DE3FA43A0BF2DE7A2C0F3F416407E9398146D75C4BF2464F597F752EF3F443A82C6672D0740CF68A6EF28EDE73F826E91DE950A04C0843AF6BA59D2F0BFCCD0D4CA3856F0BF124377F1590EEF3FBBF36C4D7586F23F7AF01DB376C40E4017DB2840E47615C0EDED5D99D4402040C040685CCECEB6BF41C21E521C041040CC7E6483130616C052E6C1CF78411FC0027D402286E211C0F55004475C8D104020450DF89155D23F91C5AFCC7279F63FCF768918734F03C037D0E92237092A403B040485FE5D06C036EAD4ADA1101C405F8B2655476A05C0A2F1B8C117F80DC0449DDCAF005309402275026DB4481EC0A445C34699660C4028D0B8924EB50BC0674EBCACBAE613401DFEF4DC5C4521C070F8B54A6E43D53F4BC8C5F919BE02C0E07F65D9324FF0BF76E82E2DC3EE06C0C03EED032B5BE3BFAE93BE43874BF43F3F836A010A97B8BFBCA6CAD60243BE3FE85D0324097FFABFD2422BEFC58813C09A2EDD38E067F9BF384860877AD106C0AC7CC6858C81CABF681336F3BDF412400CC7858F5BCA01C0061017F6404AFE3FF8456ADAE1EA1D40E0E97554A27101C0E4F2C98F643AF3BFD0DFB07F933306C04E6BFF85A6E812403C76F45E5A4F24C0FA187CB347741440C08C2C0129B3F9BF0C006AC71E4FFD3F4C2068B2AD8FF3BF6F45AE09CF27FCBF9988CC00895DE43F5E4FABEC894D22C062D07523D961FDBFBCFB66B97C1E06C0EECFF9554508F8BFCAEFA9A02CF7F63F8170091418EA07C03476C4073F240840571D8CED897C0840F8BF7B3E1EC9D03F0C7FE0E7F0EEF9BFF91BD2274D2A11C09077F0D3A5721040DAEFFF9F62D30B40F8008572EDBFCABF4E371502199010C0D668FA2D5DE91540C2D81F5A10370740AC59328FB1001840A6B67F45D21BFCBFDD8110B94DB30BC01A76DB533EBB0AC0027F3CA8A9B5963FE1D48240CE8BEABFA2AE8CA70F17C43F4C4130E59B3C19C0F0EC6DE3D6EA14C0085DBD1CCB44CDBF3EA3C06FF00E02C01A555E5A6ECAE33F680EEB43FCEAFFBFEAF632C7F328FEBFA86DA0D11695F0BF"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
