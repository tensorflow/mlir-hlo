// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %1 = call @expected() : () -> tensor<5x6x7xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<5x6x7xf32>, tensor<2x2x2xi64>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> ()
    return %2 : tensor<5x6x7xf32>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}, tensor<5x2x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xDD16AF40F322914096DF273F03CDD6BFD116D9BFF05C30C083C13C40FD0B993F00DFF03D5D4107C07CF684C0DA36E2BE21CB87C0A08D68C03D30873F687BCFC07A11BB3E0D9E373E566F04C0EFCA7840AC33B2400BD2E93F7FA4DE3FB8C28640F825494088FDA03FE4C2DFBFFBCFABBF3D7933C0191D5ABF2BCEACBFA35FFABFE536A5BF466E30C0CB71154059EC81C0CA61983FBB6342C03523E8BD6597CA40800F01C024611EC02BAD1DC19AA75E40797A9BBFEBB4753F46A2414091AF7BBFFC20DA3FA01DE53E6EC10DBFB50D4FC0AB65A63F6BC4C740AC72CAC0446555C04F1367C0BD10C83F81FA2C40B692A540BB08EAC0EA156A407F943AC024A882C0808E9E40150F5B401258F93FEE5642C0420D3F408D5913407C4DC2C02262EDC0C558813F4911823FEE6748C015248EC011D25D407993B0BFA56204BFAB298340F13C374068CB18BF8658C63FF4691D407FAF28C04FEBA2BEC6A6EF3F2B6C86C0577C813E82C8A5BF4F960AC088D26C401C28A43F570DA13F5CFB3D40A2BE4DC08C7083BF3014FB3E4430AEC0E8DC69C0A7AB9340794067BCF792193FACF1563C5B78593DDDDB4BC0A6815C3F6035983F94078DBF424CA43EF6D6FCBF8C91F13F917FA13F1EBFA940CF9BAE3FE091FBBEF6FA9CBFA59680BECD838A4094C18BBE754E8E3F5A7942C09FE0C03F57ABAB3FC9754BC0D0A871C0683B44C0447BBA3F1EC244C0D82EFDBFED5F7140050DDBBFB35581C0B78F0EC078D64CC0C5DDDCC06E13993F2FAAA83F5DBD1FBF33EFB7BF3BCA143F104AAC3E2787DEBF1E6ACB3F1A36A7C098A0B7C0AF0308BE625F84BECB1687C0B07D5CC04EAE7DBE384692BF29FFFABF2171824053BA49BFF25E2EC0D32B04402FA4E7C0C9AA7740066594BF3F6D8C40C176A1BF5CBD33C01B9F62C06D35363F4B92B0BEC43C284097230CC044CA3E4033C44B3BD3BA2DBF410309403A07AEBF33721A3EF493B1C0B75126C0A186D8408870533FDAC89F3E87D8EE3E54456B40AE3DBBBE0041ABC02C0489BF7A66F9BF5D29F4BFE49ECC3F06CF284083E934BFE5252440D4D78340175D8AC07A97D63F63AE5E3FB400ED3FA432464012888FBFA00295BF7B9220BFFB7D0440FC932440EA7304C0B9FE2FC03773A9BFD3AD2BC088FDB73E92B581BF358905BF5851F2BEC9F17FBF"> : tensor<5x6x7xf32>
    %cst_0 = stablehlo.constant dense<[[[1.28537238, -1.17656171], [1.7865777, 1.45451045]], [[-2.97710204, -1.04774261], [-1.76158166, -0.195420206]], [[-7.4935379, 1.07271349], [-1.82348382, 1.8383342]], [[4.15354347, 1.51762807], [-1.39564657, 3.91738462]], [[-1.97757554, -3.47821784], [2.175490e+00, 0.0617009103]]]> : tensor<5x2x2xf32>
    return %cst, %cst_0 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xDD16AF40F322914096DF273F03CDD6BFD116D9BFF05C30C083C13C40FD0B993F00DFF03D662DBA3F7CF684C0DA36E2BE21CB87C0A08D68C03D30873F687BCFC07A11BB3E0D9E373E566F04C0EFCA7840AC33B2400BD2E93F7FA4DE3FB8C28640F825494088FDA03FE4C2DFBFFBCFABBF94AEE43F191D5ABF2BCEACBFA35FFABFE536A5BF466E30C0CB71154059EC81C0CA61983FBB6342C03523E8BD6597CA40800F01C024611EC02BAD1DC19AA75E40797A9BBFEBB4753F46A2414091AF7BBFFC20DA3FA01DE53E6EC10DBF3C1C48BEAB65A63F6BC4C740AC72CAC0446555C04F1367C0BD10C83F81FA2C40B692A540BB08EAC0EA156A407F943AC024A882C0808E9E40150F5B401258F93FEE5642C0420D3F408D591340827BE1BF2262EDC0C558813F4911823FEE6748C015248EC011D25D407993B0BFA56204BFAB298340F13C374068CB18BF8658C63FF4691D407FAF28C04FEBA2BEC6A6EF3F2B6C86C0577C813E82C8A5BF4F960AC088D26C401C28A43F894EEB3F5CFB3D40A2BE4DC08C7083BF3014FB3E4430AEC0E8DC69C0A7AB9340AD4E893FF792193FACF1563C5B78593DDDDB4BC0A6815C3F6035983F94078DBF424CA43EF6D6FCBF8C91F13F917FA13F1EBFA940CF9BAE3FE091FBBEF6FA9CBFA59680BECD838A4094C18BBE754E8E3F5A7942C09FE0C03F57ABAB3FC9754BC0D0A871C0683B44C0D4E984401EC244C0D82EFDBFED5F7140050DDBBFB35581C0B78F0EC078D64CC06EB67A406E13993F2FAAA83F5DBD1FBF33EFB7BF3BCA143F104AAC3E2787DEBF1E6ACB3F1A36A7C098A0B7C0AF0308BE625F84BECB1687C0B07D5CC04EAE7DBE384692BF29FFFABF2171824053BA49BFF25E2EC0D32B04402FA4E7C0C9AA7740066594BF3F6D8C40C176A1BF5CBD33C01B9F62C06D35363F4B92B0BEC43C284097230CC044CA3E4033C44B3BD3BA2DBF410309403A07AEBF33721A3EF493B1C0B75126C0A186D8408870533FDAC89F3E87D8EE3E54456B40AE3DBBBE0041ABC02C0489BF7A66F9BF5D29F4BFE49ECC3F06CF284083E934BFE5252440D4D78340175D8AC07A97D63F63AE5E3FB400ED3FA43246403A3B0B40A00295BF7B9220BFFB7D0440FC932440EA7304C0B9FE2FC03773A9BFD3AD2BC088FDB73E92B581BF358905BF5851F2BEC9F17FBF"> : tensor<5x6x7xf32>
    return %cst : tensor<5x6x7xf32>
  }
}
