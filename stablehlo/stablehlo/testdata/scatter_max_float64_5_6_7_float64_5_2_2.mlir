// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x2xi64>, tensor<5x2x2xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x28E104C4DB150840C7CC5C081BE90640F27A94BA7769FFBF20B158285D63CCBFAEB8036274AFDCBF0D6FDBD31F08F03F40F7AB46508A12C005E234261CBC02404870D01240051AC02406AFC082C3E83F448D81B9D562F0BF1780FA03F10F1540280CD9047BF7C23FCC89E53B393002C0D8CA0C9B1BD2F13F713DF818B3FD0F40D2B3DF4501A9F8BFAA460FE53B3E0C407F82DA0EC9881240522DC12C9E000640EF4BFC86FFD401C0F9C163402358D0BF11C745782E640C40BD53FB4C3C5702C0CE195AF803E1B2BFF0EDF68E806300C0CC72303BCB80EABFEC6F91622FCFE43F141BCD535F0CFBBF7796584CD349FB3FE8FAD4C4099DF93FFB28094705E3883FF9E74A99947EB4BFF60D5D553E0412408251F96CEB4118C04209FD8216C5E43F360351FCF970DB3F29D8886BD1C5D1BF608A164F2350F3BFB4B841538ABBC1BF45C704AB3D2416401FEA47EF13BFF03F486124B10157E23FBE6F6F96B1FAF93F5EC039023255E1BF8C867480A8D10AC082256654044AE2BF065660734F16D6BF800CFB8DAE5A15C0BA389943A0F1094076BDADCFE0A0E6BF8C58AC125C930840966358B5A6370640225345EA9CD41240BF59635B8EBFF9BFC945ED5B8AFB1840FC2D8CC685770640AEFE40E08E1DD93FAC80213CFF55F03F7FB8D8F30776BDBFD9C610789EA21AC0028FF97D49221240F63E70EEA7AE114038EE4072DEB01FC01426B3F671A21140584C9DBFCBEAD9BF44EC29EF9477E53F17D47BDA26D70A40AB7296B325A204C07298EFEEA819114036DD45A6157A0D40EC529F1629CE0AC0375C0588F9D21640F7A0C6623B4315403889A7C10FB20E4040C835F84F7E01C09ED7C1E916980B40A055C33AB2620840BE5018856115EE3F72A82C3E20BCEABFD423512272EC15C07CA9643B3FC600C0DD8EB5ADFD72D1BF862A629AE0A40C40DCE275CA4AE6ECBF66C8648FB9C8E7BFE08C59F0E3DEF9BF4F4A559AD64301C071F5A02DD4191FC091497D36DE44134056515246CC23FEBF36DF76ACB5E803C08408B95D76D21E407A60E612723803400ACAFC0EFD64F4BF1DAC5D048B460640FD5622B0EDACF1BF6DA8D7C0EE27EA3F0860C46F57550940EC68F7BFC97AFBBF8D135EA243200F406E53D53C256912401DF327090C7113C00A1D839528ABE5BFD04D3AB0BFDC1140ACCA2847F2F6FABF8042C8A24E4813403C0AFB5971E1CD3F599C24C70B7007C064EAB5B23FEE1240905030867B9DDCBF77B57AB7A30AC13F1D5CCBEAD7600C40132585976DF0E3BFB2AAB4A03449B3BF99A91512092EF23FA63C1A95786C01C05FC618393733DEBFB8458FF15425CC3F62513DC7DC040140F90C7F5EB26E11C0D11071C739D2FB3FB6AC3A9454120AC0746E295FD08109401AC8D0F7D27F13C0AC713AE5834C0F401E01184BB23C1740AEBB78ED38FF094072A0B4237BE01C40988EFAA42323D9BF3B1006300635F5BF66E4E561F296EA3FDE1F284A443EEA3FE9D8DDF6B075F8BFB02539B1F4410440F0DCCBCFA7DD923FE6C3C3A330CEF73FBFE8ACA1AA7CFEBFD9EEDBB93F720D40B4DD600DF5DEF43FDDD1C48AC91EE9BF5E5B4062EB5803C08034E694CC8212407275CEBF28D605408C403C91E71C0140ECADB457FD4A08C0110764364411FC3F82A18F93846C0240F674EC52C6A1F63F93E99959C08BF93F719BA09E1794F1BF9803AD061EA4FE3FE100BFE8BD10EA3F1E9DBA13F0B9D43F98FB1598B1D108404F3A50932EDBE23F7EB8A73F35DE0D401C612CFBE83B10C074494E9196B3E13F52A822D9D869C03F1BEEF1574A1FF63FA64B11C7553FFEBF2E0A3B1E5B7F0FC04664244062ED00407EF73C0DA14A08C004F246FBC5AFFA3F13828E35BA419A3F6E4AA4DBE5A90540554C2BBDE35EDB3F4A584540EB5E0940641B06FF6C1306C06C529EB133E517C041AFF9E435FAF13F654B9B7E51B302C086325595F41FFEBFB6FC20F8795A13C048EF1E77A26E0840B857C859C7E701402C9F96BE8E35F7BF58F6E5353EDAF13F496553C68FA60C405CEFAC407533BFBF10C19BCB1648F3BF165FB735EFBA16C06AE368A04965F83F13A30C2DB8700D408BF88F8F03380B40B911227F0F27E33FEE8D0A31F7EA0AC064C0EE3256C51B40EA2B71AB717C014038F3116078B30DC022BAC5584A7210408FDD411DFF6216400FD0D14DDB3D1040E1BFEF945B6D13C0EC49D259F6007C3FB5841E5196BE0C40D671EEB6A1E6D1BF4D578EDEDF6BC2BFE611882B545D0840B614393FD96CFCBFE61FEF8EA66DCEBF4E3AE5A6A875F93F9025D6B59F95E83F3C443C49A362EF3F0183781281DFF23F2AEE473459ADE53FBD12804BFD3B0340AB27535D827E0240"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[[2.9280922979730741, -0.86564602921949318], [-2.6694856469877126, 4.839112097707833]], [[2.0617951888855637, 2.5700655495376243], [1.0866492819542788, -2.6755346452777062]], [[-6.5334799428720558, -5.4150470097714889], [-3.9006322363126582, -2.5969090056977744]], [[4.9312754696417276, 4.4054810986762618], [-2.4175906759199348, -0.60584448436742933]], [[-3.6425518556885752, 1.8554104418284147], [1.4133351849057056, 1.0694521245626551]]]> : tensor<5x2x2xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x28E104C4DB150840F2B59BA7BB6C0740F27A94BA7769FFBF20B158285D63CCBFAEB8036274AFDCBF0D6FDBD31F08F03F40F7AB46508A12C005E234261CBC02404870D01240051AC01855A533405B1340448D81B9D562F0BF1780FA03F10F1540280CD9047BF7C23FCC89E53B393002C0D8CA0C9B1BD2F13F713DF818B3FD0F40D2B3DF4501A9F8BFAA460FE53B3E0C407F82DA0EC9881240522DC12C9E000640EF4BFC86FFD401C0F9C163402358D0BF11C745782E640C40BD53FB4C3C5702C0CE195AF803E1B2BFF0EDF68E806300C0CC72303BCB80EABFEC6F91622FCFE43F141BCD535F0CFBBF7796584CD349FB3FE8FAD4C4099DF93FFB28094705E3883FF9E74A99947EB4BFF60D5D553E0412408251F96CEB4118C04209FD8216C5E43F360351FCF970DB3F29D8886BD1C5D1BF608A164F2350F3BFB4B841538ABBC1BF45C704AB3D2416401FEA47EF13BFF03F486124B10157E23F5582DA798E7E00405EC039023255E1BF8C867480A8D10AC082256654044AE2BF065660734F16D6BF800CFB8DAE5A15C0BA389943A0F1094076BDADCFE0A0E6BF8C58AC125C930840966358B5A6370640225345EA9CD41240BF59635B8EBFF9BFC945ED5B8AFB1840FC2D8CC685770640AEFE40E08E1DD93FAC80213CFF55F03F11B9DE867E8F0440D9C610789EA21AC0028FF97D49221240F63E70EEA7AE114038EE4072DEB01FC01426B3F671A21140584C9DBFCBEAD9BF44EC29EF9477E53F17D47BDA26D70A40AB7296B325A204C07298EFEEA819114036DD45A6157A0D40EC529F1629CE0AC0375C0588F9D21640F7A0C6623B4315403889A7C10FB20E4040C835F84F7E01C09ED7C1E916980B40A055C33AB2620840BE5018856115EE3F72A82C3E20BCEABFD423512272EC15C07CA9643B3FC600C0DD8EB5ADFD72D1BF862A629AE0A40C40DCE275CA4AE6ECBF66C8648FB9C8E7BFE08C59F0E3DEF9BF4F4A559AD64301C071F5A02DD4191FC091497D36DE44134056515246CC23FEBF36DF76ACB5E803C08408B95D76D21E407A60E612723803400ACAFC0EFD64F4BF1DAC5D048B460640FD5622B0EDACF1BF6DA8D7C0EE27EA3F0860C46F57550940EC68F7BFC97AFBBF8D135EA243200F406E53D53C256912401DF327090C7113C00A1D839528ABE5BFD04D3AB0BFDC1140ACCA2847F2F6FABF8042C8A24E4813403C0AFB5971E1CD3F599C24C70B7007C064EAB5B23FEE1240905030867B9DDCBF77B57AB7A30AC13F1D5CCBEAD7600C40132585976DF0E3BFB2AAB4A03449B3BF99A91512092EF23FA63C1A95786C01C05FC618393733DEBFB8458FF15425CC3F62513DC7DC040140F90C7F5EB26E11C0D11071C739D2FB3FB6AC3A9454120AC0746E295FD08109401AC8D0F7D27F13C0AC713AE5834C0F401E01184BB23C17408AB6D646A0B9134072A0B4237BE01C40988EFAA42323D9BF3B1006300635F5BF66E4E561F296EA3FDE1F284A443EEA3FE9D8DDF6B075F8BFB02539B1F4410440F0DCCBCFA7DD923FE6C3C3A330CEF73FBFE8ACA1AA7CFEBFD9EEDBB93F720D40B4DD600DF5DEF43FDDD1C48AC91EE9BF5E5B4062EB5803C08034E694CC821240C0D7E76F369F11408C403C91E71C0140ECADB457FD4A08C0110764364411FC3F82A18F93846C0240F674EC52C6A1F63F93E99959C08BF93F719BA09E1794F1BF9803AD061EA4FE3FE100BFE8BD10EA3F1E9DBA13F0B9D43F98FB1598B1D108404F3A50932EDBE23F7EB8A73F35DE0D401C612CFBE83B10C074494E9196B3E13F52A822D9D869C03F1BEEF1574A1FF63FA64B11C7553FFEBF2E0A3B1E5B7F0FC04664244062ED00407EF73C0DA14A08C004F246FBC5AFFA3F13828E35BA419A3F6E4AA4DBE5A90540554C2BBDE35EDB3F4A584540EB5E0940641B06FF6C1306C06C529EB133E517C041AFF9E435FAF13F654B9B7E51B302C086325595F41FFEBFB6FC20F8795A13C048EF1E77A26E0840B857C859C7E701402C9F96BE8E35F7BF58F6E5353EDAF13F496553C68FA60C405CEFAC407533BFBF10C19BCB1648F3BF165FB735EFBA16C06AE368A04965F83F13A30C2DB8700D408BF88F8F03380B40B911227F0F27E33FEE8D0A31F7EA0AC064C0EE3256C51B40EA2B71AB717C014038F3116078B30DC022BAC5584A7210408FDD411DFF6216400FD0D14DDB3D1040E1BFEF945B6D13C0434CD75A059DF63FB5841E5196BE0C40D671EEB6A1E6D1BF4D578EDEDF6BC2BFE611882B545D0840B614393FD96CFCBFE61FEF8EA66DCEBF4E3AE5A6A875F93F9025D6B59F95E83F3C443C49A362EF3F0183781281DFF23F2AEE473459ADE53FBD12804BFD3B0340AB27535D827E0240"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
