// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x50x3xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<32> : tensor<1xi64>
    %0:2 = call @inputs() : () -> (tensor<1x50x3xf64>, tensor<1x3xf64>)
    %1 = call @expected() : () -> tensor<1x50x3xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.add %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<1x50x3xf64>, tensor<1xi64>, tensor<1x3xf64>) -> tensor<1x50x3xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x50x3xf64>, tensor<1x50x3xf64>) -> ()
    return %2 : tensor<1x50x3xf64>
  }
  func.func private @inputs() -> (tensor<1x50x3xf64> {mhlo.layout_mode = "default"}, tensor<1x3xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x457D0AB3E4C6EFBF79AF69CC65D107C0D69FE2E6C57712C0DB0FBEEEBC82FFBF94DDD69B25E6ED3F147EB506FFDDF73F5D218803A698FABF52D3B8CFC3E65D3F5590C214E3CF1240EB2941D92B1AD13F0B5A3B150530DEBFA68DA2F4034D1440589FEE9FAC02F93FD9739258744AE53F9AED2562076817407227116407460E40DDC2BB1CBCC30940B0BB11A680AFE1BF00EF1DCA56F915401FF4A5351FE4D43F0187AEA13A0214C06AB385D5A900FBBF3A9A83620A3D07405EBC5128E5EEF33FFAD6660A14040640C29D6E2724A803C00393EF78B5010440D802E32F08F207C0FCD73C211C7B0D40499C46B676BFEABFC7E02D200E5AF33FE6AE0179406C1B40949B53E28BE40240F8C4FACBFB70E93F2D4292F4B00305C05DE6EFA12D85D1BF733ED058D3FFB5BF82BEA81977CC01C0F0CC3FF76A96FC3F689DF3851692963F68A7A33AA8DDFA3FD4E3164E3FEE03C04C46A949EAC009C0A274CD8455FE0540E0CA753C3E4714C01BF9EB61419A00C0501E3E3FE3B916C0E070075BDB061140B3DDBDEBEF91F33F9845494E05631440ADFBA7BBC14702C0D402B8FB4D4AFD3F2C1C20A3CEEFFB3FA31865A5EC300CC0765CAA5743630840389E170B125DFFBF1ACBDF3D75D6DE3FB676E9D2BEB10AC00D2436D5A59705C0B045130DB94612C0A369FFF579B70140582493A5E65206401A2E7FC4BAA9E23FDC51959F5D440740C23C34D90B6B04C0E436F333A648FABFDE345695FD2B04C0AF31C5F695EF19C0F71BC9D81EF907C05D7081C33D1805C0303EAE355287F8BFE5FA298F31D20DC0C4832075E2C60840FF09DAF07648F13FB6E8412E5B7D04C04A453750D5CD14C0877855A66D0622C07493A8432626CABFC6F2B394EF02FBBF6E44FBEA9042FF3FAECA1BDFE06CEF3F1CF74DC19037D53FCAE4D041E7530740C2E34F8846D21840C55CCCDE6A8902C05243273BA285EF3F78A9AC31B6AB04408C574BB69C280740B4C054830FD5F53F36439748027EBD3F47768F94B3B107C02E4AA2F500ACC13FE60813FCA86414C0FDFC56F80117A6BF1A217007BDFBD93F4289E78FFA03E9BFBB927232F7AB07C0FEBB408BA37414C01AD7D99773D01440C4072F5C6945B03F96FEBB806B30094032F5BED366E20040FA2F7E622B3DFC3F27F2E9271C1E054098A4147DF31CE9BFC1D2F5531432F7BF2DD1E8048F7D13C021F4423B860506402529F21E784411C0C86AD87182D8FBBF0722E3775F0D15C03E7814066E3C11C058E0E8897A110E401DBD4B80CCD60340B4E4AD515E34F43FEDB683157708D43FDD7475A486850840664307F8567CFABF88DC8770774307C0DEA4998B7ECBDD3F897387419E958BBF9601F135DA30DE3F5489D4A34200E7BF200E5BCB2265E3BF6B394DA27F9CFFBF092C8F4BB579D83F55E6783B0825FC3F0E7E44AE3648F93F417236643BE7F23F0EB3F68D1A571AC041AC260A0E72F6BFC27F6D1E2BF402405CDF910E45A613C018B39864815B09C06298CC25B64798BF81DFB19B806710C0FA94E4BE2B9D0BC026063814B30900C0961F0C74EE9219C0891CE2B23400E2BF8E143FDD419F05C0F910841CBA1AE4BF645B73A0A5A3B43F72006BA4F66E13C0C1B2157990FF02C0FD4DBBC3EAD4144076A50DED8D18FA3FB452D8CDC10206C08DB1D39956CC1B406F915EDFC4EBF4BF"> : tensor<1x50x3xf64>
    %cst_0 = stablehlo.constant dense<[[0.17042524727648187, 0.94325008630352913, -0.42247809791466506]]> : tensor<1x3xf64>
    return %cst, %cst_0 : tensor<1x50x3xf64>, tensor<1x3xf64>
  }
  func.func private @expected() -> (tensor<1x50x3xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x457D0AB3E4C6EFBF79AF69CC65D107C0D69FE2E6C57712C0DB0FBEEEBC82FFBF94DDD69B25E6ED3F147EB506FFDDF73F5D218803A698FABF52D3B8CFC3E65D3F5590C214E3CF1240EB2941D92B1AD13F0B5A3B150530DEBFA68DA2F4034D1440589FEE9FAC02F93FD9739258744AE53F9AED2562076817407227116407460E40DDC2BB1CBCC30940B0BB11A680AFE1BF00EF1DCA56F915401FF4A5351FE4D43F0187AEA13A0214C06AB385D5A900FBBF3A9A83620A3D07405EBC5128E5EEF33FFAD6660A14040640C29D6E2724A803C00393EF78B5010440D802E32F08F207C0FCD73C211C7B0D40499C46B676BFEABFC7E02D200E5AF33FE6AE0179406C1B40949B53E28BE40240F8C4FACBFB70E93F2D4292F4B00305C05DE6EFA12D85D1BF733ED058D3FFB5BF82BEA81977CC01C0F0CC3FF76A96FC3F689DF3851692963F68A7A33AA8DDFA3FD4E3164E3FEE03C04C46A949EAC009C0A274CD8455FE0540E0CA753C3E4714C01BF9EB61419A00C0501E3E3FE3B916C0E070075BDB061140B3DDBDEBEF91F33F9845494E05631440ADFBA7BBC14702C0D402B8FB4D4AFD3F2C1C20A3CEEFFB3FA31865A5EC300CC0765CAA5743630840389E170B125DFFBF1ACBDF3D75D6DE3FB676E9D2BEB10AC00D2436D5A59705C0B045130DB94612C0A369FFF579B70140582493A5E65206401A2E7FC4BAA9E23FDC51959F5D440740C23C34D90B6B04C0E436F333A648FABFDE345695FD2B04C0AF31C5F695EF19C0F71BC9D81EF907C05D7081C33D1805C0303EAE355287F8BFE5FA298F31D20DC0C4832075E2C60840FF09DAF07648F13FB6E8412E5B7D04C04A453750D5CD14C0877855A66D0622C07493A8432626CABFC6F2B394EF02FBBF6E44FBEA9042FF3FAECA1BDFE06CEF3F1CF74DC19037D53FCAE4D041E7530740C2E34F8846D21840C55CCCDE6A8902C05243273BA285EF3F78A9AC31B6AB04408C574BB69C280740B4C054830FD5F53F36439748027EBD3F47768F94B3B107C02E4AA2F500ACC13FE60813FCA86414C0FDFC56F80117A6BF1A217007BDFBD93F4289E78FFA03E9BFFFD9F648EF4E06C0363E7E31C0AE10C0A88FA27ED51F1340C4072F5C6945B03F96FEBB806B30094032F5BED366E20040FA2F7E622B3DFC3F27F2E9271C1E054098A4147DF31CE9BFC1D2F5531432F7BF2DD1E8048F7D13C021F4423B860506402529F21E784411C0C86AD87182D8FBBF0722E3775F0D15C03E7814066E3C11C058E0E8897A110E401DBD4B80CCD60340B4E4AD515E34F43FEDB683157708D43FDD7475A486850840664307F8567CFABF88DC8770774307C0DEA4998B7ECBDD3F897387419E958BBF9601F135DA30DE3F5489D4A34200E7BF200E5BCB2265E3BF6B394DA27F9CFFBF092C8F4BB579D83F55E6783B0825FC3F0E7E44AE3648F93F417236643BE7F23F0EB3F68D1A571AC041AC260A0E72F6BFC27F6D1E2BF402405CDF910E45A613C018B39864815B09C06298CC25B64798BF81DFB19B806710C0FA94E4BE2B9D0BC026063814B30900C0961F0C74EE9219C0891CE2B23400E2BF8E143FDD419F05C0F910841CBA1AE4BF645B73A0A5A3B43F72006BA4F66E13C0C1B2157990FF02C0FD4DBBC3EAD4144076A50DED8D18FA3FB452D8CDC10206C08DB1D39956CC1B406F915EDFC4EBF4BF"> : tensor<1x50x3xf64>
    return %cst : tensor<1x50x3xf64>
  }
}
