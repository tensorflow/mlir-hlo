// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<4x2x3x5xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[0, 4]> : tensor<2xi64>
    %0:2 = call @inputs() : () -> (tensor<4x2x3x5xf64>, tensor<4x3xf64>)
    %1 = call @expected() : () -> tensor<4x2x3x5xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1, 3], scatter_dims_to_operand_dims = [1, 3]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      stablehlo.return %arg1 : tensor<f64>
    }) : (tensor<4x2x3x5xf64>, tensor<2xi64>, tensor<4x3xf64>) -> tensor<4x2x3x5xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<4x2x3x5xf64>, tensor<4x2x3x5xf64>) -> ()
    return %2 : tensor<4x2x3x5xf64>
  }
  func.func private @inputs() -> (tensor<4x2x3x5xf64> {mhlo.layout_mode = "default"}, tensor<4x3xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xFADF2701758C02C0608D96F6F6F0F2BF1361E24B15CD0A401B57C051853507C06B0F36050655034050012F2F2A390EC05A93DE4B3C570AC0D6C3E653F51A004078B0F02B9A1314C0C018604DAEEFD53F2842E172CF3513401FBFF7EC4E7ED8BFAF4AA962C7870640C89DE056C212044032E94F8892F90440405ABF6A948308C024AA941F5B48094021852B88AF970240244C9CAE3B341340F0796935304DFC3F42D91AAEFBF3D0BF5F689EFCF40F06403E65162B0A77C43F32834D6DA5271240D960B0C6C55E12C06BEC26AD75B5F23F69597081A737064012067C5AB3CE01C0E3BC4C9ED1DEF33FAAEC96F7B543F43F94D2DC628644F4BFBE3B43F4CDDB104030791AFABC65E3BF68BEABD44F1600C098D09D8913A61FC02C0B3A016E79F43F7A0B4202CBD2EEBFE692AA49A93E1340D945B8ADF83506C04E2FE6A3E94B01C030874AB275C118C0032A33092426FFBF3D139F4E9D42F8BF84A6F66880AAF9BF34B44F9A05B3FABFBE197BE78F8104C0B4EA081C9FECD9BFC835CDA2D254F9BF3EB10F5F982E02C0D813F64FD3F8F4BFDE95412F8A3DDBBF3947F8D00E0AE4BFFEA4F41DCE211AC0049BCE37137C0AC078DEDCE53288FD3F39E9D6EF4A57F33FCAFB9DCE2AC6CE3F347D4149669808C02EB675D97A7BF93F18FAFCADFD52AE3F689859DB81E6F2BFF3550024C16AFBBFDAAF3CA63EE40EC05E1EA67B3217FABFBC820790F883E9BF2CE7A39A5AEB0D40BC0CDB3798FAF4BF21EF6C790253F63FE2201ECED3DB0440C4CC5D898A1211C048A230E42988FA3FB732F52F6590D2BF4C2A341840240A402BBC9FD1DEFCF6BF88AA4D5A7E6EC63F4F06BCCD06CE0B404897C3A63C70F7BF4ACCA4B43577F7BF2676684C9EF500C0B025E9A9B6C1F3BF46EA94C0364A16C08E1C181525491FC0ACC81F39DB3AE83F547A71AB0B5DFC3FEB3109A868CAF33FBC4C6FE0710700407254B43D78D414C02E8BDD607EF4014092877FCFBBF0E83F1483C95A420BFA3F78598353FAC706C03CD3AB5058BAF3BF4FCB2458CEE5B43F5A934EC10F280440FE0703690EB9F1BF6BC2B3F10B670AC000B6A0CA53610540180DEBE50CB2B73F5CBA67B7C47C0AC0ACD6C79E203BD93F88F4D9295612C8BFD544353C0F7DDEBFDA723C6A2B66FD3FF9EEF33C796316C02CEEECB06CD41140CCCD1CE27758ECBFB0347A38A1510EC02D21553843F3EDBFD30D2F2BD3FFEB3FDACD8FEAEB650540348A126137F3F3BF18AD29526F7300403AEE604B2FE3FFBF7C6F436D02D7F6BF0E5A76417AA21440EAB77A943FE1D63F5CD664284A67DA3F5B0B7C1C77750AC0A8D4B8F7F044FABF4680C0F1DD080740"> : tensor<4x2x3x5xf64>
    %cst_0 = stablehlo.constant dense<[[2.3981820435009205, 0.9283540802891046, -1.2950643510535638], [-8.5131186581872597, -1.2845910341175841, -2.1735571383813181], [-1.3052048336175714, 7.3634456630589371, 0.066315855972680249], [-2.3715905950965954, 1.7028962552193589, 0.52489133239010832]]> : tensor<4x3xf64>
    return %cst, %cst_0 : tensor<4x2x3x5xf64>, tensor<4x3xf64>
  }
  func.func private @expected() -> (tensor<4x2x3x5xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xFADF2701758C02C0608D96F6F6F0F2BF1361E24B15CD0A401B57C051853507C0F88635117A2F034050012F2F2A390EC05A93DE4B3C570AC0D6C3E653F51A004078B0F02B9A1314C04665BE9D13B5ED3F2842E172CF3513401FBFF7EC4E7ED8BFAF4AA962C7870640C89DE056C21204402BD99F6595B8F4BF405ABF6A948308C024AA941F5B48094021852B88AF970240244C9CAE3B341340F0796935304DFC3F42D91AAEFBF3D0BF5F689EFCF40F06403E65162B0A77C43F32834D6DA5271240D960B0C6C55E12C06BEC26AD75B5F23F69597081A737064012067C5AB3CE01C0E3BC4C9ED1DEF33FAAEC96F7B543F43F94D2DC628644F4BFBE3B43F4CDDB104030791AFABC65E3BF68BEABD44F1600C06CC31F7DB70621C02C0B3A016E79F43F7A0B4202CBD2EEBFE692AA49A93E1340D945B8ADF83506C048510454AF8DF4BF30874AB275C118C0032A33092426FFBF3D139F4E9D42F8BF84A6F66880AAF9BF4DAECAEC716301C0BE197BE78F8104C0B4EA081C9FECD9BFC835CDA2D254F9BF3EB10F5F982E02C0D813F64FD3F8F4BFDE95412F8A3DDBBF3947F8D00E0AE4BFFEA4F41DCE211AC0049BCE37137C0AC078DEDCE53288FD3F39E9D6EF4A57F33FCAFB9DCE2AC6CE3F347D4149669808C02EB675D97A7BF93F18FAFCADFD52AE3F689859DB81E6F2BFF3550024C16AFBBFDAAF3CA63EE40EC05E1EA67B3217FABF597FAF761EE2F4BF2CE7A39A5AEB0D40BC0CDB3798FAF4BF21EF6C790253F63FE2201ECED3DB04403DD892192B741D4048A230E42988FA3FB732F52F6590D2BF4C2A341840240A402BBC9FD1DEFCF6BF64E19B7013FAB03F4F06BCCD06CE0B404897C3A63C70F7BF4ACCA4B43577F7BF2676684C9EF500C0B025E9A9B6C1F3BF46EA94C0364A16C08E1C181525491FC0ACC81F39DB3AE83F547A71AB0B5DFC3FEB3109A868CAF33FBC4C6FE0710700407254B43D78D414C02E8BDD607EF4014092877FCFBBF0E83F1483C95A420BFA3F78598353FAC706C03CD3AB5058BAF3BF4FCB2458CEE5B43F5A934EC10F28044048876B7D04F902C06BC2B3F10B670AC000B6A0CA53610540180DEBE50CB2B73F5CBA67B7C47C0AC0465ECA24103FFB3F88F4D9295612C8BFD544353C0F7DDEBFDA723C6A2B66FD3FF9EEF33C796316C05E3852E8E8CBE03FCCCD1CE27758ECBFB0347A38A1510EC02D21553843F3EDBFD30D2F2BD3FFEB3FDACD8FEAEB650540348A126137F3F3BF18AD29526F7300403AEE604B2FE3FFBF7C6F436D02D7F6BF0E5A76417AA21440EAB77A943FE1D63F5CD664284A67DA3F5B0B7C1C77750AC0A8D4B8F7F044FABF4680C0F1DD080740"> : tensor<4x2x3x5xf64>
    return %cst : tensor<4x2x3x5xf64>
  }
}
