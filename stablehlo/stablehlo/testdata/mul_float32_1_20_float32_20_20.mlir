// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<1x20xf32>, tensor<20x20xf32>)
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = stablehlo.broadcast_in_dim %0#0, dims = [0, 1] : (tensor<1x20xf32>) -> tensor<20x20xf32>
    %3 = stablehlo.multiply %2, %0#1 : tensor<20x20xf32>
    stablehlo.custom_call @check.expect_close(%3, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %3 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<1x20xf32> {mhlo.layout_mode = "default"}, tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<[[7.210290e-02, 1.62635362, -0.475408643, 2.24727774, -0.387222171, -1.94730842, -2.26543784, 1.14745438, 2.38171506, 0.776695967, 0.301315486, 0.346164763, 2.79359055, 3.06095266, 2.32065725, 7.43872642, 2.44612527, -2.22714376, 0.880327999, -4.15442657]]> : tensor<1x20xf32>
    %cst_0 = stablehlo.constant dense<"0x81C35EC086E9EBBFB016F23E36E92D40CF8E3240445A6CBF41F39A3D65982640969A983FCE69CBBE24822440153D043FA1501AC028EE8A40B43003400E4F0CC07679D23E2FB7D43FE648C73F4EFB80C0F5DC0D3FCEC81440204FFFBFED4ED3C05C67A53F502E35C0DEE325404FC683C0C051D23FD2FF39C0C575763F2BF73BC0F0FCC8BF42A50D4098C906403012D83E623A44BF1CF8423F51694DC0070A74C0EB3993C0B91F00C023D10F40B6AAEE3F514B01BFF7311B40CB95563F76CFA5BFAACE6E3FC9C3ABC089A71C3F3E8D4440FB82B340AC042FBEB5A258BFEFACF23F999470BFFFDE28BFF94BD3BE4CE7ED3F45FC033E02F913C0F1A926408F155C40A59DB4BE92B57DBF90695BBE964B0840794B4B40A83A08BFA84699C0CE80BD3E1C96FCBFBAB6183F898CCDC0BD7C9140396BD83F0E36C83F7AC287C0134DAABF0A2C0C40F22E0B403D9690C0B052A0C0EF2B94C0DC8FE4BFDDC9D73FB023B8BFB8785ABF092975BFF6919B3F9F6B90BF86E46EC0EF60174044B004C082BBEC3FBA8705C0F218A1BE42C8983FE1BDEFBF6329F23F26C3DABE7740063F4CFC0CC1915E4440F72392BFEC2D1B409019CD3F9F5517402B1D433F4C71323F6C1D6D3F272F6E40DBCBFEBF66D52EC0A034C73F26406740949D1940DA385DBF3F6E34C06FFD443F352EBEBFBE9461C081C1D03FE0AC4F40FD8ACB3FF74637C06F0128C05A8ED6400BBA63C0C3DD9DBF3650A740B77DD7BFC1D3A3C0A537FBBF8C2C6EC035FCEABF2E8A26407B188C3D7D6383BE45508340CDDA46402B2E56BFB05ED9BF10CEB2C09090C63F77AF8E3FD91208C057B085C0949AD2BF459C613F73CA8D402188AE40A0FB2A40BAA2D83DB50921C0CD49E340B4B2E6C0621707C0062C124082A4373FC4B55E404F569EBFEFB222C0984A223FABC14E3E10A724C075D0163F198868C006864640792E70C05CADAABEA7D51A4059F1224026766940ECA2733F33229F40673F783E5A4683C048BF8340A9E699BFCD484DBF55329FBFD93C023E26B30F3FE1F2BD40EE1EF9BF87309D40F63A60C0770DB7BFC8073CBFC77A993EB25852BFEF26B8C0DC4AA9BF63C56FC01336B43F8842DABFF35C6F40964BF43FEF67324020DD83C0C39F41403579B4BF094B8EC092E182C0B97D5F40E6E6EB3F6C8AB5BCBEB605401D780ABE13712A4072CBEF3F24ED80C0872FA33F2C05753F5F8A6D3F48085D40CF073140A3DB463F254E843F98FABE4041B4D63E815602C00EAB113F44DF273F828B74C033F715BF5D30D53F0203054190CD3B3FED1E8440C8F48340F00C41C0E5EE9CBF6F28853F5A48384060F14140C2D8B8BF77F9D03F8F58144043BC1FBF9CF16F40A4380A407D9B82404016C9BFB7D088407011BABF5288CEC026FC48BF36BBD440082D973F54AC93C008F583C0F2388FBF649537C0E0B164BF57763A40F13F05C01901FC3F2CCDF83FF26ACD3F41BC16C0D178DA3B5D830E41088974C0126856402C2508BE40C067C0BD7110C026CC9AC02105ADC09AF3A0C0D2C98BC0FF514F3EDF48CF3FDF05A740EA44F6BF66A02240E7CBE63F04CA64C0B478104099508FBFD6348D401F253CC075263D40A012E94077C0FABD0AC4B0C070CA24BFFD49443F9AC8C740A740A84046255F40944B1BC0E160A6C060FED1BFD07672BE400A82C0C32B7B40412C463F5FD987BD909838BC29BD0240E50C1B40C144C3BF64C327C005569DBF251AC3BFC70A55400FEC1DC0351066405B742AC0A6695AC09618A1BF42661840523AFFBF5CBE7CC07E4B654060D2073FBA3D0E40995D3B405C2CB5C0489580C0612C23C046FAA9C0BFB63BC0D1D8C4BF0C16D6BE84E1DB3E27F66340FA9760BF02B927C017222CBF0D8DCDC0BDCD4BBF5204ABC0F287EDBE300F6D3EC9B8CABF9C5B7D408E2702C0B9A49040279FFF3FA42D68C00EA401C1721C1B40E0FFE140810CBC3FA47055BF9B2385BE0FBB11C07404373F55839840D5C20EC051CA134014F97BC05A882240C0894CC0A142F33F33208EBF61E219BEC6919EBDF83A303DD0625640C3BF24BFBEA9B03E369A463FB47C1F410F2C80BF6C9B7E3E5EDBAEC0562F9AC00AA6C1C004032D400E8F30C0111FBF3F0FA4B73EFB27B6C08048AEBFB00AF83F86C5EF3F6D8E304039551AC063F611C0F8A7C83F4733F33FDC61CE3FF0516A3FFA1EB7BFB55643C03CC7983F81DA933FC25BB8BE68E669C00AB71A4017596240CE4AB23F48CF43BD2EEF6BC0"> : tensor<20x20xf32>
    return %cst, %cst_0 : tensor<1x20xf32>, tensor<20x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xC97E80BE9DD63FC09B2E66BEC369C3407A488ABF2E20E63FD9832FBE16293F40BDBA354084FD9DBE9246463FFA1A373EE18BD7C029A154414B399840017782C133B6803FC3DF6CC09B6FAF3F12F68541EDA8233DDEF9714096C0723F296F6DC1931800BF5568B04028E8BBC0953497C0DA757A40047710C04286943E522282BF9C5E8CC0FFC8D840D4659C4063E94840CCFFEFBFB91CD9BF54D434C0F1757D41D6D8A9BEF35F50C05FBE88BF711686402843483E3F1B97C08C10F3BF8642BEBF56310E40B56885C044CF3C3E1D14883FB3BD7A413FEE05BF535EFBBF4CA661415B1F13C0D20CBC3FAE02BABE9216F7C0B743183CEAA770C084779EBF914BF7407BE00B3E6C06F73F5488F83E81641C405C18F240029ED3BEDCBCB8BFD932033EDD67B0C08EB9E93F1D816EC1AD470742CE58844013F35EC0AD066FC036E0B0407EB5213E845C6240C7790940292534C15880E53F518A5E40816D74C0A44AD3BF911502C03E6A3EBFB780BB3E17F9C7BE92D726C173AEE7405AF699C09D1F5C41D750A3C0C264333F9E7F863F52FFF84039AF0B3E76E431BF434C7FBEB56A9EC1C11398BF514A0E404EC6AFC0BD57EB3FC037B440518B173FEE11573E6329A43EE7582641D8FAC2C04ADDCAC0BE3A3941BF6A0D41DC0FABC07CBF42BF7F653B41BB41633D7FA61AC0817CD63FF3906A403DD5A0BF302E46C0009ACF405DC740C076817F41DBDF30C02B45BEBE02ACE73F9B7F96C0CDBB7AC152BF91C0C376DDC168B38FC03974B9C003A9763D0B76883F497D973E3BB4A14079A5CB3EC83E74C077790A40575541C05A9F21C066231CC050341FC13C93A3BFB8F5873EFA54C43FFEC87341B8D70241595E7B3E58BD95C170FE8A410E73804171D9EDBFAFD017C1CFDB533D461AB540B98C163F9CD0B6C00D5F7BBE324FC9BE4E81BA40710D2D3FBE740AC143311A40A7BD90BF6854ECBDAF45D8404B61F94030720741078BE2405FA1424187380ABF392167C061D588C11F8CB1BDB8EEA6BFEC5D173F1357923E33935EBEC4F138C189178D402B5EB440608305C11C2D8EBF3AA062BE5584D43DCDE712C092EB8CC1526F44C0EBF2DEC1DD685C404F0C7340D0B7524008BAFDC042D14D3E0675D6C0E219B8BF79C94AC06C65DC3FAEDDFE401127FDC0E75707406A3058BDC2B5CF3F43E426BDEE006C3FD978A740965145C157593D406DD4E34072431140AA22F6C04CD81B4002894EC02BA2983DB24C1B41F6244CBEE77392C0B19F61BE0C73A3BF17800A4126142CBFACE07D40909ECE400E5A623E38F1B63FD6503841CABA13C1151836C0A2A1F740A263E14026F8D7C0CAB9A2BFD30AD9C085232B3EA4E481BF8824E4BF8F4F9B40D94BCABF04CA434028F91AC13281D5BF67F375C1AD1A1CBFCF320040BC53D13EE8444EC112F549C1632F26C017B4AAC1A3DA0BC09EA3CFC0659BEABFDEDD02C1B3830F3E7C0A274061528F3FCB7B753CABBC5CC0C217EE40C1DCF2C06D381CBEBFFD09C1EC60E0BF4D92BABFE292EFBFFFD060C15AF155C1478FF03EE2BD40418E474C41861E89402B2A0F40EFB4EFC08BF883BE35F66A402744083F3DAA1E4135B5913FBB2AB8C0C20084C1F6DC0FBEBB8052C112FCFFBE66946C3EEB500A40AD036B4171C22A418931B4C099B41AC2EE6A80C02800073FAEF464C0146F82C1149F643D4EF0DCBD5B84AF3B40E79240E02770BFC31F3E405207BE403189B4BFBE5668C00C78254067563EBF95479F3F0E17EEC0422327C1A2EC3AC00CB58D416E149CC05DB90C41CEDA4940BE100DC09018243E835C98403F432C40237B10C1C4BC7C3FDB7F254185A0D44075DFE1BF32F27EBFD7C7AA3E6E60893F2A7E9BBE3646EAC00EB903C0B6816EC14581BDC0132A51C10241843FA1B0503E598CD2408724923E61AD53C08D8709C0FD9C8F4025CFB33F61737C4182B2AFC07DA901417BF05F402AC725BFAC77A0BD8EC949BF49A3FF3FE56A694156A6A5C0E46B8941E0161AC1E4FDB4C0840F34C0D8A6FCC080F6A3BD31457ABE43C5163DEF04C63DAF07A6BF9C68A03F0E1C48BF1EE3633F2BEDBD41FD1947BF236F993D001EF2BF605D57C1F22F94C122C0C840ED2BA4C1DEC069404E7F4CBF705BA0C0FE02B54084130F3E08FA424072DFA7BF196AADC06014623FA45E43C021BD89C072D0EC3F5A850B40B63A8EBF2E6F6BBFBA8BD33E68854E40FF138DBF50B307C13EDC8F413D6B0A418B8A46C073602CBDFD0A7541"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
