// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x125xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<0> : tensor<1xi64>
    %0:2 = call @inputs() : () -> (tensor<1x125xf32>, tensor<1xf32>)
    %1 = call @expected() : () -> tensor<1x125xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<1x125xf32>, tensor<1xi64>, tensor<1xf32>) -> tensor<1x125xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x125xf32>, tensor<1x125xf32>) -> ()
    return %2 : tensor<1x125xf32>
  }
  func.func private @inputs() -> (tensor<1x125xf32> {mhlo.layout_mode = "default"}, tensor<1xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xCA490C4003B19DBEE71AF2BFB34C963F5692BBBF5EE3503D90787740A4EC694071A6B93F24D0E9BF7AB40C402127063FAD00893F36A200C00FF63E3FA3C141BD3F7F1FC151856D40A69DE43F8516CCBF4FE9EEC080AE93BF13192CC01E39274029A948BF85D340C0B0BD9CC0F72DA0BF42B7CBBE3E8892BE7F1325C03A2F05C01EB9C0BC014BBCBF531938BFDB688DBEDB2FB4BFA437E73FDF24623FB38E413F5C23B1BF60B94BC0CF1DD93F7F83BE40E4E82140825B50BFC457D0BF21E02F40B62D8BBF4BA70AC0E447F8BF3941BF3F464886BE06FB0940946890BEE64F494049D20CC0EB05DD3FA9C0F4402E4012C088A6F34097F5073E765B34BF3F2D35407A7DAD3EE04E58C02FA8573E14CF22BF0064A13E50680C40DDCB4740908FDD3E0D1C363FCEA01B4082F99BBF15010D40720E2FBD7C3D30C0D07CB64075F53D4087574CC08079FC3FE65BCB4015C7663F62926240CA708640336513C06D851640DB1327C0C14C0FC0348BE53F28860B403E9E4540DC595FBFDE81164052B3D2BFB2BF793F7AFA3AC094CF12405ECF8C40835169C0D07158BF8381CFBF728DF0BF50261C40348D4ABF8CC146BF3E3565408C43BD3CFEF78C3F3B6480405F3A64BC0EE1E1BF0AB6F33F050EB63E8AF43D3EC69337C08BF2B83F0808D5BEDE38A4BFA580AD4085730D40CE6AC13F5615FBBF0F1B3BBF"> : tensor<1x125xf32>
    %cst_0 = stablehlo.constant dense<0.222643897> : tensor<1xf32>
    return %cst, %cst_0 : tensor<1x125xf32>, tensor<1xf32>
  }
  func.func private @expected() -> (tensor<1x125xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xC3FC633E03B19DBEE71AF2BFB34C963F5692BBBF5EE3503D90787740A4EC694071A6B93F24D0E9BF7AB40C402127063FAD00893F36A200C00FF63E3FA3C141BD3F7F1FC151856D40A69DE43F8516CCBF4FE9EEC080AE93BF13192CC01E39274029A948BF85D340C0B0BD9CC0F72DA0BF42B7CBBE3E8892BE7F1325C03A2F05C01EB9C0BC014BBCBF531938BFDB688DBEDB2FB4BFA437E73FDF24623FB38E413F5C23B1BF60B94BC0CF1DD93F7F83BE40E4E82140825B50BFC457D0BF21E02F40B62D8BBF4BA70AC0E447F8BF3941BF3F464886BE06FB0940946890BEE64F494049D20CC0EB05DD3FA9C0F4402E4012C088A6F34097F5073E765B34BF3F2D35407A7DAD3EE04E58C02FA8573E14CF22BF0064A13E50680C40DDCB4740908FDD3E0D1C363FCEA01B4082F99BBF15010D40720E2FBD7C3D30C0D07CB64075F53D4087574CC08079FC3FE65BCB4015C7663F62926240CA708640336513C06D851640DB1327C0C14C0FC0348BE53F28860B403E9E4540DC595FBFDE81164052B3D2BFB2BF793F7AFA3AC094CF12405ECF8C40835169C0D07158BF8381CFBF728DF0BF50261C40348D4ABF8CC146BF3E3565408C43BD3CFEF78C3F3B6480405F3A64BC0EE1E1BF0AB6F33F050EB63E8AF43D3EC69337C08BF2B83F0808D5BEDE38A4BFA580AD4085730D40CE6AC13F5615FBBF0F1B3BBF"> : tensor<1x125xf32>
    return %cst : tensor<1x125xf32>
  }
}
