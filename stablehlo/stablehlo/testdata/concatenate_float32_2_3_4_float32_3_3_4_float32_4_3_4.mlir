// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<9x3x4xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:3 = call @inputs() : () -> (tensor<2x3x4xf32>, tensor<3x3x4xf32>, tensor<4x3x4xf32>)
    %1 = call @expected() : () -> tensor<9x3x4xf32>
    %2 = stablehlo.concatenate %0#0, %0#1, %0#2, dim = 0 : (tensor<2x3x4xf32>, tensor<3x3x4xf32>, tensor<4x3x4xf32>) -> tensor<9x3x4xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<9x3x4xf32>, tensor<9x3x4xf32>) -> ()
    return %2 : tensor<9x3x4xf32>
  }
  func.func private @inputs() -> (tensor<2x3x4xf32> {mhlo.layout_mode = "default"}, tensor<3x3x4xf32> {mhlo.layout_mode = "default"}, tensor<4x3x4xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<[[[-1.953030e+00, 2.05950665, 2.3854239, 2.38184953], [0.765693426, 4.09123898, 1.92274404, -4.34489393], [0.824891984, -1.64015448, -3.7772758, 0.547654867]], [[1.29468739, -9.07286643, -4.98233175, -3.45069027], [1.89753163, 1.38768494, -2.948627, 3.98811412], [1.63555312, -4.82003832, -0.685211837, 1.66109741]]]> : tensor<2x3x4xf32>
    %cst_0 = stablehlo.constant dense<[[[0.659511089, -2.89385772, 0.289041758, -1.77192366], [0.470422298, -2.5430584, -3.22449517, 0.512335658], [3.5530498, 1.40809155, -0.281045496, -2.00989246]], [[-7.84037303, -3.54320478, -1.95607173, -2.98617935], [3.36991048, -1.64211965, -4.5221591, 4.27031565], [1.4676404, -6.29902887, 1.79546607, -2.13308144]], [[-3.26074243, 1.47914219, 4.5732975, 2.96255541], [3.72356486, 1.38876295, -5.80264664, 3.32357955], [-2.3450079, -3.98001957, 3.226758, 1.44549334]]]> : tensor<3x3x4xf32>
    %cst_1 = stablehlo.constant dense<[[[-0.555016279, -2.20731282, 2.90613341, 0.500222266], [0.38899371, -2.92378283, -3.08918715, -5.68386698], [0.62350738, 0.0829987525, 2.99244976, -4.79262972]], [[1.75759315, -5.2516346, -1.98002207, 0.109034732], [4.79244184, 0.892904877, 0.84407258, -1.53377807], [4.03320408, -0.24227798, 2.58443809, 0.018028507]], [[2.230124, 2.85721684, -2.45961165, 2.87561679], [-1.32067132, -1.56313062, 3.28821301, 1.65090251], [3.18915701, -2.51505828, 2.11667728, -1.22647262]], [[6.48363876, -0.793597638, -0.203004882, 3.0453279], [-2.33138275, -5.18852329, 0.254258901, 1.73985839], [0.708224654, 0.726162076, -1.25470269, 0.230825275]]]> : tensor<4x3x4xf32>
    return %cst, %cst_0, %cst_1 : tensor<2x3x4xf32>, tensor<3x3x4xf32>, tensor<4x3x4xf32>
  }
  func.func private @expected() -> (tensor<9x3x4xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xE3FCF9BFF5CE0340C9AA1840397018407C04443F6EEB82407A1CF63F5F098BC01F2C533F95F0D1BFE3BE71C01C330C3F51B8A53F762A11C1436F9FC01CD85CC051E2F23FA99FB13F4EB63CC0433D7F40CE59D13FC13D9AC00B6A2FBFD79ED43FB8D5283FF73439C048FD933E65CEE2BF31DBF03E78C122C0215E4EC06E28033F2B656340583CB43F32E58FBE14A200C056E4FAC0DEC362C08F60FABF901D3FC09DAC5740FA30D2BF87B590C06DA68840A4DBBB3FA591C9C0D5D1E53F688408C001B050C08854BD3F74589240829A3D40E34E6E40FCC2B13F48AFB9C087B554409C1416C0A4B87EC034834E40ED05B93F8C150EBF9D440DC017FE3940910E003F2F2AC73E421F3BC03EB545C03DE2B5C02E9E1F3F40FBA93D4C843F40395D99C0D0F8E03F640DA8C05D71FDBF9A4DDF3DAF5B99406A95643F2415583FD752C4BF02108140B81778BE6F67254085B0933C5ABA0E40A4DC3640476A1DC01B0A3840C20BA9BFAA14C8BF15725240C650D33F261B4C40B7F620C0A47707400EFD9CBFF879CF4037294BBF83E04FBEA7E64240603515C06208A6C0392E823EAEB3DE3F364E353FC2E5393F199AA0BF765D6C3E"> : tensor<9x3x4xf32>
    return %cst : tensor<9x3x4xf32>
  }
}
