// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<2x7xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.multiply %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2xi64>, tensor<2x7xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<2x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xAD36476C2A6FE2BFB0AF673E327D0840B8089DDDD650F13FA0F670DC047F0CC072D4B5B50EE30340F1E8D4158C821240E67357A4FC97DEBF46292E93A846DBBF47D1F8E231010BC030AEAB26E86ED5BF4C1BDD083EAF0240D2BD81805807D63F066153632FF7024074BF965E63300940FE56789CD7A1F43F16AADC038E190C409A34AFA32D221040481B99B45BB4F53FAABE502FBCBB0640003E54617F92CBBF442FB6AD498CFABF61481A4EE54E1D40C603F9B8CF83F43F85231F891D72FF3F666816A6E39C0F400BAB9B5FE41CE0BF180E892EA80CDABF4BF7FF88ED380440E8AEF639E70B00C0BAD37F235324E13FAE27C7BECB6012C0478531D1BB7213C0FE788DA8228DCBBF72F0076DBD67F4BF7375139FC644124014AFC5BB6D23F13F0BA9BF3E678B0740FEFDACAE76C31740C66D101E25F7BB3F07B225F7F0E600C0B79EF54B39FC01C0BC5E2852F30803400E8A97EB66140C4007033247C490F03FED2074AE1439E03F853BFD018D5D16404F0691E0E13CF0BFBE40F319EB8EC9BF2814B0024A47D8BFCE6D5DC68C29EE3F0E7C72586242FBBFEAE970C814741B406855CD975EF91440B78031C316E606C0391081BE496EF33FAE8C52CC789DED3FE44803B91F6FFE3F8FF5B0CC83DA07C042E523CFCE82ED3F191F4EEDF0720C40968B6EE9BB3602C0EE684D61CFFFF0BF1AB8B3D31A2802C04CAF24A601A1EDBF9A0D6F467FADF4BFF408EE880B390CC000C2C3BBE16504C004973BEC6BFE054098EDFA74607CEE3F6EAB8AEE134F0A4041F3AF1DB80A02C036995D0CFBF1034086CF12012F1118C030C5B971C8D311C0695DC2B14B93D7BF3569968AB866623F9BF3BD77355A11401FB50449EB7702C05E8D218C6396FABFE8AE93BD466401401C85E884876CE6BF9B9EAA12F65BE4BF87417FCEA33B214000D0297824DA02C0D5355C83B18AF03F0C3FDC7AE007FB3FE041B37C3D170B40A6ADA5EA56FAF13F6C5F7F17858D0840D2713F605C60A3BF4808BA8542D1E33F93CB12A86445BE3F5B4C34CB17A1E63F8F612E3F2242C0BF6A7488ACDFB8F1BFB2FC0A6A3333FC3F5D9862EE6C08C4BFB86629A05A4D0B40B904A8CCEAF4C03F448F2FD8D219FB3FEAE7110BF1FAFE3F4561DBB98FA3EBBF0866580D801DF13F627F24FD33A71040FDF852C11E95D4BFF86A40D910C2EE3F08813C3C6EBB02C03ACCAF0AA89FE9BF60D69017DBB609C065FDD34D64F5F8BF25A2F9A1B80D004059392A1AF21500C03AF7021AF421F0BF2E539E76E3CCD43F163454AF7BE6D2BF2A4419655D0914C01EE4C8A0739804C0CE65CB93FF48E93FB4B3D21F7DF9FDBFA2ED084B32AAF23FCA2B627B264D09C0F631144DCF87FFBF609AD05AA8ECE23F166F980EFD9D18C00B3FD57748F3F53FC434955E262701C0D2D7FAD5AC6EFF3F3C346213321815C0508936B955DF02C037DFC6BA34CCF73F9F4223A42EF80DC028871E5B9A79F3BFADD590683F81E03F7A9D10510F9915C06E9387F01F3C14C022603ECC32FF1EC00AB54E6BAF830EC09E6920AB8811F5BF98D8A409AA19CC3F4D1CE019E94212C0F4657EB8BBEB1040F0A57A6BD606E7BF95F69D28D94411401027CAD368FA07C0E60ADE12521E02C0F4A5C9587001F9BF4478FC0AB9410CC058A0D592BC6BFCBF3AB96778769707C0FCBB926755ED14C0B88F84E005DC0240CC93266E76D907C0669633A0FB54CC3FD4466940187B14C029B8F15937D6D53F10F0CE414F07CC3FB5381DEBFB280040CA39F598E9E007405FCECD159C6901C0D5A68B6C0DA405C022C76AFC3C37FB3F41EA6E284A8F00402B7FB73EE457F0BFB3B54070EAA326C0F883493A4A790340A8E4E3D2F6A3104015CA072261351440F63292C6C1D4ED3F2D270D3EE224D13FF88D6E42BA7BE83FD5CC89C27EF20BC054F53BED0A7E0540FABB559DD3D4F7BF6E93107C8CFCF4BF7607F9DDD38701405D877C4D42A20040B610D846A608FF3F042970D81DADC2BF045C670B9BE8FE3FC64C0B44563DF83F15DE7F40B5C00440861BC977A042F7BF68A7F0F235D913C067BF249B4F2814C01C4037A15856B73FA37174B5D5BC09C03CA2C1F4A270CCBFDC7499FD3D2EFD3F64154F04B2C501C09574000343ACD3BFCB017F72343B10C0381B183721421BC07A053FDDA6E70640E4A858925237DC3F245718B3299D0D40861BB0C2699F00C0045FF5CFF835F6BF3C9F7975B2811740581D129B5B85034026B51FEDAE8DBA3F1FFB7FD5BE09FFBF5853149CD600D9BFB34F0011341B0BC0DEB3AB9DE688B83F9DA165D5E75AD4BF1F05DA2C9DEEE2BF89C0B943778BF5BF217EC01AE2A4D6BFA7CD0EA4B6CB0F40E868F9DA83BE0040"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[-4.7996992985726745, -2.0760117444365549, 1.6443447785476846, -1.8064711547540904, 4.9466353673197538, -6.0988715164944693, -1.7509591568187353], [4.1191716258703917, -0.084749327404239919, -2.4728064724232395, 3.0054377256564146, 3.2859904513554268, 2.8328988400656732, -1.8966182602530677]]> : tensor<2x7xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<2x7xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xAD36476C2A6FE2BFB0AF673E327D0840B8089DDDD650F13FA0F670DC047F0CC072D4B5B50EE30340F1E8D4158C821240E67357A4FC97DEBF048A9A27555D0040D20FBDD6EF071C40916A2BED2E9FE1BFFD5B330765E010C04973415DF23DFB3F9F67659CC9EA2CC0C5335AA16E0D16C0FE56789CD7A1F43F16AADC038E190C409A34AFA32D221040481B99B45BB4F53FAABE502FBCBB0640003E54617F92CBBF442FB6AD498CFABF61481A4EE54E1D40C603F9B8CF83F43F85231F891D72FF3F666816A6E39C0F400BAB9B5FE41CE0BF180E892EA80CDABF4BF7FF88ED380440E8AEF639E70B00C0BAD37F235324E13FAE27C7BECB6012C0478531D1BB7213C0FE788DA8228DCBBF72F0076DBD67F4BF7375139FC644124014AFC5BB6D23F13F0BA9BF3E678B0740FEFDACAE76C31740C66D101E25F7BB3F07B225F7F0E600C0B79EF54B39FC01C0BC5E2852F30803400E8A97EB66140C4007033247C490F03FED2074AE1439E03F853BFD018D5D16404F0691E0E13CF0BFBE40F319EB8EC9BF2814B0024A47D8BFCE6D5DC68C29EE3F0E7C72586242FBBFEAE970C814741B406855CD975EF91440B78031C316E606C0391081BE496EF33FAE8C52CC789DED3FE44803B91F6FFE3F8FF5B0CC83DA07C042E523CFCE82ED3F191F4EEDF0720C40968B6EE9BB3602C0EE684D61CFFFF0BF1AB8B3D31A2802C04CAF24A601A1EDBF9A0D6F467FADF4BFF408EE880B390CC000C2C3BBE16504C004973BEC6BFE054098EDFA74607CEE3F6EAB8AEE134F0A4041F3AF1DB80A02C036995D0CFBF1034086CF12012F1118C030C5B971C8D311C0695DC2B14B93D7BF3569968AB866623F9BF3BD77355A11401FB50449EB7702C05E8D218C6396FABFE8AE93BD466401401C85E884876CE6BF9B9EAA12F65BE4BF87417FCEA33B214000D0297824DA02C0D5355C83B18AF03F0C3FDC7AE007FB3FE041B37C3D170B40A6ADA5EA56FAF13F6C5F7F17858D0840D2713F605C60A3BF4808BA8542D1E33F93CB12A86445BE3F5B4C34CB17A1E63F8F612E3F2242C0BF6A7488ACDFB8F1BFB2FC0A6A3333FC3F5D9862EE6C08C4BFB86629A05A4D0B40B904A8CCEAF4C03F448F2FD8D219FB3FEAE7110BF1FAFE3F4561DBB98FA3EBBF0866580D801DF13F627F24FD33A71040FDF852C11E95D4BF93B41A39A8AC0F40303E4C638D66C93F2E6E0B6361AEFF3F0FE2783F175223C0FE8D48C0DE8014C095F5685536BD1640098CBAC82B820E403AF7021AF421F0BF2E539E76E3CCD43F163454AF7BE6D2BF2A4419655D0914C01EE4C8A0739804C0CE65CB93FF48E93FB4B3D21F7DF9FDBFA2ED084B32AAF23FCA2B627B264D09C0F631144DCF87FFBF609AD05AA8ECE23F166F980EFD9D18C00B3FD57748F3F53FC434955E262701C0D2D7FAD5AC6EFF3F3C346213321815C0508936B955DF02C037DFC6BA34CCF73F9F4223A42EF80DC028871E5B9A79F3BFADD590683F81E03F7A9D10510F9915C06E9387F01F3C14C022603ECC32FF1EC00AB54E6BAF830EC09E6920AB8811F5BF98D8A409AA19CC3F4D1CE019E94212C0F4657EB8BBEB1040F0A57A6BD606E7BF95F69D28D94411401027CAD368FA07C0E60ADE12521E02C0F4A5C9587001F9BF4478FC0AB9410CC058A0D592BC6BFCBF3AB96778769707C0FCBB926755ED14C0B88F84E005DC0240CC93266E76D907C0669633A0FB54CC3FD4466940187B14C029B8F15937D6D53F10F0CE414F07CC3FB5381DEBFB280040CA39F598E9E007405FCECD159C6901C0D5A68B6C0DA405C022C76AFC3C37FB3F41EA6E284A8F00402B7FB73EE457F0BFB3B54070EAA326C0F883493A4A790340A8E4E3D2F6A3104015CA072261351440F63292C6C1D4ED3F2D270D3EE224D13FF88D6E42BA7BE83FD5CC89C27EF20BC054F53BED0A7E0540FABB559DD3D4F7BF6E93107C8CFCF4BF7607F9DDD38701405D877C4D42A20040B610D846A608FF3F042970D81DADC2BF045C670B9BE8FE3FC64C0B44563DF83F15DE7F40B5C00440861BC977A042F7BF68A7F0F235D913C067BF249B4F2814C01C4037A15856B73FA37174B5D5BC09C03CA2C1F4A270CCBFDC7499FD3D2EFD3F64154F04B2C501C09574000343ACD3BFCB017F72343B10C0381B183721421BC07A053FDDA6E70640E4A858925237DC3F245718B3299D0D40861BB0C2699F00C0045FF5CFF835F6BF3C9F7975B2811740581D129B5B85034026B51FEDAE8DBA3F1FFB7FD5BE09FFBF5853149CD600D9BFB34F0011341B0BC0DEB3AB9DE688B83F9DA165D5E75AD4BF1F05DA2C9DEEE2BF89C0B943778BF5BF217EC01AE2A4D6BFA7CD0EA4B6CB0F40E868F9DA83BE0040"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
