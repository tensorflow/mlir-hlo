// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0], [1]], [[2], [3]]]> : tensor<2x2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf16>, tensor<5x2x2x7xf16>)
    %1 = call @expected() : () -> tensor<5x6x7xf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 3], inserted_window_dims = [1], scatter_dims_to_operand_dims = [1], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %3 : tensor<f16>
    }) : (tensor<5x6x7xf16>, tensor<2x2x1xi64>, tensor<5x2x2x7xf16>) -> tensor<5x6x7xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf16>, tensor<5x6x7xf16>) -> ()
    return %2 : tensor<5x6x7xf16>
  }
  func.func private @inputs() -> (tensor<5x6x7xf16> {mhlo.layout_mode = "default"}, tensor<5x2x2x7xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8BBC7F3E38BB5C47F5BFF241153665C286C5C4C18B39F9BE3BC21EC2DEB78DC5B7C6EBC5823F53B8BBC35B44703510B68CC42DC0BF3D30B9283DAFAC424464BD7530AB46E738B4C3853C4CC305C1033F19C4EA407B44B7C12BBCDFBEA9437CC11BC5CC424CC43537A5BB39BF30C082B205C37EC18FBBDDB2A6418531EC3FBE35D0B8803ED9BEC4BE37BD8C43BB2C56B3BDC22DBC95BF823DCB417CC1D6437045B3BAE5C082C8A0366DC490C24AB283C7443D01BAB5BE91BAEFC0ADC106C8C2BAACB7F03CBB4002C40CA4AA3675387FB8FBBCEAC0E09E83B125C40238463E0AC48FBBFA34ECBF153BDE3893BD89B8CC43A23FD1C13E42DC3875C02D3C54C0A2C31346563E05166844DAC5C33E09BD703F1E39A5C032431FB7703A3C3D5E44C13CB2C0A2BD86BE82C52E3E06A2304319B25AC6C9C43BC063C664BF2BB874C1DDBDD6C4263892BC65C17E43A3311F424EC509C1DFC046BC173E28C1DAC27DBE43461AB667BAF43BAF4411B0B4BF613EF340C2C0533AA73D144341C0B1BF19B865C080BF1AB2363F67BD29BCC93D9A396D442C432CBCB7C72D4319C00AB41BB8E03E7F2261BD"> : tensor<5x6x7xf16>
    %cst_0 = stablehlo.constant dense<"0x73BDE63C56BAB5C38E44D1B8164520357E3FF3BF15BF0CBC2E30BC3F2EBDEC3D2541D6C0F3C1AFC404446FC6CBB916C54C3D263BE8C0A5BDFC42E3BDEDC41F4223C30641C53A06440D395B983ABF45BB0A41CF40873B99BFB041A542D0BFF243484397400246F5BD02BD7B42A7C4DFC1E73B9939BB456DB027C49DC177C2E33C3B462C47E5409B42EC3A2ABD33C6DBC11B44613B263F1FC06142633D2DBD1C40743F5EC004BC0CBF54B969400441B340B5B84F386ABCC93B273F47C2AB485A3B8B42BBC60FAD5742B3417E3C52C6B1441FC49FC50D464BB4BAB425451AC5D54064C46FC177C495B2673548C027BF1641112E642D12C24444AF391F389740D3BC5CC58CC240B8C5BCB0C26BBE6FBC164575BC64BEFBBE1943"> : tensor<5x2x2x7xf16>
    return %cst, %cst_0 : tensor<5x6x7xf16>, tensor<5x2x2x7xf16>
  }
  func.func private @expected() -> (tensor<5x6x7xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x73BDE63C38BBB5C3F5BFD1B8153665C286C5C4C115BFF9BE3BC21EC22EBD8DC5B7C6EBC5F3C1AFC4BBC36FC6CBB916C58CC42DC0E8C0A5BD283DAFAC424464BD7530AB46E738B4C3853C4CC305C1033F19C4EA40FC42B7C1EDC4DFBE23C37CC11BC5CC424CC45B983ABF39BF30C082B205C37EC18FBBDDB2D0BF8531EC3FBE35D0B8F5BDD9BEC4BEA7C4DFC1BB2C56B3BDC22DBC95BF823DCB417CC1D6437045B3BAE5C082C8A0366DC490C24AB283C727C49DC177C291BAEFC0ADC106C8C2BAACB72ABD33C602C40CA4AA3675381FC0FBBCEAC02DBD83B125C45EC004BC0AC48FBBFA34ECBF153BDE3893BD89B8CC43A23FD1C13E42DC3875C02D3C54C0A2C30441563EB5B84F38DAC5C93B09BD47C21E39A5C08B42BBC60FAD3C3DB3417E3C52C6A2BD1FC49FC52E3E4BB4BAB419B25AC6C9C43BC063C664BF2BB874C1DDBDD6C4263892BC65C17E43A3311F424EC564C46FC177C495B228C1DAC227BF16411AB667BA12C2444411B0B4BF613ED3BC5CC58CC240B8C5BCB0C2B1BF6FBC65C080BF64BEFBBE67BD29BCC93D9A396D442C432CBCB7C72D4319C00AB41BB8E03E7F2261BD"> : tensor<5x6x7xf16>
    return %cst : tensor<5x6x7xf16>
  }
}
