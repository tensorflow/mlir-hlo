// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<5x2x2xf32>)
    %1 = call @expected() : () -> tensor<5x6x7xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.add %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<5x6x7xf32>, tensor<2x2x2xi64>, tensor<5x2x2xf32>) -> tensor<5x6x7xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> ()
    return %2 : tensor<5x6x7xf32>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}, tensor<5x2x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8EB5CE40743C67C09F042EBFC0D00A40309C7A409B5E2940CF5632BF4C2656C07B2E8FC0CAD45FBFA9AF4D40D1033BC00BBF33BEED0713400559D5BFD7619EBEBE12183F0678564017B89C4058C5E6C0DBBF1BBF3C95F53FE77E14405569D04047D824C074A29EBF2688BDBF5B0DAB3FB0FD733F6885174077F406C0574082C0572D4840CE4FF5BD950952C044E1D13F819462BE52B7683F066C60BF72FFAC40D583823F3C6ED7BFD1076640180749BE13AA004070091840BD89D3BFC640A53E8D9C863DD45A9ABF4E54383E58B87CC049469DBFC3E586C0E3F727C09064A8BFF2C18CBF91A0E9BFE9EAA43C4C66AA3F964A1740EB1566C0725282BEE7BE4A4049334140D5F8D6C0C53220406621D7BF7A600C4104DADDC0239E9ABFB1DF0640C4AAE3BEFCF9A8BF9AC491BF9252414019F61D400B0471BF7BA0F83F13BC10C04E7312C0C76682C07B680AC0E96EA53D02FD2140708A9FBF86A92D401540CCC05FA3DABFBFA3593F56FEA93F6189FBBFDC7C92405A1050BF16ADA93FD29069C0B592B1BFB326A0BFDF227F405191A6C0C9AF0441E3010640C7900DC04F171D40BA161040CBACCDBF5F5E37C054369ABFDCBDBCBF24EF2640A27EDF3F74E3C2408B3FA6BF0BAFFFBFB3E025402F911D400A7DA7C0322590402302673E05DBA2C06474BAC02473C03FB1BD41BF3A4C264064C72BC05B013EC0B65A4EBF2EA3E4BE7F2437C0F5BEB2C05F76793F50B625BE2CED1B3F26B340BE958E78BE8ADF1BBEBC97E040CC339D40FC97154011EEE33FF9E238410B47343F4D6E3AC0850B57BF37AF653F8CDE92C01A8EA63F13F60CC13CE95240714563BEEB4E62BF83E20ABFA56787BFB5D0A440C3E09DC03FFED0BEE2EDD4C0567C24401EF616BF782E5340046704C01E0675BDD4A333407BF4BCBFF64174BFF61D5A40E53A4C408A7E7DC05A89554058F63CC089EA9C406D01B53F44B994C0A4BA283E6A132EC0B08FF93FABC5D03F790436BE98505CC065B10A40F1E215C02579023F1B829ABFB7040CC04863EBC011B5CF3FCB7CF8BF8A3EB8406CC7164061B5913F16DD8F40967A30BF5EB77CBF7D3501C1DCBC80BF8CD49F3FBA364AC08D138DBE62E5623F5E81F93FC7B2C340BE8D6DBEE4E943C0A9F847407AB140BEF407CBBEBA08C83FA404C5BF522AC8C0FC49B9C0"> : tensor<5x6x7xf32>
    %cst_0 = stablehlo.constant dense<[[[0.756782293, 4.70556259], [2.56708074, 0.843875647]], [[-3.15996146, -0.464651823], [-0.885185778, -3.96363592]], [[2.97152495, -0.270928681], [3.95516014, 2.40570521]], [[3.84634924, -5.809070e-01], [-5.61832619, -0.545445919]], [[-4.48537874, -2.47330403], [1.42267144, 1.36708045]]]> : tensor<5x2x2xf32>
    return %cst, %cst_0 : tensor<5x6x7xf32>, tensor<5x2x2xf32>
  }
  func.func private @expected() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x8EB5CE4055CD36C09F042EBFC0D00A40309C7A409B5E2940CF5632BF4C2656C07B2E8FC0C091F9BCA9AF4D40D1033BC00BBF33BEED0713400559D5BFD7619EBEBE12183FFEE7004117B89C4058C5E6C0DBBF1BBF3C95F53FE77E14405569D04047D824C074A29EBF2688BDBF5B0DAB3F794A61406885174077F406C0574082C0572D4840CE4FF5BD950952C044E1D13F819462BE52B7683F066C60BF72FFAC40D583823F3C6ED7BFD107664040CD56C013AA004070091840BD89D3BFC640A53E8D9C863DD45A9ABF4E54383E4732FDC049469DBFC3E586C0E3F727C09064A8BFF2C18CBF91A0E9BFE9EAA43C2CD95D3F964A1740EB1566C0725282BEE7BE4A4049334140D5F8D6C0C53220406621D7BF7A600C4104DADDC0F4F505C0B1DF0640C4AAE3BEFCF9A8BF9AC491BF9252414019F61D400B0471BF7BA0F83F13BC10C04E7312C0C76682C07B680AC0E96EA53D02FD21407ED0DC3F86A92D401540CCC05FA3DABFBFA3593F56FEA93F6189FBBFDC7C9240F9E5CB3F16ADA93FD29069C0B592B1BFB326A0BFDF227F405191A6C0C9AF0441FC55E93FC7900DC04F171D40BA161040CBACCDBF5F5E37C054369ABFDCBDBCBF24EF2640A27EDF3F74E3C24092012A400BAFFFBFB3E025402F911D400A7DA7C0322590402302673E05DBA2C06474BAC02473C03FB1BD41BF3A4C264064C72BC05B013EC0B65A4EBF309659407F2437C0F5BEB2C05F76793F50B625BE2CED1B3F26B340BE958E78BE3A9A32BFBC97E040CC339D40FC97154011EEE33FF9E238410B47343F4D6E3AC0ECE0B5BF37AF653F8CDE92C01A8EA63F13F60CC13CE95240714563BEEB4E62BF83E20ABFA56787BFB5D0A4400CD528C13FFED0BEE2EDD4C0567C24401EF616BF782E5340046704C01E0675BDD4A333407BF4BCBFF64174BFF61D5A40E53A4C408A7E7DC05A8955406503EEC089EA9C406D01B53F44B994C0A4BA283E6A132EC0B08FF93FABC5D03FEF3B983F98505CC065B10A40F1E215C02579023F1B829ABFB7040CC04863EBC052C059BFCB7CF8BF8A3EB8406CC7164061B5913F16DD8F40967A30BF5EB77CBF7D3501C1DCBC80BF8CD49F3F5B53DEBF8D138DBE62E5623F5E81F93FC7B2C340BE8D6DBEE4E943C0A9F847407AB140BEF407CBBEBA08C83FA404C5BF522AC8C0FC49B9C0"> : tensor<5x6x7xf32>
    return %cst : tensor<5x6x7xf32>
  }
}
