// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      stablehlo.return %arg1 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x2xi64>, tensor<5x2x2xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xA5E604C17C0907402CD89B9583BEE3BF66858764E073FABF0B6D8502683A0040766E304A035DFD3F9F758DF3FA26FBBFB0946A5DB322F5BF877311E4008217C020AB2DF7B65BF7BFE18DF3B91C2001403461599EFCD80E401F2596F0CF110DC052827A5443010BC0CA5E17B542EE03C0798988537F72F33F9CB876D1DD2DEE3F5136F65E17B1F83F44EBE66580780DC0C2948307BF76FD3F1562200C14EF06C0EC7F26317ABDF83FD4A33CFE424D09C09428DC5A3E97F33F4E5A85A8FF79DCBFABE90F23EF99F13FAC0D106058A4DBBF561054B8224DFE3FD56B86EBE25001C09B4F0F9D68D113C0878B276818E20240E6FA66BD0E0C11C0B0C73A08D64600405F2C9B9F713A07C06443F83ADA160E408524105541A912C057E5CCB19DEBD6BFBF20030BE8C4B23F1FC74B6B09FC004014D3BDCC69F3F63FA89C95BCCD470740191E2F19D5020E40DA4FE1FF1CBE1040D12C296C98D913409856E58645F7F4BFAA655D6537A71EC0E009154382F20740ECA45889F6BA00C0705B89F069CB04C0FC0E18C551C9F5BFB5F1EE8D8BA7E83FDD5AE0AD8214E2BF7EC7240A1156F33FC8358138D9F115C07AC761C7A97BF03FEE90977E8099EBBF45025B33765E09C0C8100151EFA4A8BF686AC891AB89EBBFD1267F6093141DC05036A5F4F461E8BF9E5864714512DABFECD272601728F23FA3868B546F320440D4F546F737970140DA562DA5908E01C0A9E3E848BAF8B3BFC6A191DC1D8BFFBF757F99594BE410C016496CB97E45E33F8A6D604189F7FABF9047FC8C65D30CC0DE719C68EDA8B63F72B5AFB1C730EA3F90C265573E8C18C02727DD20D4BBE33F965AEAE19A44124041F970CE92BFF23F184F082DC78C1FC03A90C17C39D80840FA91D27543CF1040F62C5B2A4E0E04402B2417971381CFBFDE95A41B7BAB00C0FBE90619384CFC3F02EAF55C4927FC3FAB28F03FEE6108C0EEC37C271B806EBF8A17AB3976B1F7BF9A93013ACE1BFEBF33D81799D23DF8BFBA03E87E5E2B0C4093A627ABE8F3FF3F2EE772C43B200140744F3CC479281340369C4DB5089310C0D485E1DDEF0F09C0E88EC0F043DC10C086212DA00BD9184046C23B626A06C2BF50B07BDED5771A40DD20348E4BE7FE3FF45EBE0FB0B20EC064D35FB0A84BDEBF708B1C965820E33F44E2A41D3492F43F4FE742F5571D1040C3B95B69BE4AE4BFF928E65F464B04C0F92F886CF5E20540E8549F2FCE1AEF3F440EEF09EFD204405C58873C5D2CE63FBC50ED1462D017C0AA2C0AAA851DFC3FBAF6E8B0E1EAF7BF7ABA4A62D73305C0D69A72073954ECBFACC475EE567B2140342D0D1849D813C0A84BDFA69C9E0140F4AFAEB43D3013C02BA9DBC878BB124073C0C9127E0AF23FA782DD8A8FBC0840028D255554BBCF3FE618D96F813F0F40CE3323E9380F0C40D4CA68DA2D4EF83F6355A80778CA08C03239476975220740C8832F570E830C40341BDAC3C1A8FCBF8B26808D8B0205C058328E5C263EB83F7E5704F9B8BAF7BF8A602D6D50DDFDBFE256407FF2E801C0AE9F1820CF9304409A3ADFB462C60FC06047C728A3440AC0666F5DEC7864F93FB0B85192A317F1BF77FA4681A8C3F6BF0367F59821B0F73F1AB56DCA5FE5074069B0F0297D88C23FE7CEFBCE2FB7F1BF7A07F2CB205410C0CBF56C4311AF0640A8748ED3559BF03F6664CC318A0E0040844FFA5A9C6611C0EEAB5A28113611C0A405E7E485C2EE3F34960340AA74EBBF3E35D112FD0906C080B7CF2629760C401821382D2E52EABFDACA608B6F38E7BF06E661071D5100C0312A1E256E9C07C0D816485A2EE412400E11A10E753700400B30FAA76C460E407705CF6235DE03C09CAD7AE16143D63F94B7A4E30115EBBF60476A8D186407C090D2D08C174F10C0A6811512C7C805407D0DB9FBDF50A2BF84CEA351015504C06FAF3D04FE4F14405B05F327A83105C0E91E04A1F0DA04C06D0856314B7401C08AD2A0BB7687FDBF09DA7D068D251040E6C0BCE2F2B203C0EAF1F5773A22FABF6AC7EE8309DA18C0682A11F3363200C0D2139D4F6E11D23F2C81D9E84E16044022E757A01E3F1D401A52A6C17BD3E63F61464EC555510240BEF7D529E77BFE3F2853EEC9874612C0058D03EDE057CDBF942889F03E971340776E958C6EE311C098D575871B7C01C0AD883EA33393F83F8C8C8D1818091540E07BBA33D198F63F1A0CAF570C23E2BF1E02D991A0E5FABFF8A68441B8F0C33FF44239358789F1BFC63366709C95EDBF6F62AA4D456B11C039320B6B618D1540B822664CE62013C0386876C1C6E9F9BF70B394A7CFEAFDBF93979FE07675F53F51DBD4A06A3F12401DA8DDCBD1A8F53FA6068F68CB9D0FC0"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[[2.1415817509648511, 4.1938719601866428], [-3.0236833610867357, -2.7673312548942612]], [[-1.7481817674044426, 0.076123201428400816], [0.18955761478392796, -2.2900746995194066]], [[0.6611928864140374, -3.0891000596455669], [2.1163850706277532, -1.6869461526772032]], [[4.8881946631406228, 1.637707621428127], [-4.0488591534777427, -5.7896296220892571]], [[0.48609888835058968, -0.39221532292465966], [3.9409344362725998, -0.50905661481516162]]]> : tensor<5x2x2xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xA5E604C17C090740EBD5F09CF521014066858764E073FABF0B6D8502683A0040766E304A035DFD3F9F758DF3FA26FBBFB0946A5DB322F5BF877311E4008217C020AB2DF7B65BF7BF85C1A7917E2306C03461599EFCD80E401F2596F0CF110DC052827A5443010BC0CA5E17B542EE03C0798988537F72F33F9CB876D1DD2DEE3F5136F65E17B1F83FC273025F86C61040C2948307BF76FD3F1562200C14EF06C0EC7F26317ABDF83FD4A33CFE424D09C09428DC5A3E97F33F4E5A85A8FF79DCBFABE90F23EF99F13FAC0D106058A4DBBF561054B8224DFE3FD56B86EBE25001C0789DEAE6803008C0878B276818E20240E6FA66BD0E0C11C0B0C73A08D64600405F2C9B9F713A07C06443F83ADA160E408524105541A912C057E5CCB19DEBD6BFBF20030BE8C4B23F1FC74B6B09FC004014D3BDCC69F3F63FA89C95BCCD470740191E2F19D5020E40DA4FE1FF1CBE1040D12C296C98D91340EF72E7718DF8FBBFAA655D6537A71EC0E009154382F20740ECA45889F6BA00C0705B89F069CB04C0FC0E18C551C9F5BFB5F1EE8D8BA7E83FDD5AE0AD8214E2BFBCA91EAF125202C0C8358138D9F115C07AC761C7A97BF03FEE90977E8099EBBF45025B33765E09C0C8100151EFA4A8BF686AC891AB89EBBFD1267F6093141DC0B20F9A64CF7CB33F9E5864714512DABFECD272601728F23FA3868B546F320440D4F546F737970140DA562DA5908E01C0A9E3E848BAF8B3BFC6A191DC1D8BFFBF757F99594BE410C016496CB97E45E33F8A6D604189F7FABFD0341A866C43C83FDE719C68EDA8B63F72B5AFB1C730EA3F90C265573E8C18C02727DD20D4BBE33F965AEAE19A44124041F970CE92BFF23F184F082DC78C1FC03A90C17C39D80840FA91D27543CF1040F62C5B2A4E0E04402B2417971381CFBFDE95A41B7BAB00C0FBE90619384CFC3F02EAF55C4927FC3F53E0EFFB7D28E53FEEC37C271B806EBF8A17AB3976B1F7BF9A93013ACE1BFEBF33D81799D23DF8BFBA03E87E5E2B0C4093A627ABE8F3FF3F2EE772C43B20014028C9BD3FBBFDFABF369C4DB5089310C0D485E1DDEF0F09C0E88EC0F043DC10C086212DA00BD9184046C23B626A06C2BF50B07BDED5771A40DD20348E4BE7FE3FB0FE91177AB608C064D35FB0A84BDEBF708B1C965820E33F44E2A41D3492F43F4FE742F5571D1040C3B95B69BE4AE4BFF928E65F464B04C0F92F886CF5E20540E8549F2FCE1AEF3F440EEF09EFD204405C58873C5D2CE63FF7B5C04B5BEE0040AA2C0AAA851DFC3FBAF6E8B0E1EAF7BF7ABA4A62D73305C0D69A72073954ECBFACC475EE567B2140342D0D1849D813C0A84BDFA69C9E0140F4AFAEB43D3013C02BA9DBC878BB124073C0C9127E0AF23FA782DD8A8FBC0840028D255554BBCF3FE618D96F813F0F40CE3323E9380F0C40CFAEDAE6828D13406355A80778CA08C03239476975220740C8832F570E830C40341BDAC3C1A8FCBF8B26808D8B0205C058328E5C263EB83F7E5704F9B8BAF7BF074EEBAA942817C0E256407FF2E801C0AE9F1820CF9304409A3ADFB462C60FC06047C728A3440AC0666F5DEC7864F93FB0B85192A317F1BF77FA4681A8C3F6BF9E1927E80C34FA3F1AB56DCA5FE5074069B0F0297D88C23FE7CEFBCE2FB7F1BF7A07F2CB205410C0CBF56C4311AF0640A8748ED3559BF03F6664CC318A0E0040844FFA5A9C6611C0EEAB5A28113611C0A405E7E485C2EE3F48304922083210C03E35D112FD0906C080B7CF2629760C401821382D2E52EABFDACA608B6F38E7BF06E661071D5100C0312A1E256E9C07C0D816485A2EE412400E11A10E753700400B30FAA76C460E407705CF6235DE03C09CAD7AE16143D63F94B7A4E30115EBBF60476A8D186407C090D2D08C174F10C0809D05833E1CDF3F7D0DB9FBDF50A2BF84CEA351015504C06FAF3D04FE4F14405B05F327A83105C0E91E04A1F0DA04C06D0856314B7401C08AD2A0BB7687FDBFE0310E19314AE0BFE6C0BCE2F2B203C0EAF1F5773A22FABF6AC7EE8309DA18C0682A11F3363200C0D2139D4F6E11D23F2C81D9E84E16044022E757A01E3F1D4040E53C4C0E1AD9BF61464EC555510240BEF7D529E77BFE3F2853EEC9874612C0058D03EDE057CDBF942889F03E971340776E958C6EE311C098D575871B7C01C0AD883EA33393F83F8C8C8D1818091540E07BBA33D198F63FA2C43BA208870F401E02D991A0E5FABFF8A68441B8F0C33FF44239358789F1BFC63366709C95EDBF6F62AA4D456B11C039320B6B618D1540B822664CE62013C0386876C1C6E9F9BF70B394A7CFEAFDBF93979FE07675F53F51DBD4A06A3F12401DA8DDCBD1A8F53FA6068F68CB9D0FC0"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
