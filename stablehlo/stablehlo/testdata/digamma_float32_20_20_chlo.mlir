// RUN: stablehlo-opt --chlo-pre-serialization-pipeline -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s | stablehlo-translate --serialize --target=current | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt --chlo-pre-serialization-pipeline %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0 = call @inputs() : () -> tensor<20x20xf32>
    %1 = call @expected() : () -> tensor<20x20xf32>
    %2 = chlo.digamma %0 : tensor<20x20xf32> -> tensor<20x20xf32>
    stablehlo.custom_call @check.expect_almost_eq(%2, %1) {has_side_effect = true} : (tensor<20x20xf32>, tensor<20x20xf32>) -> ()
    return %2 : tensor<20x20xf32>
  }
  func.func private @inputs() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x10FF1A4037B02F4009FC8BBE39C8C03F22F8DC3FB807013E20514EC059F45CC05E89C3BF13870940192A32BFCC66C0BFAA3C84BFFF4EB0C047ADD640AA99B14026EAF73E587EF8BE4CED11C0DB01363F82B1D83FCAC902C0E78A07405AC339401F1CBABFED5958C06D6572BF44CDE9BF23FA32C0109631BF843800C08C893840F3A709C09630F73E554D46C0B70A0340CB1085BFCFA699BFC4CE2540219C23C0F0090A405279623FF80A8FC08C6876406D8F6DBF8F7E9CC002521CC0523F483D7FA1B73E4E1E8CBF64BA1D3FFF3E5340DE18493FCABF1ABF3629CBBE426836BFD063993E249F5CBF34CC0140AE4A0BC0BF2E953FF68C5640AD4A8D406832D5BF3F862C3E606D61C0DFA4814036AE60BFD7C67E40BC2101BFBCED89BF287CB03FAC89AD40EDF8093CE127CB3F8D87CFBF0CD7ABBF01FA2B40F285373F8C6CF73F89657AC0FC1E66BFA807B5C05C2310C0B2D3BBBF9EF7844076FD2A3F5F2737BF90605EC0B2D028400E72E7C0A90D95C08A698CC05BD09B3F65AB374080DD42402B78284058B403C070ED82402E2DC640DEF0B0401C6EAEC003ADF6BFD9175440F9184B3F248958C0126891BFD1E79A3F2910AEC0EC5E29C02D540A402139F93F1721C8C09C7241401722DFBF5A5A8BC070E23940BAEA9C3FCEB3EC3E6FE1A4BE3B7B14BF3BA718C03577393E1269CABFF299DFC022E3E9404E6F52BFA89B813FCB0C02BFA1B70BC03E571640B4735840216C0FC0CBD1D5403C244340F2385A3F68B8D4BF1F09BFBF6C67EBBE1735973FD9635F4024FCA53E8677A24088139AC0B59C35C000BC833F32374E40A2258FBE548EB23F44922CC0B2C75C3E91809E3FF4D8A8BF02808C3F064C98BF28EAEA40A278973FF7708D40801F4140942CC93F5109FBBF2C883540D23E19405F121D40993C3D402F520CC0C083B13E59C1FA4020B2F93F6D7988BF34B715BE6257DFC0B8FC1040B5473F40CFBF0E40E65F3140393B5540B32AAFBF5ECF0AC04220AEBF1CA6563FE2A29BBF38E4EC3F45446A40551A4B401BD189C0293E92BF7F97A93FFD4AE43F163152C0301262C006BE8140D46F4E4018036DC0B6D99D400C654340D2D88DBFF0009540A6373F40FE93D03F4865EEBFCED1DB3FE35AD4BEB180274090FD90C0337689C0E0DE723F797C76BF28A5EF3F005657C0F34EDFBDEFC9494028BE974042105FBFF4EF924051976040151654BEFC1330BFC902FCC0F860AD408DB025BE446025BF24542CC0C0FEFE3FC714FCBF542A1640A5F6D83E5A730140FD4804BF5572F73F1CFF423F5DF1B8BE7D80A740FF89E0BF3456F73F1818E03E79B2CEC0AD2DBEBF2D3643C08D1B01BFE6158CBF8BE697BEAF2892BF4DB55CBF7A3BCB400B091ABEA769A13F945E283F7E841B40A48852BFCE7D64BF9D83AA3FF5EC87404855AE3FDAABC73F12B3E9BFB9C4C4BEBB2080406AA754C006DC7C3E00187E3FAC1C44BD90EA44BF3E0BBCC06013734054544F40788D4AC0E4D4673FBB257EBE3AFF95C07C95A1C0AF3326C0638EA5C06632BC3EF64725C0CE79D34075E8ECC04D73214039A45CBFAFD3353FCB229840DBCA9840A1F986BFFAD814BF31A275BFB5ADFFBFA46819BEB86389C027D10440922B85BE7E7BBD3FB1333C40F814A2BE023BE73F64349E3F465D0FC09C84E6BF166B8A4030F9F5BECFFC68BF9F6932C09E6F32BE1942914089838E3FF8236340C65FD9BEA6F83CC05CC9B8C0F6C41540EBF04B4071CBB8BF207B6B40719DA93F3EF2CE3F1640C13DF10CB8C0DC60593F3B830F401C14E4403C4F29C0BB9B68BFAE2E8E3F7D48FA3E4043ED3E42824C3F58E21D406933213FD8708F40583621C04FB1CF40646CC33DC4E5A63FCC688DC041931A40C569F8BF103694C0CBAF593F1D3A98BECC6274C060A2983E32B028C080570440882857BF58BD543FF564B1BFEC5EBA408747FABF420411BF8C86063F7143D33FC89633BF9EE6DBBE94B17A3F1C779F3F7F6F94C041CB98C0A39CCC3F0B17393F56EA22C044CC5B3F748F1740935085BD17F7BC3EC7905D40D4CB253DD3ADE53FC5A64BC0A7A887C08F4FA740E38305C0ED3E7FC0865F31400963673F702BD2408F7A40C0E1FC7AC0932BD14036D99EBF2746A6406B179840040909BF1CA78C407DFDC9BE8E68F6BF4B05F03FEC1729C0A3E333400F9782C05313E2BFA24FDDBE8985EB402123E73F5AAB5CC0A73D8CBEDC1FBEBE021E1FC0086A8F402180AD3F1B2683BE384265C0"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
  func.func private @expected() -> (tensor<20x20xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x1E012A3FBB17513F2EAF2040C0CB2C3D0CB96A3EEF2B05C180D9A040CAD1EC3FB9EFE23EF8BA033FFC1101C0A7792C3F985CF4410883D93FCADBE93F597DCF3F63CA02C053842B3E9CFE6740E03B98BFB0C84F3ECBFFBD41A202FE3E1A30623F0CA0913FB43426409E0A92C179A18AC024E141C05E1CFEBF4F689143CE2A603FA159E340A04303C0F4CE31413EEEE73E72B0CC410B6D9B4044283F3FAC1C0F3F04EF043F41E848BF595AF33F54389B3F045254C1C985E2C0FE2ED43F4FA2A7C1702439C033B32B410ADBBDBF6A7D843F6FAD7FBF2BA970BF4EBB7D3FAB8D10C0C87B60C0E045CEC004A9E13E5C17C24042D8AABE07CE863F6A0DAF3FCE5E82BFF27BC8C0C243963FDAA2A23FDAA6EDC03916A03F700146BBF7B7514118B8AABDD43DCC3FAE9FEEC24871EB3D86FBFEBE4D591440DA7F4A3FD82696BF4CDDC13E7F541AC1223B13C1A8AE023ED6BE8340D045813F684DA63F433DA8BF786A13C00411D13FB3BF443F4698B14060FC6EBD72902F4076E088BE1ABA5E3F55B8703FAE1C443F723F90418310A43F52C9DE3FD0F7CE3F48751140AB7F49C15616853F6FFB7ABF4F282440F20AED40A6688DBE82CC184050E5CFBE209D053FE0AFC63E3C2A9F4084826E3FBD760CC0F4E647402A63623F3A6C83BEBF640AC0391DE93F1BAC32BF2EF40F4004B4BAC07880A0BD726E9CC24BA6F53FCC0297C060860EBF6AC50FBDC9D5BA40C156203F3E1E883FE7D68A40664EE93F1826713FC1A559BF0DC378BF9C19463F2871CB3E7840A0BEEACC8C3F84824EC0DCF2C23FA2D646C046138DC0A1BC07BF68E2803F16731A40804E88BDDF1088BF900A9DC04C5A77BEF670274058AFDABE4B56A5402B40F63FD2E29EBE5134AF3F45006E3FE0C1CF3D6805C6C11E255B3F3869263F4E332E3F8BD4673FC250B140A41C40C09B2DFF3F42F2C73E399C7541CFC0BF40DB023AC276C3143FD2176B3FC7C40F3F9308543FB6E2853F4AE10040DBECCA4008CD0640D63261BFB0758E4000B7A43EB2D0933F3B347D3F6A3C70401EAAE140F4A910BEF6AA8B3E0239774089C7893FFEBEA23F8A0B813F720765BFAADDBE3F738A713F2D021641E4A8B63F58FE6A3F88B51A3EB143BEC0CC8B633ED8CF503FCE52423FF5C7A73FBFBD7A407C362ABF7819D3C1FA7DAC3ECFC331403E6106419E407B3FC641B93F0744E0C044AAB43F10988D3F0231764048CCF3BFF868AFC0D81CCC3F3499A940DA78B1BF2E1381BFF0DDD53EEF35FDC1B8F71F3FD16A19C0AAE5DF3ECC1BE8BDE2ECC13E443A87BF764EAE3F2E42C73F20ED19C018A1C13E4FB913C0F71316402E32563F9342A84180BA0EBBA02B2C41043D0A40E0C2E240C7DECEC01A48E23F4E55B94074765BBEAE4AACBF7F102B3FCB6F97C02C9509C1448A08BE057BA93F380FCFBD9885BA3D9BB489C0A1028F3F9EEDA03F463453406AFC88C085EB16BF3FD1A141982452C0CB60BAC0C33A993F00B1813FC40EDA408A853EBF30AA3C40B869E6BE210AAE41D01E173EEC3BDD40C53434C0B802983EAFC8E73F1654434067D6363FE068CEC0C07B98BF1CA0B93F083DBA3F86079541BA3536BFB352C1C1E7A0C6C3403EBA40B7F17C400CC0F03EDDE72E40A0FA923C8B29663FF80CF23FBA5B943E983E7ABE1E708B40299C60C04E19AC3F869F583E6C6C27C185F432C0D09B9A407005B33FBC38CFBE35438F3F45EB383F40DC9DC1DE5CEABFAB201F3FF7707E3F4D499E3F3C93943F907510BE40B60F3EEB7830C18C65ABBFFF695BBFAC7B113F7D32F23F8008CABE9D7924C1AE17D1BE794201C0B7FF09C063B677BF1ED32F3FC0EAB7BFC937B13FF2166C3FBE49E53FF68F2EC1E4BE28BE78561A400625293FAA6D7CC1BC76843E81C45ABF30A9094016D85BC0FCA561C0E0928FBE5E67EE3E716FADC0CE4F65BFA24CE93FE23BD63FAD95AAC195A211BF28E5EBBFBC902C3E9F2006C07B082D3F64A11CBFE40B6EBE30FD343E729B00C0588FFF3D370794BF77582A3FC96056BFDCE7223F4FC26A41886533C0E3958B3F90BDC9C13EC98F3EAEFBC5408A599D40F618C73F3A694441EFA1A6C2F207543FB75E3FBF80EDE63FA8EA0643385830C1C844E63FFE1479408438C63F7295B93F2FC48FBEC866AE3F92C9813F0B4743C13C8BAD3EE880B5BEB65B583FE6C759419ACD29C0EF6F263FBA9AF63F9C15943ECB71F23FBA2B20405057A03F4B0E9E3FFC30B13FA048DDBDF85933409C63143F"> : tensor<20x20xf32>
    return %cst : tensor<20x20xf32>
  }
}
