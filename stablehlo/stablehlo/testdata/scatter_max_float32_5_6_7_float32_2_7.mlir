// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[0, 1], [2, 3]]> : tensor<2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf32>, tensor<2x7xf32>)
    %1 = call @expected() : () -> tensor<5x6x7xf32>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [1], inserted_window_dims = [0, 1], scatter_dims_to_operand_dims = [0, 1], index_vector_dim = 1>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f32>, %arg1: tensor<f32>):
      %3 = stablehlo.maximum %arg0, %arg1 : tensor<f32>
      stablehlo.return %3 : tensor<f32>
    }) : (tensor<5x6x7xf32>, tensor<2x2xi64>, tensor<2x7xf32>) -> tensor<5x6x7xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf32>, tensor<5x6x7xf32>) -> ()
    return %2 : tensor<5x6x7xf32>
  }
  func.func private @inputs() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}, tensor<2x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x803BC3402C1361BF21C738BF4BE9BD400AF8913F41CD51BF7BE659C05BA4963F03A31CBFB0C333C063A45D40A5F592C0EF7349C0AF7D023FF312E2C027508ABF602F41BF3558523F45C7713FA56D6CC0396BD7BFA2CDCFBFF656D63F803F1A40CC748D40AB45C0C0E2A7B73F6BDC8740140ABB3F57134D3E90DBC8BD371823C0A8658FC06214EF4001DC8DBE3E0897BF47B294406B693B3F8C6DC5BFE4713C40F01D0DC00A67823E541B40C063B6B03F0579FCC0859F3040A93986C0601A16C043CD7EC089F21F40E5E8583DF93DF4BF7426133FFDAD7AC0C24D35C083C38C40ED283840CB0C6740F83A6EC0B4F7F03FEE2286BF7A3D813FBC3C2E40D3FE733FFC484ABF6550CBBFDF2EB9BEED97B4BF59C480C0C07F43406F0537C0E1381840BAF2A43FACCDD83FF6B6E93F810FC8C07986C0403E8D07C02C37EFBF1DCD0CC0F9F813C087363D40D6AA623FF29D10BF4F75A6BEEBFAF0BF22CA8BBF04B9F0BF85EF3AC092C9E7BF679C74C0A98E67BEB5EF98402236C340220CC5BFA5D429408BC0CDBFBA39A4C09127AE40FD2980C0CE4EF2BF3E3215BFE99B18401578E1BE3E6164C07EA1DA40BEEFD94059305D402C480EBD57FC0A405ACE1C40122C573F5B6302BF3D0CBA3F791D3D40A23F58C0CE3D01C060103240824B24C04E2CF9BF0FC11E40EA4E89C0E91112407DBEF63F474B74BF8DFA4540AE1EE73E28A33740613A8740AC7A5340BFC6A440841449BF960C92409DF09940B5A34EBD3A921140E9F05E3F34BA42C0A56980C0B1D62EBECE2BD23E18A72BC0CAD415BFEA1F47C09F720B40B0251740555032C071EA5640E0F38BC0F9DDD3BF0FCB7E40A08ABCC058853BBE983C65401CDDB9BF6B668ABF7F8BA63E6D526240827360C06931A33F591FB4BFFB85043FE990AF3F053611C043393F40A724883EC2CFD23E20BC64BF26D886C0AD2C633F5E0BA840DBDD0CC0847728BF30C54DC0A4CB3F40B269A13FE9ED3BC08AD5E53E31CD164059593AC0F9461740105696C0B78614C0F226223F4864CDBF12A6ABBEEAE002C03F125C3F4A44E8BF31FFBAC00ECAC23D66728BBF9D3BC53F5E15F5BD8727323F931FD8BE33EB75BF33EAF33F4E25AC3FFCFD863F85F03340D380C9402AF3CA3FA2CA8CC020F16940D8E901C0115919C022525DC05CCDBD40A0FE0C40"> : tensor<5x6x7xf32>
    %cst_0 = stablehlo.constant dense<[[2.25645947, 0.994455456, -2.76648712, 1.56659055, 0.456258118, -0.668891727, 3.56288123], [-0.446560442, -0.272196054, 2.00474262, -1.55408919, -1.15244007, -0.637384712, 3.85008883]]> : tensor<2x7xf32>
    return %cst, %cst_0 : tensor<5x6x7xf32>, tensor<2x7xf32>
  }
  func.func private @expected() -> (tensor<5x6x7xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x803BC3402C1361BF21C738BF4BE9BD400AF8913F41CD51BF7BE659C0D5691040A2947E3F200E31C063A45D40AA9AE93E7D3C2BBF3F066440F312E2C027508ABF602F41BF3558523F45C7713FA56D6CC0396BD7BFA2CDCFBFF656D63F803F1A40CC748D40AB45C0C0E2A7B73F6BDC8740140ABB3F57134D3E90DBC8BD371823C0A8658FC06214EF4001DC8DBE3E0897BF47B294406B693B3F8C6DC5BFE4713C40F01D0DC00A67823E541B40C063B6B03F0579FCC0859F3040A93986C0601A16C043CD7EC089F21F40E5E8583DF93DF4BF7426133FFDAD7AC0C24D35C083C38C40ED283840CB0C6740F83A6EC0B4F7F03FEE2286BF7A3D813FBC3C2E40D3FE733FFC484ABF6550CBBFDF2EB9BEED97B4BF59C480C0C07F43406F0537C0E1381840BAF2A43FACCDD83FF6B6E93F810FC8C07986C0403E8D07C02C37EFBF1DCD0CC0F9F813C087363D40D6AA623FF29D10BF4F75A6BEEBFAF0BF22CA8BBF04B9F0BF85EF3AC092C9E7BF679C74C0A98E67BEB5EF98402236C340220CC5BFA5D429408BC0CDBFBA39A4C09127AE40FD2980C0CE4EF2BF3E3215BFE99B18401578E1BE3E6164C07EA1DA40BEEFD94059305D402C480EBD57FC0A405ACE1C40DB6776405B6302BF3D0CBA3F791D3D40A23F58C0CE3D01C060103240824B24C04E2CF9BF0FC11E40EA4E89C0E91112407DBEF63F474B74BF8DFA4540AE1EE73E28A33740613A8740AC7A5340BFC6A440841449BF960C92409DF09940B5A34EBD3A921140E9F05E3F34BA42C0A56980C0B1D62EBECE2BD23E18A72BC0CAD415BFEA1F47C09F720B40B0251740555032C071EA5640E0F38BC0F9DDD3BF0FCB7E40A08ABCC058853BBE983C65401CDDB9BF6B668ABF7F8BA63E6D526240827360C06931A33F591FB4BFFB85043FE990AF3F053611C043393F40A724883EC2CFD23E20BC64BF26D886C0AD2C633F5E0BA840DBDD0CC0847728BF30C54DC0A4CB3F40B269A13FE9ED3BC08AD5E53E31CD164059593AC0F9461740105696C0B78614C0F226223F4864CDBF12A6ABBEEAE002C03F125C3F4A44E8BF31FFBAC00ECAC23D66728BBF9D3BC53F5E15F5BD8727323F931FD8BE33EB75BF33EAF33F4E25AC3FFCFD863F85F03340D380C9402AF3CA3FA2CA8CC020F16940D8E901C0115919C022525DC05CCDBD40A0FE0C40"> : tensor<5x6x7xf32>
    return %cst : tensor<5x6x7xf32>
  }
}
