// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<1x4x2x2x2xf32> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<10x10x10xf32>, tensor<1x4x2xi64>)
    %1 = call @expected() : () -> tensor<1x4x2x2x2xf32>
    %2 = "stablehlo.gather"(%0#0, %0#1) <{dimension_numbers = #stablehlo.gather<offset_dims = [2, 3, 4], start_index_map = [2, 1], index_vector_dim = 2>, slice_sizes = array<i64: 2, 2, 2>}> : (tensor<10x10x10xf32>, tensor<1x4x2xi64>) -> tensor<1x4x2x2x2xf32>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<1x4x2x2x2xf32>, tensor<1x4x2x2x2xf32>) -> ()
    return %2 : tensor<1x4x2x2x2xf32>
  }
  func.func private @inputs() -> (tensor<10x10x10xf32> {mhlo.layout_mode = "default"}, tensor<1x4x2xi64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0x0CEADEBFB8745C3E458B83BF284BFA3F205508C0BC273FBF76537E3E09FA2FC051DC193E1A409CC0677F973F75D12FBEBAD4C0BFB7091A40FA0CAABF0F057BBF174B7D40C112D73F3926843F5E337FC0D6E2BF3F8543C8BF9D6D3DC05F2DD23F562A9DBF1E8636BEE8FD953F948396C09522254048F279BE7CB226BD60FB0A3F94D3F8BF6CE8BB407E3E0CC09FF826C02AA208C0611C304036FE1C40BE1DEBBFAB267040096215C00FFD88BE3EA4BB3F732BBD4004D26CC0EA6366401F6EECBF797A873E959594BF58BF193D6E200340C6808DC0E7DEE1C09CE874BF8E84AC4074069C3EF88A344079A294BDA1CDB8BF0957F33FF068C7403B028CC0C5654F402AF5BF4042D904C08DABA340FA3B4FBF6E01A5C0B073B6BF35BA7FBF0F9CF23FF68FE93E12521FC0B71CF2BF35D63A40FA8FD2BFE53780BF4D272340FC3A9D3FE37760C0B20B2E3F6B3B823F1C28E5C031AC47BF15078ABFFBC0423F70CE3540C068803FB6525FC0F7BD6A403F9A1BC0380E8A3F1020F3BF6C4931C02C326C3E7C26CB3F264819402C24CC3FC74A2EBF7B6E923F65CD8FC0A8B1B13FE0557840FBECA2BF71B3C1400CDA65C085D5364086A0BD3E78A826C0AF68F8404CA9BB3FC0F154C02A1716C0DE658DC0BE52AF3DBFAE0D40224CA4BEC9EC84C0BE7A8E3FADDD63BFE11376C0A81A67C09C3D51C09644CDBF3DD5493F638C9D3F2C2206C06721A1BF0A2E3440F36667C0DDAA37C0ECFA8BC09B70A7BFA98B53C0E12100409835E9BE365C35C0BFEB003FE83833401CDB03C01D8FE1C0E0E825C06F80D4BF5C8578BE9AF2933F5B7F3340EAC03B40FDE6D83F8E211D3E91D2514025DB853F7AAE993FDA0426C0597F5EC0BA35A7BFF5C4A5C0759C3A40807FEDBF5FFB863ED825A1BE90431240C2DA75C03A1D66C05B718A40C29137407883FC4064180B3F8FC6A03F8CEB8BC07972CBC0C95764C0FF6F713FCC1FD33E1ED159C08EAF53C0319335BC11632540AA8623C08834C6BF27DA9DBD1DE861409A2CABBF74F0C7BFD470173F8F76B8C0234B9ABEAA30DFBEE72A7540791CB0C0F8A136BF5A66B040BFA089409900DA3FA0FE49403C85F1BDBBDB62C03CE42A40BB5239C0D0CC6EC00DECB13F8091FEBEA5E7883F157D31C09A57863FF2ED5B401AF39AC027224E4017DC60C09415483F2D37FA3F47DBCABEB1E2B13FCA12C7400E4EC9BF0243C83F05E7D33F9236B5C01023D13F37DF79C093F992BEAD9791C0107EBEBFE56AE1BA087EE53F638FB4BF91AA84406CC82BC057671C405A541A3F6C47B9C0F333AFBF6FBF49C046B9F63E278A7840F6902D40E86DB6BF230A0840F74381C0E464613E764FBC40FB17F4BF12C6F03F80714C40951EB23F7C005E403C718ABF99576E3FA2B867C0AA3B0340E85DE9BF5465C040B7F948C065D792C04FFDFD401DB6D6BFF115DB3E6DA95BC04F5E04405DD6854097FFF23F8A92933F714A10401243EA3D325F65C07EB51BC0ED6B23C047BA01C0DCC7E6BF09C978C0BDBFB1BFE530A2BF0733A940E666B8BF4F6BDA3FF2B415C0FFC659C02BECEB3EDF76A9BE6E8944C0085CA03F41202640BF4746C0CDD7BBBE71BE07C0599599BFE0969CC05B6EE0BE42D5933F61B030C070129640EC154140D16B20C07DFB60C0C1BAE54073908DBFE2A7164077550A40A2BB93C0EE0617C0D73F5A408DBF623F426BA0BFC326C73F25E3AEBD5EA108C0EB343840841C85BFD54D203F79331240D8030D4062F8C6401E9C80407A3B5DBFC24092C0F71C6CC066D8A1BD8346563FBF8B1FC0406327BFEBE9E04078C0823F2F46D3BF463E133FC944AF405DC0933F52FA7D3F854A933EC5CD5BC05D3D2CBF625EBCC0C4E78C4014491540A59E3E3F95094B40928A1CC026F6584007E3184170809AC02046B6BF53B228BFAC313140C28138C04FC503C04201C2BF6E1545C0D0BBF1BB2DBEA940E53780C08E1A1EC0F105D33F96D32FC09E1C38BFA33329BF2D1916C0D9FA8BBF431A1ABE9773253FD49F17C02AF9493E8AD622408FE18A4065A063405E3F37C0E702FFBF6D1D54C088B94CC031DA484033D7DDC019AA45404C060EC0E765843FFEEE07411DB2104141208BC0F1A87EBF1D81DE3FF230714072A802C0E51AC53F5AECADC0BEF06CC0BB90C73EA84D24C0A7E19D3F56828BC0A4FEDA3F67BC15BCF4496FC0C13835408339B9C01BDF084096E061BEB75FF7BE6F91B4C0211AAC3FD64C44C0618A3F3F7C17EABF0E097A40AED2BF403585CF3EEFAEB5BE41499F3EA7C4BC3FAFCB0DC066C8403FD32E98C0D3F3AABFA7B2343F475779C0169693C09816DBC0E73E7FBFB552F23E151E8540E70E89C0BAC8943F42F5CB3F235A86C031F19A3F192184BE0E4782BD886F353FEE13EC400C8BB7BFBBCF0C40A01B7ABE0152513FBD94B4C073721DC0169FE4BDEBCE9F40DB6A423F0A8555405123CBC02BEEBBBE37346D3F7C860D4017AB1D40B0B04AC079F16EBF3D28833EA081733FF8F22240634F53BF20B2A54024F7AABFA6C14CC0D66AA83F124461C015D302C04416C53F4F8E91C0B5F99C3F69AA18C04626F33FFFF541C0FAAFD8C05693A840E5CD8D3FA60F8D3F030C904028646440697018C0D22898BF9D0DB73F926DFEBF444418C0B81DC13EC39BF8BF496D3BC0C9280B403BE86640533829403E4B62BE9F170EBF0FB1A9402A8853404618B6BE36FB1CBFA7A0D8BF55C11FBF77DB243F7B0478BF7B052BBF1BE161C0AF5925C0DA960340EB14C23F05ABA9BF9EF839C0C2FA48C0B2D2E23F2B608CC03C158540DA0A86BFBC109A3FC2CDD23D79E1D83F0BBC84400EA659C0C37E8DC08311B7BF0B8097404C1810BF889293BF538911C01470C83F0EB44DBF03847AC06789D340BBDBEEBE870D96BEB06349C0FD91823D9E5989BF8EE95B3F21E4CF3E37C480407CBA7B40008A28C085FBD1C0100B7C40C1311CBD157632409EE0C3BEDADAE23ECF0215BFCDD79F40071DA3BF7BA2414067C86C408FEE9E3F4CDB53BF01D4A43F20ECA0BDB2963D40A23620BE98E48840AA1B07C00770D93FBD8883C0EB16A83F4B750DC0B6B8F3BF50B0F4BEB97A154155F9893F36EC723F5A64B2BF3B624940BEDA3BC046012BC02AA74AC0F07BD23F03120CC064FE5B403919BBBD903397C09B97AD406EAEE8BE0D7BCD3F8E6F82407961FDC09C88A1BFCB5434BFBDA682BF490FCBBF26C4B9C05140943D6C7FAE3FED5297BFA5C32BC005A48D3FD4C7C9BFAFB38140943AD23F36F3963F21579B40884FA4BDC7EB533EC6D6C8BF3CEE09BFB59FA8C0D7CF943F6239ADC085B4C83F7AB9613FC5D4C3C074493FBF98F4B73F6C2AAABF37ED9040A6D3094042C39140BE96593F094EC73EB10B1240301280BFBEC026C006A449C0A1C48AC050ED513FDCA2A0402EE709C0514729C08FFA5CC02EE080BFB2C3E8BFA1434A405B9FFC4037CCC4C080B6B2BFF194FDBF6D2E454056CB9DBFCD14B1BF3B0B02C021A35ABEB1C732C0C98FE8BF42E9AF404B4A7A3D547849C03C2169BE2B8F31C0D302CDBF6D60D03FCCCC8F3F1B30D5402C6ADAC0271BD03FFF6A9D3F68218ABF845690BE9D5D6640E78E4B400B97F13FADB316C0A67972C06C6CF2BF24AB343F0F4F26BF75D761BD47FD15405D0588C0F8B14E40AF2A41BFA39C6B3FAD3ABAC00F9DE8BEF787F5BF2747FA3FFA3A163F5CFA8FC0540ADC3F70CB0641552600C1B4BB01C1F3962C4050D2B7C05A1F653FB128B53F130132BFB27B3CBF0900CBBF9F5A05405E5DAC3EF7A63BC06ED6353FFD80E140C06CD73F101193C0DBF6CABF1C703D3F2824EDBF82B4ABC0720E403F4A98B33F00B51F3F2F07B7BF594E37BFE3E3A740B9B4A33F40F390BFD0F710C0F8C94040A91083BDB3C27FBDB7DE8E3E6AD7D8BED6929C3F988E153D594A7040C8C2383EA5BBD040F921FA40DCD101BFB39836C02EFF4DBFDA8859402FF70940FBCACB3F91CDFD3FF27F9B4060250AC0B387D5C06344E33F57E1ADBFB33E163FF49D85409E9A36C02890C83E06776A40DA53A23FB8A842BF4A56B0BF0FE29040D8D78D3E91241140A5E5B43F08A0D93ED86583BF1ED487BFA666C33FDC45C7C0C5980B403F4BF8BEDA9BD840FAA2BF3F24BAA54051CC5C400940AC3E680F5E3F6A766E3EB5FBF83E4A637640ED84CD3D8998FCBFAF09CDBD81E27FBFB95A27C0B4EA92BFE50D61C09F3F98408859A440FAA77DBF85F49B40A94BA1C04289B1C0841F8B40CC8C7AC08D37CFBF7E6A8140785393BF5B31CDC092F24240E2BF16BFC43F5940EEE6FE3F91C07D3FBBA188BF28F0BEBEDEAEEABE892EB7BE7183FCBEE0F407C02CDC86C023DE5840BF265DC0107774C0FAA6303E447CCDBEA0485E40ED6DB340A71F5F40E7320C40366A9ABFFED96FC0B9EEAE40B81E9940D6837EBFBEFE0940F112F5BFDF1B62BF8F43783F2F622040DC0463C07E0C26C02507003F2D75A9C028149ABFAB5905C13D5B1140ADED29C0B982BF409B786FC0B78E8EC00C77D9C011CC6540B659FB3F51C48FC038694B40D11B923F989C62C0AD09BCC0A30FF53F4AB72EC0A701F5BFEE8CBCBE633B48408CFA99C08E7B6FBF04355F3F33A52D40BB7414C0EC9B953EEAE421C02FC34F3ABE3FB6BF791FA1BF6685E2BF8C66F63A581696406A4068C0520D4BC034B63BC03FA312C0519697BF88B030BF6B8619C02777413EA9A8C9BF861C0F3DCA36D7BEC7D44AC07D27E4C05F5372409577A9400B9F36C0EABAB2BF4868764020EB2A40AA54A5C07D3977C05DF4AC3EA26AF9BEFEB3C43ED624E03E6FBA603D1F76AF3FC276EBBD87EE8DBF8E2CB9BF20256AC09295FBBD3464A6BE92B388C07F2CC7BF19A0A9402CA3CD3EA5A07A40F7B09A4061756B3F4D7457BFB260A0BE29F57FC027F24EBF4A4FC44024D311406667833EF2A224C064D6844095F08CBF730F6340259315C05A519AC00B7B3940354DDBBEC82A61C0BA65C93EDEBD91BF6CDB7240C50C533F14F40F40A3253A3F575C6940F8503240CEA54C3D670CA3BFD70D793FC493CCBFCA5637C0ACE89EBDEBD0EA3EB82C783F8D23D6BE2267B640ADF1FA40BA37324040BE37407541BFBEB020443E4BB364C0BCAF84C0422AED3EAE578DC0B27B15C0BF2CBB402D6D82C0CEB5543F093FCB40A7224D3EF81C28BF9451A83EF14203C047871440F0F54DC091270FC06A99503FCDF0F3BF699A6B40348288BF2CB906C08B8ECABFD8A538C01D3AE93FF4849C3E6E5B29C01EF978C00FFA773F111364BF9723CCC04C70763E89E9DF3F867F0E3D7B039B3FD9F46440118ABFBF3C6046408812CEBE03D11540079634BFDAC772C0042F3A40BCCC49BF01CD36C0C998E83F06783E40D1F75E40F92231C012B86CBFB15D15C0B5A4C7C0CE4D2F40467E99405F5E61C0E95D38C068BE7140642410C02951A43F715C8A3DDC677FBFB7C70DBF2D798BC0937D69C0FE7FA5BF9C1C28C0AD097BC0C0CAD6BF862630C09A21AA3FFCDB5040BFE509C07EB16EC01954D1BE82D8A240A71014C0BC870CBF8FD1BF3D81D7453F7A208BC0A39C8540A327E0BE4FF02C3F33137DBF55809EBFB8C2B53FE43CA3C0771C5040862BC23F87DCD5C0D65490BD82A8F7BE455E62BE7967D640051753BF47292740D9B1F9BF"> : tensor<10x10x10xf32>
    %c = stablehlo.constant dense<[[[0, 1], [1, 0], [0, 1], [1, 0]]]> : tensor<1x4x2xi64>
    return %cst, %c : tensor<10x10x10xf32>, tensor<1x4x2xi64>
  }
  func.func private @expected() -> (tensor<1x4x2x2x2xf32> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<[[[[[1.18357551, -0.171697453], [1.499110e+00, -1.56456053]], [[7.76277876, 1.46610403], [-0.890101253, -3.84496331]]], [[[2.152890e-01, -1.02768767], [-0.171697453, -1.5064919]], [[-4.49382257, 1.38823414], [1.46610403, -3.32725525]]], [[[1.18357551, -0.171697453], [1.499110e+00, -1.56456053]], [[7.76277876, 1.46610403], [-0.890101253, -3.84496331]]], [[[2.152890e-01, -1.02768767], [-0.171697453, -1.5064919]], [[-4.49382257, 1.38823414], [1.46610403, -3.32725525]]]]]> : tensor<1x4x2x2x2xf32>
    return %cst : tensor<1x4x2x2x2xf32>
  }
}
