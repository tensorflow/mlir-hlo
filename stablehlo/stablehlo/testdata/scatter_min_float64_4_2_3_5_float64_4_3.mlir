// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<4x2x3x5xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[0, 4]> : tensor<2xi64>
    %0:2 = call @inputs() : () -> (tensor<4x2x3x5xf64>, tensor<4x3xf64>)
    %1 = call @expected() : () -> tensor<4x2x3x5xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [1, 3], scatter_dims_to_operand_dims = [1, 3]>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<4x2x3x5xf64>, tensor<2xi64>, tensor<4x3xf64>) -> tensor<4x2x3x5xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<4x2x3x5xf64>, tensor<4x2x3x5xf64>) -> ()
    return %2 : tensor<4x2x3x5xf64>
  }
  func.func private @inputs() -> (tensor<4x2x3x5xf64> {mhlo.layout_mode = "default"}, tensor<4x3xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xB6F8EA3814D606C00A17946EA6170A400451B53797B215C0F654A2DF7343174046DD8963B49BFFBF995AE0014C5904C09F80471B9E3E144042D0F97E53EA044070DACB174BD401C0EE4106DBC773C9BF8931BD8AAB0EF1BFF1CAEBBDEAFD0540B5101F272AF60BC06C7CE393E4F41940827B75E7CF62FB3F4FEC8170B407CF3FBD569E097EFB0B401ABB864891CAE5BFA404611B1385DC3F5665D3553CFFE0BF63143BFBB7810E40DEBC45B58F32F93F415C43EF071CEBBF3391E447B14302C0346576965E9009C08DF1CC3F529515C0C8B46ED2E4C816402CD6BCA28E340EC0987DA9ACACCFF6BFA423CC2647869D3FBD2C13158E7BD0BF5CFA75EC4C4205C0BCB6E5E122B5C6BF0237095FC487EFBFF4334A4F1FAC0BC0D81EF67B721B03C01CD68102E8AB12C0FEE3606E422508409001341B817A0D40AA21F47572DDF43FDEBD0F0B02E320C08EE0F894E0BE15C0F74C5DD511EBF2BF53570B7DDB4CF6BF1A663AE8BD2AC9BF6F1F3E095C7509C02A5481C1F689F53FB210519DA4F51BC0C3F05E6436900040FE7AE902968E20C01E8B5B12E6DD0140B440C8F981D002C0AB5C13193B0EF23FC17159DF84D3FD3FB451E5A8B492F63F02040D9FA852DC3FB33BA1E62EF0FE3F61B95E6E94DA0B4058F6BB636A1702C0255AD5FEA04111C05E993ABF566CD03F9F491FE9FD6BE13F3E02F614825309404DD4E4AA8CA50FC0D5B9CE7FF038DA3F8EB1D6E6D63C13C0F30BE6C53726D13F5AA153911B0BE83FB649F6D3CE86F4BFFAE7F0805B5FF6BF3A1472E25FA5F03F9C9943D81F31EC3FAAC9BD8A2560F0BFD233E39854F4C7BF2C934DE21D26ECBF0C90325A59AD0440EA70DC6D11B3F7BFFCC945EDDDC41E402A5E10F9EC85DDBF6FFBC1DADE1DF23F5FC96FB3055FFF3F2597B268EDA0F23F2652624A671300403453A571A8161340C4B4199C460B03C02216400961A0FCBF89B95E0CC8850FC0EED2FDC87DC6B4BF04F0F1C811DB0640F6C779D3951224C076371104EA31D63F104907AD48D0D63F984BF2EA8BC706406545B341510EFFBFDB1417DDC7E5FCBFFC04783FEBAC0B40F47E4641FEE3FEBF921E94FFB63C044080B09EC1A6E105403AFD626B401007C05AB87BEAB748B7BF42D00FF5F8560CC0CCED8D93507EE63FCED9A2595B4E0EC0E960663F126D07C0C9187A0FA3FADA3F6C8A273F6728A9BF70F65F15A562DCBF97C20CF8948CF33FCF0014A5D4DFF2BFD749F66147C9A03F8CB56D8FD2F11240E05ADA7D82DBC83F3C3044288D000EC0491FC15024CFF93FF95077D1A00BE5BF1A8504C8E2E9FA3F43143F04EEF7FB3F7691603A3989E7BFE2D2E2EB084101C0"> : tensor<4x2x3x5xf64>
    %cst_0 = stablehlo.constant dense<[[-2.9341671752263729, 0.75282599271031081, -1.580624585111583], [1.8955907678170321, -1.7244450809756078, -5.0319700986522591], [-0.1536522913150376, -2.7018256071510303, -7.2223317337724051], [0.97537307919867188, -1.4816863865136694, -3.1491353264558937]]> : tensor<4x3xf64>
    return %cst, %cst_0 : tensor<4x2x3x5xf64>, tensor<4x3xf64>
  }
  func.func private @expected() -> (tensor<4x2x3x5xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xB6F8EA3814D606C00A17946EA6170A400451B53797B215C0F654A2DF7343174075C0D4A32C7907C0995AE0014C5904C09F80471B9E3E144042D0F97E53EA044070DACB174BD401C0EE4106DBC773C9BF8931BD8AAB0EF1BFF1CAEBBDEAFD0540B5101F272AF60BC06C7CE393E4F41940D2EC44013D4AF9BF4FEC8170B407CF3FBD569E097EFB0B401ABB864891CAE5BFA404611B1385DC3F5665D3553CFFE0BF63143BFBB7810E40DEBC45B58F32F93F415C43EF071CEBBF3391E447B14302C0346576965E9009C08DF1CC3F529515C0C8B46ED2E4C816402CD6BCA28E340EC0987DA9ACACCFF6BFA423CC2647869D3FBD2C13158E7BD0BF5CFA75EC4C4205C0BCB6E5E122B5C6BF0237095FC487EFBFF4334A4F1FAC0BC0D81EF67B721B03C01CD68102E8AB12C0FEE3606E422508409001341B817A0D40E89CA8B95397FBBFDEBD0F0B02E320C08EE0F894E0BE15C0F74C5DD511EBF2BF53570B7DDB4CF6BF38A500C5BC2014C06F1F3E095C7509C02A5481C1F689F53FB210519DA4F51BC0C3F05E6436900040FE7AE902968E20C01E8B5B12E6DD0140B440C8F981D002C0AB5C13193B0EF23FC17159DF84D3FD3FB451E5A8B492F63F02040D9FA852DC3FB33BA1E62EF0FE3F61B95E6E94DA0B4058F6BB636A1702C0255AD5FEA04111C05E993ABF566CD03F9F491FE9FD6BE13F3E02F614825309404DD4E4AA8CA50FC092A713D7E0AAC3BF8EB1D6E6D63C13C0F30BE6C53726D13F5AA153911B0BE83FB649F6D3CE86F4BF12AC71BE569D05C03A1472E25FA5F03F9C9943D81F31EC3FAAC9BD8A2560F0BFD233E39854F4C7BF6EA915EEAAE31CC00C90325A59AD0440EA70DC6D11B3F7BFFCC945EDDDC41E402A5E10F9EC85DDBF6FFBC1DADE1DF23F5FC96FB3055FFF3F2597B268EDA0F23F2652624A671300403453A571A8161340C4B4199C460B03C02216400961A0FCBF89B95E0CC8850FC0EED2FDC87DC6B4BF04F0F1C811DB0640F6C779D3951224C076371104EA31D63F104907AD48D0D63F984BF2EA8BC706406545B341510EFFBFDB1417DDC7E5FCBFFC04783FEBAC0B40F47E4641FEE3FEBF921E94FFB63C044080B09EC1A6E105403AFD626B401007C05AB87BEAB748B7BF42D00FF5F8560CC0CCED8D93507EE63FCED9A2595B4E0EC06673AEDC6D3109C0C9187A0FA3FADA3F6C8A273F6728A9BF70F65F15A562DCBF97C20CF8948CF33FCF0014A5D4DFF2BFD749F66147C9A03F8CB56D8FD2F11240E05ADA7D82DBC83F3C3044288D000EC0491FC15024CFF93FF95077D1A00BE5BF1A8504C8E2E9FA3F43143F04EEF7FB3F7691603A3989E7BFE2D2E2EB084101C0"> : tensor<4x2x3x5xf64>
    return %cst : tensor<4x2x3x5xf64>
  }
}
