// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<5x6x7xf64> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<[[[0, 1], [2, 3]], [[4, 0], [1, 2]]]> : tensor<2x2x2xi64>
    %0:2 = call @inputs() : () -> (tensor<5x6x7xf64>, tensor<5x2x2xf64>)
    %1 = call @expected() : () -> tensor<5x6x7xf64>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0], inserted_window_dims = [1, 2], scatter_dims_to_operand_dims = [1, 2], index_vector_dim = 2>, unique_indices = true}> ({
    ^bb0(%arg0: tensor<f64>, %arg1: tensor<f64>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f64>
      stablehlo.return %3 : tensor<f64>
    }) : (tensor<5x6x7xf64>, tensor<2x2x2xi64>, tensor<5x2x2xf64>) -> tensor<5x6x7xf64>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<5x6x7xf64>, tensor<5x6x7xf64>) -> ()
    return %2 : tensor<5x6x7xf64>
  }
  func.func private @inputs() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}, tensor<5x2x2xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xD74DF03099B506C072F86E5AB60BF73FB0902D5D4B01104088962A235C7DBCBF540C8020785219C0D70D4CE89BC7FF3FE3C1463B798B19C02F3E430E3F70E4BF7F7C0872B8CE0D4094B7A0BF8F4020C03F8B01B36BDEC83FD47697CD9FF61CC0EED484A7A218F5BF724A6C8689E5FEBFC633002C0F82FFBF8409E5272B7DEFBF621426C0A5B7D83F891624DA35FAE53F664DC7941ABE12400E91926715EE0CC02B682247831AB6BFB436891B8B2412C01A1A66CA1AD7E33F6811ABD20EFDD13F8EE7E2E0BCD603406CFD7AF494500C40BC4255407275FA3F5AC0323E477F1240EC66E12FD58700C0CEF38CFFCF01F03F08515D6A974DFABF1BF651385784C1BF686DF3495708FD3F8C598AD11B38F93F5D48C81FCF5B1340763B1E7DDA6A02409A6C2F39C271E5BF41A9EF752DB5F8BF5C8CEB140EF9F73F5301888E5BC7FA3F4CEE7E180A54FDBF7AA302B0D85AFEBF28DC981111D7EE3FF3EA1F15C0A2FD3FDBF80A130F9C0D404A81060B2B2F0040DAA88D4BBC1F084033A9297C5BE10940704BF1C73842044004E754216622F53F776E66A0A5EDF63FD93F4BD4A91E11C06C3CADF0361503C043739C2DA06A07C02223426CF431FDBFA2A0A614BA3B0F403A35034DF46117402684F69B3C70FF3F452657779A05E43F41F239AC10E20D40AB304197F2430EC0DCC35E7BE31F08C074D9FCFD9842FD3F4F3DBF850345E7BF2E36FF0AE71E08C03473E2E638090F40A6ADF37CBA3BEFBF082A2C51E1A7D73F6050F1F9DF97F93FE3016F7946C917401208E57A30AF0740F89C9947F65708C09599AEDDFE3DCABF5A39A886260CF43F328CF3F79CC201C0A73455FCD54015C0AF78A464F1661640923B1018B402A4BF5FE621145EBBEF3F27E91A0B87D10140EAA723683691F53F88F5856AED6401408338161C2256034096643374426CEC3F64430AB9ABBF0CC0B62F34D9BBFF11C0B117B4F1AC3DF93F388F96F280A90940E93BE91DF78CA2BF6C40E795166111C06EFC085C11F2E23FD218013B6D4221C032B1A0D8E0B608407046DEDA82A0DDBF696CFD40486B14402CFDC9E4C6E5E8BF01D9AE27E719DB3FF7FAA2584E0D0D4060EF80CA756D0AC010D421CF3800EA3F511D98F57E02DCBFA6102FB6C9611240206C2125F1CDFBBFD1392628414E06406CB42B1601C11AC0BAE5886DFEE4FDBF2DFBCF8102A10740E10DA051B853FC3FC2EA6D6A318C02C022DCC0FEF1420A40B221DD2C6325EB3FF160FA6F1527F0BFB838866D65AD0DC0E073BC29D4441540501D9876097B0A4043D9E25F4515F2BFF119C7BFAE0602C04A572F353BF212C0B8B3321FD1C9E9BF9D6EA958C907F33F4C0E5D8632910DC08CE249D91F7ED93F6B701BFE8225FABFF8FF8D8BAD790C401CE963FF05CC0840A2EDD29E36FED33F0A7C6B4F0F3CFDBFCE371339F1D00B409E06A81E8BF6FD3FBA391BE30DA1F2BF067A5F3E0472FD3F5805C5A5E852B5BF8C29DFE0D79C0BC03DBF102D637EF6BFC5A722FAE1C6EE3F7AB24BC6A55317C0ABDDD51F4EB10040D0FCEA8AFAEEEABFD1DB8C34A25A06C083DA650CC44812C064E178D5BBCA04C0F2AAD50C8258EEBF569416D8B66706C033AB20BF9EA1E73F9788CFCF115A14C083080379E4A1F1BFF8E143E38DB5B93F876253AAD8D5FEBF7F184C72C674FD3F2D894731BBF2D63F743DAD5B56B201C02E6CD53A0181D43FDD5B4BAD2689D0BF14689CD7AC2AE23F5D5446BE5A4E12C029B62E5C606305C033D0EA7226800C402691B9B9A5C2F0BF260AE53D0ECEFD3F96D6C7A783241AC0B45FEDAFACE01D40A2F0035649FDFD3F10C9DDAAD67D0D4054C4628B5E2D0BC0A47F7A153A20F5BF80D2117EA4AAFC3F59BDA538BFBF0CC07E7CD8ACFB68F13F4CB5A823C0F81F4059A9E74094A103401E0C39CEE09702405C4CE65B7824074072E3D575D3AEF7BFCA26F2643FA2F23FC9BFCE0E13A4004095D9CD4E1DDFF53FA681749FC847F93F3B7976CAB20E0040296619658614F3BF4AF62A8758EC04C03F87474A79D40AC0B1B5FEE747DDA0BFCC2421DBF3B50BC0F2DC1070FB78F13F6B618B2E8092FBBFD84A1E64EAF5F63FD4E82E51E9B40F40139C53B384D0FBBF1C5065084D880840A861C7BE0260F53FEE367731F6E0EA3FC46957F61824F93F1BD10D853BE50D40684D83ECCBD3F13FF86225BF7BDFF83F26C68F9E3D81F23F3206D6A23E860340A3C977A3176A02C0CCD2C8C9DDF00140F8084659859CF73FCC2DA4AE2AB2EEBF103570C3FC5F1A401AAE5BAFC74001C03FDB9846FB2211C0CE3A7BFAAC3E02C0B103452EF59011404E4FF5E7C777E63FC888C481218611C024AE5139B65EF63FF396C7914CBC09C0"> : tensor<5x6x7xf64>
    %cst_0 = stablehlo.constant dense<[[[-1.4020369602495077, -1.6119943628957176], [-2.631800126295524, -5.7710095634246237]], [[0.5053985176773208, -7.906297735997974], [-4.33380887437169, -2.3667987773121641]], [[0.99318623787458304, -1.8544832986270987], [3.676295064356526, -1.9653990129941949]], [[-2.7303809542920665, 2.5762348629997396], [-0.34782543756372269, -5.852758716029971]], [[2.2171859218312462, 2.6446123105430677], [4.9332245684929426, -3.3994659494911681]]]> : tensor<5x2x2xf64>
    return %cst, %cst_0 : tensor<5x6x7xf64>, tensor<5x2x2xf64>
  }
  func.func private @expected() -> (tensor<5x6x7xf64> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xD74DF03099B506C0D2E0C04EBE6EF6BFB0902D5D4B01104088962A235C7DBCBF540C8020785219C0D70D4CE89BC7FF3FE3C1463B798B19C02F3E430E3F70E4BF7F7C0872B8CE0D4094B7A0BF8F4020C03F8B01B36BDEC83FD47697CD9FF61CC0EED484A7A218F5BF724A6C8689E5FEBFC633002C0F82FFBF8409E5272B7DEFBF621426C0A5B7D83F4E93DF99BACAF9BF664DC7941ABE12400E91926715EE0CC02B682247831AB6BFB436891B8B2412C01A1A66CA1AD7E33F6811ABD20EFDD13F8EE7E2E0BCD603406CFD7AF494500C40BC4255407275FA3F5AC0323E477F124031628039ED0D05C0CEF38CFFCF01F03F08515D6A974DFABF1BF651385784C1BF686DF3495708FD3F8C598AD11B38F93F5D48C81FCF5B1340763B1E7DDA6A02409A6C2F39C271E5BF41A9EF752DB5F8BF5C8CEB140EF9F73F5301888E5BC7FA3F4CEE7E180A54FDBF7AA302B0D85AFEBF28DC981111D7EE3FFEDE1B83392CE03FDBF80A130F9C0D404A81060B2B2F0040DAA88D4BBC1F084033A9297C5BE10940704BF1C73842044004E754216622F53F776E66A0A5EDF63FD93F4BD4A91E11C06C3CADF0361503C043739C2DA06A07C02223426CF431FDBFA2A0A614BA3B0F403A35034DF46117402684F69B3C70FF3F452657779A05E43F583382830CA01FC0AB304197F2430EC0DCC35E7BE31F08C074D9FCFD9842FD3F4F3DBF850345E7BF2E36FF0AE71E08C03473E2E638090F40A6ADF37CBA3BEFBF082A2C51E1A7D73F6050F1F9DF97F93FE3016F7946C91740F7295AFED15511C0F89C9947F65708C09599AEDDFE3DCABF5A39A886260CF43F328CF3F79CC201C0A73455FCD54015C0AF78A464F1661640923B1018B402A4BF5FE621145EBBEF3F27E91A0B87D10140EAA723683691F53F88F5856AED6401408338161C2256034096643374426CEC3F64430AB9ABBF0CC0B62F34D9BBFF11C0B117B4F1AC3DF93F388F96F280A90940E93BE91DF78CA2BF6C40E795166111C06EFC085C11F2E23FD218013B6D4221C032B1A0D8E0B608407569463C4672FFBF696CFD40486B14402CFDC9E4C6E5E8BF01D9AE27E719DB3FF7FAA2584E0D0D4060EF80CA756D0AC010D421CF3800EA3F511D98F57E02DCBF324EE9ADF6ABFDBF206C2125F1CDFBBFD1392628414E06406CB42B1601C11AC0BAE5886DFEE4FDBF2DFBCF8102A10740E10DA051B853FC3FC2EA6D6A318C02C022DCC0FEF1420A40B221DD2C6325EB3FF160FA6F1527F0BFB838866D65AD0DC0E073BC29D4441540501D9876097B0A4043D9E25F4515F2BFF119C7BFAE0602C04A572F353BF212C0B8B3321FD1C9E9BF9D6EA958C907F33F4C0E5D8632910DC08CE249D91F7ED93F6B701BFE8225FABFF8FF8D8BAD790C401CE963FF05CC0840A2EDD29E36FED33F0A7C6B4F0F3CFDBF117242F8D1D705C09E06A81E8BF6FD3FBA391BE30DA1F2BF067A5F3E0472FD3F5805C5A5E852B5BF8C29DFE0D79C0BC03DBF102D637EF6BFC5A722FAE1C6EE3F24E9B294396917C0ABDDD51F4EB10040D0FCEA8AFAEEEABFD1DB8C34A25A06C083DA650CC44812C064E178D5BBCA04C0F2AAD50C8258EEBF569416D8B66706C033AB20BF9EA1E73F9788CFCF115A14C083080379E4A1F1BFF8E143E38DB5B93F876253AAD8D5FEBF7F184C72C674FD3F2D894731BBF2D63F743DAD5B56B201C02E6CD53A0181D43FDD5B4BAD2689D0BF14689CD7AC2AE23F5D5446BE5A4E12C029B62E5C606305C033D0EA7226800C402691B9B9A5C2F0BF260AE53D0ECEFD3F96D6C7A783241AC0B45FEDAFACE01D40A2F0035649FDFD3F10C9DDAAD67D0D4054C4628B5E2D0BC0A47F7A153A20F5BF80D2117EA4AAFC3F59BDA538BFBF0CC07E7CD8ACFB68F13F4CB5A823C0F81F40A355FBF8CBBC01401E0C39CEE09702405C4CE65B7824074072E3D575D3AEF7BFCA26F2643FA2F23FC9BFCE0E13A4004095D9CD4E1DDFF53FA681749FC847F93FF57027341B320BC0296619658614F3BF4AF62A8758EC04C03F87474A79D40AC0B1B5FEE747DDA0BFCC2421DBF3B50BC0F2DC1070FB78F13F6B618B2E8092FBBFD84A1E64EAF5F63FD4E82E51E9B40F40139C53B384D0FBBF1C5065084D880840A861C7BE0260F53FEE367731F6E0EA3FC46957F61824F93F1BD10D853BE50D40684D83ECCBD3F13FF86225BF7BDFF83F26C68F9E3D81F23F3206D6A23E860340A3C977A3176A02C0CCD2C8C9DDF00140F8084659859CF73FCC2DA4AE2AB2EEBF103570C3FC5F1A401AAE5BAFC74001C03FDB9846FB2211C0CE3A7BFAAC3E02C0B103452EF59011404E4FF5E7C777E63FC888C481218611C024AE5139B65EF63FF396C7914CBC09C0"> : tensor<5x6x7xf64>
    return %cst : tensor<5x6x7xf64>
  }
}
