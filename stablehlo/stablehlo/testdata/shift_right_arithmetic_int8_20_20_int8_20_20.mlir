// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<20x20xi8> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %0:2 = call @inputs() : () -> (tensor<20x20xi8>, tensor<20x20xi8>)
    %1 = call @expected() : () -> tensor<20x20xi8>
    %2 = stablehlo.shift_right_arithmetic %0#0, %0#1 : tensor<20x20xi8>
    stablehlo.custom_call @check.expect_eq(%2, %1) {has_side_effect = true} : (tensor<20x20xi8>, tensor<20x20xi8>) -> ()
    return %2 : tensor<20x20xi8>
  }
  func.func private @inputs() -> (tensor<20x20xi8> {mhlo.layout_mode = "default"}, tensor<20x20xi8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x03FD03FF0301020202FE0003FAFF0104FDFD0204FE0005FD0200010100FEFE03FF05FF00FF0204FE00FF000401FE00FC00FE04010301FE0302000400040203060100FF00FC0100FC07FF01FDFC0A05020000FF03010100010103FCFBFF010001FE010000FE0100FD01FFFEFA0400010201FEFF0302060605FFFEFF0001000200040000FEFDFFFE03030400000101000100FE01FEFE0200020100FEFE04000005FE0301FF0400FE000300FD0404FFFF04FA030200FEFB000100FB010500040002FE0001FF02FFFAFD00FDFF05000000FBFE0000FEFCFEFF030101FFFBFD00FFFDFC00040200FFFF0006FF03FC000002FE000001F9FC00FF00020200FF0002FC03FFFE040200FF00000500FFFE04020002FF0201FF000105000606FC0000FD010602FDFD040105FEFF000003FE02FF00FC00FCFFFE00FCFCFC06FFFC0300FB00FE0200FFFF03FEFA04FA03FA02FE00020200FCFE00FFFE04000000FD050000000304000101040001FD0100030300FEFDFFFC03FE0100FEF6FF00FF0001FB00FD0000FF0000FC0000030300FB0000000203"> : tensor<20x20xi8>
    %c_0 = stablehlo.constant dense<"0xFE02000302FF02010002FE00FF0104FDFD03FDFFF900FF06FD03FF03FDFEFB0000FE00FCFDFFFF05000000010103FEFB030400FEFA03FF000003010200FF00000302FB0400FC000300FE01000200FC000408FE00FCFE00030500FD02FCFC030006FF0002060000060004010103000101FC01020001FFFFFCFC000200F9FE0004FE01FC0000FF00FF0001FE0000000504FDFD0000FFFDFE0502020500030202040100FBFE000104FFFFFAFAFDFD00000402FEFF00FE01050201FD0000000000FE010005010206FE02FC030101FC010100FE0001FC0003FFFF00FDFB030001030200FE000000FF000000FFFF01040002000300FF0001FB00020300010300000200F700FC0200FF000209FFFFFF0A01000003FFFFFA00FCFF000001FEFFFBF9FEFC0104FD06FE05FF0000FF00000000000001FB04FC000001000100FD000300FCFDFFFDFDFEFF020000FD0000FFFD0100FFFEFE00030000FDFE00FF00FF00000002FD0205000200FBFE050000FE01FE000000FCFF0000FEFD01FDFF040100000000FF0300FFFF02FEFD010201000002FF01"> : tensor<20x20xi8>
    return %c, %c_0 : tensor<20x20xi8>, tensor<20x20xi8>
  }
  func.func private @expected() -> (tensor<20x20xi8> {mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<"0x00FF03FF0000000102FF0003FFFF0000FFFF0000FF0000FF0000000000FFFF03FF00FF00FF0000FF00FF000200FF00FF00FF04000000FF0302000200040003060000FF00FC0000FF07FF00FDFF0A00020000FF03000000000003FFFEFF000001FF000000FF0100FF01FFFFFD0000000100FFFF0301000000FFFEFF0000000200000000FEFDFFFE00030200000101000000FF01FEFF0000000000FFFE00000000FF0300FF0400FF000000FF0000FFFF00FE000000FFFD000000FF010500040000FF0000FF00FFFFFF00FFFF02000000FBFF0000FFFCFFFF000100FFFFFD00FFFFFC00040200FFFF0006FF00FE000000FE000000F9FE00FF00000200FF0002FF03FFFE000000FF00000000FFFF00010002FF0000FF000000000603FF0000FF000001FFFF000000FFFF000003FE02FF00FC00FFFFFF00FCFEFC03FFFF0300FB00FF0000FFFF00FFFA04FF03FA00FF00020000FFFE00FFFE00000000FD000000000000000001010000FF0000030000FFFDFFFC00FF0100FFFFFF00FF0000FB00FD0000FF0000FF0000000100FD0000000001"> : tensor<20x20xi8>
    return %c : tensor<20x20xi8>
  }
}
