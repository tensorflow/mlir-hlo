// RUN: stablehlo-opt -inline %s | stablehlo-translate --interpret
// RUN: stablehlo-translate --serialize --target=current %s | stablehlo-translate --deserialize | stablehlo-opt > %t.0
// RUN: stablehlo-opt %s > %t.1
// RUN: diff %t.0 %t.1

module @jit_main attributes {mhlo.num_partitions = 1 : i32, mhlo.num_replicas = 1 : i32} {
  func.func public @main() -> (tensor<3x5x40xf16> {jax.result_info = "", mhlo.layout_mode = "default"}) {
    %c = stablehlo.constant dense<1> : tensor<2x1xi64>
    %0:2 = call @inputs() : () -> (tensor<3x5x40xf16>, tensor<3x5x2xf16>)
    %1 = call @expected() : () -> tensor<3x5x40xf16>
    %2 = "stablehlo.scatter"(%0#0, %c, %0#1) <{scatter_dimension_numbers = #stablehlo.scatter<update_window_dims = [0, 1], inserted_window_dims = [2], scatter_dims_to_operand_dims = [2], index_vector_dim = 1>}> ({
    ^bb0(%arg0: tensor<f16>, %arg1: tensor<f16>):
      %3 = stablehlo.minimum %arg0, %arg1 : tensor<f16>
      stablehlo.return %3 : tensor<f16>
    }) : (tensor<3x5x40xf16>, tensor<2x1xi64>, tensor<3x5x2xf16>) -> tensor<3x5x40xf16>
    stablehlo.custom_call @check.expect_close(%2, %1) {has_side_effect = true} : (tensor<3x5x40xf16>, tensor<3x5x40xf16>) -> ()
    return %2 : tensor<3x5x40xf16>
  }
  func.func private @inputs() -> (tensor<3x5x40xf16> {mhlo.layout_mode = "default"}, tensor<3x5x2xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xCDC31F3FCD41832E0F4248350B4638C46C3F36C48EC113C863C26BBE02390BC367BFA63D703A93C062C8563F6DC5AB3FADB68E405D3D8041AA411B42693714BBE7C5FE3F50BCFBB64440324442B9AEBC7BB3D6C11C441B443EBD9BB44B30533EDDC437442DC4B9C15FBD13C24ABFF43C25C2663EBFC32C3D623752C6A7360B454440674798A9E31FF3C270C4C1C2E0BC74BD203930C428456F41B9B7A0BFA134B73092C577451A35BC3E93409C45E63968C44E3F74BA2F4357C417B65D42E1C434BC4BBD123AA5BFA24383C0C2BFEDC07D42E0BECF3D944286B972359EB4E6C59643DB3C9CB646C11FBC9FB2423D5CBCAC44D3B15B40E0C3183DF94002C4BB3A2CC03ABF01B735B5CFB72047F43EE3441339C5C24FBB0AC277B888BCC838EA44E5C9D33973BCA53E2C4219BAE5416141163CCDC1F2C23E3F4F452645E6C37BC0293F4C3DD8427B3DDAC84F401EC0A73FABB74ABF01BD11BDF3C1D1C33BC5EC404142193042AE6FC085296D2223B875C3774493C46838FB4199AEEA457DC5EFB919C6B03F52C590C591B925BC7C401CAB72263337C53B9DB70EBA98C18DC086B7D63944C26C424BC398C41EBF8C3E0AC038443CB329C53E3D8D400ABAC6C33D4192C041374B3EDA3A30C0F53BAEC1173F112EA2C177B421C434423640E93D79356E38F841D9C10698AFC1D7C2853D96B808BDF5418937B3BDD0C062BEABBD88475CC3B4BCD7AAF0C1B8453042B8425DC417C099BDEB4486BC7FC4673799C09943EE4381C5B8C1D5B2A73110C335455F40BAC3D5C2D241A1C669B06DC02F44C7BB99BE5DBB7CBE22BED933AB3D9244A0C192BE9CC03A46EEC31FC6B8C31F3D2AC65F42B4C2263ED33942BA60C169B80D44844424C1A6C0EFBEECC53744043D9B444846B5BE6D420F332942E73D3EB2E0C39D40123F51C4373DAAC1CF3F47C2CDC08D3BCE436EC39E41DC4312BE0FC030458D3BA23E3A463740863E7FBD953EA4449341EC38163C294404422B3D13432428C0BD83C96344E440F6426CC10CC35FC1793DE036BBC046BFF93884BB7BBC37342342CC4178BA154640C23844A43F9F4076B854BBA5C58CC196455C3D33BE703C5841C9C12038D8457E3C77C32F4270C0B5BB5BC03FBD1C439E385E4106BA444410C992C651B8223F80349744933EB63FB93B3B43123D452B5ABC7C4160C503C105363C42FA3A8B398D2CF9BDC940243EB5BA9443A7B52C3C0A3EA1B47F436343DFC03D435D38C036A8C213443C3F1C44BE3B05C1093932B8F1C44D41EB434EC68AB839BC55436A45F53972BBAFBA2E384E3CE04414BBCF3FE7B86CC5A03FF4B0633F574049413E42453DAA46BEBAB439CC2C7A3A0445B43E11291AC4E8BCC4B11AC4523FDEC714C5F635BD405EB82BC214C915BD48BD82BF973BAB44CB400CBCA5C1F73ED5B755C35147D1C11446A1C360C3AF43EA35FCC5A7BEB9C0B0411542D4C0A7C337B10B413C4099445845A63DD6325540C9BDF6BEEF3D6E485A41AA3A3CBAEA4430AFB14561B3CBC3DFBEF4AFF140ED440FBDE33FA9B943C22FC1BB39B444DD3C1AADEC3E38C156BA6EC5EAC073BB0C3D1445A5B40E3B3EC49F3FCD3FECBEDA3464C394BF4342B8C46143F8C40BC4D9C1E4BE4EC024B292BFEF41D0441045023D11485C401FB2E0C164BF4BC5D5BF7244A42A263C0E41B1BD0F3F6244"> : tensor<3x5x40xf16>
    %cst_0 = stablehlo.constant dense<[[[9.736320e-01, 6.105460e+00], [-1.363280e+00, -1.515630e+00], [-8.793940e-01, -4.210940e+00], [-1.010740e+00, -6.396480e-01], [1.104490e+00, 1.270510e+00]], [[6.890630e+00, -5.597650e+00], [3.039060e+00, 4.656250e+00], [-2.897950e-01, -8.950190e-01], [-9.121090e-01, 1.915040e+00], [-3.089840e+00, 1.289060e+00]], [[2.425780e+00, -1.012700e+00], [4.128420e-01, -1.425780e+00], [-7.319330e-01, 2.927730e+00], [-9.472650e-01, -1.171880e+00], [4.852290e-03, -3.390630e+00]]]> : tensor<3x5x2xf16>
    return %cst, %cst_0 : tensor<3x5x40xf16>, tensor<3x5x2xf16>
  }
  func.func private @expected() -> (tensor<3x5x40xf16> {mhlo.layout_mode = "default"}) {
    %cst = stablehlo.constant dense<"0xCDC3CA3BCD41832E0F4248350B4638C46C3F36C48EC113C863C26BBE02390BC367BFA63D703A93C062C8563F6DC5AB3FADB68E405D3D8041AA411B42693714BBE7C5FE3F50BCFBB64440324442B9AEBC7BB3D6C11C441B443EBD9BB44B30533EDDC437442DC4B9C15FBD13C24ABFF43C25C2663EBFC32C3D623752C6A7360B454440674798A9E31FF3C270C4C1C2E0BC74BD203930C428456F41B9B7A0BFA134B73092C577451A35BC3E93409C45E63968C44E3F74BA2F4357C417B65D42E1C434BC4BBD123AA5BFA24383C0C2BFEDC07D42E0BECF3D944286B972359EB4E6C59643DB3C9CB646C11FBC9FB2423D5CBCAC440BBC5B40E0C3183DF94002C4BB3A2CC03ABF01B735B5CFB72047F43EE3441339C5C24FBB0AC277B888BCC838EA44E5C9D33973BCA53E2C4219BAE5416141163CCDC1F2C23E3F4F452645E6C37BC0293F6B3CD8427B3DDAC84F401EC0A73FABB74ABF01BD11BDF3C1D1C33BC5EC404142193042AE6FC085296D2223B875C3774493C46838FB4199AEEA457DC5EFB919C6B03F52C590C591B925BC7C401CAB722699C5C53B9DB70EBA98C18DC086B7D63944C26C424BC398C41EBF8C3E0AC038443CB329C53E3D8D400ABAC6C33D4192C041374B3EDA3A30C0F53BAEC1173F112EA2C177B421C434423640E93D79356E38F841D9C10698AFC1D7C2853D96B808BDF5418937B3BDD0C062BEABBD88475CC3B4BCD7AAF0C1B8453042B8425DC417C099BDEB4486BC7FC4673799C09943EE4381C5B8C1D5B2A73110C335455F40BAC3D5C2D241A1C669B06DC02F44C7BB99BE5DBB7CBE22BED933AB3D9244A0C192BE9CC03A46EEC31FC6B8C31F3D2AC65F42B4C2263ED33942BA60C169B80D44844424C1A6C0EFBEECC53744043D9B444846B5BE6D420F332942E73D3EB2E0C39D40123F51C4373DAAC1CF3F47C2CDC08D3BCE436EC39E41DC4312BE0FC030458D3BA23E3A463740863E7FBD953EA4449341EC38163C294404422B3D13432428C0BD83C96344E440F6426CC10CC35FC1793DE036BBC046BFF93884BB7BBC37342342CC4178BA154640C23844A43F9F4076B854BBA5C58CC196455C3D33BE703C5841C9C12038D8457E3C77C32F4270C0B5BB5BC03FBD1C439E385E4106BA444410C992C651B8223F80349744933EB63FB93B3B43123D452B5ABC7C4160C503C105363C42FA3A8B398D2CF9BDC940243EB5BA9443A7B52C3C0A3EA1B47F436343DFC0B4BD5D38C036A8C213443C3F1C44BE3B05C1093932B8F1C44D41EB434EC68AB839BC55436A45F53972BBAFBA2E384E3CE04414BBCF3FE7B86CC5A03FF4B0633F574049413E42453DAA46BEBAB439CC2CDBB90445B43E11291AC4E8BCC4B11AC4523FDEC714C5F635BD405EB82BC214C915BD48BD82BF973BAB44CB400CBCA5C1F73ED5B755C35147D1C11446A1C360C3AF43EA35FCC5A7BEB9C0B0411542D4C0A7C337B10B413C4099445845A63DD6325540C9BDF6BEEF3D6E485A41AA3A3CBAEA4430AFB14561B3CBC3DFBEF4AFF140ED440FBDE33FA9B943C22FC1BB39B444DD3C1AADEC3E38C156BA6EC5EAC073BBC8C21445A5B40E3B3EC49F3FCD3FECBEDA3464C394BF4342B8C46143F8C40BC4D9C1E4BE4EC024B292BFEF41D0441045023D11485C401FB2E0C164BF4BC5D5BF7244A42A263C0E41B1BD0F3F6244"> : tensor<3x5x40xf16>
    return %cst : tensor<3x5x40xf16>
  }
}
